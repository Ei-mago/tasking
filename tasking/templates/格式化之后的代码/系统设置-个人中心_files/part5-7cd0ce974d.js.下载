+function(){"use strict";angular.module("eweiApp.statistics",["eweiApp.common","ui.router","ui.bootstrap"])}();+function(){"use strict";angular.module("eweiApp.statistics").config(e);e.$inject=["$stateProvider","$urlRouterProvider"];function e(e,t){e.state("statistics",{url:"/statistics",controller:"StatisticsController",templateUrl:"source/statistics/statistics.view.html",permission:["statistics_engineer_performance","statistics_ticket_statistics","statistics_chat_statistics","statistics_customer_statistics","service_report","ticket_performance_statistics","ticket_distributed_statistics","customer_analyze_statistics"]}).state("statistics.engineer",{url:"/engineer",controller:"StatisticsEngineerRootController",templateUrl:"source/statistics/engineer/engineer.view.html",permission:"statistics_engineer_performance",onEnter:a("statistics")}).state("statistics.engineer.quantityServiceDesk",{url:"/quantity-serviceDesk",controller:"StatisticsQuantityServiceDeskController",templateUrl:"source/statistics/engineer/ticket/engineer.quantityServiceDesk.view.html",permission:"statistics_engineer_performance",onEnter:a("statistics-engineer"),params:{scene:"ticket"}}).state("statistics.engineer.quantityServiceDeskDetail",{url:"/quantity-serviceDesk",controller:"StatisticsQuantityServiceDeskDetailController",params:{params:null},templateUrl:"source/statistics/engineer/ticket/engineer.quantityServiceDesk.detail.view.html"}).state("statistics.engineer.qualityServiceDesk",{url:"/quality-serviceDesk",controller:"StatisticsQualityServiceDeskController",templateUrl:"source/statistics/engineer/ticket/engineer.qualityServiceDesk.view.html",permission:"statistics_engineer_performance",onEnter:a("statistics-engineer"),params:{scene:"ticket"}}).state("statistics.engineer.qualityServiceDeskDetail",{url:"/quality-serviceDesk",controller:"StatisticsQualityServiceDeskDetailController",params:{params:null},permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/ticket/engineer.qualityServiceDesk.detail.view.html"}).state("statistics.engineer.quantityEngineer",{url:"/quantity-engineer",controller:"StatisticsQuantityEngineerController",permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/ticket/engineer.quantityEngineer.view.html",onEnter:a("statistics-engineer"),params:{scene:"ticket"}}).state("statistics.engineer.quantityEngineerDetail",{url:"/quantity-engineer",controller:"StatisticsQuantityEngineerDetailController",params:{params:null},permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/ticket/engineer.quantityEngineer.detail.view.html"}).state("statistics.engineer.qualityEngineer",{url:"/quality-engineer",controller:"StatisticsQualityEngineerController",permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/ticket/engineer.qualityEngineer.view.html",onEnter:a("statistics-engineer"),params:{scene:"ticket"}}).state("statistics.engineer.qualityEngineerDetail",{url:"/quality-engineer",controller:"StatisticsQualityEngineerDetailController",params:{params:null},permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/ticket/engineer.qualityEngineer.detail.view.html"}).state("statistics.engineer.chat_quantity",{url:"/chat-quantity",controller:"StatisticsEngineerChatQuantityController",permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/engineer.chat.quantity.view.html",onEnter:a("statistics-engineer"),params:{scene:"chat"}}).state("statistics.engineer.chat_quality",{url:"/chat-quality",controller:"StatisticsEngineerChatQualityController",permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/engineer.chat.quality.view.html",onEnter:a("statistics-engineer"),params:{scene:"chat"}}).state("statistics.engineer.chat_quality_detail",{url:"/chat-quality",controller:"StatisticsEngineerChatQualityDetailController",permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/engineer.chat.quality.detail.view.html",params:{params:null}}).state("statistics.engineer.evaluate",{url:"/evaluate-ticket",controller:"StatisticsEngineerEvaluateController",permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/ticket/engineer.evaluate.view.html",onEnter:a("statistics-engineer"),params:{scene:"ticket"}}).state("statistics.engineer.evaluateChat",{url:"/evaluate-chat",controller:"StatisticsEngineerEvaluateChatController",permission:"statistics_engineer_performance",templateUrl:"source/statistics/engineer/engineer.evaluate.chat.view.html",onEnter:a("statistics-engineer"),params:{scene:"chat"}}).state("statistics.customer",{url:"/customer",controller:"StatisticsCustomerRootController",templateUrl:"source/statistics/customer/customer.view.html",permission:"statistics_customer_statistics",onEnter:a("statistics")}).state("statistics.customer.customerGroup",{url:"/group",controller:"StatisticsCustomerGroupController",templateUrl:"source/statistics/customer/customer.customerGroup.view.html",permission:"statistics_customer_statistics",onEnter:a("statistics-customer")}).state("statistics.customer.customerGroupDetail",{url:"/group",controller:"StatisticsCustomerGroupDetailController",params:{params:null},permission:"statistics_customer_statistics",templateUrl:"source/statistics/customer/customer.customerGroup.detail.view.html"}).state("statistics.customer.customer",{url:"/customer",controller:"StatisticsCustomerController",templateUrl:"source/statistics/customer/customer.customer.view.html",permission:"statistics_customer_statistics",onEnter:a("statistics-customer")}).state("statistics.customer.customerDetail",{url:"/customer",controller:"StatisticsCustomerDetailController",params:{params:null},templateUrl:"source/statistics/customer/customer.customer.detail.view.html",permission:"statistics_customer_statistics",onEnter:a("statistics-customer")}).state("statistics.customer.evaluate",{url:"/evaluate",controller:"StatisticsCustomerEvaluateController",templateUrl:"source/statistics/customer/customer.evaluate.view.html",permission:"statistics_customer_statistics",onEnter:a("statistics-customer")}).state("statistics.customer.evaluateDetail",{url:"/evaluate",controller:"StatisticsCustomerEvaluateDetailController",templateUrl:"source/statistics/customer/customer.evaluate.detail.view.html",params:{params:null},permission:"statistics_customer_statistics",onEnter:a("statistics-customer")}).state("statistics.ticket",{url:"/ticket",controller:"StatisticsTicketController",templateUrl:"source/statistics/ticket/ticket.view.html",permission:"statistics_ticket_statistics",onEnter:a("statistics")}).state("statistics.ticket.quantity",{url:"/quantity",controller:"StatisticsTicketQuantityController",templateUrl:"source/statistics/ticket/ticket.quantity.view.html",permission:"statistics_ticket_statistics",onEnter:a("statistics-ticket")}).state("statistics.ticket.quantityDetail",{url:"/quantity",controller:"StatisticsTicketQuantityDetailController",templateUrl:"source/statistics/ticket/ticket.quantity.detail.view.html",params:{params:null,queryParams:null},permission:"statistics_ticket_statistics"}).state("statistics.ticket.quality",{url:"/quality",controller:"StatisticsTicketQualityController",templateUrl:"source/statistics/ticket/ticket.quality.view.html",permission:"statistics_ticket_statistics",onEnter:a("statistics-ticket")}).state("statistics.ticket.type",{url:"/type",controller:"StatisticsTicketTypeController",templateUrl:"source/statistics/ticket/ticket.type.view.html",permission:"statistics_ticket_statistics",onEnter:a("statistics-ticket")}).state("statistics.ticket.typeDetail",{url:"/type",controller:"StatisticsTicketTypeDetailController",templateUrl:"source/statistics/ticket/ticket.type.detail.view.html",params:{item:null,queryParams:null},permission:"statistics_ticket_statistics"}).state("statistics.ticket.priority",{url:"/priority",controller:"StatisticsTicketPriorityController",templateUrl:"source/statistics/ticket/ticket.priority.view.html",permission:"statistics_ticket_statistics",onEnter:a("statistics-ticket")}).state("statistics.ticket.priorityDetail",{url:"/priority",controller:"StatisticsTicketPriorityDetailController",templateUrl:"source/statistics/ticket/ticket.priority.detail.html",params:{item:null},permission:"statistics_ticket_statistics",onEnter:a("statistics-ticket")}).state("statistics.ticket.channel",{url:"/channel",controller:"StatisticsTicketChannelController",templateUrl:"source/statistics/ticket/ticket.channel.view.html",permission:"statistics_ticket_statistics",onEnter:a("statistics-ticket")}).state("statistics.ticket.channelDetail",{url:"/channel",controller:"StatisticsTicketChannelDetailController",templateUrl:"source/statistics/ticket/ticket.channel.detail.view.html",params:{params:null},permission:"statistics_ticket_statistics"}).state("statistics.ticket.workflow",{url:"/workflow",controller:"StatisticsTicketWorkflowController",templateUrl:"source/statistics/ticket/ticket.workflow.view.html",permission:"statistics_ticket_statistics",onEnter:a("statistics-ticket")}).state("statistics.ticket.workflowDetail",{url:"/workflow",controller:"StatisticsTicketWorkflowDetailController",templateUrl:"source/statistics/ticket/ticket.workflow.detail.view.html",permission:"statistics_ticket_statistics",params:{item:null},onEnter:a("statistics-ticket")}).state("statistics.ticket.serviceCatalog",{url:"/service_catalog",controller:"StatisticsTicketServiceCatalogController",templateUrl:"source/statistics/ticket/ticket.serviceCatalog.view.html",permission:"statistics_ticket_statistics",onEnter:a("statistics-ticket")}).state("statistics.chat",{url:"/chat",controller:"StatisticsChatRootController",templateUrl:"source/statistics/chat/chat.view.html",permission:"statistics_chat_statistics",onEnter:a("statistics")}).state("statistics.chat.quantity",{url:"/quantity",controller:"StatisticsChatQuantityController",templateUrl:"source/statistics/chat/chat.quantity.view.html",permission:"statistics_chat_statistics",onEnter:a("statistics-chat")}).state("statistics.chat.quantityDetail",{url:"/quantity",controller:"StatisticsChatQuantityDetailController",templateUrl:"source/statistics/chat/chat.quantity.detail.view.html",params:{params:null},permission:"statistics_chat_statistics"}).state("statistics.chat.quality",{url:"/quality",controller:"StatisticsChatQualityController",templateUrl:"source/statistics/chat/chat.quality.view.html",permission:"statistics_chat_statistics",onEnter:a("statistics-chat")}).state("statistics.chat.channel",{url:"/channel",controller:"StatisticsChatChannelController",templateUrl:"source/statistics/chat/chat.channel.view.html",permission:"statistics_chat_statistics",onEnter:a("statistics-chat")}).state("statistics.chat.channelDetail",{url:"/channel",controller:"StatisticsChatChannelDetailController",templateUrl:"source/statistics/chat/chat.channel.detail.view.html",params:{params:null},permission:"statistics_chat_statistics"}).state("statistics.chat.serviceCatalog",{url:"/service_catalog",controller:"StatisticsChatServiceCatalogController",templateUrl:"source/statistics/chat/chat.serviceCatalog.view.html",permission:"statistics_chat_statistics",onEnter:a("statistics-chat")}).state("statistics.ticket.sla",{url:"/sla",controller:"StatisticsTicketSlaController",templateUrl:"source/statistics/ticket/ticket.sla.view.html",permission:"statistics_ticket_statistics",onEnter:a("statistics-ticket")}).state("statistics.ticket.slaDetail",{url:"/sla",controller:"StatisticsTicketSlaDetailController",templateUrl:"source/statistics/ticket/ticket.sla.detail.html",params:{item:null},permission:"statistics_ticket_statistics"}).state("statistics.ticket.slaTicket",{url:"/sla",controller:"StatisticsTicketSlaTicketController",templateUrl:"source/statistics/ticket/ticket.sla.ticket.html",params:{routeFather:null,item:null,type:null},onEnter:a("statistics-ticket")}).state("statistics.serviceReport",{url:"/service_report",templateUrl:"/source/statistics/service-report/service-report.view.html",controller:"StatisticsServiceReportController",permission:"service_report",onEnter:a("statistics")}).state("statistics.serviceReportDetail",{url:"/service_report/:type/:id",controller:"StatisticsServiceReportDetailController as vm",templateUrl:"/source/statistics/service-report/service-report.detail.view.html",permission:"service_report",params:{dateFrom:null,dateTo:null},onEnter:a("statistics"),resolve:{reportData:["$stateParams","$q","apiRestfulService","apiServiceReportService",function(t,e,a,i){void 0;var r=e.defer();function n(){var e=a.run({url:"/api/v1/service_report/show_report.json",urlParam:{type:t.type,targetId:t.id,beginTime:t.dateFrom,endTime:t.dateTo}});e.get(null,function(e){if(e.status==0){r.resolve(e.result)}else{r.reject()}},r.reject)}if(!t.dateFrom||!t.dateTo){i.getDateRange().then(function(e){t.dateFrom=e.beginTime;t.dateTo=e.endTime;n()})}else{n()}return r.promise}]}})}function a(i){e.$inject=["$state","$stateParams","coreModelService"];function e(e,t,a){a.config.route.put(i,{name:this.name,params:t,permission:this.permission||""})}return e}}();+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsController",e);e.$inject=["$rootScope","$scope","$state","$location","permissions","coreModelService","ConsoleConfig"];function e(e,s,t,a,i,r,n){s.dateFormat="YYYY/MM/DD";var o=moment(new Date("2017/08/01"));s.minRangeDate=o.clone();s.maxRangeDate=moment();var l=moment();var c;try{c=JSON.parse(sessionStorage.getItem("statistics.daterange"));c.startDate=moment(c.startDate);c.endDate=moment(c.endDate)}catch(e){}if(c){s.dateRange=c}else{s.dateRange={startDate:l.clone().subtract(6,"days").endOf("day"),endDate:l.clone().endOf("day")}}if(s.dateRange.startDate<o){s.dateRange.startDate=o.clone()}s.$broadcast("statistics.datarange.changed",{startDate:s.dateRange.startDate.format(s.dateFormat),endDate:s.dateRange.endDate.format(s.dateFormat)});s.nextRange=function(){if(s.dateRangeSelectroDisabled)return;var e=s.dateRange.endDate-s.dateRange.startDate;var t=s.dateRange.endDate.clone().add(1,"days").startOf("day");var a={startDate:t.clone(),endDate:t.clone().add(e)};if(a.startDate<o){a.startDate=o.clone();a.endDate=moment(a.startDate).add(e)}if(a.endDate.isAfter(s.maxRangeDate.endOf("day"))){a.startDate=s.maxRangeDate.clone().add(1,"days").startOf("day").subtract(e);a.endDate=s.maxRangeDate.clone()}s.dateRange=a};s.prevRange=function(){if(s.dateRangeSelectroDisabled)return;var e=s.dateRange.endDate-s.dateRange.startDate;var t=s.dateRange.startDate.clone().subtract(1,"days").endOf("day");var a={startDate:t.clone().subtract(e),endDate:t.clone()};if(a.startDate.isAfter(s.maxRangeDate)){a.startDate=s.maxRangeDate.clone().endOf("day").subtract(e)}if(a.startDate<o){a.startDate=o.clone();a.endDate=moment(a.startDate).add(e)}s.dateRange=a};s.$watch("dateRange",function(e,t){if(e!==t){void 0;void 0;var a={startDate:s.dateRange.startDate.clone(),endDate:s.dateRange.endDate.clone()};s.$broadcast("statistics.datarange.changed",a);try{sessionStorage.setItem("statistics.daterange",JSON.stringify(a))}catch(e){}}},true);s.$location=a;s.hideOldVersionSwitch=false;s.hideDateRangeSelector=t.current.name.endsWith("Detail")||t.current.name.indexOf("serviceReport")>-1;if(n.provider.createdAt){var u=moment(n.provider.createdAt);if(u.isAfter("2017-07-03")){s.hideOldVersionSwitch=true}}s.$on("$stateChangeStart",function(e,t,a,i,r,n){if(t&&t.name.startsWith("statistics.")){if(t.name.indexOf("serviceReport")>-1){s.hideDateRangeSelector=true}else{s.hideDateRangeSelector=false}if(t.name.toLowerCase().endsWith("detail")){s.dateRangeSelectroDisabled=true}else{s.dateRangeSelectroDisabled=false}}});s.$on("$destroy",function(){void 0});function d(){if(i.hasPermission("statistics_engineer_performance")){t.go("statistics.engineer")}else if(i.hasPermission("statistics_ticket_statistics")){t.go("statistics.ticket")}else if(i.hasPermission("statistics_chat_statistics")){t.go("statistics.chat")}else if(i.hasPermission("statistics_customer_statistics")){t.go("statistics.customer")}else if(i.hasPermission("service_report")){t.go("statistics.serviceReport")}else if(i.anyPermissions(["ticket_performance_statistics","ticket_distributed_statistics","customer_analyze_statistics"])){t.go("chart")}else{t.go("unauthorized")}}var f=r.config.route.get("statistics");if(f){if(f.permission){if(i.hasPermission(f.permission)){return t.go(f.name,f.params)}else{d()}}else{return t.go(f.name,f.params)}}else{d()}}}();+function(){"use strict";angular.module("eweiApp.statistics").service("echartPieColor",e);e.$inject=[];function e(){return{"sla.rate.total":["#45AEEA","#C0E3F7"],"sla.rate.response":["#D2D558","#F8F9B6"],"sla.rate.solve":["#D43A43","#F4BCBF"],"customer.evaluate.rate":["#4B253A","#D3B6C6"],"customer.evaluate.avgScore":["#EFB917","#FCE6A4"],"customer.evaluate.avgLoyalty":["#D2D558","#F8F9B6"],"customer.evaluate.avgRecommend":["#D43A43","#F4BCBF"],"menggang.kpi.kpi":["#4B253A","#D3B6C6"],"menggang.kpi.ticketCount":["#4B253A","#D3B6C6"],"menggang.kpi.responseTimeoutCount":["#EFB917","#FCE6A4"],"menggang.kpi.solveTimeoutCount":["#45AEEA","#BEE3F7"],"menggang.kpi.evaluateGoodCount":["#D2D558","#F8F9B6"],"menggang.kpi.evaluateBadCount":["#D43A43","#F4BCBF"]}}}();+function(){"use strict";angular.module("eweiApp.statistics").service("StatisticsBreadcrumbService",e);e.$inject=["$state"];function e(t){var i=[];return{push:function(e){if(e){i.push(e)}},pop:function(e){if(e&&angular.isNumber(e)){var t=[];for(var a=0;a<e;a++){t.push(i.pop())}return t}else{return i.pop()}},items:i,splice:i.splice,clear:function(){i.splice(0,i.length)},goto:function(e){if(e&&e.url){t.go(e.url,e.params)}}}}}();+function(a){"use strict";angular.module("eweiApp.statistics").factory("allConditionOptionsTicketReport",[function(){var e=[{option:"请选择",value:"-1"},{option:"工单 : 状态",value:"status",valueType:"select"},{option:"工单 : 处理人",value:"engineer.id",valueType:"engineer"},{option:"工单 : 创建人",value:"user.id",valueType:"user"},{option:"工单 : 抄送给",value:"id",valueType:"copyTo"},{option:"工单 : 客服组",value:"serviceDesk.id",valueType:"serviceDesk"},{option:"工单 : 客户",value:"requester.id",valueType:"requester"},{option:"工单 : 解决否",value:"evaluate.solved",valueType:"select"},{option:"工单 : 客户组",value:"requester.userGroup.id",valueType:"userGroup"},{option:"工单 : 渠道",value:"via.channel",valueType:"via"},{option:"工单 : 服务评价",value:"evaluate.score",valueType:"select"},{option:"工单 : 创建以来小时数",value:"createdAt",valueType:"number"},{option:"工单 : 处理中以来小时数",value:"ticketMetric.responseAt",valueType:"number"},{option:"工单 : 暂停以来小时数",value:"ticketMetric.pausedAt",valueType:"number"},{option:"工单 : 处理完毕以来小时数",value:"ticketMetric.solvedAt",valueType:"number"},{option:"工单 : 最后回复以来小时数",value:"lastReply",valueType:"number"},{option:"工单 : 客户最后回复以来小时数",value:"customerLastReply",valueType:"number"},{option:"工单 : 客服最后回复以来小时数",value:"engineerLastReply",valueType:"number"},{option:"工单 : 最后一条回复的发送者（客户/客服）",value:"lastReplyUserType",valueType:"select"},{option:"工单 : 评价",value:"ticketHaveEvaluate",valueType:"select"}];return e}]).factory("anyConditionOptionsTicketReport",[function(){var e=[{option:"请选择",value:"-1"},{option:"工单 : 状态",value:"status",valueType:"select"},{option:"工单 : 处理人",value:"engineer.id",valueType:"engineer"},{option:"工单 : 创建人",value:"user.id",valueType:"user"},{option:"工单 : 抄送给",value:"id",valueType:"copyTo"},{option:"工单 : 客服组",value:"serviceDesk.id",valueType:"serviceDesk"},{option:"工单 : 客户",value:"requester.id",valueType:"requester"},{option:"工单 : 解决否",value:"evaluate.solved",valueType:"select"},{option:"工单 : 客户组",value:"requester.userGroup.id",valueType:"userGroup"},{option:"工单 : 渠道",value:"via.channel",valueType:"via"},{option:"工单 : 服务评价",value:"evaluate.score",valueType:"select"},{option:"工单 : 创建以来小时数",value:"createdAt",valueType:"number"},{option:"工单 : 处理中以来小时数",value:"ticketMetric.responseAt",valueType:"number"},{option:"工单 : 暂停以来小时数",value:"ticketMetric.pausedAt",valueType:"number"},{option:"工单 : 处理完毕以来小时数",value:"ticketMetric.solvedAt",valueType:"number"},{option:"工单 : 最后回复以来小时数",value:"lastReply",valueType:"number"},{option:"工单 : 客户最后回复以来小时数",value:"customerLastReply",valueType:"number"},{option:"工单 : 客服最后回复以来小时数",value:"engineerLastReply",valueType:"number"},{option:"工单 : 最后一条回复的发送者（客户/客服）",value:"lastReplyUserType",valueType:"select"},{option:"工单 : 评价",value:"ticketHaveEvaluate",valueType:"select"}];return e}]).factory("compareOptionsReport",[function(){var e={0:{option:"是",value:"$eq"},1:{option:"否",value:"$ne_or_null"},2:{option:"大于",value:"$gt"},3:{option:"小于",value:"$lt"},4:{option:"是",value:"$eq_hours"},5:{option:"小于",value:"$lt_hours"},6:{option:"大于",value:"$gt_hours"},7:{option:"是",value:"$eq_last_comment_hours"},8:{option:"小于",value:"$lt_last_comment_hours"},9:{option:"大于",value:"$gt_last_comment_hours"},10:{option:"至少包含其中一个",value:"$tags_include"},11:{option:"不含以下",value:"$tags_not_include"},12:{option:"包含以下字符串",value:"$like"},13:{option:"不含以下字符串",value:"$not_like"},14:{option:"是",value:"$eq_engineer"},15:{option:"否",value:"$ne_engineer"},16:{option:"包含",value:"$comment_contain"},17:{option:"不包含",value:"$comment_not_contain"},18:{option:"是",value:"$eq"},19:{option:"不是",value:"$ne"},20:{option:"是",value:"$eq_ticket_custom_field"},21:{option:"不是",value:"$ne_or_null_ticket_custom_field"},22:{option:"勾选",value:"$eq_ticket_custom_field"},23:{option:"不勾选",value:"$ne_or_null_ticket_custom_field"},24:{option:"包含以下字符串",value:"$like_ticket_custom_field"},25:{option:"不含以下字符串",value:"$not_like_ticket_custom_field"},26:{option:"是",value:"$eq_ticket_custom_field"},27:{option:"小于",value:"$lt_ticket_custom_field"},28:{option:"大于",value:"$gt_ticket_custom_field"},29:{option:"至少包含其中一个",value:"$ticket_custom_field_options_include"},30:{option:"不含以下",value:"$ticket_custom_field_options_not_include"},31:{option:"大于等于",value:"$in"},32:{option:"小于",value:"$not_in"},33:{option:"至少是下列一个",value:"$in"},34:{option:"不是以下",value:"$not_in"},35:{option:"至少包含其中一个",value:"$in"},36:{option:"不含以下",value:"$not_in"},37:{option:"是且包含其子目录",value:"$in"},38:{option:"是但不包含其子目录",value:"$eq"},39:{option:"不是且不是其子目录",value:"$not_in"},40:{option:"不是但可能是其子目录",value:"$ne_or_null"},41:{option:"是",value:"$in"},42:{option:"不是",value:"$not_in"},43:{option:"是",value:"$eq_last_comment_user_type"},44:{option:"是",value:"$eq_has_evaluate"}};return e}]).factory("allConditionOptionsChatReport",[function(){var e=[{option:"请选择",value:"-1"},{option:"会话 : 处理人",value:"engineer.id",valueType:"engineer"},{option:"会话 : 客服组",value:"serviceDesk.id",valueType:"serviceDesk"},{option:"会话 : 客户",value:"user.id",valueType:"user"},{option:"会话 : 客户组",value:"user.userGroup.id",valueType:"userGroup"},{option:"会话 : 渠道",value:"via.channel",valueType:"via"},{option:"会话 : 服务评价",value:"evaluate.score",valueType:"select"},{option:"会话 : 主题",value:"firstMessage",valueType:"text"},{option:"会话 : 是否转接",value:"transfer",valueType:"checkbox"},{option:"会话 : 是否多方",value:"tripartite",valueType:"checkbox"},{option:"会话 : 是否自动邀请",value:"isAutoinvite",valueType:"checkbox"},{option:"会话 : 是否超时自动结束",value:"autoClose",valueType:"checkbox"},{option:"会话 : 是否质检",value:"isQualitied",valueType:"checkbox"}];return e}]).factory("anyConditionOptionsChatReport",[function(){var e=[{option:"请选择",value:"-1"},{option:"会话 : 处理人",value:"engineer.id",valueType:"engineer"},{option:"会话 : 客服组",value:"serviceDesk.id",valueType:"serviceDesk"},{option:"会话 : 客户",value:"user.id",valueType:"user"},{option:"会话 : 客户组",value:"user.userGroup.id",valueType:"userGroup"},{option:"会话 : 渠道",value:"via.channel",valueType:"via"},{option:"会话 : 服务评价",value:"evaluate.score",valueType:"select"},{option:"会话 : 主题",value:"firstMessage",valueType:"text"},{option:"会话 : 是否转接",value:"transfer",valueType:"checkbox"},{option:"会话 : 是否多方",value:"tripartite",valueType:"checkbox"},{option:"会话 : 是否自动邀请",value:"isAutoinvite",valueType:"checkbox"},{option:"会话 : 是否超时自动结束",value:"autoClose",valueType:"checkbox"},{option:"会话 : 是否质检",value:"isQualitied",valueType:"checkbox"}];return e}]).service("searchService",e);e.$inject=[];function e(){var t=[{id:"ticket.all",text:"所有工单",value:""},{id:"ticket.all.evaluate",text:"所有工单",value:"EVALUATE_CREATED_AT"},{id:"ticket.all.perfomance",text:"所有工单",value:"PERFORMANCE_CREATED_AT"},{id:"ticket.create",text:"在筛选时段内新建的工单",value:"TICKET_CREATED_AT"},{id:"ticket.solved",text:"在筛选时段内处理完毕的工单",value:"TICKET_SOLVED_AT"},{id:"ticket.closed",text:"在筛选时段内关闭的工单",value:"TICKET_CLOSED_AT"},{id:"chat.open",text:"在筛选时段内发起的会话请求",value:"CHAT_CREATED_AT"},{id:"chat.closed",text:"在筛选时段内结束的会话请求",value:"CHAT_CLOSED_AT"}];var r={};var n='{"$and":[{"$and":[]},{"$or": []}]}';var s='{"$and":[{"$and":[]},{"$or": []}]}';var o='{"$and": [],"$or": []}';return{getShowDataSource:function(e){var a=[];t.forEach(function(t){e.forEach(function(e){if(t.id===e){a.push(t)}})});return a},loadSearchDataView:function(e,i,t){a.sdk.OpenReportFilterCondirionApi().list({reportType:e}).then(function(e){if(e&&e.length>0){var a=-1;e.forEach(function(e,t){i.push({id:e.id,title:e.title,filter:e.filter||n,customFieldFilter:e.customFieldFilter||s,reportType:e.reportType,selectedDataSource:JSON.parse(e.types),filterDescription:e.filterDescription||o,isDefault:e.isDefault,active:e.selected});if(e.isDefault&&a===-1){a=t}if(e.selected){a=t}});if(a>-1){i[a].active=true;r.filterDescription=i[a].filterDescription||o;r.filter=i[a].filter||n;r.customFieldFilter=i[a].customFieldFilter||s;r.types=i[a].selectedDataSource}t()}})},loadLocalSearchDataView:function(e,t,a,i){a.push({id:0,active:true,filter:n,customFieldFilter:s,filterDescription:o,isDefault:true,reportType:e,selectedDataSource:t,title:"默认筛选方法"});r.filterDescription=o;r.filter=n;r.customFieldFilter=s;r.types=t;i()},searchData:r}}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").service("StatisticsTimeFormatterService",e);e.$inject=["$state"];function e(e){var r=function(e){var t=e;if(typeof e==="object"){t=e.value}if(typeof t==="number"){if(t<60){return t.toFixed(1)+"s"}if(t<3600){return(t/60).toFixed(1)+"m"}return(t/3600).toFixed(1)+"h"}return t};var t=function(e){var t;if(Object.prototype.toString.call(e)==="[object Array]"){t=e}else{t=[e]}var a=t[0].name+"<br/>";var i=[];angular.forEach(e,function(e){i.push('<span style="display:inline-block; background-color:'+e.color+';width:10px;height:10px;border-radius: 5px"></span> '+e.seriesName+": "+r(e.value))});return a+i.join("<br/>")};var a=function(e){var t;if(Object.prototype.toString.call(e)==="[object Array]"){t=e}else{t=[e]}var a=t[0].name+"<br/>";var i=[];angular.forEach(e,function(e){i.push('<span style="display:inline-block; background-color:'+e.color+';width:10px;height:10px;border-radius: 5px"></span> '+e.seriesName+": "+e.value.toFixed(2)+"%")});return a+i.join("<br/>")};return{formatter:r,tipFormatter:t,tipEvaluateFormatter:a}}}();+function(){"use strict";angular.module("eweiApp.statistics").service("StatisticsTicketTypeService",e);e.$inject=["$q"];function e(a){return{getChartData:e};function e(e){var t=a.defer();org.ewei.sdk.OpenReportApi().countTicketType(e).then({success:t.resolve,fail:t.reject});return t.promise}}}();+function(){"use strict";angular.module("eweiApp.statistics").service("ChartTicketService",e);e.$inject=["$q","customFieldService","apiRestfulService","apiTicketEvaluateConfigService","coreModelService"];function e(i,e,r,a,n){return{getTicketList:t,getCustomFields:s,getServiceCatalogNames:o,getCustomFieldValue:l,getCopyto:c,getTags:u,getEvaluateConfig:d};function t(e){var t=i.defer();org.ewei.sdk.OpenReportApi().listTickets(e).then({success:t.resolve,fail:t.reject});return t.promise}function s(){var t=i.defer();e.run("",{scope:"ticket",active:true},true,function(e){if(e.status==0&&e.result){t.resolve(e.result)}else{t.reject(e.result)}});return t.promise}function o(e){var t=i.defer();var a={url:"/api/v1/tickets/service_catalog_full_names.json"};r.run(a).get({ticketIds:e.ticketIds},function(e){if(angular.isDefined(e.result)){t.resolve(e.result)}else{t.reject(e.result)}});return t.promise}function l(e){var t=i.defer();var a={url:"/api/v1/tickets/custom_field_value.json"};r.run(a).get(e,function(e){if(angular.isDefined(e.result)){t.resolve(e.result)}else{t.reject(e.result)}});return t.promise}function c(e){var t=i.defer();var a={url:"/api/v1/tickets/ccs.json"};r.run(a).get(e,function(e){if(0==e.status&&e.result){t.resolve(e.result)}else{t.reject(e.result)}});return t.promise}function u(e){var t=i.defer();var a={url:"/api/v1/tickets/tags.json"};r.run(a).get(e,function(e){if(0==e.status&&e.result){t.resolve(e.result)}else{t.reject(e.result)}});return t.promise}function d(){var t=i.defer();if(!n.config.evaluate||!n.config.evaluate.firstQuestionOptions){a.run(["response",function(e){if(0==e.status){t.resolve(n.config.evaluate)}else{t.reject(e.result)}}])}else{t.resolve(n.config.evaluate)}return t.promise}}}();+function(){"use strict";angular.module("eweiApp.statistics").service("StatisticsServiceCatalogService",e);e.$inject=["$q","serviceCatalogService"];function e(a,e){return{getServiceCatalogList:r,getTicketChartData:t,getTicketListData:i,getChatChartData:n,getChatListData:s};function t(e){var t=a.defer();org.ewei.sdk.OpenTicketReportApi().countByServiceCatalog(e).then({success:t.resolve,fail:t.reject});return t.promise}function i(e){var t=a.defer();org.ewei.sdk.OpenTicketReportApi().listByServiceCatalog(e).then({success:t.resolve,fail:t.reject});return t.promise}function r(){var t=a.defer();e.run("",{},true,function(e){if(e.status==0){t.resolve(e.result)}else{t.reject(e.result)}});return t.promise}function n(e){var t=a.defer();org.ewei.sdk.OpenChatReportApi().countByServiceCatalog(e).then({success:t.resolve,fail:t.reject});return t.promise}function s(e){var t=a.defer();org.ewei.sdk.OpenChatReportApi().listChatByServiceCatalog(e).then({success:t.resolve,fail:t.reject});return t.promise}}}();+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketController",e);e.$inject=["$rootScope","$scope","$state","permissions","coreModelService","StatisticsBreadcrumbService"];function e(e,t,a,i,r,n){t.breadcrumbs=n.items;t.goto=n.goto;var s=r.config.route.get("statistics-ticket");if(s){if(s.permission){if(i.hasPermission(s.permission)){return a.go(s.name,s.params)}else{return a.go("unauthorized")}}else{return a.go(s.name,s.params)}}else{a.go("statistics.ticket.quantity")}}}();+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketQuantityController",t);t.$inject=["$rootScope","$scope","$state","coreNotifyService","searchService","apiTicketQuantityService"];function t(e,i,r,t,n,a){var s=this.__proto__.constructor.name+"_"+Date.now();i.questionTip=["新建工单=新建时间在选择时间段内的工单数","完成工单=处理完毕时间在选择时间段内的工单数","删除工单=删除时间在选择时间段内的工单数"];var o=function(){var e="ticket.quantity";i.searchData={showDataSource:["ticket.all"],reportType:e,views:[]};n.loadSearchDataView(e,i.searchData.views,function(){f()})};var l=function(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter};return e};var c=function(){var e={};e.lineColor=["#ee7b1a","#4c9dd7","#b8c2d3"];e.titleText="";e.legendData=["新建","完成","删除"];e.xAxisData=[];e.yAxis={minInterval:1,type:"value",name:"工单数量",axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}};e.series=[{name:"新建",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"完成",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"删除",type:"line",symbol:"circle",symbolSize:10,data:[]}];return e};var u=function(e,t,a){var i={startDate:e.date=="all"?n.searchData.startDate:e.date,endDate:e.date=="all"?n.searchData.endDate:e.date,filter:t,customFieldFilter:n.searchData.customFieldFilter,types:a,filterDescription:n.searchData.filterDescription};r.go("statistics.ticket.quantityDetail",{params:e,queryParams:i})};var d=function(){i.columns=[{title:"日期",visible:true,sortable:true,field:"name"},{title:"新建工单",visible:true,sortable:true,field:"newTicketCount",totalFunction:function(e){if(i.totalData.newTicketCount>0){var t={date:"all",type:"new",title:"新建工单"};var a=n.searchData.filter;u(t,a,["TICKET_CREATED_AT"])}},callbackFunction:function(e){if(e.newTicketCount>0){var t={date:e.name,type:"new",title:"新建工单"};var a=n.searchData.filter;u(t,a,["TICKET_CREATED_AT"])}}},{title:"完成工单",visible:true,sortable:true,field:"solvedTicketCount",total:0,totalFunction:function(e){if(i.totalData.solvedTicketCount>0){var t={date:"all",type:"solved",title:"完成工单"};var a=n.searchData.filter;u(t,a,["TICKET_SOLVED_AT"])}},callbackFunction:function(e){if(e.solvedTicketCount>0){var t={date:e.name,type:"solved",title:"完成工单"};var a=n.searchData.filter;u(t,a,["TICKET_SOLVED_AT"])}}},{title:"删除工单",visible:true,sortable:true,field:"deletedTicketCount",total:0,totalFunction:function(e){if(i.totalData.deletedTicketCount>0){var t={date:"all",type:"deleted",title:"删除工单"};var a=JSON.parse(n.searchData.filter);a["$and"][0]["$and"].push({$eq:{deleted:true}});u(t,JSON.stringify(a),["TICKET_DELETED_AT"])}},callbackFunction:function(e){if(e.deletedTicketCount>0){var t={date:e.name,type:"deleted",title:"删除工单"};var a=JSON.parse(n.searchData.filter);a["$and"][0]["$and"].push({$eq:{deleted:true}});u(t,JSON.stringify(a),["TICKET_DELETED_AT"])}}}]};i.quantity=[];var f=function(){h.xAxisData=[];h.series[0].data=[];h.series[1].data=[];h.series[2].data=[];i.totalData={name:"合计",newTicketCount:0,solvedTicketCount:0,deletedTicketCount:0};a.getQuantity(l(),function(e){i.quantity=angular.copy(e);i.loadComplete=true;i.quantity.reverse();if(e.length>0){angular.forEach(e,function(e){h.xAxisData.push(e.name);h.series[0].data.push(e.newTicketCount);h.series[1].data.push(e.solvedTicketCount);h.series[2].data.push(e.deletedTicketCount);i.totalData.newTicketCount+=e.newTicketCount;i.totalData.solvedTicketCount+=e.solvedTicketCount;i.totalData.deletedTicketCount+=e.deletedTicketCount})}i.option=angular.copy(h);p()})};function p(){var t=[],a=[],e="工单统计-数量统计-工单数量-日走势";i.quantity.forEach(function(e){t.push([e.name,e.newTicketCount,e.solvedTicketCount,e.deletedTicketCount])});i.totalData&&t.unshift([i.totalData.name,i.totalData.newTicketCount,i.totalData.solvedTicketCount,i.totalData.deletedTicketCount]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}var m=function(){d();o()};var h=c();m();var v=function(){f()};t.register(s,t.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){v()});i.$on("statistics.datarange.changed",v);i.$on("$destroy",function(){t.unRegister(s)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketQuantityDetailController",e);e.$inject=["$rootScope","$scope","$stateParams","coreModelService","StatisticsBreadcrumbService","customFieldService","ngTableParams"];function e(e,t,a,i,r,n,s){t.params=a.params;t.queryParams=a.queryParams;t.queryName="工单统计-数量统计-"+(t.params.date=="all"?t.params.title:t.params.date+"("+t.params.title+")");r.push({url:"statistics.ticket.quantity",name:"数量统计"});r.push({name:t.params.date=="all"?t.params.title:t.params.date+"("+t.params.title+")"});t.$on("$destroy",function(){r.pop(2)});if(i.detail.statistics.columns.ticket.quantity.length>0){t.defaultColumns=i.detail.statistics.columns.ticket.quantity}else{t.defaultColumns=i.detail.statistics.columns.ticket.quantity=["no","subject","requester.name","requester.userGroup.name","priority.name","status","createdAt"]}}}();+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketQualityController",t);t.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","apiTicketQualityService","coreNotifyService"];function t(e,E,t,A,n,i,a,r){var s=this.__proto__.constructor.name+"_"+Date.now();E.questionTip=["响应时长 = 所选时间范围内，工单从创建时间到第一条公开回复的时长","处理时长 = 所选时间范围内，工单从创建时间到处理完毕的时长","评价否 = 所选时间范围内，工单是否被评价，“统计”值为参评率即已评价的工单/已完毕或已关闭工单量比值*100%","满意度 = 所选时间范围内，已评价工单的评价分值，“统计”值为所有已评价工单的评价分的平均值","忠诚度 = 所选时间范围内，已评价工单的评价分值，“统计”值为所有已评价工单的评价分的平均值","推荐度 = 所选时间范围内，已评价工单的评价分值，“统计”值为所有已评价工单的评价分的平均值","解决否 = 所选时间范围内，工单是否为解决，“统计”值为解决率即已解决的工单/有评价工单量比值*100%","一次解决 = 所选时间范围内，评价为已解决且未被重置的工单，“统计”值为一次解决率即评价为已解决且未被重置的工单/处理完毕或已关闭工单量比值*100%","SLA达标 = 所选时间范围内，工单SLA是否达标，“统计“值为SLA达标率即响应且处理达标的工单数量/匹配SLA（已完毕或已关闭）的工单量比值*100%"];var o=function(){var e="ticket.quality";E.searchData={showDataSource:["ticket.create","ticket.solved","ticket.closed"],reportType:e,views:[]};i.loadSearchDataView(e,E.searchData.views,function(){f();c();u()})};var l=function(){i.searchData.startDate=E.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=E.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,customFieldFilter:i.searchData.customFieldFilter,types:i.searchData.types};return e};var x=function(e,t,a){var i={title:{text:e,x:"center",y:"center",show:true},color:t,series:[{type:"pie",radius:["80%","100%"],hoverAnimation:false,avoidLabelOverlap:false,label:{normal:{show:false,position:"center"}},data:[{value:e},{value:a?5-e:100-e}]}]};return i};var c=function(){var i={};i.lineColor=[e.mainColor];i.titleText="";i.legendData=["数量"];i.xAxis={name:"工单数量",data:[]};i.yAxis={name:"工单数量"};i.series=[{barWidth:30,name:"数量",data:[]}];var r=["1M","3M","5M","10M","30M","1H","4H","8H","24H","48H","72H","72H+"];a.getResponseOption(l(),function(t){var a=0;_.keys(t).forEach(function(e){a+=t[e]});for(var e=0;e<r.length;e++){if(t[r[e]]>0){i.xAxis.data.push(r[e]);i.series[0].data.push({value:t[r[e]],percent:n.getPercentValue(t[r[e]]/a)})}}E.responseOption=angular.copy(i)})};var u=function(){var i={};i.lineColor=[e.mainColor];i.titleText="";i.legendData=["数量"];i.xAxis={name:"工单数量",data:[]};i.yAxis={name:"工单数量"};i.series=[{name:"数量",data:[]}];var r=["1M","3M","5M","10M","30M","1H","4H","8H","24H","48H","72H","72H+"];a.getSolvedOption(l(),function(t){var a=0;_.keys(t).forEach(function(e){a+=t[e]});for(var e=0;e<r.length;e++){if(t[r[e]]>0){i.xAxis.data.push(r[e]);i.series[0].data.push({value:t[r[e]],percent:n.getPercentValue(t[r[e]]/a)})}}E.solvedOption=angular.copy(i)})};var d=function(){E.columns=[{title:"工单",visible:true,sortable:true,class:"text-left",field:"ticket",callbackFunction:function(e){n.addTab("tickets_detail"+e.id,e.subject,"tickets_detail",{id:e.id},"",false)}},{title:"响应时长",visible:true,sortable:true,sortType:"number",field:"responseTime"},{title:"处理时长",visible:true,sortable:true,sortType:"number",field:"processTime"},{title:"评价否",visible:true,sortable:true,field:"evaluate"},{title:"满意度",visible:true,sortable:true,sortType:"number",field:"score"},{title:"忠诚度",visible:true,sortable:true,sortType:"number",field:"loyalty"},{title:"推荐度",visible:true,sortable:true,sortType:"number",field:"recommend"},{title:"解决否",visible:true,sortable:true,field:"solved"},{title:"一次解决",visible:true,sortable:true,field:"once_solved"},{title:"SLA达标",visible:true,sortable:true,field:"sla"}]};var f=function(){a.getListQuality(l(),function(e){var t=0,a=0,i=0,r=0,n=0,s=0,o=0,l=0,c=0,u=0,d=0,f=0,p=0,m=0,h=0,v=0;E.quality=e;E.loadComplete=true;var g=e.length;if(e.length){angular.forEach(e,function(e){if(Number(e.response_minutes)||Number(e.response_minutes)===0){t+=Number(e.response_minutes);e.responseTime=A("minutesToTime")(e.response_minutes)}else{e.responseTime="-"}if(Number(e.process_minutes)||Number(e.process_minutes)===0){a+=Number(e.process_minutes);e.processTime=A("minutesToTime")(e.process_minutes)}else{e.processTime="-"}if(e.status=="solved"||e.status=="closed"){r+=1;if(e.evaluate_id){i+=1;e.evaluate="已评价";e.score=parseFloat(e.score);n+=e.score;s++;m+=1;if(e.solved){if(e.once_solved){p+=1;e.once_solved="是"}else{e.once_solved="否"}}else{e.once_solved="否"}}else{e.evaluate="未评价";e.score="-";if(e.once_solved==false){m+=1;e.once_solved="否"}else{e.once_solved="-"}}if(e.qualified){h+=1;v+=1;e.sla="是"}else{if(e.qualified==false){v+=1;e.sla="否"}else{e.sla="-"}}}else{e.evaluate="-";e.score="-";e.once_solved="-";e.sla="-"}e.ticket="# "+e.no+" "+e.subject;if(e.solved){d+=1;e.solved="已解决"}else{if(e.solved==false){e.solved="未解决"}else{e.solved="-"}}if(e.evaluate_id){f+=1}if(e.loyalty>0){o+=Number(e.loyalty);l+=1}if(e.recommend>0){c+=Number(e.recommend);u+=1}});var D=A("chartTimeFormat")(parseInt(t*60/g));var y=A("chartTimeFormat")(parseInt(a*60/g));var b=i==0?0:(i/r*100).toFixed(2);var C=n==0?0:(n/s).toFixed(2);var T=o==0?0:(o/l).toFixed(2);var k=c==0?0:(c/u).toFixed(2);var w=f==0?0:(d/f*100).toFixed(2);var S=m==0?0:(p/m*100).toFixed(2);var _=h==0?0:(h/v*100).toFixed(2);E.totalData={ticket:"统计",responseTime:D,processTime:y,evaluate:b+"%",score:C,loyalty:T,recommend:k,solved:w+"%",once_solved:S+"%",sla:_+"%"};E.ticketQuality=[{title:"评分",chartCircularOption:x(C,["#4B253A","#D3B6C6"],true)},{title:"评价率",chartCircularOption:x(b,["#EFB917","#FCE6A4"])},{title:"解决率",chartCircularOption:x(w,["#45AEEA","#BEE3F7"])},{title:"一次解决率",chartCircularOption:x(S,["#D2D558","#F8F9B6"])},{title:"SLA达标率",chartCircularOption:x(_,["#D43A43","#F4BCBF"])}]}else{E.totalData=undefined;E.ticketQuality=[{title:"评分",chartCircularOption:x(0,["#4B253A","#D3B6C6"])},{title:"评价率",chartCircularOption:x(0,["#EFB917","#FCE6A4"])},{title:"解决率",chartCircularOption:x(0,["#45AEEA","#BEE3F7"])},{title:"一次解决率",chartCircularOption:x(0,["#D2D558","#F8F9B6"])},{title:"SLA达标率",chartCircularOption:x(0,["#D43A43","#F4BCBF"])}]}$()})};function $(){var t=[],a=[],e="工单统计-质量统计-评分、解决率和达标率";E.quality.forEach(function(e){t.push([e.ticket,e.responseTime,e.processTime,e.evaluate,e.score,e.loyalty,e.recommend,e.solved,e.once_solved,e.sla])});E.totalData&&t.unshift([E.totalData.ticket,E.totalData.responseTime,E.totalData.processTime,E.totalData.evaluate,E.totalData.score,E.totalData.loyalty,E.totalData.recommend,E.totalData.solved,E.totalData.once_solved,E.totalData.sla]);E.columns.forEach(function(e){a.push(e.title)});E.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var p=function(){o();d()};p();var m=function(){f();c();u()};E.showWhichOne={circular:true};E.checked=function(e){E.showWhichOne.circular=false;E.showWhichOne.response=false;E.showWhichOne.solved=false;E.showWhichOne[e]=true};r.register(s,r.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){m()});E.$on("statistics.datarange.changed",m);E.$on("$destroy",function(){r.unRegister(s)})}}(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketTypeController",t);t.$inject=["$rootScope","$scope","$state","coreModelService","StatisticsBreadcrumbService","$timeout","StatisticsTicketTypeService","searchService","coreNotifyService","utils"];function t(t,i,a,e,r,n,s,o,l,c){void 0;i.questionTip="类型占比=筛选条件内该类型工单的数量÷筛选条件内所有类型工单数量总和×100%";var u=function(){var e="ticket.type";i.searchData={showDataSource:["ticket.create","ticket.solved","ticket.closed"],reportType:e,views:[]};o.loadSearchDataView(e,i.searchData.views,function(){p()})};var d=function(){var e={};e.lineColor=[t.mainColor];e.titleText="";e.legendData=["数量"];e.xAxis={name:"工单数量"};e.yAxis={name:"工单数量"};e.series=[{name:"数量"}];return e};var f=function(){i.columns=[{title:"类型",visible:true,class:"text-left",field:"name",callbackFunction:function(e){var t=JSON.parse(o.searchData.filter);if(e.id!==undefined&&e.id!==null){t["$and"][0]["$and"].push({$eq:{"ticketType.id":e.id}})}else{t["$and"][0]["$and"].push({$is_null:"ticketType.id"})}a.go("statistics.ticket.typeDetail",{item:e,queryParams:{startDate:o.searchData.startDate,endDate:o.searchData.endDate,filter:JSON.stringify(t),customFieldFilter:o.searchData.customFieldFilter,filterDescription:o.searchData.filterDescription,types:o.searchData.types}})}},{title:"工单数量",visible:true,sortable:true,field:"value",total:0},{title:"占比",visible:true,sortable:true,sortType:"number",field:"ratio",total:0}]};var p=function(){o.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");o.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:o.searchData.startDate,endDate:o.searchData.endDate,filter:o.searchData.filter,customFieldFilter:o.searchData.customFieldFilter,types:o.searchData.types};s.getChartData(e).then(function(e){v.xAxis.data=[];v.series[0].data=[];var t=_.reduce(e,function(e,t){return e+t.value},0);angular.forEach(e,function(e){if(!e.name){e.name="未分类"}v.xAxis.data.push(e.name);v.series[0].data.push({value:e.value,percent:c.getPercentValue(e.value/t)});e.ratio=Math.round(e.value/t*100)+"%"});i.option=v;i.tableData=e;i.loadComplete=true;m()})};function m(){var t=[],a=[],e="工单统计-工单类型";i.tableData.forEach(function(e){t.push([e.name,e.value,e.ratio])});i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:o.searchData.startDate,endDate:o.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:o.searchData.filterDescription,types:o.searchData.types}}var h=function(){f();u()};var v=d();var g=this.__proto__.constructor.name+"_"+Date.now();l.register(g,l.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){p()});h();i.$on("statistics.datarange.changed",function(){o.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");o.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");p()});i.$on("$destroy",function(){l.unRegister(g)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketTypeDetailController",e);e.$inject=["$rootScope","$scope","$stateParams","coreModelService","StatisticsBreadcrumbService","customFieldService","ngTableParams"];function e(e,t,a,i,r,n,s){t.data=a.item;t.queryParams=a.queryParams;t.queryName="工单统计-工单类型-"+t.data.name;r.push({url:"statistics.ticket.type",name:"工单类型"});r.push({name:t.data.name});t.$on("$destroy",function(){r.pop(2)});if(i.detail.statistics.columns.ticket.type.length>0){t.defaultColumns=i.detail.statistics.columns.ticket.type}else{t.defaultColumns=i.detail.statistics.columns.ticket.type=["no","subject","requester.name","requester.userGroup.name","status","createdAt"]}}}();+function(b){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketPriorityController",e);e.$inject=["$rootScope","$scope","$state","$stateParams","StatisticsBreadcrumbService","searchService","coreNotifyService"];function e(e,i,t,a,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();var l=[];var c=0;i.data=[];i.questionTip=["优先级占比=筛选条件内该优先级工单的数量÷筛选条件内所有优先级工单数量总和×100%"];function u(){i.columns=[{title:"优先级",visible:true,sortable:true,field:"priority.name",callbackFunction:function(e){if(e.count!==0){t.go("statistics.ticket.priorityDetail",{item:e})}}},{title:"工单数量",visible:true,sortable:true,field:"count"},{title:"占比",visible:true,sortable:true,sortType:"number",field:"percent"}]}function d(){h();f()}function f(){var e="ticket.priority";i.searchData={showDataSource:["ticket.create","ticket.solved","ticket.closed"],reportType:e,views:[]};n.loadSearchDataView(e,i.searchData.views,function(){p();m()})}function p(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD")}function m(){b.sdk.OpenTicketReportApi().priorityStatistics({startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,types:n.searchData.types}).then({success:function(e){i.loadComplete=true;i.data=[];e.forEach(function(e){var t=e.ticketCount*1;i.data.push({priority:v(e.priority),count:t,percent:b.utils.n2p(e.rate)});if(c<t){c=t}});g();D()}})}function h(){if(localStorage&&localStorage["systemFieldPriority"]){l=JSON.parse(JSON.parse(localStorage["systemFieldPriority"]).customFieldOptions)}}function v(t){var a={name:"",value:""};l.forEach(function(e){if(e.value===t){a=e}});return a}function g(){var e=[];i.priorityTickets={indicator:[],data:[{name:"工单数量",value:null}]};l.forEach(function(t){var a=null;i.priorityTickets.indicator.push({text:t.name,max:c});i.data.forEach(function(e){if(e.priority.name===t.name){a=e}});if(a!==null){e.push(a.count)}else{e.push(0)}});i.priorityTickets.data[0].value=e}s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){m()});i.$on("statistics.datarange.changed",function(e,t){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");m()});function D(){var t=[],a=[],e="工单统计-优先级";i.data.forEach(function(e){t.push([e.priority.name,e.count,e.percent])});i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function y(){u();d()}r.push({url:"statistics.ticket.priority",name:"优先级"});i.$on("$destroy",function(){r.pop(1);s.unRegister(o)});y()}}(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketPriorityDetailController",t);t.$inject=["$rootScope","$scope","$state","$stateParams","StatisticsBreadcrumbService","searchService","coreModelService"];function t(e,t,a,i,r,n,s){t.queryName="工单统计-优先级-"+i.item.priority.name;function o(){var e=JSON.parse(n.searchData.filter);e["$and"][0]["$and"].push({$eq:{priority:i.item.priority.value}});t.queryParams={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:JSON.stringify(e),customFieldFilter:n.searchData.customFieldFilter,filterDescription:n.searchData.filterDescription,types:n.searchData.types,page:{pageNumber:1,pageSize:20}}}function l(){o();if(s.detail.statistics.columns.ticket.priority.length>0){t.defaultColumns=s.detail.statistics.columns.ticket.priority}else{t.defaultColumns=s.detail.statistics.columns.ticket.priority=["no","subject","requester.name","requester.userGroup.name","priority.name","status","createdAt"]}}r.push({url:"statistics.ticket.priority",name:"优先级"});r.push({name:i.item.priority.name});t.$on("$destroy",function(){r.pop(2)});l()}}(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketChannelController",t).filter("requestTimeDistribution",a);t.$inject=["$rootScope","$scope","$timeout","$filter","$state","StatisticsBreadcrumbService","searchService","coreNotifyService"];function t(e,n,t,s,a,i,r,o){var l=this.__proto__.constructor.name+"_"+Date.now();n.questionTip=["请求数量：筛选条件内该渠道新增的工单数量（含移除隔离区的工单数量）","渠道占比=筛选条件内该渠道的请求数量÷筛选条件内所有渠道请求数量总和×100%","请求人数：筛选条件内通过该渠道发起请求的人数","渠道复用率=请求数量÷请求人数"];var c=function(){var e="ticket.channel";n.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};r.loadSearchDataView(e,n.searchData.views,function(){d();f();p()})};var u=function(){r.searchData.startDate=n.$parent.dateRange.startDate.format("YYYY-MM-DD");r.searchData.endDate=n.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:r.searchData.startDate,endDate:r.searchData.endDate,filter:r.searchData.filter,customFieldFilter:r.searchData.customFieldFilter,types:r.searchData.types};return e};n.showWhichOne={circular:true};n.checked=function(e){n.showWhichOne.circular=false;n.showWhichOne.lineGraphStack=false;n.showWhichOne.mapChina=false;n.showWhichOne[e]=true};n.columns=[{title:"渠道",visible:true,sortable:true,class:"text-left",field:"channel_name",callback:true,callbackFunction:function(e){var t=JSON.parse(r.searchData.filter);if(e.channel_uid){t["$and"][0]["$and"].push({$eq:{"via.channelUid":e.channel_uid}})}else{t["$and"][0]["$and"].push({$is_null:"via.channelUid"})}if(e.channel){t["$and"][0]["$and"].push({$eq:{"via.channel":e.channel}})}else{t["$and"][0]["$and"].push({$is_null:"via.channel"})}a.go("statistics.ticket.channelDetail",{params:{item:e,queryParams:{startDate:r.searchData.startDate,endDate:r.searchData.endDate,filter:JSON.stringify(t),customFieldFilter:r.searchData.customFieldFilter,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}})}},{title:"请求数量",visible:true,sortable:true,field:"countTicket"},{title:"占比",visible:true,sortable:true,sortType:"number",field:"scale"},{title:"请求人数",visible:true,sortable:true,field:"countRequester"},{title:"渠道复用率",visible:true,sortable:true,sortType:"number",field:"viaRepetitionRate"},{title:"启/停",visible:true,sortable:true,field:"activeName"},{title:"渠道创建时间",visible:true,sortable:true,field:"created_at"}];var d=function(){org.ewei.sdk.OpenReportApi().countTicketVia(u()).then({success:function(e){n.loadComplete=true;if(e.length){n.quantity=e;var t=[],a=[],i=0,r=0;angular.forEach(e,function(e){t.push(e.channel_name);a.push({value:e.countTicket,name:e.channel_name});e.created_at=s("date")(e.created_at,"yyyy-MM-dd HH:mm:ss");if(e.enable===0){e.activeName="停用"}else{e.activeName="启用"}i+=e.countTicket;r+=e.countRequester});angular.forEach(e,function(e){e.scale=(e.countTicket/i*100).toFixed(2)+"%"});n.totalData={channel_name:"全部",countTicket:i,scale:"100%",countRequester:r,viaRepetitionRate:(i/r).toFixed(2),activeName:"-",created_at:"-"};n.chartCircularOption={tooltip:{formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",x:"right",y:"bottom",data:t},series:[{name:"访问来源",type:"pie",radius:["50%","70%"],data:a}]}}else{n.totalData=null;n.quantity=[];n.chartCircularOption={tooltip:{formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"访问来源",type:"pie",radius:["50%","70%"],data:[{value:0,name:"无数据"}]}]}}m()}})};var f=function(){org.ewei.sdk.OpenReportApi().countTicketRequestTimeDistribution(u()).then({success:function(e){var t=s("requestTimeDistribution")(e);var a=[],i=[];angular.forEach(t,function(e){a.push(e.name+"时");i.push(e.value)});n.chartLineGraphStackOption={xAxis:{data:a},yAxis:{name:"工单数量"},series:[{name:"工单数量",type:"line",symbol:"circle",symbolSize:10,data:i}]}}})};var p=function(){org.ewei.sdk.OpenReportApi().countTicketRequestLocationDistribution(u()).then({success:function(e){var t=_.max(e,function(e){return e.value}).value;n.chartMapChinaOption={visualMap:{max:t||0},series:[{name:"工单数量",data:e}]}}})};function m(){var t=[],a=[],e="工单统计-渠道来源";n.quantity.forEach(function(e){t.push([e.channel_name,e.countTicket,e.scale,e.countRequester,e.viaRepetitionRate,e.activeName,e.created_at])});n.totalData&&t.unshift([n.totalData.channel_name,n.totalData.countTicket,n.totalData.scale,n.totalData.countRequester,n.totalData.viaRepetitionRate,n.totalData.activeName,n.totalData.created_at]);n.columns.forEach(function(e){a.push(e.title)});n.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}var h=function(){c()};h();o.register(l,o.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){d();f();p()});n.$on("statistics.datarange.changed",function(e,t){d();f();p()});n.$on("$destroy",function(){o.unRegister(l)})}function a(){return function(i){var e=[],t=false;if(!i.length){t=true}for(var a=0;a<24;a++){e.push(a);if(t){i.push({name:a,value:0})}}var r=_.indexOf(e,Number(i[0].name));var n=_.indexOf(e,Number(i[i.length?i.length-1:0].name));return _.map(e.slice(r,n+1),function(t){var e={name:t,value:0};var a=_.find(i,function(e){return e.name==t});if(a){e.value=a.value}return e})}}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketChannelDetailController",e);e.$inject=["$rootScope","$scope","$stateParams","coreModelService","StatisticsBreadcrumbService","searchService","coreNotifyService","$filter"];function e(e,r,t,a,i,n,s,o){r.params=t.params.item;r.queryName="工单统计-渠道统计-"+r.params.channel_name;i.push({url:"statistics.ticket.channel",name:"渠道统计"});i.push({name:r.params.channel_name});r.showWhichOne={day:true};var l=function(e,t){var a=[],i=[];angular.forEach(e,function(e){if(t==="time"){a.push(e.name+"时")}else{a.push(e.name)}i.push(e.value)});r.chartLineGraphStackOption={xAxis:{data:a},yAxis:{name:"工单数量"},series:[{name:"工单数量",type:"line",symbol:"circle",symbolSize:10,data:i}]}};var c=function(){var e={startDate:n.searchData.startDate,endDate:n.searchData.endDate,via:{channel:r.params.channel,channelUid:r.params.channel_uid},filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,types:n.searchData.types};return e};var u=function(){org.ewei.sdk.OpenReportApi().countTicketRequestTimeStatistics(c()).then({success:function(e){var t=o("requestTimeDistribution")(e);if(t.length){l(t,"time")}}})};var d=function(){org.ewei.sdk.OpenReportApi().countTicketRequestDayStatistics(c()).then({success:function(e){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.name==a})){e.push({name:a,value:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.name});if(e.length){l(e)}}})};var f=function(){org.ewei.sdk.OpenReportApi().countTicketRequestLocationStatistics(c()).then({success:function(e){var t=_.max(e,function(e){return e.value}).value;r.chartMapChinaOption={visualMap:{max:t||0},series:[{name:"工单数量",data:e}]}}})};var p=function(){u();d();f();r.queryParams=t.params.queryParams;if(a.detail.statistics.columns.ticket.channel.length>0){r.defaultColumns=a.detail.statistics.columns.ticket.channel}else{r.defaultColumns=a.detail.statistics.columns.ticket.channel=["id","no","subject","requester.name","requester.userGroup.name","status","createdAt"]}};p();r.$on("statistics.datarange.changed",function(e,t){p()});r.checked=function(e){if(e==="day"){d()}else if(e==="time"){u()}r.showWhichOne.day=false;r.showWhichOne.time=false;r.showWhichOne[e]=true};r.$on("$destroy",function(){i.pop(2)})}}();+function(h){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketWorkflowController",e);e.$inject=["$rootScope","$scope","coreNotifyService","searchService","$state","$filter","utils"];function e(t,i,e,r,a,n,s){i.questionTip="• 工单数量=筛选条件内使用该工作流的工单数量";var o=function(){var e="ticket.workflow";i.searchData={showDataSource:["ticket.create","ticket.solved","ticket.closed"],reportType:e,views:[]};r.loadSearchDataView(e,i.searchData.views,function(){u()})};var l=function(){var e={};e.lineColor=[t.mainColor];e.titleText="";e.legendData=["数量"];e.xAxis={name:"工单数量"};e.yAxis={name:"工单数量"};e.series=[{name:"数量"}];return e};var c=function(){i.columns=[{title:"工作流",visible:true,sortable:true,class:"text-left",field:"name",callbackFunction:function(e){a.go("statistics.ticket.workflowDetail",{item:e})}},{title:"工单数量",visible:true,sortable:true,field:"ticketCount",total:0},{title:"工作流创建时间",visible:true,sortable:true,field:"createdAt",total:0}]};var u=function(){r.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");r.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:r.searchData.startDate,endDate:r.searchData.endDate,filter:r.searchData.filter,customFieldFilter:r.searchData.customFieldFilter,types:r.searchData.types,page:{pageNumber:1,pageSize:999}};h.sdk.OpenTicketReportApi().activitiWorkflowReport(e).then(function(e){var t=_.reduce(e.list,function(e,t){return e+t.ticketCount},0);p.xAxis.data=[];p.series[0].data=[];i.totalData={name:"全部",ticketCount:0,active:"",createdAt:""};angular.forEach(e.list,function(e){p.xAxis.data.push(n("cutStr")(e.name,5));p.series[0].data.push({value:e.ticketCount,percent:s.getPercentValue(e.ticketCount/t)});i.totalData.ticketCount+=e.ticketCount});i.option=p;i.tableData=e.list;i.loadComplete=true;d()})};function d(){var t=[],a=[],e="工单统计-工作流";i.tableData.forEach(function(e){t.push([e.name,e.ticketCount,e.createdAt])});i.totalData&&t.unshift([i.totalData.name,i.totalData.ticketCount,i.totalData.createdAt]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}var f=function(){c();o()};var p=l();var m=this.__proto__.constructor.name+"_"+Date.now();e.register(m,e.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){u()});f();i.$on("statistics.datarange.changed",function(){r.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");r.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");u()});i.$on("$destroy",function(){e.unRegister(m)})}}(org.ewei);+function(y){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketWorkflowDetailController",e);e.$inject=["utils","$rootScope","$scope","$stateParams","coreModelService","StatisticsBreadcrumbService","searchService","coreNotifyService","$filter"];function e(t,e,d,n,a,i,r,s,o){var l=0;var f=[];var c={};d.processChart={xAxis:[],baseSeries:[],series:[]};d.queryName="工作流统计-"+n.item.name;var u=function(){d.columns=[{title:"工单编号",visible:true,sortable:true,class:"text-left",field:"name",rowspan:2,callbackFunction:function(e){t.addTab("tickets_detail"+e.id,e.subject,"tickets_detail",{id:e.id},"",false)}},{title:"SLA",visible:true,sortable:true,field:"sla",rowspan:2},{title:"节点",visible:true,sortable:true,field:"nodeCount",rowspan:2}];d.subColumns=[];d.exportColumns=[];y.sdk.OpenActivitiWorkflowTemplateApi().getById({id:y.utils.s2n(n.item.id)}).then(function(e){var t=1;y.utils.traverse(e.rootNode,function(e){l++;if(e.type==="handler"){d.columns.push({title:"节点"+t,visible:true,sortable:false,field:e.uId,colspan:3});d.subColumns.push({title:"处理人",visible:true,sortable:false,field:e.uId+"handler"},{title:"响应耗时",visible:true,sortable:false,sortType:"number",field:e.uId+"response"},{title:"处理耗时",visible:true,sortable:false,sortType:"number",field:e.uId+"process"});f.push({uId:e.uId,no:"节点"+t});d.exportColumns.push({title:"节点"+t+"处理人"},{title:"节点"+t+"响应耗时"},{title:"节点"+t+"处理耗时"});t++;c[e.uId+"handler"]="";c[e.uId+"response"]="";c[e.uId+"process"]=""}});d.mergeColumns=[d.columns[0],d.columns[1],d.columns[2]];d.mergeColumns=d.mergeColumns.concat(d.subColumns);d.exportColumns.unshift(d.columns[2]);d.exportColumns.unshift(d.columns[1]);d.exportColumns.unshift(d.columns[0])})};var p=function(){var e={startDate:r.searchData.startDate,endDate:r.searchData.endDate,workflowTemplateId:n.item.id,filter:r.searchData.filter,customFieldFilter:r.searchData.customFieldFilter,types:r.searchData.types};return e};var m=function(){org.ewei.sdk.OpenTicketReportApi().activitiWorkflowReportDetail(p()).then({success:function(e){var r=e.processDuration;var n=e.responseDuration;var s=[];var o=[],l=[];var c=[],u=[];f.forEach(function(e){var t=1e4;var a=0;for(var i in r){if(r.hasOwnProperty(i)){if(e.uId===i){r[i].forEach(function(e){if(t>e){t=e}if(a<e){a=e}})}}}if(t===1e4){o.push(0);l.push(0)}else{o.push(t);l.push(a)}s.push(e.no)});d.processChart={xAxis:s,baseSeries:o,series:l,color:"#199ED8"};s=[];f.forEach(function(e){var t=1e4;var a=0;for(var i in r){if(n.hasOwnProperty(i)){if(e.uId===i){n[i].forEach(function(e){if(t>e){t=e}if(a<e){a=e}})}}}if(t===1e4){c.push(0);u.push(0)}else{c.push(t);u.push(a)}s.push(e.no)});d.responseChart={xAxis:s,baseSeries:c,series:u,color:"#FF6600"}}})};function h(e){if(y.utils.isUndefined(e)){return""}else{if(e){return"达标"}else{return"未达标"}}}var v=function(){d.tableData=[];var r=[];var e=p();e.page={pageNumber:1,pageSize:100};org.ewei.sdk.OpenTicketReportApi().activitiWorkflowReportTickets(e).then({success:function(e){var i=[];e.list.forEach(function(e){var t={};t.subject=e.subject;t.id=e.id;t.name="#"+e.no;t.sla=h(e.ticketMetric&&e.ticketMetric.qualified);t.nodeCount=l;for(var a in c){if(c.hasOwnProperty(a)){t[a]=""}}r.push(t);i.push(e.id)});if(i.length>0){org.ewei.sdk.OpenTicketReportApi().activitiWorkflowReportNodes({ticketIds:i,workflowTemplateId:n.item.id}).then({success:function(n){r.forEach(function(r){var e=false;for(var t in n){if(n.hasOwnProperty(t)&&r.id===parseInt(t)){e=true;var a=[];for(var i in n[t]){if(n[t].hasOwnProperty(i)){n[t][i].forEach(function(e,t){a[t]=a[t]||{};a[t][i+"handler"]=e.performanceUser.name;a[t][i+"response"]=e.responseDuration?o("minutesToTime")(e.responseDuration):"-";a[t][i+"process"]=e.processDuration?o("minutesToTime")(e.processDuration):"-"})}}a.forEach(function(e,t){var a=angular.copy(r);for(var i in e){if(e.hasOwnProperty(i)){a[i]=e[i]}}if(t>0){a.name=" ";a.sla=" ";a.nodeCount=" "}d.tableData.push(a)})}}if(e===false){d.tableData.push(r)}});g()}})}}})};function g(){var e=[],t=[],a="工单统计-"+n.item.name+"-工作流明细";d.tableData.forEach(function(t){var a=[];d.mergeColumns.forEach(function(e){a.push(t[e.field])});e.push(a)});d.exportColumns.forEach(function(e){t.push(e.title)});d.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:e,titleList:t,reportName:a,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}var D=function(){u();m();v()};D();d.$on("statistics.datarange.changed",function(e,t){D()});i.push({url:"statistics.ticket.workflow",name:"工作流统计"});i.push({name:n.item.name});d.$on("$destroy",function(){i.pop(2)})}}(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketServiceCatalogController",t);t.$inject=["$filter","$rootScope","$scope","$state","coreModelService","$timeout","StatisticsServiceCatalogService","utils","searchService","coreNotifyService"];function t(r,t,l,e,a,i,n,c,s,o){l.selectedServiceCatalog=null;l.tableData=[];var u=function(){var e="ticket.service_catalog";l.searchData={showDataSource:["ticket.create","ticket.solved","ticket.closed"],reportType:e,views:[]};s.loadSearchDataView(e,l.searchData.views,function(){m()})};var d=function(){var e={};e.lineColor=[t.mainColor];e.titleText="";e.legendData=["数量"];e.xAxis={name:"服务目录",data:[]};e.yAxis={name:"工单数量"};e.series=[{name:"数量",data:[]}];return e};var f=function(){l.columns=[{title:"主题",visible:true,sortable:true,class:"text-left",field:"subject",callbackFunction:function(e){c.addTab("tickets_detail"+e.id,e.subject,"tickets_detail",{id:e.id},"",false)}},{title:"处理人",visible:true,sortable:true,class:"text-left",field:"engineerUserName",total:0},{title:"客服组",visible:true,sortable:true,class:"text-left",field:"serviceDeskName",total:0},{title:"客户",visible:true,sortable:true,class:"text-left",field:"requesterName",total:0},{title:"客户组",visible:true,sortable:true,class:"text-left",field:"requesterGroupName",total:0},{title:"优先级",visible:true,sortable:true,field:"priority",total:0},{title:"服务目录",visible:true,sortable:true,class:"text-left",field:"catalog",total:0}]};var p=function(){s.searchData.startDate=l.$parent.dateRange.startDate.format("YYYY-MM-DD");s.searchData.endDate=l.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:s.searchData.startDate,endDate:s.searchData.endDate,filter:s.searchData.filter,customFieldFilter:s.searchData.customFieldFilter,types:s.searchData.types};return e};var m=function(){g();v()};var h=function(e){if(!e.children||e.children&&e.children.length===0){return[e.id]}else{var t=e.id;for(var a=0;a<e.children.length;a++){t+=","+h(e.children[a])}return t.split(",")}};var v=function(){var e=p();var t=JSON.parse(JSON.stringify(e));var a=JSON.parse(t.filter);if(l.selectedServiceCatalog){var i=h(l.selectedServiceCatalog);a.$and[0].$and.push({$in:{"serviceCatalog.id":i}});t.filter=JSON.stringify(a)}n.getTicketListData(t).then(function(e){l.tableData=e?e.list||[]:[];l.loadComplete=true;angular.forEach(l.tableData,function(e){e.catalog=e.serviceCatalogNameList?e.serviceCatalogNameList.join("->"):"-";if(e.serviceDeskName==="DEFAULT_SERVICE_DESK_NAME"){e.serviceDeskName=r("translate")("DEFAULT_SERVICE_DESK_NAME")}});b()})};var g=function(){var e=p();n.getTicketChartData(e).then(function(e){l.allServiceCatalogData=e;y()})};var D=function(e,t,a){var i=d();i.xAxis.data=[];i.series[0].data=[];var r=0;if(a===null||a!==null&&t[a]){var n=0;if(a===null){for(var s in e){for(var o in t){if(e[s].id==o){r+=t[o];break}}}}else{r=t[a]||0}for(var s in e){for(var o in t){if(e[s].id==o){i.xAxis.data.push(e[s].name);i.series[0].data.push({value:t[o],percent:c.getPercentValue(t[o]/r)});n+=t[o];break}}}if(a!==null){i.xAxis.data.unshift("-");i.series[0].data.unshift({value:r-n,percent:c.getPercentValue((r-n)/r)})}}l.total=r;l.options=i};var y=function(){if(l.allServiceCatalog&&l.allServiceCatalogData){if(l.selectedServiceCatalog===null){var e=JSON.parse(JSON.stringify(l.allServiceCatalog));e.unshift({name:"无服务目录",id:-1});D(e,l.allServiceCatalogData,null)}else{var t=JSON.parse(JSON.stringify(l.selectedServiceCatalog.children));D(t,l.allServiceCatalogData,l.selectedServiceCatalog.id)}}};function b(){var t=[],a=[],e="工单统计-服务目录";l.tableData.forEach(function(e){t.push([e.subject,e.engineerUserName,e.serviceDeskName,e.requesterName,e.requesterGroupName,e.priority,e.catalog])});l.columns.forEach(function(e){a.push(e.title)});l.exportData={startDate:s.searchData.startDate,endDate:s.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:s.searchData.filterDescription,types:s.searchData.types}}var C=function(){f();u()};var T=this.__proto__.constructor.name+"_"+Date.now();o.register(T,o.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){m()});C();l.$on("statistics.datarange.changed",function(){m()});l.$watch("selectedServiceCatalog",function(e,t){if(e!==t){v();y()}});l.$watch("allServiceCatalog",function(e,t){if(e!==t){y()}});l.$on("$destroy",function(){o.unRegister(T)})}}(org.ewei);+function(v){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketSlaController",e);e.$inject=["$rootScope","$scope","$state","$stateParams","StatisticsBreadcrumbService","searchService","$filter","coreNotifyService"];function e(e,i,t,a,r,n,s,o){var l=this.__proto__.constructor.name+"_"+Date.now();i.questionTip=["响应耗时达标率=筛选条件内该类SLA响应达标的工单数量÷筛选条件内该类SLA所有工单总量×100%","处理耗时达标率=筛选条件内该类SLA处理达标的工单数量÷筛选条件内该类SLA所有工单总量×100%","总体达标率=筛选条件内该类SLA响应且处理达标的工单数量÷筛选条件内该类SLA所有工单总量×100%"];function c(){i.columns=[{title:"SLA",visible:true,sortable:true,class:"text-left",field:"sla",callbackFunction:function(e){t.go("statistics.ticket.slaDetail",{item:e})}},{title:"响应时长达标率",visible:true,sortable:true,field:"rate.response",filter:function(e){return v.utils.n2p(e)}},{title:"处理时长达标率",visible:true,sortable:true,field:"rate.solve",filter:function(e){return v.utils.n2p(e)}},{title:"总体达标率",visible:true,sortable:true,field:"rate.total",filter:function(e){return v.utils.n2p(e)}},{title:"响应超时数量",visible:true,sortable:true,field:"count.responseTimeOut",filter:function(e){return v.utils.n2s(e)},callbackFunction:function(e){if(e.count.responseTimeOut!==0){t.go("statistics.ticket.slaTicket",{routeFather:{item:e},item:{id:e.id,priority:{name:"-",value:""},rate:e.rate},type:"response"})}}},{title:"处理超时数量",visible:true,sortable:true,field:"count.solveTimeOut",filter:function(e){return v.utils.n2s(e)},callbackFunction:function(e){if(e.count.solveTimeOut!==0){t.go("statistics.ticket.slaTicket",{routeFather:{item:e},item:{id:e.id,priority:{name:"-",value:""},rate:e.rate},type:"solved"})}}},{title:"响应且处理达标数量",visible:true,sortable:true,field:"count.qualifiedCount",filter:function(e){return v.utils.n2s(e)}},{title:"工单数量",visible:true,sortable:true,field:"count.total",filter:function(e){return v.utils.n2s(e)}}]}var u=function(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,types:n.searchData.types};return e};function d(){v.sdk.OpenTicketReportApi().slaStatistics(u()).then({success:function(e){i.loadComplete=true;if(e&&e.length>0){i.data=[];e.forEach(function(e){if(v.utils.isDefined(e.slaId)){i.data.push({id:e.slaId,sla:e.slaName,rate:{response:e.respondQualifiedRate,solve:e.solvedQualifiedRate,total:e.qualifiedRate},count:{responseTimeOut:e.respondNotQualifiedCount,solveTimeOut:e.solvedNotQualifiedCount,qualifiedCount:e.qualifiedCount,total:e.ticketCount}})}else{m(e)}});f()}}})}function f(){var t=[],a=[],e="工单统计-SLA分析-SLA达标率";i.data.forEach(function(e){t.push([e.sla,e.rate.response,e.rate.solve,e.rate.total,e.count.responseTimeOut,e.count.solveTimeOut,e.count.qualifiedCount,e.count.total])});i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function p(){var e="ticket.sla";i.searchData={showDataSource:["ticket.solved","ticket.closed"],reportType:e,views:[]};n.loadSearchDataView(e,i.searchData.views,function(){d()})}function m(e){e.qualifiedRate=e.qualifiedRate?e.qualifiedRate:0;e.respondQualifiedRate=e.respondQualifiedRate?e.respondQualifiedRate:0;e.solvedQualifiedRate=e.solvedQualifiedRate?e.solvedQualifiedRate:0;i.slaRates=[{title:"SLA达标率",text:v.utils.n2d(e.qualifiedRate),data:[{name:"达标率",value:e.qualifiedRate},{name:"未达标率",value:100-e.qualifiedRate}],color:"sla.rate.total"},{title:"响应时长达标率",text:v.utils.n2d(e.respondQualifiedRate),data:[{name:"达标率",value:e.respondQualifiedRate},{name:"未达标率",value:100-e.respondQualifiedRate}],color:"sla.rate.response"},{title:"处理时长达标率",text:v.utils.n2d(e.solvedQualifiedRate),data:[{name:"达标率",value:e.solvedQualifiedRate},{name:"未达标率",value:100-e.solvedQualifiedRate}],color:"sla.rate.solve"}]}o.register(l,o.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){d()});i.$on("statistics.datarange.changed",function(e,t){d()});function h(){c();p()}r.push({url:"statistics.ticket.sla",name:"SLA分析"});i.$on("$destroy",function(){r.pop(1);o.unRegister(l)});h()}}(org.ewei);+function(w){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketSlaDetailController",e);e.$inject=["$rootScope","$scope","NgTableParams","$state","$stateParams","StatisticsBreadcrumbService","searchService","$interval","alertService"];function e(e,c,t,a,i,r,n,s,u){var d=[];var o=[];function l(){c.columns=[{title:"SLA",visible:true,sortable:true,field:"sla"},{title:"优先级",visible:true,sortable:true,field:"priority.name"},{title:"响应时长达标率",visible:true,sortable:true,field:"rate.response",filter:function(e){return w.utils.n2p(e)}},{title:"处理时长达标率",visible:true,sortable:true,field:"rate.solve",filter:function(e){return w.utils.n2p(e)}},{title:"总体达标率",visible:true,sortable:true,field:"rate.total",filter:function(e){return w.utils.n2p(e)}},{title:"响应超时数量",visible:true,sortable:true,field:"count.responseTimeOut",callbackFunction:function(e){if(e.count.responseTimeOut!==0){a.go("statistics.ticket.slaTicket",{routeFather:c.routeFather,item:e,type:"response"})}},filter:function(e){return w.utils.n2s(e)}},{title:"处理超时数量",visible:true,sortable:true,field:"count.solveTimeOut",callbackFunction:function(e){if(e.count.solveTimeOut!==0){a.go("statistics.ticket.slaTicket",{routeFather:c.routeFather,item:e,type:"solved"})}},filter:function(e){return w.utils.n2s(e)}},{title:"工单数量",visible:true,sortable:true,field:"count.total",callbackFunction:function(e){if(e.count.total!==0){a.go("statistics.ticket.slaTicket",{routeFather:c.routeFather,item:e})}},filter:function(e){return w.utils.n2s(e)}}]}function f(){m();p()}function p(){w.sdk.OpenTicketReportApi().ticketPriorityStatistics({startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,types:n.searchData.types,slaId:n.searchData.id}).then({success:function(e){if(e&&e.length>0){c.data=[];y();o.forEach(function(a){var i=false;e.forEach(function(e,t){if(a.value===e.priority){i=true;c.data.push({isTotal:false,id:n.searchData.id,sla:n.searchData.sla,priority:a,rate:{response:e.respondQualifiedRate,solve:e.solvedQualifiedRate,total:e.qualifiedRate},count:{responseTimeOut:e.respondNotQualifiedCount,solveTimeOut:e.solvedNotQualifiedCount,total:e.ticketCount}})}});if(i===false){c.data.push({isTotal:false,id:n.searchData.id,sla:n.searchData.sla,priority:a,rate:{response:0,solve:0,total:0},count:{responseTimeOut:0,solveTimeOut:0,total:0}})}});i.item.isTotal=true;i.item.priority={name:"",value:""};c.data.unshift(i.item);c.tableParams.reload();v();g()}}})}function m(){n.searchData.id=i.item.id;n.searchData.sla=i.item.sla}function h(){c.tableParams=c.tableParams||new t({page:1,count:20,sorting:""},{counts:[],total:0,groupBy:function(e){return null},getData:function(e,t){e.resolve(c.data)}})}function v(){c.slaRecalculates=[{group:"P1",type:"quota",text:b("P1").name,count:3860},{group:"P1",type:"rate",title:"响应时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.response",time1:"00:00:00"},{group:"P1",type:"rate",title:"处理时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.solve",time2:"00:00:00"},{group:"P1",type:"rate",title:"SLA达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.total",timeChanged:false},{group:"P1",type:"null"},{group:"P2",type:"quota",text:b("P2").name,count:2100},{group:"P2",type:"rate",title:"响应时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.response",time1:"00:00:00"},{group:"P2",type:"rate",title:"处理时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.solve",time2:"00:00:00"},{group:"P2",type:"rate",title:"SLA达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.total",timeChanged:false},{group:"P2",type:"null"},{group:"P3",type:"quota",text:b("P3").name,count:257},{group:"P3",type:"rate",title:"响应时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.response",time1:"00:00:00"},{group:"P3",type:"rate",title:"处理时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.solve",time2:"00:00:00"},{group:"P3",type:"rate",title:"SLA达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.total",timeChanged:false},{group:"P3",type:"null"},{group:"P4",type:"quota",text:b("P4").name,count:150},{group:"P4",type:"rate",title:"响应时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.response",time1:"00:00:00"},{group:"P4",type:"rate",title:"处理时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.solve",time2:"00:00:00"},{group:"P4",type:"rate",title:"SLA达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.total",timeChanged:false},{group:"P4",type:"null"},{group:"P5",type:"quota",text:b("P5").name,count:150},{group:"P5",type:"rate",title:"响应时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.response",time1:"00:00:00"},{group:"P5",type:"rate",title:"处理时长达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.solve",time2:"00:00:00"},{group:"P5",type:"rate",title:"SLA达标率",text:"无数据",data:[{name:"达标率",value:0},{name:"未达标率",value:100}],color:"sla.rate.total",timeChanged:false},{group:"P5",type:"null"},{group:"P6",type:"null"},{group:"P6",type:"operate"},{group:"P6",type:"null"},{group:"P6",type:"null"},{group:"P6",type:"null"}];c.resetRecalculate()}function g(){var t=[],a=[],e="工单统计-SLA分析-"+i.item.sla;c.data.forEach(function(e){t.push([e.sla,e.priority.name,e.rate.response,e.rate.solve,e.rate.total,e.count.responseTimeOut,e.count.solveTimeOut,e.count.total])});c.columns.forEach(function(e){a.push(e.title)});c.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function D(){l();f();h();c.routeFather=i}function y(){if(localStorage&&localStorage["systemFieldPriority"]){o=JSON.parse(JSON.parse(localStorage["systemFieldPriority"]).customFieldOptions)}}function b(t){var a={name:"",value:""};o.forEach(function(e){if(e.value===t){a=e}});return a}function C(t,a){w.sdk.OpenTicketReportApi().listTicketMetricByPriority({startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,types:n.searchData.types,slaId:n.searchData.id}).then({success:function(e){if(e&&e.length>0){e.forEach(function(e){d.push({time1:e.responseMinutes?e.responseMinutes:0,time2:e.solveMinutes?e.solveMinutes:0,group:e.priority})});t(a)}}})}c.recalculate=function(e){if(d.length===0){C(T,e)}else{T(e)}};var T=function(t){var a={response:0,solve:0,total:0};var i="";var r=[];var n=true;c.slaRecalculates.forEach(function(e){if(e.group===t){if(e.type==="rate"){r.push(e);if(e.color==="sla.rate.total"){n=e.timeChanged}}else if(e.type==="quota"){i=e.text}}});if(n){var s=w.utils.t2m(r[0].time1);var o=w.utils.t2m(r[1].time2);var l=0;d.forEach(function(e){if(e.group===t){if(e.time1<s){a.response++}if(e.time2<o){a.solve++}if(e.time1<s&&e.time2<o){a.total++}l++}});if(l>0){r.forEach(function(e){var t=0;if(e.color==="sla.rate.total"){t=a.total/l*100;e.timeChanged=false}if(e.color==="sla.rate.response"){t=a.response/l*100}if(e.color==="sla.rate.solve"){t=a.solve/l*100}e.text=t!==0?w.utils.n2d(t):"无数据";e.data[0].value=t;e.data[1].value=100-t})}else{r.forEach(function(e){if(e.color==="sla.rate.total"){e.timeChanged=false}});u.add(i+"没有工单","danger")}}};c.timeChanged=function(t){c.slaRecalculates.forEach(function(e){if(e.group===t){if(e.timeChanged!==undefined){e.timeChanged=true}}})};function k(e,t){for(var a in c.data){if(c.data.hasOwnProperty(a)&&c.data[a].rate&&c.data[a].priority.value===t){var i={sla:{rate:c.data[a].rate}};var r=e.split(".");for(var n in r){if(r.hasOwnProperty(n)){i=i[r[n]];if(!i){break}}}return i}}}c.resetRecalculate=function(){c.slaRecalculates.forEach(function(e){if(e.type==="rate"){if(e.time1){e.time1="00:00:00"}else if(e.time2){e.time2="00:00:00"}if(e.timeChanged){e.timeChanged=false}e.data[0].value=w.utils.n2d(k(e.color,e.group));e.data[1].value=100-e.data[0].value;e.text=e.data[0].value*1!==0?w.utils.n2d(e.data[0].value):"无数据"}})};r.push({url:"statistics.ticket.sla",name:"SLA分析"});r.push({name:i.item.sla});c.$on("$destroy",function(){r.pop(2)});D()}}(org.ewei);+function(d){"use strict";angular.module("eweiApp.statistics").controller("StatisticsTicketSlaTicketController",e);e.$inject=["$rootScope","$scope","$state","$stateParams","StatisticsBreadcrumbService","searchService","coreModelService"];function e(e,t,a,i,r,n,s){t.queryName="工单统计-SLA分析-"+i.routeFather.item.sla+"-"+(i.item.priority.name===""?"-":i.item.priority.name)+u(i.type);function o(){var e=JSON.parse(n.searchData.filter);if(i.item.id>0){e["$and"][0]["$and"].push({$eq:{"ticketMetric.sla.id":i.item.id}})}else{e["$and"][0]["$and"].push({$is_null:"ticketMetric.sla.id"})}if(i.item.priority.value===""){}else{e["$and"][0]["$and"].push({$eq:{priority:i.item.priority.value}})}if(i.type==="response"){e["$and"][0]["$and"].push({$eq:{"ticketMetric.respondQualified":0}})}else if(i.type==="solved"){e["$and"][0]["$and"].push({$eq:{"ticketMetric.solveQualified":0}})}t.queryParams={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:JSON.stringify(e),customFieldFilter:n.searchData.customFieldFilter,filterDescription:n.searchData.filterDescription,types:n.searchData.types,page:{pageNumber:1,pageSize:20}};d.logger.info("getListTicketBySlaAndPriority",n.searchData);l()}function l(){var e={response:i.item.rate.response?i.item.rate.response:0,solve:i.item.rate.solve?i.item.rate.solve:0,total:i.item.rate.total?i.item.rate.total:0};t.slaRates=[{title:"SLA达标率",text:d.utils.n2d(e.total),data:[{name:"达标率",value:e.total},{name:"未达标率",value:100-e.total}],color:"sla.rate.total"},{title:"响应时长达标率",text:d.utils.n2d(e.response),data:[{name:"达标率",value:e.response},{name:"未达标率",value:100-e.response}],color:"sla.rate.response"},{title:"处理时长达标率",text:d.utils.n2d(e.solve),data:[{name:"达标率",value:e.solve},{name:"未达标率",value:100-e.solve}],color:"sla.rate.solve"}]}function c(){o();if(s.detail.statistics.columns.ticket.sla.length>0){t.defaultColumns=s.detail.statistics.columns.ticket.sla}else{t.defaultColumns=s.detail.statistics.columns.ticket.sla=["no","subject","requester.name","requester.userGroup.name","status","createdAt"]}}function u(e){if(e==="response"){return"(响应超时)"}if(e==="solved"){return"(处理超时)"}if(e===null){return"(所有工单)"}}r.push({url:"statistics.ticket.sla",name:"SLA分析"});r.push({url:"statistics.ticket.slaDetail",params:{item:i.routeFather.item},name:i.routeFather.item.sla});r.push({name:(i.item.priority.name===""?"-":i.item.priority.name)+u(i.type)});t.$on("$destroy",function(){r.pop(3)});c()}}(org.ewei);+function(n){"use strict";angular.module("eweiApp.statistics").directive("toolTip",e);e.$inject=["$filter"];function e(r){return{restrict:"AE",replace:false,transclude:true,scope:{tip:"=",placement:"@",trigger:"@",isOpen:"@",opacity:"@"},templateUrl:"source/statistics/directive/tool-tip/tooltip.html",link:function(e,t,a){var i="";if(n.utils.isArray(e.tip)){e.tip.forEach(function(e){i+="<li>"+e+"</li>"});i="<ul>"+i+"</ul>"}if(n.utils.isString(e.tip)){i=e.tip}e.placement=e.placement?e.placement:"left";e.trigger=e.trigger?e.trigger:"mouseenter";e.isOpen=e.isOpen?e.isOpen:false;e.opacity=e.opacity?n.utils.s2n(e.opacity):.7;e.htmlTip=r("trusted")(i)}}}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").directive("echartPie",e);e.$inject=["echartPieColor","$window"];function e(l,c){return{restrict:"A",replace:false,scope:{text:"=",data:"=",color:"=",radius:"="},link:function(e,t,a){var i=null;function r(e,t,a,i){return{title:{text:e,x:"center",y:"center",show:true,textStyle:{fontSize:"16"}},color:a,series:[{type:"pie",radius:i?i:["40","50"],hoverAnimation:false,avoidLabelOverlap:false,label:{normal:{show:false,position:"center"}},data:t}]}}function n(){i=i||echarts.getInstanceByDom(t[0])||echarts.init(t[0]);i.setOption(r(e.text,e.data,l[e.color],e.radius))}var s=e.$watch("data",function(e,t){if(t!==e){n()}},true);var o=e.$watch("text",function(e,t){if(t!==e){n()}},true);e.$on("$destroy",function(){s();o();angular.element(c).off("resize",i.resize);if(i){i.dispose()}});n()}}}}();+function(){"use strict";angular.module("eweiApp.statistics").directive("echartRadar",e);e.$inject=["$window"];function e(l){return{restrict:"A",replace:false,scope:{data:"=",indicator:"="},link:function(e,t,a){var i=null;function r(e,t){return{name:{show:true,formatter:function(e){if(e.length>4){return e.substr(0,4)+"..."}return e},textStyle:{color:"#000000"}},tooltip:{},radar:[{indicator:t}],series:[{type:"radar",data:e}]}}function n(){i=i||echarts.getInstanceByDom(t[0])||echarts.init(t[0]);i.setOption(r(e.data,e.indicator))}var s=e.$watch("data",function(e,t){if(t!==e){n()}},true);var o=e.$watch("indicator",function(e,t){if(t!==e){n()}},true);e.$on("$destroy",function(){s();o();angular.element(l).off("resize",i.resize);if(i){i.dispose()}});n()}}}}();(function(){"use strict";angular.module("com.ewei.angular.ui").directive("echartStackArea",e);e.$inject=["$rootScope","$window"];function e(e,r){return{restrict:"EA",replace:true,scope:{option:"="},link:function(e,a,t){var i=function(e){var t=echarts.getInstanceByDom(a[0])||echarts.init(a[0]);t.setOption(e)};e.$watch("option",function(e){if(e){i(e)}});e.$on("$destroy",function(){angular.element(r).off("resize",myChart.resize);if(myChart){myChart.dispose()}})}}}})();+function(){"use strict";angular.module("eweiApp.statistics").directive("echartBarStack",e);e.$inject=["$window"];function e(o){return{restrict:"A",replace:false,scope:{chartData:"="},link:function(e,t,a){var i=i||echarts.getInstanceByDom(t[0])||echarts.init(t[0]);function r(e,t,a,i){var r=t.length<20?30:10;return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},dataZoom:[{show:true,realtime:true,start:0,end:100},{type:"inside",realtime:true,start:0,end:100}],legend:{data:e,right:0},grid:{left:"50",right:"50",bottom:"50",containLabel:true},xAxis:[{type:"category",data:t}],yAxis:[{type:"value",name:a,axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}],series:[{name:i[0].name,type:"bar",stack:"stack",barWidth:r,data:i[0].data,itemStyle:{normal:{color:"rgb(255,153,0)"}}},{name:i[1].name,type:"bar",stack:"stack",barWidth:r,data:i[1].data,itemStyle:{normal:{color:"rgb(102,102,102)"}}},{name:i[2].name,type:"bar",barWidth:r,data:i[2].data,itemStyle:{normal:{color:"rgb(77,187,165)"}}}]}}function n(){if(e.chartData){i.setOption(r(e.chartData.legendData,e.chartData.xAxisData,e.chartData.yAxisName,e.chartData.series))}}var s=e.$watch("chartData",function(e,t){if(t!==e){n()}},true);angular.element(o).on("resize",i.resize);e.$on("$destroy",function(){s();angular.element(o).off("resize",i.resize);if(i){i.dispose()}});n()}}}}();+function(){"use strict";angular.module("eweiApp.statistics").directive("echartStairBar",e);e.$inject=["$window"];function e(l){return{restrict:"A",replace:false,scope:{xaxis:"=",baseSeries:"=",series:"=",color:"="},link:function(e,t,a){var i=null;function r(e,t,a,i){var r=e&&e.length<20?30:10;return{color:[i],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"0",right:"0",bottom:"0",containLabel:true},xAxis:{type:"category",splitLine:{show:false},data:e,axisLine:{show:false},axisTick:{alignWithLabel:true,lineStyle:{color:"#eef2f9"}}},yAxis:{axisLabel:{formatter:""},minInterval:1,type:"value",axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}}},series:[{name:"最小",type:"bar",stack:"总量",itemStyle:{normal:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"},emphasis:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"}},data:t,barWidth:r},{name:"最大",type:"bar",stack:"总量",label:{normal:{show:true,position:"top"}},data:a,barWidth:r}]}}function n(){i=i||echarts.getInstanceByDom(t[0])||echarts.init(t[0]);i.setOption(r(e.xaxis,e.baseSeries,e.series,e.color))}var s=e.$watch("baseSeries",function(e,t){if(t!==e){n()}},true);var o=e.$watch("series",function(e,t){if(t!==e){n()}},true);e.$on("$destroy",function(){s();o();angular.element(l).off("resize",i.resize);if(i){i.dispose()}});n()}}}}();+function(e){"use strict";angular.module("eweiApp.statistics").directive("echartNoData",t);t.$inject=[];function t(){return{restrict:"E",transclude:true,replace:false,scope:{},templateUrl:"source/statistics/directive/echart-nodata/echart-nodata.html",link:function(e,t,a){}}}}();+function(e){"use strict";angular.module("eweiApp.statistics").directive("searchBox",t).controller("searchBoxCtrl",a);t.$inject=[];function t(){return{restrict:"EA",transclude:true,replace:false,scope:{searchData:"=",hasAddSearch:"="},templateUrl:"source/statistics/directive/search-box/search-box.html",controller:a,link:function(e,t,a){}}}a.$inject=["$scope","coreNotifyService"];function a(i,e){var t=this.__proto__.constructor.name+"_"+Date.now();i.showView=true;i.showDetail=false;i.reportType=i.searchData.reportType;i.views=i.searchData.views;i.showDataSource=i.searchData.showDataSource;var r={view:function(){i.showView=true;i.showDetail=false;i.headerType="view"},detail:function(e,t){i.showView=false;i.showDetail=true;i.openType=e;i.view=t;i.headerType="detail"}};function a(){e.register(t,e.constant.EVENT_STATISTICS_SEARCH_DETAIL_EDIT,function(e,t){if(t&&t.view){r["detail"]("edit",t.view)}});e.register(t,e.constant.EVENT_STATISTICS_SEARCH_DETAIL_ADD,function(e,t){var a={title:"自定义筛选方法"+i.views.length,reportType:i.reportType,isDefault:false};r["detail"]("add",a)});e.register(t,e.constant.EVENT_STATISTICS_SEARCH_DETAIL_SEARCH,function(e,t){i.views.forEach(function(e){if(e.active){r["detail"]("search",e)}})});e.register(t,e.constant.EVENT_STATISTICS_SEARCH_VIEW,function(e,t){if(t){i.views.push(t)}r["view"]()});e.register(t,e.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){r["view"]()})}var n=i.$watch("searchData",function(e,t){if(e!==t){}});function s(){e.unRegister(t)}i.$on("$destory",function(){n();s()});function o(){a();r["view"]()}o()}}(org.ewei);+function(s){"use strict";angular.module("eweiApp.statistics").directive("searchView",e).controller("searchViewCtrl",t);e.$inject=[];function e(){return{restrict:"EA",transclude:true,replace:false,scope:{views:"=",hasAddSearch:"="},templateUrl:"source/statistics/directive/search-box/search-view.html",controller:t,link:function(e,t,a){}}}t.$inject=["$scope","coreNotifyService","alertService","$modal_","searchService"];function t(i,a,t,r,n){if(s.utils.isUndefined(i.hasAddSearch)){i.hasAddSearch=true}i.select=function(t){i.views.forEach(function(e){if(e.id!==t.id){e.active=false}});t.active=true;s.sdk.OpenReportFilterCondirionApi().updateSelected({id:t.id,selected:true}).then(function(e){n.searchData.filter=t.filter;n.searchData.customFieldFilter=t.customFieldFilter;n.searchData.types=t.selectedDataSource;n.searchData.filterDescription=t.filterDescription;a.doNotify(a.constant.EVENT_STATISTICS_SEARCH_DONE)})};i.edit=function(e){a.doNotify(a.constant.EVENT_STATISTICS_SEARCH_DETAIL_EDIT,{view:e})};i.del=function(a){i._messages="确定删除【"+a.title+"】吗？";var e=r({scope:i,title:"删除确认",contentTemplate:"source/views/alter_common.html",html:true,show:true,placement:"center"});i.$ok=function(){s.sdk.OpenReportFilterCondirionApi().deleteById({id:a.id}).then({success:function(e){i.views.forEach(function(e,t){if(e.id===a.id){i.views.splice(t,1)}})},fail:function(e){t.add("删除筛选条件失败","danger")}});e.$promise.then(e.hide)};i.$hide=function(){e.$promise.then(e.hide)}};i.add=function(){a.doNotify(a.constant.EVENT_STATISTICS_SEARCH_DETAIL_ADD)}}}(org.ewei);+function(H){"use strict";angular.module("eweiApp.statistics").directive("searchDetail",e).controller("searchDetailCtrl",t);e.$inject=[];function e(){return{restrict:"EA",transclude:true,replace:false,scope:{openType:"=",view:"=",showDataSource:"=",reportType:"="},templateUrl:"source/statistics/directive/search-box/search-detail.html",controller:t,link:function(e,t,a){}}}t.$inject=["$filter","$http","$modal_","$scope","searchService","alertService","coreNotifyService","$rootScope","$state","$stateParams","$resource","permissions","allConditionOptionsTicketReport","anyConditionOptionsTicketReport","compareOptionsReport","allConditionOptionsChatReport","anyConditionOptionsChatReport","$timeout","ticketEvaluateService","commonTools","ticketStatusCompareService"];function t(r,e,t,l,a,i,n,s,o,c,u,d,f,p,m,h,v,g,D,y,b){l.dataSource=[];l.selectDataSource=function(e){var t=false;l.dataSource.forEach(function(e){if(e.active){t=true}});if(!t){i.add("必须选择一个数据源","danger");e.active=true}};function C(){l.view.selectedDataSource=l.view.selectedDataSource||[];l.view.selectedDataSource.length=0;l.dataSource.forEach(function(e){if(e.active){l.view.selectedDataSource.push(e.value)}});if(l.view.selectedDataSource.length===0){i.add("必须选择一个数据源","danger");return false}else{return true}}l.saveSearch=function(){if(!l.jugeCondition()){return}if(C()){var e=T();l.view.filter=e.system;l.view.customFieldFilter=e.custom;l.view.filterDescription=k();if(l.openType==="add"){H.sdk.OpenReportFilterCondirionApi().save({reportFilterCondition:{reportType:l.view.reportType,filter:l.view.filter,customFieldFilter:l.view.customFieldFilter,types:l.view.selectedDataSource,title:l.view.title,filterDescription:l.view.filterDescription,isDefault:l.view.isDefault}}).then({success:function(e){l.view.id=e;n.doNotify(n.constant.EVENT_STATISTICS_SEARCH_VIEW,l.view)},fail:function(e){i.add("添加筛选方法失败","danger")}})}else{H.sdk.OpenReportFilterCondirionApi().update({reportFilterCondition:{id:l.view.id,reportType:l.view.reportType,filter:l.view.filter,customFieldFilter:l.view.customFieldFilter,types:l.view.selectedDataSource,title:l.view.title,filterDescription:l.view.filterDescription,isDefault:l.view.isDefault,selected:l.view.active}}).then({success:function(e){if(l.view.active){l.confirmSearch()}else{n.doNotify(n.constant.EVENT_STATISTICS_SEARCH_VIEW)}},fail:function(e){i.add("更新筛选方法失败","danger")}})}}};l.confirmSearch=function(){if(C()){a.searchData.types.length=0;l.dataSource.forEach(function(e){if(e.active){a.searchData.types.push(e.value)}});var e=T();l.view.filter=a.searchData.filter=e.system;l.view.customFieldFilter=a.searchData.customFieldFilter=e.custom;l.view.filterDescription=a.searchData.filterDescription=k();n.doNotify(n.constant.EVENT_STATISTICS_SEARCH_DONE)}};l.cancelSearch=function(){n.doNotify(n.constant.EVENT_STATISTICS_SEARCH_VIEW)};function T(){var e={system:{$and:[]},custom:{$and:[]}};var i={system:{$and:[]},custom:{$and:[]}};var r={system:{$or:[]},custom:{$or:[]}};l.andConditions.forEach(function(e){if(e.attribute!=="-1"&&e.compare){var t={};var a=e.attribute;if(e.attribute.indexOf("ticketcustomfield")>-1){a=e.attribute.replace(/[^0-9]/gi,"")}t[e.compare]={};t[e.compare][a]=j(e);e.attribute.indexOf("ticketcustomfield")>-1?i.custom["$and"].push(t):i.system["$and"].push(t)}});l.orConditions.forEach(function(e){if(e.attribute!=="-1"&&e.compare){var t={};var a=e.attribute;if(e.attribute.indexOf("ticketcustomfield")>-1){a=e.attribute.replace(/[^0-9]/gi,"")}t[e.compare]={};t[e.compare][a]=j(e);e.attribute.indexOf("ticketcustomfield")>-1?r.custom["$or"].push(t):r.system["$or"].push(t)}});e.system["$and"].push(i.system);e.system["$and"].push(r.system);e.custom["$and"].push(i.custom);e.custom["$and"].push(r.custom);return{system:JSON.stringify(e.system),custom:JSON.stringify(e.custom)}}function k(){var t={system:[],custom:[]};var a={system:[],custom:[]};l.andConditions.forEach(function(e){if(e.attribute!=="-1"){if(e.attribute.indexOf("ticketcustomfield")>-1){t.custom.push(e.display)}else{t.system.push(e.display)}}});l.orConditions.forEach(function(e){if(e.attribute!=="-1"){if(e.attribute.indexOf("ticketcustomfield")>-1){a.custom.push(e.display)}else{a.system.push(e.display)}}});var e={$and:t.system.concat(t.custom),$or:a.system.concat(a.custom)};return JSON.stringify(e)}function w(){l.andConditions=[];l.orConditions=[];var s=l.view.filterDescription?JSON.parse(l.view.filterDescription):{$and:[],$or:[]};var e=l.view.filter?JSON.parse(l.view.filter)["$and"]:[{$and:[]},{$or:[]}];var t=l.view.customFieldFilter?JSON.parse(l.view.customFieldFilter)["$and"]:[{$and:[]},{$or:[]}];var a=[];var i=[];a=e[0]["$and"].concat(t[0]["$and"]);i=e[1]["$or"].concat(t[1]["$or"]);a.forEach(function(e,t){var a=Object.getOwnPropertyNames(e)[0];var i=Object.getOwnPropertyNames(e[a])[0];var r;if(i=="via.channel"){if(typeof s["$and"][t].value=="string"){r={channel:e[a][i],viaType:e[a][i],via:{}}}else{r=s["$and"][t].value}}else{r=e[a][i]}if(i==="serviceDesk.id"&&(a==="$eq"||a==="$ne_or_null")){a=a==="$eq"?"$in":"$not_in"}var n=s["$and"][t];l.andConditions.push({compare:a,attribute:i,value:r,tally:"and",orderKey:t,display:n})});i.forEach(function(e,t){var a=Object.getOwnPropertyNames(e)[0];var i=Object.getOwnPropertyNames(e[a])[0];var r;if(i=="via.channel"){if(typeof s["$or"][t].value=="string"){r={channel:e[a][i],viaType:e[a][i],via:{}}}else{r=s["$or"][t].value}}else{r=e[a][i]}var n=s["$or"][t];l.orConditions.push({compare:a,attribute:i,value:r,tally:"or",orderKey:t,display:n})});var r=[];r=r.concat(l.andConditions,l.orConditions);r.forEach(function(t){if(t.compare.indexOf("ticket_custom_field")>-1){l.customField.forEach(function(e){if(e.id===parseInt(t.attribute)){t.attribute="ticketcustomfield_"+e.type+"_"+t.attribute}})}q(t);Y(t);P(t)});if(l.andConditions.length===0){l.andConditions=[{attribute:"-1",tally:"and"}]}if(l.orConditions.length===0){l.orConditions=[{attribute:"-1",tally:"or"}]}}function S(){l.dataSource=a.getShowDataSource(l.showDataSource);l.dataSource.forEach(function(e){e.active=false});l.view.selectedDataSource&&l.view.selectedDataSource.forEach(function(t){l.dataSource.forEach(function(e){if(e.value===t){e.active=true}})})}function _(a){e.get("custom_field.json?scope=ticket&active=true&ignore_scan_able=true").success(function(e,t){l.customField=e.json;angular.forEach(e.json,function(e,t,a){var i={};var r="";if(e.systemFieldKey==="priority"){i={option:"工单："+e.title,value:"priority",valueType:"select"}}else if(e.systemFieldKey==="ticket_type"){i={option:"工单："+e.title,value:"ticketType.id",valueType:"select"}}else if(e.systemFieldKey==="service_catalog"){i={option:"工单："+e.title,value:"serviceCatalog.id",valueType:"servicecatalog"}}else if(e.systemFieldKey==="subject"){i={option:"工单："+e.title,value:"subject",valueType:"text"}}else if(e.systemFieldKey==="tags"){i={option:"工单："+e.title,value:"tags",valueType:"text"}}else if(e.systemFieldKey==="ticket_description"){i={option:"工单："+e.title,value:"ticket_description",valueType:"text"}}else if(e.type==="date_to_date"){r={option:"工单：自定义字段-"+e.title,value:"ticketcustomfield_"+e.type+"_"+e.id,valueType:"date_to_date"}}else if(e.type==="date_time"){i={option:"工单：自定义字段-"+e.title,value:"ticketcustomfield_"+e.type+"_"+e.id,valueType:"date_time"}}else{i={option:"工单：自定义字段-"+e.title,value:"ticketcustomfield_"+e.type+"_"+e.id,valueType:"text"}}if(e.type==="text"||e.type==="email"||e.type==="regexp"||e.type==="textarea"||e.type==="number"||e.type==="decimal"){i.valueType="text"}else if(e.type==="date"){i.valueType=e.type;i.start=false}else if(e.type==="date_time"){i.valueType=e.type}else if(e.type==="options"){if(e.customFieldOptions){if(e.systemFieldKey){i.valueType="select";var n=angular.fromJson(e.customFieldOptions);for(var s=0,o=n.length;s<o;s++){n[s].option=n[s].name}i.valueOptions=n}else{i.valueType="options";if(e.customFieldOptions){i.valueOptions=e}}}}else if(e.type==="cascade_options"){if(e.systemFieldKey==="service_catalog"){i.valueType="serviceCatalog"}else{i.valueType="cascade_options";if(e.customFieldOptions){i.valueOptions=e}}}else if(e.type==="multi_options"){i.valueType="multi_options";if(e.customFieldOptions){i.valueOptions=e}}else if(e.type==="checkbox"){i.valueType="checkbox"}else{i.valueType="text"}i.edit_able=e.edit_able;if(r!==""){i.startTimeForm=false;i.endTimeForm=false}else{if(i.value!=="ticket_description"){l.andConditionOptions.push(angular.copy(i));l.orConditionOptions.push(angular.copy(i))}}});a()})}function E(e){e.valueOptions=[{option:"Email收件箱",value:"email"},{option:"网页表单(feedback)",value:"form"},{option:"在线交谈/远程协助",value:"chat"},{option:"微信客服",value:"weixin"},{option:"CTI客服",value:"new_phone"},{option:"帮助中心",value:"helpcenter"},{option:"客服界面",value:"console"},{option:"API工单渠道",value:"api"},{option:"钉钉渠道",value:"dingding"}]}function A(e){e.valueOptions=[{option:"已解决",value:"1"},{option:"未解决",value:"0"}]}function x(e){e.valueOptions=[{option:"未分派",value:"new"},{option:"已分派",value:"assigned"},{option:r("translate")("TICKET_STATUS_OPEN"),value:"open"},{option:r("translate")("TICKET_STATUS_SOLVED"),value:"solved"},{option:r("translate")("TICKET_STATUS_PENDING"),value:"pending"},{option:"关闭",value:"closed"}]}function O(e){e.valueOptions=[{option:"无效信息",value:"无效信息"},{option:"重复信息",value:"重复信息"},{option:"恶意骚扰",value:"恶意骚扰"},{option:"其他原因",value:"其他原因"}]}function R(t){var e=JSON.parse(JSON.parse(localStorage.getItem("systemFieldPriority")).customFieldOptions);t.valueOptions=[];e.forEach(function(e){t.valueOptions.push({option:e.name,value:e.value})})}function M(o){e({url:"ticket_type.json",method:"GET",params:{_count:12332,_do_count:false,_fields:"id,name,description,isDefault"}}).success(function(e,t,a,i){if(e.ticketTypes){var r=[];for(var n=0,s=e.ticketTypes.length;n<s;n++){r.push({option:e.ticketTypes[n].name,value:""+e.ticketTypes[n].id})}o.valueOptions=r}})}function F(e){var t=[];for(var a=1;a<=5;a++){t.push({option:a+"分",value:a+""})}e.valueOptions=t}function N(e){e.valueOptions=[{option:"客户",value:"$customer"},{option:"客服",value:"$engineer"}]}function L(e){e.valueOptions=[{option:"真实评价",value:"true"}]}function I(e){var t=[];for(var a=0,i=e.length;a<i;a++){t.push(l.compareOptions[e[a]])}return t}function q(e){if(e.attribute.indexOf("ticketcustomfield")!==-1){if(e.attribute.indexOf("multi_options")!==-1){e.compareOptions=I([29,30])}else if(e.attribute.indexOf("date")!==-1||e.attribute.indexOf("number")!==-1||e.attribute.indexOf("decimal")!==-1){e.compareOptions=I([20,27,28])}else if(e.attribute.indexOf("textarea")!==-1){e.compareOptions=I([24,25])}else if(e.attribute.indexOf("checkbox")!==-1){e.compareOptions=I([22,23])}else if(e.attribute.indexOf("text")!==-1){e.compareOptions=I([20,21,24,25])}else{e.compareOptions=I([20,21])}}else{if(e.attribute==="priority"||e.attribute==="status"||e.attribute==="ticketType.id"||e.attribute==="requester.id"||e.attribute==="user.id"||e.attribute==="evaluate.score"){e.compareOptions=I([0,1]);if(e.attribute==="status"){e.compareOptions=e.compareOptions.concat(I([31,32]))}}else if(e.attribute==="serviceDesk.id"){e.compareOptions=I([41,42])}else if(e.attribute==="id"){e.compareOptions=I([35,36])}else if(e.attribute==="serviceCatalog.id"){e.compareOptions=I([37,38,39,40])}else if(e.attribute==="firstMessage"){e.compareOptions=I([12,13])}else if(e.attribute==="transfer"){e.compareOptions=I([0,1])}else if(e.attribute==="tripartite"){e.compareOptions=I([0,1])}else if(e.attribute==="isAutoinvite"){e.compareOptions=I([0,1])}else if(e.attribute==="autoClose"){e.compareOptions=I([0,1])}else if(e.attribute==="isQualitied"){e.compareOptions=I([0,1])}else if(e.attribute==="requester.userGroup.id"||e.attribute==="user.userGroup.id"){e.compareOptions=I([33,34])}else if(e.attribute==="engineer.id"){e.compareOptions=I([14,15])}else if(e.attribute==="tags"){e.compareOptions=I([10,11])}else if(e.attribute==="subject"||e.attribute==="ticket_description"){e.compareOptions=I([12,13])}else if(e.attribute==="createdAt"||e.attribute==="ticketMetric.responseAt"||e.attribute==="ticketMetric.pausedAt"||e.attribute==="ticketMetric.solvedAt"||e.attribute==="ticketMetric.closedAt"){e.compareOptions=I([4,5,6])}else if(e.attribute==="ticketComment"){e.compareOptions=I([16,17])}else if(e.attribute==="via.channel"){e.compareOptions=I([18,19])}else if(e.attribute.indexOf("checkbox")>=0){e.compareOptions=I([22,23]);e.value="true"}else if(e.attribute.indexOf("textarea")>=0){e.compareOptions=I([24,25])}else if(e.attribute.indexOf("date")>=0||e.attribute.indexOf("number")>=0||e.attribute.indexOf("decimal")>=0){e.compareOptions=I([26,27,28])}else if(e.attribute==="evaluate.solved"){e.compareOptions=I([18])}else if(e.attribute==="lastReplyUserType"){e.compareOptions=I([43])}else if(e.attribute==="ticketHaveEvaluate"){e.compareOptions=I([44])}else{e.compareOptions=I([7,8,9])}}}function Y(e){if(e.tally==="and"){for(var t=0,a=l.andConditionOptions.length;t<a;t++){if(l.andConditionOptions[t].value===e.attribute){e.valueType=l.andConditionOptions[t].valueType;e.valueOptions=angular.copy(l.andConditionOptions[t].valueOptions);e.edit_able=l.andConditionOptions[t].edit_able}}}else{for(var t=0,a=l.orConditionOptions.length;t<a;t++){if(l.orConditionOptions[t].value===e.attribute){e.valueType=l.orConditionOptions[t].valueType;e.valueOptions=angular.copy(l.orConditionOptions[t].valueOptions);e.edit_able=l.orConditionOptions[t].edit_able}}}if(e.valueType==="select"){if(e.attribute==="status"){x(e)}else if(e.attribute==="ticketType.id"){M(e)}else if(e.attribute==="priority"){R(e)}else if(e.attribute==="evaluate.score"){F(e)}else if(e.attribute==="deleteTicket"){O(e)}else if(e.attribute==="via.channel"){E(e)}else if(e.attribute==="evaluate.solved"){A(e)}else if(e.attribute==="lastReplyUserType"){N(e)}else if(e.attribute==="ticketHaveEvaluate"){L(e)}}}function P(e){if(e.attribute==="createdAt"||e.attribute==="ticketMetric.responseAt"||e.attribute==="ticketMetric.pausedAt"||e.attribute==="ticketMetric.solvedAt"||e.attribute==="lastReply"||e.attribute==="customerLastReply"||e.attribute==="engineerLastReply"){e.value=parseInt(e.value)}else if(e.attribute==="deleteTicket"){if(e.value!=="无效信息"&&e.value!=="重复信息"&&e.value!=="恶意骚扰"){e.reason=e.value;e.value="其他原因"}}else if(e.valueType==="copyTo"){var t=e.value;t=t.replace("[${","").replace("!}]","").replace("copy_to_user_or_email_ticket_ids_","");var a=t.split(",");var i=[];var r=e.display.value.split(",");a.forEach(function(e,t){if(/^\d+$/.test(e)){i.push({id:parseInt(e),name:r[t]})}else{i.push({id:eweiCommon.uuid(32),name:r[t]})}});e.value=i}else if(e.attribute==="user.id"){e.value={id:e.value,name:e.display.value}}else if(e.attribute==="transfer"||e.attribute==="tripartite"||e.attribute==="isAutoinvite"||e.attribute==="autoClose"||e.attribute==="isQualitied"){return true}else if(e.attribute==="engineer.id"){Q(e)}else if(e.attribute==="serviceDesk.id"){G(e)}else if(e.attribute==="requester.id"){V(e)}else if(e.attribute==="requester.userGroup.id"||e.attribute==="user.userGroup.id"){W(e)}else if(e.attribute==="addCC"){e.value=JSON.parse(e.value)}else if(e.attribute==="status"){if(e.value){e.value=b.getCurrentStatus(e.value)}}else if(e.attribute==="serviceCatalog.id"){if(e.compare==="$in"||e.compare==="$not_in"){e.value={id:parseInt(e.value.replace(/[^0-9]/gi,"")),name:e.display.value}}else{e.value={id:e.value,name:e.display.value}}}if(e.valueType==="cascade_options"||e.valueType==="multi_options"||e.valueType==="options"){e.valueOptions.value=e.value}else if(e.valueType==="date"){e.value=y.parseDate(e.value,"yyyy/MM/dd")}else if(e.valueType==="date_time"){}else if(e.valueType==="date_to_date"){var n=e.value;n=n.split("-");e.startTime=y.parseDate(n[0],"yyyy/MM/dd");e.endTime=y.parseDate(n[1],"yyyy/MM/dd")}else if(e.valueType==="checkbox"){}}function j(e){if(e.valueType==="cascade_options"||e.valueType==="multi_options"||e.valueType==="options"){return e.valueOptions.value}if(e.valueType==="date"){return r("date")(e.value,"yyyy/MM/dd").toString()}if(e.valueType==="engineer"){if(e.engineer&&e.engineerDesk){return e.engineerDesk.id+"_"+e.engineer.id}else if(e.engineer){return e.engineer.id}}if(e.valueType==="copyTo"){var t=[];e.value.forEach(function(e){if(typeof e.id==="number"){t.push(e.id)}else{t.push(Base64.encode(e.name))}});return"[${copy_to_user_or_email_ticket_ids_"+t.join(",")+"!}]"}if(e.valueType==="userGroup"){var t=[];e.value.forEach(function(e){t.push(e.id)});return JSON.stringify(t)}if(e.valueType==="via"){if(e.value.via&&e.value.via.uid){return e.value.viaType+"_"+e.value.via.uid+"_"+e.value.via.name}if(e.value.viaType){return e.value.viaType}return e.value}if(e.attribute==="transfer"||e.attribute==="tripartite"||e.attribute==="isAutoinvite"||e.attribute==="autoClose"||e.attribute==="isQualitied"){return true}if(typeof e.value==="object"){if(e.attribute.indexOf("ticketcustomfield")>=0){if(e.attribute.indexOf("ticketcustomfield_date")>=0){return r("date")(e.value,"yyyy/MM/dd").toString()}else{return e.value}}else{if(e.compare==="$in"||e.compare==="$not_in"){if(e.attribute==="serviceCatalog.id"){return"[${service_catalog_and_children_id_"+e.value.id+"!}]"}return e.value.id}else{return e.value.id}}}else{if(e.attribute.indexOf("ticketcustomfield_checkbox")>=0){return"true"}else{if(e.compare==="$in"||e.compare==="$not_in"){if(e.attribute==="status"){return b.run(e.value,e.compare)}}else{return e.value}}}}function B(t){var a={option:null,compare:null,value:null};l.andConditionOptions.forEach(function(e){if(e.value===t.attribute){a.option=e.option}});t.compareOptions.forEach(function(e){if(e.value===t.compare){a.compare=e.option}});if(t.valueOptions&&(t.attribute.indexOf("ticketcustomfield_multi_options")>-1||t.attribute.indexOf("ticketcustomfield_cascade_options")>-1||t.attribute.indexOf("ticketcustomfield_options")>-1)){a.value=t.valueOptions.value;return a}if(t.valueType==="checkbox"){if(t.compare==="$eq_ticket_custom_field"){a.value="."}else if(t.compare==="$ne_or_null_ticket_custom_field"){a.value="."}return a}if(t.attribute==="engineer.id"){if(t.engineer&&t.engineerDesk){var e="";if(t.engineer.nickname){e=t.engineer.nickname}if(t.engineer.username){e=t.engineer.username}a.value=t.engineerDesk.name+"/"+e}else if(t.engineer){a.value=t.engineer.name}}else if(t.valueType==="copyTo"){var i=[];t.value.forEach(function(e){i.push(e.name)});a.value=i.join(",")}else if(t.attribute==="transfer"||t.attribute==="tripartite"||t.attribute==="isAutoinvite"||t.attribute==="autoClose"||t.attribute==="isQualitied"){a.value=true}else if(t.value){if(t.attribute==="serviceDesk.id"){a.value=t.value.name}else if(t.attribute==="requester.id"){a.value=t.value.name}else if(t.attribute==="user.id"){a.value=t.value.name}else if(t.attribute==="serviceCatalog.id"){a.value=t.value.name}else if(t.attribute.indexOf("ticketcustomfield_date")>-1){a.value=r("date")(t.value,"yyyy/MM/dd").toString()}else if(t.attribute==="requester.userGroup.id"||t.attribute==="user.userGroup.id"){var i=[];t.value.forEach(function(e){i.push(e.name)});a.value=i.join(",")}else if(t.valueOptions){t.valueOptions.forEach(function(e){if(e.value===t.value){a.value=e.option}})}else{a.value=t.value}}return a}l.jugeCondition=function(){if(l.andConditions.length===0){l.andConditions=[{attribute:"-1",tally:"and"}]}if(l.orConditions.length===0){l.orConditions=[{attribute:"-1",tally:"or"}]}var e=[];var t=null;e=e.concat(l.andConditions,l.orConditions);for(var a=0;a<e.length;a++){if(e[a].attribute!=="-1"){e[a].display=B(e[a]);if(e[a].display.option&&e[a].display.compare&&!H.utils.isUndefined(e[a].display.value)){if(e[a].attribute=="via.channel"&&typeof e[a].display.value=="object"&&!e[a].display.value.viaType){t=e[a];break}}else{t=e[a];break}}}if(t===null){return true}else{i.add("条件【"+t.display.option+"】填写不完整,请检查","danger");return false}};l.saveCondition=function(){if(l.jugeCondition()){U.$promise.then(U.hide)}};var U;l.editCondition=function(){U=t({scope:l,title:"编辑条件",contentTemplate:"source/statistics/directive/search-box/search-box-add-condition.html",html:true,show:true,placement:"center"})};l.delCondition=function(e,t){if(e==="and"){l.andConditions.splice(t,1);if(l.andConditions.length===0){l.andConditions=[{attribute:"-1",tally:"and"}]}}else if(e==="or"){l.orConditions.splice(t,1);if(l.orConditions.length===0){l.orConditions=[{attribute:"-1",tally:"or"}]}}};l.addCondition=function(e){if(e==="and"){l.andConditions.push({attribute:"-1",tally:"and"})}else if(e==="or"){l.orConditions.push({attribute:"-1",tally:"or"})}};l.datepickers={startForm:false,startTo:false,updateFrom:false,updateTo:false};l.open=function(e,t,a){e.preventDefault();e.stopPropagation();t[a].start=!t[a].start};l.timeFrameOpen=function(e,t,a,i){e.preventDefault();e.stopPropagation();t[a][i]=!t[a][i]};l.conditionChange=function(e){for(var t in e){if(e.hasOwnProperty(t)){if(t==="attribute"||t==="tally"){}else{delete e[t]}}}q(e);Y(e)};function Q(t){if(t.value==="${current_engineer_id}"){t.engineer={name:"（当前客服）",id:"${current_engineer_id}"}}else{e({url:"service_desk/"+t.value.split("_")[0]+".json",method:"GET",params:{}}).success(function(e){t.engineerDesk=e.json});e({url:"engineer/"+t.value.split("_")[1]+".json",method:"GET",params:{}}).success(function(e){t.engineer=e.json})}}function G(e){e.value={id:e.value,name:e.display.value}}function V(t){if(t.value==="${current_user_id}"){t.value={id:"${current_user_id}",name:"（当前客户）"}}else{e({url:"user/"+t.value+"/no_access_scope.json",method:"GET",params:{}}).success(function(e){t.value=e.json})}}function W(a){var i=a.display.value.split(",");var e=JSON.parse(a.value);a.value=[];e.forEach(function(e,t){a.value.push({id:e,name:i[t]})})}l.isClick=false;l.checkCharCount=function(e){var t=$(e);if(t.val()!=null&&t.val()!=""){if(t.val().length>=t.attr("maxlength")){i.add(t.prev().text()+"不能超过"+t.attr("maxlength")+"个字符","danger")}}};function z(){S();l.compareOptions=angular.copy(m);if(l.reportType.indexOf("chat.")>-1||l.reportType.indexOf("engineer.chat.")>-1){l.andConditionOptions=angular.copy(h);l.orConditionOptions=angular.copy(v);w()}else{l.andConditionOptions=angular.copy(f);l.orConditionOptions=angular.copy(p);_(function(){w()})}}z()}}(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics").directive("searchHeader",t).controller("searchHeaderCtrl",a);t.$inject=[];function t(){return{restrict:"EA",transclude:true,replace:false,scope:{headerType:"=",openType:"=",title:"="},templateUrl:"source/statistics/directive/search-box/search-header.html",controller:a,link:function(e,t,a){}}}a.$inject=["$scope","coreNotifyService"];function a(e,t){e.reSearch=function(){t.doNotify(t.constant.EVENT_STATISTICS_SEARCH_DETAIL_SEARCH)};e.goBack=function(){t.doNotify(t.constant.EVENT_STATISTICS_SEARCH_VIEW)}}}();+function(){"use strict";angular.module("eweiApp.statistics").directive("barChart",t).controller("barChartController",e);e.$inject=["$scope","$rootScope"];function e(e,t){}t.$inject=["$rootScope","$window"];function t(l,r){return{restrict:"EA",replace:true,controller:"barChartController",scope:{option:"="},link:function(e,t,a){var o=echarts.getInstanceByDom(t[0])||echarts.init(t[0]);var i=function(e,t,a,i,r){var n=a.data.length<20?30:10;var s={color:[l.mainColor],title:{text:e,left:"15",textStyle:{color:"#4f5c69",fontWeight:"normal",fontSize:12}},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},grid:{left:"90",right:"50"},dataZoom:[{backgroundColor:"rgba(0,0,0,0)",dataBackgroundColor:"#eae",end:100,realtime:true,show:true,start:0}],toolbox:{feature:{}},legend:{data:t,align:"left",right:"50",itemWidth:40,textStyle:{fontSize:12}},xAxis:[{type:"category",data:a.data,axisTick:{alignWithLabel:true,lineStyle:{color:"#eef2f9"}},axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}}}],yAxis:[{minInterval:1,type:"value",name:i.name,axisLine:{show:i.axisLine?i.axisLine.show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}],series:[{type:"bar",name:r[0].name,data:r[0].data,barWidth:n,label:{normal:{show:true,position:"top",formatter:function(e,t){if(typeof e.data==="object"){return e.data.value+" ("+e.data.percent+"%)"}return e.value}}}}]};o.setOption(s)};e.$watch("option",function(e){if(e){i(e.titleText,e.legendData,e.xAxis,e.yAxis,e.series)}},true);angular.element(r).on("resize",o.resize);e.$on("$destroy",function(){angular.element(r).off("resize",o.resize);if(o){o.dispose()}})}}}}();+function(){"use strict";angular.module("eweiApp.statistics").controller("ServiceCatalogBreadcrumbController",e).directive("serviceCatalogBreadcrumb",t);e.$inject=["$scope","StatisticsServiceCatalogService"];function e(a,e){var t=this;a.breadcrumbs=[];a.menus=[];var i={};var r;function n(){e.getServiceCatalogList().then(function(e){var t=e?e.serviceCatalogs||[]:[];a.allServiceCatalog=t;s(i,t);a.menus=t;r=t})}function s(t,e){if(!t||!e||!e.length)return;angular.forEach(e,function(e){if(e.id!=-1){t[e.id]=e}if(e&&e.children){s(t,e.children)}})}a.selectServiceCatalog=function(e){if(!e)return;var t=i[e.id];if(t){a.menus=[];a.selectedServiceCatalog=t;a.$evalAsync(function(){a.menus=a.selectedServiceCatalog.children;a.breadcrumbs.push(a.selectedServiceCatalog)})}};a.switchCatalog=function(e,t){a.breadcrumbs.splice(t);if(a.breadcrumbs.length>0){a.menus=a.breadcrumbs[a.breadcrumbs.length-1].children;a.selectedServiceCatalog=a.breadcrumbs[a.breadcrumbs.length-1]}else{a.menus=r;a.selectedServiceCatalog=null}};n()}function t(){return{restrict:"AE",scope:{allServiceCatalog:"=",selectedServiceCatalog:"="},templateUrl:"/source/statistics/directive/service-catalog-breadcrumb/service-catalog-breadcrumb.html",controller:"ServiceCatalogBreadcrumbController as vm"}}}();+function(){"use strict";angular.module("eweiApp.statistics").directive("chartTicketTable",t).controller("ChartTicketTableController",e);e.$inject=["$scope","$rootScope","ChartTicketService","NgTableParams","utils"];function e(o,e,l,t,a){o.allFields=[];o.columns=[];var i=["service_catalog","tags","copyTo"];var r={subject:{field:"subject"},ticket_description:{field:"ticket_description"},ticket_type:{field:"ticketType.name",fieldCount:2},priority:{field:"priority"},service_catalog:{field:"serviceCatalog.id",fieldCount:2},tags:{field:"tags"}};var n=[];var s=[];var c={_count:20,_page:1,_orderField:"createdAt",_order:"desc"};var u=[{option:"编号",value:"no",width:"w100",isDefault:true,sortable:true},{option:"状态",value:"status",width:"w200",sortable:true},{option:"客户",value:"requester.name",width:"w200",isDefault:true,sortable:true},{option:"处理人",value:"engineer.user.name",width:"w200",isDefault:true,sortable:true},{option:"客服组",value:"serviceDesk.name",width:"w200",isDefault:true,sortable:true},{option:"创建人",value:"user.name",width:"w200",isDefault:true,sortable:true},{option:"审核人",value:"reviewUser.name",width:"w200",isDefault:true,sortable:true},{option:"抄送给",value:"copyTo",width:"w200",isDefault:true,standalone:true},{option:"客户组",value:"requester.userGroup.name",width:"w200",isDefault:true,sortable:true},{option:"更新于",value:"updatedAt",width:"w200",isDefault:true,sortable:true},{option:"入口",value:"via.source",width:"w150",isDefault:true,sortable:true},{option:"渠道",value:"via.channelName",width:"w150",isDefault:true,sortable:true},{option:"删除人",value:"deleter.user.name",width:"w200",isDefault:true,sortable:true},{option:"删除原因",value:"deleteReason",width:"w200",isDefault:true,sortable:true},{option:"解决否",value:"evaluate.solved",width:"w200",isDefault:true,sortable:true},{option:"满意度",value:"evaluate.score",width:"w200",isDefault:true,sortable:true},{option:"客户意见",value:"evaluate.suggestion",width:"w200",isDefault:true,sortable:true},{option:"是否系统评价",value:"evaluate.system",width:"w200",isDefault:true,sortable:true},{option:"暂停于",value:"ticketMetric.pausedAt",width:"w200",isDefault:true,sortable:true},{option:"删除于",value:"deletedAt",width:"w200",isDefault:true,sortable:true},{option:"创建于",value:"createdAt",width:"w200",isDefault:true,sortable:true},{option:"响应于",value:"ticketMetric.responseAt",width:"w200",isDefault:true},{option:"响应耗时",value:"ticketMetric.responseMinutes",width:"w200",isDefault:true},{option:"完成于",value:"ticketMetric.solvedAt",width:"w200",isDefault:true},{option:"完成耗时",value:"ticketMetric.solveMinutes",width:"w200",isDefault:true}];var d={};var f=[];if(!o.defaultColumns){n=["no","subject","requester.name","requester.userGroup.name","ticketType.name","status","createdAt"]}else{n=o.defaultColumns}l.getCustomFields().then(function(e){s=e?e.customFields||[]:[];p();o.tableParams&&o.tableParams.reload()});o.toggleCustomField=function(e){if(["no","subject","requester.name"].indexOf(e.field)>-1){e.selected=true}else{e.selected=!e.selected}};o.toggleColumnSelectPanel=function(){o.columnSelectPanelVisiable=!o.columnSelectPanelVisiable};o.hideColumnSelectPanel=function(){o.columnSelectPanelVisiable=false};var p=function(){angular.forEach(u,function(e){var t;var a=e.value.split(".");if(a.length==3){t={title:e.option,field:e.value,fieldCount:a.length,field0:a[0],field1:a[1],field2:a[2],widthClass:"w150",sortable:e.sortable,standalone:e.standalone}}else if(a.length==2){t={title:e.option,field:e.value,fieldCount:a.length,field0:a[0],field1:a[1],widthClass:"w150",sortable:e.sortable,standalone:e.standalone}}else if(a.length==1){t={title:e.option,field:e.value,widthClass:"w150",sortable:e.sortable,standalone:e.standalone}}o.allFields.push(t);if(n.indexOf(e.value)>-1){t.selected=true;o.columns.push(t)}});angular.forEach(s,function(e){if(e.systemFieldKey=="ticket_description")return;var t={title:e.title,field:e.systemFieldKey?r[e.systemFieldKey].field:e.id,fieldCount:e.systemFieldKey?r[e.systemFieldKey].fieldCount||1:"customFields",widthClass:"w150",sortable:e.systemFieldKey&&e.systemFieldKey!="tags"&&e.systemFieldKey!="service_catalog",customField:!e.systemFieldKey,standalone:!e.systemFieldKey||e.systemFieldKey=="tags"||e.systemFieldKey=="service_catalog"};o.allFields.push(t);if(e.systemFieldKey&&n.indexOf(e.systemFieldKey)>-1){t.selected=true;o.columns.push(t)}});m();o.allFieldsCopy=angular.copy(o.allFields)};var m=function(){o.columns=_.sortBy(o.columns,function(e){var t=n.indexOf(e.field);if(t>-1){return t}return 999})};o.updateShowFields=function(){o.columns=_.filter(o.allFieldsCopy,function(e){return e.selected});m();o.allFields=angular.copy(o.allFieldsCopy);if(o.tableParams){o.tableParams.reload()}o.columnSelectPanelVisiable=false;o.defaultColumns.length=0;o.columns.forEach(function(e){o.defaultColumns.push(e.field)})};o.addTicketTab=function(e){if(!e)return;a.addTab("tickets_detail"+e.id,e.subject,"tickets_detail",{id:e.id},"",false)};var h=function(){o.tableParams=o.tableParams||new t({page:c._page,count:c._count},{counts:[],total:0,getData:function(t,a){if(o.columns.length===0)return;c._page=angular.copy(a.page());var e=[];for(var i in a.$params.sorting){e.push(i+" "+a.$params.sorting[i])}var r=_.filter(o.columns,function(e){return!e.standalone});var n=_.filter(o.columns,function(e){return e.standalone});var s=angular.extend(o.queryParams,{fields:"id,"+r.map(function(e){return e.field}).join(","),page:{pageSize:c._count,pageNumber:1,offset:c._page*c._count-c._count,orderBy:e.join(",")}});l.getTicketList(s).then(function(e){o.ticketData=e.list;a.total(e.recordCount);t.resolve(o.ticketData);d={};angular.forEach(o.ticketData,function(e){d[e.id]=e});f=o.ticketData.map(function(e){return e.id});D();if(_.find(n,function(e){return e.field==="copyTo"})){y()}if(_.find(n,function(e){return e.field==="serviceCatalog.id"})){g()}if(_.find(n,function(e){return e.field==="tags"})){b()}if(_.find(r,function(e){return e.field&&e.field.indexOf("evaluate.")>-1})){C()}});v()}})};function v(){var t=[];o.columns.forEach(function(e){if(e.customField){t.push({fieldCount:"customFields",title:e.title,field:e.field})}else{t.push({title:e.title,field:e.field})}});var e=o.queryParams.types;if(e.length===0){e=[""]}o.exportData={startDate:o.queryParams.startDate,endDate:o.queryParams.endDate,columns:t,reportName:o.queryName,filter:o.queryParams.filter,customFieldFilter:o.queryParams.customFieldFilter,filterDescription:o.queryParams.filterDescription,types:e}}var g=function(){if(!o.ticketData||o.ticketData.length==0)return;l.getServiceCatalogNames({ticketIds:f.join(",")}).then(function(e){angular.forEach(e,function(e){if(d.hasOwnProperty(e.relatedId)){d[e.relatedId].serviceCatalogNames=e.serviceCatalogNames}})})};var D=function(){if(!o.ticketData||o.ticketData.length==0)return;var e=_.chain(o.columns).filter(function(e){return e.customField}).map(function(e){return e.field}).value();if(e.length==0)return;var t={customFieldIds:e.join(","),ticketIds:f.join(",")};l.getCustomFieldValue(t).then(function(e){angular.forEach(e,function(e){if(d.hasOwnProperty(e.ticketId)){d[e.ticketId][e.customFieldId]=e.value}})})};var y=function(){if(!o.ticketData||o.ticketData.length==0)return;l.getCopyto({ticketIds:f.join(",")}).then(function(e){angular.forEach(e,function(e){if(d.hasOwnProperty(e.relatedId)){d[e.relatedId].copyto=e.copyToNames.join(" ")}})})};var b=function(){if(!o.ticketData||o.ticketData.length==0)return;l.getTags({ticketIds:f.join(",")}).then(function(e){angular.forEach(e,function(e){if(d.hasOwnProperty(e.relatedId)){d[e.relatedId].tags=e.tagNames.join(" ")}})})};var C=function(){if(!o.ticketData||o.ticketData.length==0)return;l.getEvaluateConfig().then(function(e){angular.forEach(o.ticketData,function(t){if(t&&t.evaluate){angular.forEach(e.firstQuestionOptions,function(e){if(e.value==String(t.evaluate.solved)){t.evaluate.solvedName=e.name}});angular.forEach(e.secondQuestionOptions,function(e){if(e.value==t.evaluate.score){t.evaluate.scoreName=e.name}})}})})};o.sorting=function(e){if(!e.sortable)return;var t=o.tableParams.isSortBy(e.field,"desc")?"asc":"desc";o.tableParams.sorting(e.field,t)};h()}t.$inject=["$rootScope","$window"];function t(e,t){return{restrict:"EA",replace:true,templateUrl:"source/statistics/directive/chart-ticket-table/chart-ticket-table.html",controller:"ChartTicketTableController",scope:{queryName:"=",queryParams:"=",defaultColumns:"=",additionalTip:"@"}}}}();+function(e){"use strict";angular.module("eweiApp.statistics").directive("exportReport",t);t.$inject=["$http","alertService","apiRestfulService","$rootScope"];function t(e,i,r,n){return{restrict:"AE",replace:false,transclude:true,scope:{exportData:"=",exportType:"@"},template:'<button has-permission="statistics_export" class="btn custom-main-font-color" ladda="exporting" data-spinner-color="{{spinnerColor}}" ng-click="export()"><i class="icon iconfont ">&#xe744;</i>保存数据</button>',link:function(a,e,t){a.exporting=false;a.spinnerColor=n.mainColor;a.export=function(){var e;if(a.exportType==="local"){e="api/v1/chart/export.json"}else if(a.exportType==="ticket"){e="api/v1/chart/tickets/export.json"}else if(a.exportType==="chat"){e="api/v1/chart/chats/export.json"}var t={url:e,dataParam:a.exportData};a.exporting=true;r.run(t).post(t.dataParam,function(e){if(e.status===0){window.open("/api/v1/chart/download.json?fileName="+e.result.fileName,"_blank")}else{i.add("导出数据失败","danger")}a.exporting=false})}}}}}();+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsEngineerRootController",e);e.$inject=["$rootScope","$scope","$state","$stateParams","permissions","coreModelService","StatisticsBreadcrumbService"];function e(e,t,a,i,r,n,s){t.breadcrumbs=s.items;t.goto=s.goto;t.scene=i.scene||"ticket";t.changeScene=function(e){t.scene=e;if(e==="ticket"){a.go("statistics.engineer.quantityServiceDesk")}else if(e==="chat"){a.go("statistics.engineer.chat_quantity")}};var o=n.config.route.get("statistics-engineer");if(o){if(o.permission){if(r.hasPermission(o.permission)){try{a.go(o.name,o.params);t.scene=o.params.scene||"ticket"}catch(e){a.go("statistics.engineer.quantityServiceDesk")}}else{return a.go("unauthorized")}}else{try{a.go(o.name,o.params);t.scene=o.params.scene||"ticket"}catch(e){a.go("statistics.engineer.quantityServiceDesk")}}}else{a.go("statistics.engineer.quantityServiceDesk")}}}();+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsQuantityServiceDeskController",t);t.$inject=["$scope","$state","$filter","searchService","coreNotifyService"];function t(r,t,a,i,e){var n=this.__proto__.constructor.name+"_"+Date.now();r.questionTip=["抢单次数 = 所选时间范围内，该客服组下所有客服的抢接单次数总和","抢单量 = 所选时间范围内，该客服组下所有客服的抢单数量总和"];var s=function(){var e="engineer.serviceDesk";r.searchData={showDataSource:["ticket.all.perfomance"],reportType:e,views:[]};i.loadSearchDataView(e,r.searchData.views,function(){p()})};var o=function(e){i.searchData.startDate=r.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=r.$parent.dateRange.endDate.format("YYYY-MM-DD");var t={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,customFieldFilter:i.searchData.customFieldFilter,types:i.searchData.types};if(e=="page"){t.page={pageSize:9999,pageNumber:1}}return t};var l=function(){var i={};i.titleText="";i.legendData=["抢单量"];i.xAxisData=[];i.yAxis=[{name:"工单量",nameLocation:"middle",nameGap:50}];i.series=[{name:"抢单量",type:"line",data:[]}];org.ewei.sdk.OpenPerformanceApi().listServiceDeskWorkloadStatistics(o()).then(function(e){if(r.$$destroyed)return;if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,grabTicketCount:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.grabTicketCount)})}r.option=angular.copy(i)})};var c=function(){r.columns=[{title:"客服组",visible:true,sortable:true,field:"serviceDeskName",filter:function(e){return a("translate")(e)},callbackFunction:function(e){t.go("statistics.engineer.quantityServiceDeskDetail",{params:{id:e.serviceDeskId,name:a("translate")(e.serviceDeskName)}})}},{title:"抢单次数",visible:true,sortable:true,field:"grabCount"},{title:"抢单量",visible:true,sortable:true,field:"grabTicketCount"}]};var u=function(){r.totalData={serviceDeskName:"统计",grabCount:0,grabTicketCount:0};org.ewei.sdk.OpenPerformanceApi().listServiceDeskWorkload(o("page")).then(function(e){r.loadComplete=true;if(e.list&&e.list.length>0){angular.forEach(e.list,function(e){r.totalData.grabCount+=e.grabCount?e.grabCount:0;r.totalData.grabTicketCount+=e.grabTicketCount?e.grabTicketCount:0;if(e.serviceDeskName==="DEFAULT_SERVICE_DESK_NAME"){e.serviceDeskName=a("translate")(e.serviceDeskName)}})}r.serviceDesk=e.list?e.list:undefined;d()})};function d(){var t=[],a=[],e="客服绩效-客服组-工作量统计";r.serviceDesk.forEach(function(e){t.push([e.serviceDeskName,e.grabCount,e.grabTicketCount])});r.totalData&&t.unshift([r.totalData.serviceDeskName,r.totalData.grabCount,r.totalData.grabTicketCount]);r.columns.forEach(function(e){a.push(e.title)});r.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var f=function(){s();c()};f();var p=function(){l();u()};e.register(n,e.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){p()});r.$on("statistics.datarange.changed",p);r.$on("$destroy",function(){e.unRegister(n)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsQuantityServiceDeskDetailController",e);e.$inject=["$scope","$stateParams","$filter","utils","StatisticsBreadcrumbService","apiChartEngineerService","searchService"];function e(r,e,t,a,i,n,s){r.params=e.params;i.push({url:"statistics.engineer.quantityServiceDesk",name:"工作量统计"});i.push({name:r.params.name});var o=function(e){var t={serviceDeskId:r.params.id,startDate:r.$parent.dateRange.startDate.format("YYYY-MM-DD"),endDate:r.$parent.dateRange.endDate.format("YYYY-MM-DD"),filter:s.searchData.filter,customFieldFilter:s.searchData.customFieldFilter,types:s.searchData.types};if(e=="page"){t.page={pageSize:9999,pageNumber:1}}return t};var l=function(){var i={};i.titleText="";i.legendData=["抢单量"];i.xAxisData=[];i.yAxis=[{name:"工单量",nameLocation:"middle",nameGap:50}];i.series=[{name:"抢单量",type:"line",data:[]}];org.ewei.sdk.OpenPerformanceApi().listServiceDeskWorkloadStatistics(o()).then(function(e){if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,grabTicketCount:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.grabTicketCount)})}r.option=angular.copy(i)})};var c=function(){r.columns=[{title:"时间",visible:true,sortable:true,field:"createdAt"},{title:"客服组",visible:true,sortable:true,field:"serviceDeskName",filter:function(e){return t("translate")(e)}},{title:"响应时长",visible:true,sortable:true,sortType:"number",field:"responseMinutes"},{title:"操作",visible:true,sortable:true,field:"operation"},{title:"操作人",visible:true,sortable:true,field:"operatorName"},{title:"工单",visible:true,sortable:true,class:"text-left",field:"ticket",callbackFunction:function(e){a.addTab("tickets_detail"+e.ticketId,e.ticketSubject,"tickets_detail",{id:e.ticketId},"",false)}}]};var u=function(){r.serviceDesk=[];n.getChartListServiceDeskById(o("page"),function(e){if(e.list&&e.list.length>0){angular.forEach(e.list,function(e){e.responseMinutes=e.responseMinutes?t("minutesToTime")(parseInt(e.responseMinutes)):"-";e.operation=t("ticketOperation")(e.operation);e.ticket="# "+e.ticketNo+" "+e.ticketSubject;if(e.serviceDeskName==="DEFAULT_SERVICE_DESK_NAME"){e.serviceDeskName=t("translate")(e.serviceDeskName)}})}r.serviceDesk=e.list?e.list:undefined;d()})};function d(){var t=[],a=[],e="客服绩效-客服组-"+r.params.name+"-工作量统计";r.serviceDesk.forEach(function(e){t.push([e.createdAt,e.serviceDeskName,e.responseMinutes,e.operation,e.operatorName,e.ticket])});r.columns.forEach(function(e){a.push(e.title)});r.exportData={startDate:s.searchData.startDate,endDate:s.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:s.searchData.filterDescription,types:s.searchData.types}}var f=function(){l();c();u()};f();var p=function(){l();u()};r.$on("statistics.datarange.changed",p);r.$on("$destroy",function(){i.pop(2)})}}();+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsQualityServiceDeskController",t);t.$inject=["$scope","$state","$filter","searchService","coreNotifyService","StatisticsTimeFormatterService"];function t(r,t,i,n,e,a){var s=this.__proto__.constructor.name+"_"+Date.now();r.questionTip=["平均响应时长 = 所选时间范围内，该客服组响应工单总时长/该客服组响应工单总次数"];var o=function(){var e="engineer.serviceDesk";r.searchData={showDataSource:["ticket.all.perfomance"],reportType:e,views:[]};n.loadSearchDataView(e,r.searchData.views,function(){m()})};var l=function(e){n.searchData.startDate=r.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=r.$parent.dateRange.endDate.format("YYYY-MM-DD");var t={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,types:n.searchData.types};if(e=="page"){t.page={pageSize:9999,pageNumber:1}}return t};var c=function(){var i={};i.titleText="";i.legendData=["平均响应时长"];i.xAxisData=[];i.yAxis=[{name:"响应时长",nameLocation:"middle",nameGap:50,axisLabel:{formatter:a.formatter},axisPointer:{label:{formatter:a.formatter}}}];i.series=[{name:"平均响应时长",type:"line",data:[]}];i.formatter=a.tipFormatter;org.ewei.sdk.OpenPerformanceApi().listServiceDeskMassStatistics(l()).then(function(e){if(r.$$destroyed)return;if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,averageResponseMinutes:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.averageResponseMinutes*60)})}r.option=angular.copy(i)})};var u=function(){r.columns=[{title:"客服组",visible:true,sortable:true,field:"serviceDeskName",filter:function(e){return i("translate")(e)},callbackFunction:function(e){t.go("statistics.engineer.qualityServiceDeskDetail",{params:{id:e.serviceDeskId,name:i("translate")(e.serviceDeskName)}})}},{title:"平均响应时长",visible:true,sortable:true,sortType:"number",field:"averageResponseMinutes"}]};var d=function(){r.totalData={serviceDeskName:"统计",averageResponseMinutes:0};var t=0,a=0;org.ewei.sdk.OpenPerformanceApi().listServiceDeskMass(l("page")).then(function(e){r.loadComplete=true;if(e.list&&e.list.length>0){angular.forEach(e.list,function(e){t+=e.responseMinutes||0;a+=e.responseCount||0;e.averageResponseMinutes=i("chartTimeFormat")(e.averageResponseMinutes*60);if(e.serviceDeskName==="DEFAULT_SERVICE_DESK_NAME"){e.serviceDeskName=i("translate")(e.serviceDeskName)}})}r.totalData.averageResponseMinutes=i("chartTimeFormat")(parseInt(t/a*60));r.serviceDesk=e.list?e.list:undefined;f()})};function f(){var t=[],a=[],e="客服绩效-客服组-工作质量统计";r.serviceDesk.forEach(function(e){t.push([e.serviceDeskName,e.averageResponseMinutes])});r.totalData&&t.unshift([r.totalData.serviceDeskName,r.totalData.averageResponseMinutes]);r.columns.forEach(function(e){a.push(e.title)});r.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}var p=function(){o();u()};p();var m=function(){c();d()};e.register(s,e.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){m()});r.$on("statistics.datarange.changed",m);r.$on("$destroy",function(){e.unRegister(s)})}}(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsQualityServiceDeskDetailController",t);t.$inject=["$rootScope","$scope","$stateParams","$filter","utils","StatisticsBreadcrumbService","apiChartEngineerService","searchService","StatisticsTimeFormatterService"];function t(e,n,t,a,s,i,o,r,l){n.params=t.params;i.push({url:"statistics.engineer.qualityServiceDesk",name:"工作质量统计"});i.push({name:n.params.name});n.showWhichOne={average:true};n.checked=function(e){n.showWhichOne.average=false;n.showWhichOne.response=false;n.showWhichOne[e]=true};var c=function(e){r.searchData.startDate=n.$parent.dateRange.startDate.format("YYYY-MM-DD");r.searchData.endDate=n.$parent.dateRange.endDate.format("YYYY-MM-DD");var t={serviceDeskId:n.params.id,startDate:r.searchData.startDate,endDate:r.searchData.endDate,filter:r.searchData.filter,customFieldFilter:r.searchData.customFieldFilter,types:r.searchData.types};if(e=="page"){t.page={pageSize:9999,pageNumber:1}}return t};var u=function(){var i={};i.legendData=["平均响应时长"];i.xAxisData=[];i.yAxis=[{name:"响应时长",nameLocation:"middle",nameGap:50,axisLabel:{formatter:l.formatter},axisPointer:{label:{formatter:l.formatter}}}];i.series=[{name:"平均响应时长",type:"line",data:[]}];i.formatter=l.tipFormatter;org.ewei.sdk.OpenPerformanceApi().listServiceDeskMassStatistics(c()).then(function(e){if(n.$$destroyed)return;if(e.length>0){var t=n.$parent.dateRange.startDate.clone();while(t<=n.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,averageResponseMinutes:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.averageResponseMinutes*60)})}n.averageOption=angular.copy(i)})};var d=function(){var i={};i.lineColor=[e.mainColor];i.titleText="";i.legendData=["次数"];i.xAxis={name:"响应次数",data:[]};i.yAxis={name:"响应次数"};i.series=[{name:"次数",data:[]}];var r=["1M","3M","5M","10M","30M","1H","4H","8H","24H","48H","72H","72H+"];o.getServiceDeskResponseOption(c(),function(t){var a=0;_.keys(t).forEach(function(e){a+=t[e]});for(var e=0;e<r.length;e++){if(t[r[e]]>=0){i.xAxis.data.push(r[e]);i.series[0].data.push({value:t[r[e]],percent:s.getPercentValue(t[r[e]]/a||0)})}}n.responseOption=angular.copy(i)})};var f=function(){n.columns=[{title:"时间",visible:true,sortable:true,field:"createdAt"},{title:"客服组",visible:true,sortable:true,field:"serviceDeskName",filter:function(e){return a("translate")(e)}},{title:"响应时长",visible:true,sortable:true,sortType:"number",field:"responseMinutes"},{title:"操作",visible:true,sortable:true,field:"operation"},{title:"操作人",visible:true,sortable:true,field:"operatorName"},{title:"工单",visible:true,sortable:true,class:"text-left",field:"ticket",callbackFunction:function(e){s.addTab("tickets_detail"+e.ticketId,e.ticketSubject,"tickets_detail",{id:e.ticketId},"",false)}}]};var p=function(){n.serviceDesk=[];o.getChartListServiceDeskById(c("page"),function(e){if(e.list&&e.list.length>0){angular.forEach(e.list,function(e){e.responseMinutes=e.responseMinutes?a("minutesToTime")(parseInt(e.responseMinutes)):"-";e.operation=a("ticketOperation")(e.operation);e.ticket="# "+e.ticketNo+" "+e.ticketSubject;if(e.serviceDeskName==="DEFAULT_SERVICE_DESK_NAME"){e.serviceDeskName=a("translate")(e.serviceDeskName)}})}n.serviceDesk=e.list?e.list:undefined;m()})};function m(){var t=[],a=[],e="客服绩效-客服组-"+n.params.name+"-工作质量统计";n.serviceDesk.forEach(function(e){t.push([e.createdAt,e.serviceDeskName,e.responseMinutes,e.operation,e.operatorName,e.ticket])});n.columns.forEach(function(e){a.push(e.title)});n.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}var h=function(){u();d();f();p()};h();var v=function(){u();d();p()};n.$on("statistics.datarange.changed",v);n.$on("$destroy",function(){i.pop(2)})}}(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsQuantityEngineerController",t);t.$inject=["$rootScope","$scope","$state","$filter","searchService","apiChartEngineerService","coreNotifyService"];function t(e,r,t,a,i,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();r.questionTip=["全部操作次数 = 所选时间范围内，客服抢接单次数+派单+处理完毕工单的次数总和","抢接单次数 = 所选时间范围内，客服抢接单次数总和","处理完毕工单次数 = 所选时间范围内，客服处理完毕工单次数总和","分派工单次数 = 所选时间范围内，客服派单次数总和","抢接工单量 = 所选时间范围内，客服抢接工单的数量总和 ","完结工单量 = 所选时间范围内，客服处理完毕的工单量"];var l=function(){var e="engineer.engineer";r.searchData={showDataSource:["ticket.all.perfomance"],reportType:e,views:[]};i.loadSearchDataView(e,r.searchData.views,function(){u();f()})};var c=function(e){i.searchData.startDate=r.$parent.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=r.$parent.dateRange.endDate.format("YYYY-MM-DD");var t={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,customFieldFilter:i.searchData.customFieldFilter,types:i.searchData.types};if(e=="page"){t.page={pageSize:9999,pageNumber:1}}return t};var u=function(){var i={};i.titleText="";i.legendData=["抢接工单量","完结工单量"];i.xAxisData=[];i.yAxis=[{name:"工单数量",nameLocation:"middle",nameGap:50}];i.series=[{name:"抢接工单量",type:"line",data:[]},{name:"完结工单量",type:"line",data:[]}];org.ewei.sdk.OpenPerformanceApi().listEngineerWorkloadStatistics(c()).then(function(e){if(r.$$destroyed)return;if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,grabTicketCount:0,solvedTicketCount:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.grabTicketCount);i.series[1].data.push(e.solvedTicketCount)})}r.option=angular.copy(i)})};var d=function(){r.columns=[{title:"客服",visible:true,sortable:true,field:"engineerName",callbackFunction:function(e){t.go("statistics.engineer.quantityEngineerDetail",{params:{id:e.engineerId,name:e.engineerName}})}},{title:"全部操作/次",visible:true,sortable:true,field:"operateCount"},{title:"抢接单/次",visible:true,sortable:true,field:"grabCount"},{title:"处理完毕工单/次",visible:true,sortable:true,field:"solvedCount"},{title:"分派工单/次",visible:true,sortable:true,field:"assignCount"},{title:"抢接工单量",visible:true,sortable:true,field:"grabTicketCount"},{title:"完结工单量",visible:true,sortable:true,field:"solvedTicketCount"}]};var f=function(){r.totalData={engineerName:"统计",grabCount:0,operateCount:0,solvedCount:0,assignCount:0,grabTicketCount:0,solvedTicketCount:0};n.getChartListEngineer(c("page"),function(e){r.loadComplete=true;if(e.list&&e.list.length>0){angular.forEach(e.list,function(e){r.totalData.grabCount+=e.grabCount?e.grabCount:0;r.totalData.operateCount+=e.operateCount?e.operateCount:0;r.totalData.solvedCount+=e.solvedCount?e.solvedCount:0;r.totalData.assignCount+=e.assignCount?e.assignCount:0;r.totalData.grabTicketCount+=e.grabTicketCount?e.grabTicketCount:0;r.totalData.solvedTicketCount+=e.solvedTicketCount?e.solvedTicketCount:0})}r.engineer=e.list?e.list:undefined;p()})};function p(){var t=[],a=[],e="客服绩效-客服-工作量统计";r.engineer.forEach(function(e){t.push([e.engineerName,e.operateCount,e.grabCount,e.solvedCount,e.assignCount,e.grabTicketCount,e.solvedTicketCount])});r.totalData&&t.unshift([r.totalData.engineerName,r.totalData.operateCount,r.totalData.grabCount,r.totalData.solvedCount,r.totalData.assignCount,r.totalData.grabTicketCount,r.totalData.solvedTicketCount]);r.columns.forEach(function(e){a.push(e.title)});r.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var m=function(){l();d()};m();var h=function(){u();f()};s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){h()});r.$on("statistics.datarange.changed",h);r.$on("$destroy",function(){s.unRegister(o)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsQuantityEngineerDetailController",e);e.$inject=["$rootScope","$scope","$stateParams","$state","$filter","utils","StatisticsBreadcrumbService","apiChartEngineerService","searchService"];function e(e,r,t,a,i,n,s,o,l){r.params=t.params;s.push({url:"statistics.engineer.quantityEngineer",name:"客服"});s.push({name:r.params.name});var c=function(e){var t={engineerId:r.params.id,startDate:r.$parent.dateRange.startDate.format("YYYY-MM-DD"),endDate:r.$parent.dateRange.endDate.format("YYYY-MM-DD"),filter:l.searchData.filter,customFieldFilter:l.searchData.customFieldFilter,types:l.searchData.types};if(e=="page"){t.page={pageSize:9999,pageNumber:1}}return t};var u=function(){var i={};i.legendData=["抢接工单量","完结工单量"];i.xAxisData=[];i.yAxis=[{name:"工单数量",nameLocation:"middle",nameGap:50}];i.series=[{name:"抢接工单量",type:"line",data:[]},{name:"完结工单量",type:"line",data:[]}];org.ewei.sdk.OpenPerformanceApi().listEngineerWorkloadStatistics(c()).then(function(e){if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,grabTicketCount:0,solvedTicketCount:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.grabTicketCount);i.series[1].data.push(e.solvedTicketCount)})}r.option=angular.copy(i)})};var d=function(){r.columns=[{title:"时间",visible:true,sortable:true,field:"createdAt"},{title:"客服",visible:true,sortable:true,field:"engineerName"},{title:"操作",visible:true,sortable:true,field:"operation"},{title:"响应时长",visible:true,sortable:true,sortType:"number",field:"responseMinutes"},{title:"处理时长",visible:true,sortable:true,sortType:"number",field:"workingMinutes"},{title:"工单",visible:true,sortable:true,class:"text-left",field:"ticket",callbackFunction:function(e){n.addTab("tickets_detail"+e.ticketId,e.ticketSubject,"tickets_detail",{id:e.ticketId},"",false)}},{title:"解决否",visible:true,sortable:true,field:"solved"},{title:"评价否",visible:true,sortable:true,field:"evaluation"},{title:"满意度",visible:true,sortable:true,field:"evaluationScore"}]};var f=function(){r.engineer=[];org.ewei.sdk.OpenPerformanceApi().listEngineerMassRecordByEngineerId(c("page")).then(function(e){r.loadComplete=true;if(e.list&&e.list.length>0){angular.forEach(e.list,function(e){e.responseMinutes=i("minutesToTime")(parseInt(e.responseMinutes))||"-";e.workingMinutes=i("minutesToTime")(parseInt(e.workingMinutes))||"-";e.operation=i("ticketOperation")(e.operation);e.ticket="# "+e.ticketNo+" "+e.ticketSubject;if(e.solved){e.solved="已解决"}else if(e.solved===false){e.solved="未解决"}else{e.solved="-"}e.evaluation=e.evaluation?"已评价":"未评价"})}r.engineer=e.list?e.list:undefined;p()})};function p(){var t=[],a=[],e="客服绩效-客服-"+r.params.name+"工作量统计";r.engineer.forEach(function(e){t.push([e.createdAt,e.engineerName,e.operation,e.responseMinutes,e.workingMinutes,e.ticket,e.solved,e.evaluation,e.evaluationScore])});r.columns.forEach(function(e){a.push(e.title)});r.exportData={startDate:l.searchData.startDate,endDate:l.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:l.searchData.filterDescription,types:l.searchData.types}}var m=function(){u();d();f()};m();var h=function(){u();f()};r.$on("statistics.datarange.changed",h);r.$on("$destroy",function(){s.pop(2)})}}();+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsQualityEngineerController",t);t.$inject=["$rootScope","$scope","$state","$filter","searchService","StatisticsTimeFormatterService","coreNotifyService"];function t(e,r,t,a,i,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();r.questionTip=["平均响应时长 = 所选时间范围内，该客服响应工单总时长/该客服响应工单次数","累计处理时长 = 所选时间范围内，客服处理时长总和","平均处理时长 = 所选时间范围内，客服累计处理时长/处理工单次数","参评率 = 所选时间范围内，客服作为最后处理人，有客户评价的工单数量/已完毕或已关闭工单数量比值*100%","相对满意度 = 所选时间范围内，客服作为最后处理人，评价分3分及以上工单数量/有评价的工单数量比值*100%","问题解决率 = 所选时间范围内，客服作为最后处理人，满意度为已解决的工单数量/有评价的工单数量比值*100%","平均评价分= 所选时间范围内，客服作为最后处理人，已评价工单的总分/已评价的工单数量"];var l=function(){var e="engineer.engineer";r.searchData={showDataSource:["ticket.all.perfomance"],reportType:e,views:[]};i.loadSearchDataView(e,r.searchData.views,function(){g()})};var c=function(e){i.searchData.startDate=r.$parent.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=r.$parent.dateRange.endDate.format("YYYY-MM-DD");var t={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,customFieldFilter:i.searchData.customFieldFilter,types:i.searchData.types};if(e=="page"){t.page={pageSize:9999,pageNumber:1}}return t};r.showWhichOne={response:true};r.checked=function(e){r.showWhichOne.response=false;r.showWhichOne.solved=false;r.showWhichOne.evaluate=false;r.showWhichOne[e]=true};var u=function(){var i={};i.titleText="";i.legendData=["平均响应时长"];i.xAxisData=[];i.yAxis=[{name:"响应时长",nameLocation:"middle",nameGap:50,axisLabel:{formatter:n.formatter},axisPointer:{label:{formatter:n.formatter}}}];i.series=[{name:"平均响应时长",type:"line",data:[]}];i.formatter=n.tipFormatter;org.ewei.sdk.OpenPerformanceApi().listEngineerMassResponseStatistics(c()).then(function(e){if(r.$$destroyed)return;if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,averageResponseMinutes:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.averageResponseMinutes*60)})}r.responseOption=angular.copy(i)})};var d=function(){var i={};i.titleText="";i.legendData=["平均处理时长"];i.xAxisData=[];i.yAxis=[{name:"处理时长",nameLocation:"middle",nameGap:50,axisLabel:{formatter:n.formatter},axisPointer:{label:{formatter:n.formatter}}}];i.series=[{name:"平均处理时长",type:"line",data:[]}];i.formatter=n.tipFormatter;org.ewei.sdk.OpenPerformanceApi().listEngineerMassProcessStatistics(c()).then(function(e){if(r.$$destroyed)return;if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,averageProcessMinutes:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.averageProcessMinutes*60)})}r.solvedOption=angular.copy(i)})};var f=function(){var i={};i.titleText="";i.legendData=["参评率","相对满意度","问题解决率"];i.xAxisData=[];i.yAxis=[{name:"百分比",nameLocation:"middle",nameGap:50,axisPointer:{label:{formatter:function(e){return e.value.toFixed(0)+"%"}}},axisLabel:{formatter:function(e){return e.toFixed(0)+"%"}}}];i.series=[{name:"参评率",type:"line",data:[]},{name:"相对满意度",type:"line",data:[]},{name:"问题解决率",type:"line",data:[]}];i.formatter=n.tipEvaluateFormatter;org.ewei.sdk.OpenPerformanceApi().listEngineerMassSatisfactionStatistics(c()).then(function(e){if(r.$$destroyed)return;if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,rateOfComment:0,rateOfSatisfaction:0,rateOfSolved:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push((e.rateOfComment||0)*100);i.series[1].data.push((e.rateOfSatisfaction||0)*100);i.series[2].data.push((e.rateOfSolved||0)*100)})}r.evaluateOption=angular.copy(i)})};var p=function(){r.columns=[{title:"客服",visible:true,sortable:true,field:"engineerName",callbackFunction:function(e){t.go("statistics.engineer.qualityEngineerDetail",{params:{id:e.engineerId,name:e.engineerName}})}},{title:"平均响应时长",visible:true,sortable:true,sortType:"number",field:"averageResponseMinutes"},{title:"累计处理时长",visible:true,sortable:true,sortType:"number",field:"totalProcessMinutes"},{title:"平均处理时长",visible:true,sortable:true,sortType:"number",field:"averageProcessMinutes"},{title:"参评率",visible:true,sortable:true,sortType:"number",field:"rateOfComment"},{title:"相对满意度",visible:true,sortable:true,sortType:"number",field:"rateOfSatisfaction"},{title:"问题解决率",visible:true,sortable:true,sortType:"number",field:"rateOfSolved"},{title:"平均评价分",visible:true,sortable:true,sortType:"number",field:"averageSatisfaction"}]};var m=function(){org.ewei.sdk.OpenPerformanceApi().listEngineerMass(c("page")).then(function(e){r.loadComplete=true;r.totalData={};if(e.list&&e.list.length>0){r.totalData=e.list.shift();angular.forEach(e.list,function(e){e.averageResponseMinutes=a("chartTimeFormat")(e.averageResponseMinutes*60);e.totalProcessMinutes=a("chartTimeFormat")(e.totalProcessMinutes*60);e.averageProcessMinutes=a("chartTimeFormat")(e.averageProcessMinutes*60);e.rateOfComment=e.rateOfComment||e.rateOfComment==0?(e.rateOfComment*100).toFixed(2)+"%":"-";e.rateOfSatisfaction=e.rateOfSatisfaction||e.rateOfSatisfaction==0?(e.rateOfSatisfaction*100).toFixed(2)+"%":"-";e.rateOfSolved=e.rateOfSolved||e.rateOfSolved==0?(e.rateOfSolved*100).toFixed(2)+"%":"-";e.averageSatisfaction=e.averageSatisfaction||e.averageSatisfaction==0?e.averageSatisfaction.toFixed(2):"-"})}r.totalData.averageResponseMinutes=a("chartTimeFormat")(r.totalData.averageResponseMinutes*60||0);r.totalData.totalProcessMinutes=a("chartTimeFormat")(r.totalData.totalProcessMinutes*60||0);r.totalData.averageProcessMinutes=a("chartTimeFormat")(r.totalData.averageProcessMinutes*60||0);r.totalData.rateOfComment=(r.totalData.rateOfComment*100||0).toFixed(2)+"%";r.totalData.rateOfSatisfaction=(r.totalData.rateOfSatisfaction*100||0).toFixed(2)+"%";r.totalData.rateOfSolved=(r.totalData.rateOfSolved*100||0).toFixed(2)+"%";r.totalData.averageSatisfaction=(r.totalData.averageSatisfaction||0).toFixed(2);r.engineer=e.list?e.list:undefined;h()})};function h(){var t=[],a=[],e="客服绩效-客服-工作质量统计";r.engineer.forEach(function(e){t.push([e.engineerName,e.averageResponseMinutes,e.totalProcessMinutes,e.averageProcessMinutes,e.rateOfComment,e.rateOfSatisfaction,e.rateOfSolved,e.averageSatisfaction])});r.totalData&&t.unshift([r.totalData.engineerName,r.totalData.averageResponseMinutes,r.totalData.totalProcessMinutes,r.totalData.averageProcessMinutes,r.totalData.rateOfComment,r.totalData.rateOfSatisfaction,r.totalData.rateOfSolved,r.totalData.averageSatisfaction]);r.columns.forEach(function(e){a.push(e.title)});r.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var v=function(){l();p()};v();var g=function(){u();d();f();m()};s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){g()});r.$on("statistics.datarange.changed",g);r.$on("$destroy",function(){s.unRegister(o)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsQualityEngineerDetailController",e);e.$inject=["$rootScope","$scope","$stateParams","$state","$filter","utils","StatisticsBreadcrumbService","StatisticsTimeFormatterService","searchService"];function e(e,r,t,a,i,n,s,o,l){r.params=t.params;s.push({url:"statistics.engineer.qualityEngineer",name:"客服"});s.push({name:r.params.name});var c=function(e){var t={engineerId:r.params.id,startDate:r.$parent.dateRange.startDate.format("YYYY-MM-DD"),endDate:r.$parent.dateRange.endDate.format("YYYY-MM-DD"),filter:l.searchData.filter,customFieldFilter:l.searchData.customFieldFilter,types:l.searchData.types};if(e=="page"){t.page={pageSize:9999,pageNumber:1}}return t};r.showWhichOne={response:true};r.checked=function(e){r.showWhichOne.response=false;r.showWhichOne.solved=false;r.showWhichOne.evaluate=false;r.showWhichOne[e]=true};var u=function(){var i={};i.titleText="";i.legendData=["平均响应时长"];i.xAxisData=[];i.yAxis=[{name:"响应时长",nameLocation:"middle",nameGap:50,axisLabel:{formatter:o.formatter},axisPointer:{label:{formatter:o.formatter}}}];i.series=[{name:"平均响应时长",type:"line",data:[]}];i.formatter=o.tipFormatter;org.ewei.sdk.OpenPerformanceApi().listEngineerMassResponseStatistics(c()).then(function(e){if(r.$$destroyed)return;if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,averageResponseMinutes:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.averageResponseMinutes*60)})}r.responseOption=angular.copy(i)})};var d=function(){var i={};i.titleText="";i.legendData=["平均处理时长"];i.xAxisData=[];i.yAxis=[{name:"处理时长",nameLocation:"middle",nameGap:50,axisLabel:{formatter:o.formatter},axisPointer:{label:{formatter:o.formatter}}}];i.series=[{name:"平均处理时长",type:"line",data:[]}];i.formatter=o.tipFormatter;org.ewei.sdk.OpenPerformanceApi().listEngineerMassProcessStatistics(c()).then(function(e){if(r.$$destroyed)return;if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,averageProcessMinutes:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push(e.averageProcessMinutes*60)})}r.solvedOption=angular.copy(i)})};var f=function(){var i={};i.titleText="";i.legendData=["参评率","相对满意度","问题解决率"];i.xAxisData=[];i.yAxis=[{name:"百分比",nameLocation:"middle",nameGap:50,axisPointer:{label:{formatter:function(e){return e.value.toFixed(0)+"%"}}},axisLabel:{formatter:function(e){return e.toFixed(0)+"%"}}}];i.series=[{name:"参评率",type:"line",data:[]},{name:"相对满意度",type:"line",data:[]},{name:"问题解决率",type:"line",data:[]}];i.formatter=o.tipEvaluateFormatter;org.ewei.sdk.OpenPerformanceApi().listEngineerMassSatisfactionStatistics(c()).then(function(e){if(r.$$destroyed)return;if(e.length>0){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,rateOfComment:0,rateOfSatisfaction:0,rateOfSolved:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);i.series[0].data.push((e.rateOfComment||0)*100);i.series[1].data.push((e.rateOfSatisfaction||0)*100);i.series[2].data.push((e.rateOfSolved||0)*100)})}r.evaluateOption=angular.copy(i)})};var p=function(){r.columns=[{title:"时间",visible:true,sortable:true,field:"createdAt"},{title:"客服",visible:true,sortable:true,field:"engineerName"},{title:"操作",visible:true,sortable:true,field:"operation"},{title:"响应时长",visible:true,sortable:true,sortType:"number",field:"responseMinutes"},{title:"处理时长",visible:true,sortable:true,sortType:"number",field:"workingMinutes"},{title:"工单",visible:true,sortable:true,class:"text-left",field:"ticket",callbackFunction:function(e){n.addTab("tickets_detail"+e.ticketId,e.ticketSubject,"tickets_detail",{id:e.ticketId},"",false)}},{title:"解决否",visible:true,sortable:true,field:"solved"},{title:"评价否",visible:true,sortable:true,field:"evaluation"},{title:"满意度",visible:true,sortable:true,field:"evaluationScore"}]};var m=function(){r.engineer=[];org.ewei.sdk.OpenPerformanceApi().listEngineerMassRecordByEngineerId(c("page")).then(function(e){r.loadComplete=true;if(e.list&&e.list.length>0){angular.forEach(e.list,function(e){e.responseMinutes=i("minutesToTime")(parseInt(e.responseMinutes))||"-";e.workingMinutes=i("minutesToTime")(parseInt(e.workingMinutes))||"-";e.operation=i("ticketOperation")(e.operation);e.ticket="# "+e.ticketNo+" "+e.ticketSubject;if(e.solved){e.solved="已解决"}else if(e.solved===false){e.solved="未解决"}else{e.solved="-"}e.evaluation=e.evaluation?"已评价":"未评价"})}r.engineer=e.list?e.list:undefined;h()})};function h(){var t=[],a=[],e="客服绩效-客服-"+r.params.name+"工作质量统计";r.engineer.forEach(function(e){t.push([e.createdAt,e.engineerName,e.operation,e.responseMinutes,e.workingMinutes,e.ticket,e.solved,e.evaluation,e.evaluationScore])});r.columns.forEach(function(e){a.push(e.title)});r.exportData={startDate:l.searchData.startDate,endDate:l.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:l.searchData.filterDescription,types:l.searchData.types}}var v=function(){u();d();f();p();m()};v();var g=function(){u();d();f();m()};r.$on("statistics.datarange.changed",g);r.$on("$destroy",function(){s.pop(2)})}}();(function(v){"use strict";angular.module("eweiApp.statistics").controller("StatisticsEngineerEvaluateController",e);e.$inject=["$rootScope","$scope","$timeout","$state","searchService","coreNotifyService"];function e(e,i,t,a,r,n){var s=this.__proto__.constructor.name+"_"+Date.now();i.questionTip=["评价数：该客服作为处理人时获得到的点评次数","平均分=客户的评分总和/评价次数（评分总和即该客服获得的星星数量）"];i.allData=[];var o=i.$parent.dateRange.startDate.format("YYYY-MM-DD");var l=i.$parent.dateRange.endDate.format("YYYY-MM-DD");var c=function(){var e="engineer.evaluate";i.searchData={showDataSource:["ticket.solved","ticket.closed","ticket.create"],reportType:e,views:[]};r.loadSearchDataView(e,i.searchData.views,function(){p()})};var u=function(e){r.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");r.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");var t={startDate:r.searchData.startDate,endDate:r.searchData.endDate,filter:r.searchData.filter,customFieldFilter:r.searchData.customFieldFilter,types:r.searchData.types,page:{pageNumber:1,pageSize:9999}};return t};var d=function(){i.columns=[{title:"客服",visible:true,sortable:true,class:"text-left",field:"userName"},{title:"评价数",visible:true,sortable:true,field:"allCount"},{title:"一星评价",visible:true,sortable:true,field:"point1"},{title:"二星评价",visible:true,sortable:true,field:"point2"},{title:"三星评价",visible:true,sortable:true,field:"point3"},{title:"四星评价",visible:true,sortable:true,field:"point4"},{title:"五星评价",visible:true,sortable:true,field:"point5"},{title:"平均分",visible:true,sortable:true,sortType:"number",field:"averagePoint"}]};function f(){var t=[],a=[],e="客服绩效-客服-满意度评分";i.allData.forEach(function(e){t.push([e.userName,e.allCount,e.point1,e.point2,e.point3,e.point4,e.point5,e.averagePoint])});i.totalData&&t.unshift([i.totalData.userName,i.totalData.allCount,i.totalData.point1,i.totalData.point2,i.totalData.point3,i.totalData.point4,i.totalData.point5,i.totalData.averagePoint]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}var p=function(){i.totalData={userName:"合计",allCount:0,point1:0,point2:0,point3:0,point4:0,point5:0,averagePoint:0};v.sdk.OpenPerformanceApi().engineerSatisfaction(u()).then({success:function(e){i.loadComplete=true;if(e){m(e)}}})};function m(e){i.allData=e.list;angular.forEach(i.allData,function(e){i.totalData.allCount+=e.allCount;i.totalData.point1+=e.point1;i.totalData.point2+=e.point2;i.totalData.point3+=e.point3;i.totalData.point4+=e.point4;i.totalData.point5+=e.point5;var t=e.averagePoint.toFixed(3);e.averagePoint=t.substring(0,t.toString().length-1)});var t=i.totalData.point1*1+i.totalData.point2*2+i.totalData.point3*3+i.totalData.point4*4+i.totalData.point5*5;if(i.totalData.allCount){var a=(t/i.totalData.allCount).toFixed(3);i.totalData.averagePoint=a.substring(0,a.toString().length-1)}f()}n.register(s,n.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){p()});i.$on("$destroy",function(){n.unRegister(s)});i.$on("statistics.datarange.changed",function(e,t){p()});var h=function(){d();c()};h()}})(org.ewei);(function(v){"use strict";angular.module("eweiApp.statistics").controller("StatisticsEngineerEvaluateChatController",e);e.$inject=["$rootScope","$scope","$timeout","$state","searchService","coreNotifyService"];function e(e,i,t,a,r,n){var s=this.__proto__.constructor.name+"_"+Date.now();i.questionTip=["评价数：该客服作为接待客服时得到的点评次数","平均分=客户的评分总和/评价次数（评分总和即该客服获得的星星数量）"];i.allData=[];var o=i.$parent.dateRange.startDate.format("YYYY-MM-DD");var l=i.$parent.dateRange.endDate.format("YYYY-MM-DD");var c=function(){var e="chat.evaluate";i.searchData={showDataSource:["chat.open","chat.closed"],reportType:e,views:[]};r.loadSearchDataView(e,i.searchData.views,function(){p()})};var u=function(e){r.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");r.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");var t={startDate:r.searchData.startDate,endDate:r.searchData.endDate,filter:r.searchData.filter,customFieldFilter:r.searchData.customFieldFilter,types:r.searchData.types,page:{pageNumber:1,pageSize:9999}};return t};var d=function(){i.columns=[{title:"客服",visible:true,sortable:true,class:"text-left",field:"userName"},{title:"评价数",visible:true,sortable:true,field:"allCount"},{title:"一星评价",visible:true,sortable:true,field:"point1"},{title:"二星评价",visible:true,sortable:true,field:"point2"},{title:"三星评价",visible:true,sortable:true,field:"point3"},{title:"四星评价",visible:true,sortable:true,field:"point4"},{title:"五星评价",visible:true,sortable:true,field:"point5"},{title:"平均分",visible:true,sortable:true,sortType:"number",field:"averagePoint"}]};function f(){var t=[],a=[],e="客服统计-满意度";i.allData.forEach(function(e){t.push([e.userName,e.allCount,e.point1,e.point2,e.point3,e.point4,e.point5,e.averagePoint])});i.totalData&&t.unshift([i.totalData.userName,i.totalData.allCount,i.totalData.point1,i.totalData.point2,i.totalData.point3,i.totalData.point4,i.totalData.point5,i.totalData.averagePoint]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}var p=function(){i.totalData={userName:"合计",allCount:0,point1:0,point2:0,point3:0,point4:0,point5:0,averagePoint:0};v.sdk.OpenReportApi().engineerChatSatisfaction(u()).then({success:function(e){i.loadComplete=true;if(e){m(e)}}})};function m(e){i.allData=e.list;angular.forEach(i.allData,function(e){i.totalData.allCount+=e.allCount;i.totalData.point1+=e.point1;i.totalData.point2+=e.point2;i.totalData.point3+=e.point3;i.totalData.point4+=e.point4;i.totalData.point5+=e.point5;var t=e.averagePoint.toFixed(3);e.averagePoint=t.substring(0,t.toString().length-1)});var t=i.totalData.point1*1+i.totalData.point2*2+i.totalData.point3*3+i.totalData.point4*4+i.totalData.point5*5;if(i.totalData.allCount){var a=(t/i.totalData.allCount).toFixed(3);i.totalData.averagePoint=a.substring(0,a.toString().length-1)}f()}n.register(s,n.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){p()});i.$on("$destroy",function(){n.unRegister(s)});i.$on("statistics.datarange.changed",function(e,t){p()});var h=function(){d();c()};h()}})(org.ewei);(function(m){"use strict";angular.module("eweiApp.statistics").controller("StatisticsEngineerChatQuantityController",e);e.$inject=["$rootScope","$scope","$timeout","$state","searchService","coreNotifyService"];function e(e,n,t,a,i,r){var s=this.__proto__.constructor.name+"_"+Date.now();n.questionTip=["接待会话量 = 所选时间范围内，客服作为接待客服的会话数量","转接会话量 = 所选时间范围内，客服转出的会话数量，转出的会话不计入接待会话数中","首次响应会话量 = 所选时间范围内，客服首次响应的会话数量","质检会话量 = 所选时间范围内，客服作为会话质检人，所质检的会话数量"];n.allData=[];var o=function(){var e="engineer.chat.quantity";n.searchData={showDataSource:["chat.open","chat.closed"],reportType:e,views:[]};i.loadSearchDataView(e,n.searchData.views,function(){d();f()})};var l=function(e){i.searchData.startDate=n.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=n.$parent.dateRange.endDate.format("YYYY-MM-DD");var t={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,customFieldFilter:i.searchData.customFieldFilter,types:i.searchData.types,page:{pageNumber:1,pageSize:9999}};return t};var c=function(){n.columns=[{title:"客服",visible:true,sortable:true,class:"text-left",field:"username"},{title:"接待会话量",visible:true,sortable:true,class:"text-left",field:"receiveCount"},{title:"转接会话量",visible:true,sortable:true,field:"transferCount"},{title:"首次响应会话量",visible:true,sortable:true,field:"firstResponseCount"},{title:"质检会话量",visible:true,sortable:true,field:"qualityCount"}]};function u(){var t=[],a=[],e="客服绩效-工作量统计";n.allData.forEach(function(e){t.push([e.username,e.receiveCount,e.transferCount,e.firstResponseCount,e.qualityCount])});n.totalData&&t.unshift([n.totalData.username,n.totalData.receiveCount,n.totalData.transferCount,n.totalData.firstResponseCount,n.totalData.qualityCount]);n.columns.forEach(function(e){a.push(e.title)});n.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var d=function(){n.totalData={username:"合计",receiveCount:0,transferCount:0,firstResponseCount:0,qualityCount:0};m.sdk.OpenChatPerformanceApi().workloadEngineerDistribution(l()).then({success:function(e){n.allData=e||[];angular.forEach(n.allData,function(e){n.totalData.receiveCount+=e.receiveCount||0;n.totalData.transferCount+=e.transferCount||0;n.totalData.firstResponseCount+=e.firstResponseCount||0;n.totalData.qualityCount+=e.qualityCount||0});u()}})};var f=function(){var i={titleText:"趋势图",legendData:["接待会话量","转接会话量","响应会话量","质检会话量"],xAxisData:[],yAxis:{name:"数量",axisLine:{show:false},axisPointer:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},offset:-10,nameGap:50}};var r=[{name:"接待会话量",type:"line",data:[]},{name:"转接会话量",type:"line",data:[]},{name:"响应会话量",type:"line",data:[]},{name:"质检会话量",type:"line",data:[]}];m.sdk.OpenChatPerformanceApi().workloadTimeDistribution(l()).then({success:function(e){n.loadComplete=true;if(e){var t=n.$parent.dateRange.startDate.clone();while(t<=n.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.days==a})){e.push({days:a,receiveCount:0,transferCount:0,responseCount:0,qualityCount:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.days});angular.forEach(e,function(e){i.xAxisData.push(e.days);r[0].data.push(e.receiveCount||0);r[1].data.push(e.transferCount||0);r[2].data.push(e.responseCount||0);r[3].data.push(e.qualityCount||0)})}}});i.series=r;n.option=i};r.register(s,r.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){d();f()});n.$on("$destroy",function(){r.unRegister(s)});n.$on("statistics.datarange.changed",function(e,t){d();f()});var p=function(){c();o()};p()}})(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsEngineerChatQualityController",t);t.$inject=["$rootScope","$scope","$filter","$state","utils","searchService","coreNotifyService"];function t(e,l,t,a,i,r,n){var s=this.__proto__.constructor.name+"_"+Date.now();l.questionTip=["平均首次响应时长 = 所选时间范围内，客服所有首次响应会话中响应时长平均值","平均会话时长 = 所选时间范围内，客服作为接待客服，接通会话到会话结束的时间间隔的平均值","参评率 = 所选时间范围内，客服作为接待客服，有客户评价的会话数量/已结束会话数量比值*100%","相对满意度 = 所选时间范围内，客服作为接待客服，评价分3分及以上会话数量/有评价的会话数量比值*100%","问题解决率 = 所选时间范围内，客服作为接待客服，满意度为已解决的会话数量/有评价的会话数量比值*100%","平均评价分= 所选时间范围内，客服作为接待客服，已评价会话的总分/已评价的会话数量","抽样质检率 = 所选时间范围内，客服作为接待客服，被质检的会话数量/已结束会话数量比值*100%","平均质检分 = 所选时间范围内，客服作为接待客服，被质检的会话质检分/被质检的会话数量"];var o=function(){var e="engineer.chat.quality";l.searchData={showDataSource:["chat.open","chat.closed"],reportType:e,views:[]};r.loadSearchDataView(e,l.searchData.views,function(){u()})};var c=function(){r.searchData.startDate=l.$parent.dateRange.startDate.format("YYYY-MM-DD");r.searchData.endDate=l.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:r.searchData.startDate,endDate:r.searchData.endDate,filter:r.searchData.filter,types:r.searchData.types};return e};l.columns=[{title:"客服",visible:true,sortable:true,class:"text-left",field:"engineerName",callback:true,callbackFunction:function(e){a.go("statistics.engineer.chat_quality_detail",{params:{engineerId:e.engineerId,name:e.engineerName}})}},{title:"平均首次响应时长",visible:true,sortable:true,sortType:"number",field:"avgFirstResponseTime"},{title:"平均会话时长",visible:true,sortable:true,sortType:"number",field:"avgDurationTime"},{title:"参评率",visible:true,sortable:true,sortType:"number",field:"evaluateRate"},{title:"相对满意度",visible:true,sortable:true,sortType:"number",field:"relateSatisfaction"},{title:"问题解决率",visible:true,sortable:true,sortType:"number",field:"solvedRate"},{title:"平均评价分",visible:true,sortable:true,sortType:"number",field:"avgScore"},{title:"抽样质检率",visible:true,sortable:true,sortType:"number",field:"qualityRate"},{title:"平均质检分",visible:true,sortable:true,sortType:"number",field:"qualityScore"}];l.showWhichOne={response:true};l.checked=function(e){l.showWhichOne.response=false;l.showWhichOne.duration=false;l.showWhichOne.satisfaction=false;l.showWhichOne[e]=true};var u=function(){org.ewei.sdk.OpenChatPerformanceApi().listEngineerChatPerformance(c()).then({success:function(e){l.loadComplete=true;if(e){d(e.engineerChatPerformances||[]);f(e.daysData||[]);p(e.daysData||[])}}})};var d=function(e){l.totalData={engineerName:"统计",sumFirstResponseTime:0,sumDurationTime:0,evaluateCount:0,relateSatisfactionCount:0,solvedRate:0,solvedCount:0,avgScore:0,sumEvaluateScore:0,validResponseAmount:0,validSumAmount:0,validEvaluateAmount:0,sumCount:0,sumQualityCount:0,sumQualityScore:0};angular.forEach(e,function(e){l.totalData.sumQualityCount+=e.sumQualityCount||0;l.totalData.sumQualityScore+=e.sumQualityScore||0;if(e.firstResponseCount>0){e.avgFirstResponseTime=(e.sumFirstResponseTime||0)/e.firstResponseCount;l.totalData.sumFirstResponseTime+=e.sumFirstResponseTime||0;e.avgFirstResponseTime=t("chartTimeFormat")(e.avgFirstResponseTime);l.totalData.validResponseAmount+=e.firstResponseCount}else{e.avgFirstResponseTime="-"}if(e.sumCount>0){e.avgDurationTime=(e.sumDurationTime||0)/e.sumCount;l.totalData.sumDurationTime+=e.sumDurationTime||0;e.avgDurationTime=t("chartTimeFormat")(e.avgDurationTime);e.evaluateRate=((e.evaluateCount||0)/e.sumCount*100).toFixed(2)+"%";l.totalData.evaluateCount+=e.evaluateCount||0;l.totalData.validSumAmount+=e.sumCount||0;l.totalData.sumCount+=e.sumCount||0;e.qualityRate=((e.sumQualityCount||0)/e.sumCount*100).toFixed(2)+"%"}else{e.avgDurationTime="-"}if(e.sumQualityCount>0){e.qualityScore=(e.sumQualityScore/e.sumQualityCount).toFixed(2)}else{e.qualityScore=null}if(e.evaluateCount>0){e.relateSatisfaction=((e.relateSatisfactionCount||0)/e.evaluateCount*100).toFixed(2)+"%";l.totalData.relateSatisfactionCount+=e.relateSatisfactionCount||0;e.solvedRate=((e.solvedCount||0)/e.evaluateCount*100).toFixed(2)+"%";l.totalData.solvedCount+=e.solvedCount||0;e.avgScore=((e.sumEvaluateScore||0)/e.evaluateCount).toFixed(2);l.totalData.sumEvaluateScore+=e.sumEvaluateScore||0;l.totalData.validEvaluateAmount+=e.evaluateCount}else{e.relateSatisfaction="-";e.solvedRate="-";e.avgScore="-"}});if(l.totalData.validResponseAmount>0){l.totalData.avgFirstResponseTime=t("chartTimeFormat")(l.totalData.sumFirstResponseTime/l.totalData.validResponseAmount)}else{l.totalData.avgFirstResponseTime="-"}if(l.totalData.validSumAmount>0){l.totalData.evaluateRate=(l.totalData.evaluateCount/l.totalData.validSumAmount*100).toFixed(2)+"%";l.totalData.avgDurationTime=t("chartTimeFormat")(l.totalData.sumDurationTime/l.totalData.validSumAmount)}else{l.totalData.evaluateRate=(0).toFixed(2)+"%";l.totalData.avgDurationTime="-"}if(l.totalData.validEvaluateAmount>0){l.totalData.relateSatisfaction=l.totalData.relateSatisfactionCount>0?(l.totalData.relateSatisfactionCount/l.totalData.validEvaluateAmount*100).toFixed(2)+"%":"-";l.totalData.solvedRate=l.totalData.solvedCount>0?(l.totalData.solvedCount/l.totalData.validEvaluateAmount*100).toFixed(2)+"%":"-";l.totalData.avgScore=l.totalData.sumEvaluateScore>0?(l.totalData.sumEvaluateScore/l.totalData.validEvaluateAmount).toFixed(2):"-"}else{l.totalData.relateSatisfaction="-";l.totalData.solvedRate="-";l.totalData.avgScore="-"}if(l.totalData.sumCount>0){l.totalData.qualityRate=(l.totalData.sumQualityCount/l.totalData.sumCount*100).toFixed(2)+"%"}else{l.totalData.qualityRate="-"}if(l.totalData.sumQualityCount>0){l.totalData.qualityScore=(l.totalData.sumQualityScore/l.totalData.sumQualityCount).toFixed(2)}else{l.totalData.qualityScore="-"}l.allData=e;m()};var f=function(t){var r=function(e){var t=e;if(typeof e==="object"){t=e.value}if(typeof t==="number"){if(t<60){return t.toFixed(1)+"s"}if(t<3600){return(t/60).toFixed(1)+"m"}return(t/3600).toFixed(1)+"h"}return t};var a=function(e){var t;if(Object.prototype.toString.call(e)==="[object Array]"){t=e}else{t=[e]}var a=t[0].name+"<br/>";var i=[];angular.forEach(e,function(e){i.push('<span style="display:inline-block; background-color:'+e.color+';width:10px;height:10px;border-radius: 5px"></span> '+e.seriesName+": "+r(e.value))});return a+i.join("<br/>")};var i={titleText:"趋势图",legendData:["平均首次响应时长"],xAxisData:[],yAxis:{name:"平均首次响应时长",axisLine:{show:false},axisLabel:{formatter:r},axisPointer:{label:{formatter:r}},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},offset:-10,nameGap:50},series:[{type:"line",name:"平均首次响应时长",data:[]}],formatter:a};var n={titleText:"趋势图",legendData:["平均会话时长"],xAxisData:[],yAxis:{name:"平均会话时长",axisLine:{show:false},axisLabel:{formatter:r},axisPointer:{label:{formatter:r}},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},offset:-10,nameGap:50},series:[{type:"line",name:"平均会话时长",data:[]}],formatter:a};var e=l.$parent.dateRange.startDate.clone();while(e<=l.$parent.dateRange.endDate){var s=e.format("YYYY-MM-DD");if(!Object.prototype.hasOwnProperty.call(t,s)){t[s]={averageDaysFirstResponseTime:0,averageDaysDurationTime:0}}e.add(1,"days")}var o=Object.keys(t).sort();angular.forEach(o,function(e){i.xAxisData.push(e);i.series[0].data.push({value:t[e].averageDaysFirstResponseTime||0,tooltip:{formatter:a}});n.xAxisData.push(e);n.series[0].data.push({value:t[e].averageDaysDurationTime||0,tooltip:{formatter:a}})});l.responseOption=i;l.durationOption=n};var p=function(t){var e=function(e){var t;if(Object.prototype.toString.call(e)==="[object Array]"){t=e}else{t=[e]}var a=t[0].name+"<br/>";var i=[];angular.forEach(e,function(e){i.push('<span style="display:inline-block; background-color:'+e.color+';width:10px;height:10px;border-radius: 5px"></span> '+e.seriesName+": "+e.value.toFixed(2)+"%")});return a+i.join("<br/>")};var a={titleText:"趋势图",legendData:["参评率","相对满意度","问题解决率"],xAxisData:[],yAxis:{name:"百分比",axisLine:{show:false},axisPointer:{label:{formatter:function(e){return e.value.toFixed(0)+"%"}}},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},offset:-10,nameGap:50,axisLabel:{formatter:function(e){return e.toFixed(0)+"%"}}},series:[{name:"参评率",type:"line",data:[]},{name:"相对满意度",type:"line",data:[]},{name:"问题解决率",type:"line",data:[]}],formatter:e};var i=Object.keys(t).sort();angular.forEach(i,function(e){a.xAxisData.push(e);a.series[0].data.push({value:(t[e].averageDaysEvaluate||0)*100});a.series[1].data.push({value:(t[e].averageDaysRelateSatisfaction||0)*100});a.series[2].data.push({value:(t[e].averageDaysSolved||0)*100})});l.satisfactionOption=a};function m(){var t=[],a=[],e="客服绩效-工作质量统计";l.allData.forEach(function(e){t.push([e.engineerName,e.avgFirstResponseTime,e.avgDurationTime,e.evaluateRate,e.relateSatisfaction,e.solvedRate,e.avgScore,e.qualityRate,e.qualityScore])});l.totalData&&t.unshift([l.totalData.engineerName,l.totalData.avgFirstResponseTime,l.totalData.avgDurationTime,l.totalData.evaluateRate,l.totalData.relateSatisfaction,l.totalData.solvedRate,l.totalData.avgScore,l.totalData.qualityRate,l.totalData.qualityScore]);l.columns.forEach(function(e){a.push(e.title)});l.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}var h=function(){o()};h();n.register(s,n.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){u()});l.$on("statistics.datarange.changed",function(e,t){u()});l.$on("$destroy",function(){n.unRegister(s)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsEngineerChatQualityDetailController",e);e.$inject=["$rootScope","$scope","$stateParams","$state","$filter","utils","StatisticsBreadcrumbService","apiChartEngineerService","searchService","WebChatListManager"];function e(e,l,t,a,i,r,n,s,o,c){l.params=t.params;n.push({url:"statistics.engineer.chat_quality",name:"工作质量统计"});n.push({name:l.params.name});var u=function(e){var t={engineerId:l.params.engineerId,startDate:l.$parent.dateRange.startDate.format("YYYY-MM-DD"),endDate:l.$parent.dateRange.endDate.format("YYYY-MM-DD"),filter:o.searchData.filter,customFieldFilter:o.searchData.customFieldFilter,types:o.searchData.types};if(e=="page"){t.page={pageSize:9999,pageNumber:1}}return t};var d=function(t){var r=function(e){var t=e;if(typeof e==="object"){t=e.value}if(typeof t==="number"){if(t<60){return t.toFixed(1)+"s"}if(t<3600){return(t/60).toFixed(1)+"m"}return(t/3600).toFixed(1)+"h"}return t};var a=function(e){var t;if(Object.prototype.toString.call(e)==="[object Array]"){t=e}else{t=[e]}var a=t[0].name+"<br/>";var i=[];angular.forEach(e,function(e){i.push('<span style="display:inline-block; background-color:'+e.color+';width:10px;height:10px;border-radius: 5px"></span> '+e.seriesName+": "+r(e.value))});return a+i.join("<br/>")};var i={titleText:"趋势分析",legendData:["平均首次响应时长"],xAxisData:[],yAxis:{name:"平均首次响应时长",axisLine:{show:false},axisLabel:{formatter:r},axisPointer:{label:{formatter:r}},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},offset:-10,nameGap:50},series:[{type:"line",name:"平均首次响应时长",data:[]}],formatter:a};var n={titleText:"趋势分析",legendData:["平均会话时长"],xAxisData:[],yAxis:{name:"平均会话时长",axisLine:{show:false},axisLabel:{formatter:r},axisPointer:{label:{formatter:r}},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},offset:-10,nameGap:50},series:[{type:"line",name:"平均会话时长",data:[]}],formatter:a};var e=l.$parent.dateRange.startDate.clone();while(e<=l.$parent.dateRange.endDate){var s=e.format("YYYY-MM-DD");if(!Object.prototype.hasOwnProperty.call(t,s)){t[s]={averageDaysFirstResponseTime:0,averageDaysDurationTime:0}}e.add(1,"days")}var o=Object.keys(t).sort();angular.forEach(o,function(e){i.xAxisData.push(e);i.series[0].data.push({value:t[e].averageDaysFirstResponseTime||0,tooltip:{formatter:a}});n.xAxisData.push(e);n.series[0].data.push({value:t[e].averageDaysDurationTime||0,tooltip:{formatter:a}})});l.responseOption=i;l.durationOption=n};var f=function(t){var e=function(e){var t;if(Object.prototype.toString.call(e)==="[object Array]"){t=e}else{t=[e]}var a=t[0].name+"<br/>";var i=[];angular.forEach(e,function(e){i.push('<span style="display:inline-block; background-color:'+e.color+';width:10px;height:10px;border-radius: 5px"></span> '+e.seriesName+": "+e.value.toFixed(2)+"%")});return a+i.join("<br/>")};var a={titleText:"趋势分析",legendData:["参评率","相对满意度","问题解决率"],xAxisData:[],yAxis:{name:"百分比",axisLine:{show:false},axisPointer:{label:{formatter:function(e){return e.value.toFixed(0)+"%"}}},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},offset:-10,nameGap:50,axisLabel:{formatter:function(e){return e.toFixed(0)+"%"}}},series:[{name:"参评率",type:"line",data:[]},{name:"相对满意度",type:"line",data:[]},{name:"问题解决率",type:"line",data:[]}],formatter:e};var i=Object.keys(t).sort();angular.forEach(i,function(e){a.xAxisData.push(e);a.series[0].data.push({value:(t[e].averageDaysEvaluate||0)*100});a.series[1].data.push({value:(t[e].averageDaysRelateSatisfaction||0)*100});a.series[2].data.push({value:(t[e].averageDaysSolved||0)*100})});l.satisfactionOption=a};var p=function(){org.ewei.sdk.OpenChatPerformanceApi().getChatPerformanceByEngineerId(u()).then({success:function(e){d(e);f(e);l.loadComplete=true}})};var m=function(){l.columns=[{title:"时间",visible:true,sortable:true,field:"createdAt"},{title:"客服",visible:true,sortable:true,field:"engineerName"},{title:"主题",visible:true,sortable:true,field:"firstMessage",callbackFunction:function(e){a.go("webchat-history.detail",{id:e.id,key:"engineerChatQuality"+l.params.engineerId})}},{title:"首次响应时长",visible:true,sortable:true,sortType:"number",field:"firstResponseTime"},{title:"会话时长",visible:true,sortable:true,sortType:"number",field:"durationTime"},{title:"解决否",visible:true,sortable:true,field:"solved"},{title:"评价否",visible:true,sortable:true,field:"hasEvaluation"},{title:"满意度",visible:true,sortable:true,sortType:"number",field:"score"},{title:"质检否",visible:true,sortable:true,field:"isChatQuality"},{title:"质检分",visible:true,sortable:true,field:"qualityScore"}]};var h=function(){l.allData=[];org.ewei.sdk.OpenChatPerformanceApi().listChatByEngineerId(u("page")).then({success:function(e){l.loadComplete=true;var t=[];if(e&&e.list&&e.list.length>0){angular.forEach(e.list,function(e){if(e.status!=="overflow"&&e.status!=="canceled"){t.push(e.id)}e.engineerName=e.engineer&&e.engineer.user?e.engineer.user.name||e.engineer.user.nickname:"-";e.firstResponseTime=e.chatExtra&&e.chatExtra.firstResponseTime!==undefined&&e.chatExtra.firstResponseTime!==null?i("chartTimeFormat")(e.chatExtra.firstResponseTime):"-";e.durationTime=e.chatExtra?i("chartTimeFormat")(e.chatExtra.durationTime||0):"-";e.solved=e.chatEvaluation?i("evaluateValueFilter")(e.chatEvaluation.solved,"firstQuestion"):"-";e.hasEvaluation=e.chatEvaluation?"已评价":"未评价";e.score=e.chatEvaluation?i("evaluateValueFilter")(e.chatEvaluation.score):"-";e.isChatQuality=e.chatQuality?"已质检":"未质检";e.qualityScore=e.chatQuality?e.chatQuality.totalScore:null})}l.allData=e.list||[];c.setHistoryChatList("engineerChatQuality"+l.params.engineerId,t,u("page"),e.recordCount);v()}})};function v(){var t=[],a=[],e="客服绩效-工作质量统计-客服-"+l.params.name;l.allData.forEach(function(e){t.push([e.createdAt,e.engineerName,e.firstMessage,e.firstResponseTime,e.durationTime,e.solved,e.hasEvaluation,e.score,e.isChatQuality,e.qualityScore])});l.columns.forEach(function(e){a.push(e.title)});l.exportData={startDate:o.searchData.startDate,endDate:o.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:o.searchData.filterDescription,types:o.searchData.types}}var g=function(){p();m();h()};g();var D=function(){p();h()};l.$on("statistics.datarange.changed",D);l.showWhichOne={response:true};l.checked=function(e){l.showWhichOne.response=false;l.showWhichOne.duration=false;l.showWhichOne.satisfaction=false;l.showWhichOne[e]=true};l.$on("$destroy",function(){n.pop(2)})}}();(function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsCustomerRootController",e);e.$inject=["$rootScope","$scope","$state","permissions","coreModelService","StatisticsBreadcrumbService"];function e(e,t,a,i,r,n){t.breadcrumbs=n.items;t.goto=n.goto;var s=r.config.route.get("statistics-customer");if(s){if(s.permission){if(i.hasPermission(s.permission)){return a.go(s.name,s.params)}else{return a.go("unauthorized")}}else{return a.go(s.name,s.params)}}else{a.go("statistics.customer.customerGroup")}}})();(function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsCustomerGroupController",t);t.$inject=["$rootScope","$scope","$timeout","$state","StatisticsBreadcrumbService","searchService","coreNotifyService"];function t(e,i,t,a,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();i.questionTip=["人数：该客户组中的客户人数总和","期间增减：筛选时间段内增加或减少的人数","请求数：筛选条件内该客户组中所有客户的所有请求总和","期间新增：筛选时段内新产生的工单数量","活跃度：筛选时段内有新增工单则为向上的绿色箭头，没有新增工单则为向下红色箭头"];i.showWhichOne={customerGroup:true};i.allData=[];var c={ticketList:[],userGroupList:[],userList:[],evaluateList:[],scoreList:[],timeArr:[]};var l=function(){var e="customer.group";i.searchData={showDataSource:["ticket.all"],reportType:e,views:[]};n.loadSearchDataView(e,i.searchData.views,function(){v()})};var u=function(e){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");var t;if(e==="group"){t={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,types:[]}}else{t={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,types:[]}}return t};i.checked=function(e){i.showWhichOne.customerGroup=false;i.showWhichOne.customerEvaluate=false;i.showWhichOne[e]=true;d(e)};var d=function(e){var t={};t.titleText="";t.xAxisData=c.timeArr;var a={first:"",second:""};if(e==="customerGroup"){t.lineColor=["#FF9900","#33CC00","#FF33FF"];t.legendData=["请求数","人数","组数量"];a.first="组/人数量";a.second="请求数";t.series=[{name:t.legendData[0],type:"line",symbol:"circle",symbolSize:10,yAxisIndex:1,data:c.ticketList},{name:t.legendData[1],type:"line",symbol:"circle",symbolSize:10,data:c.userList},{name:t.legendData[2],type:"line",symbol:"circle",symbolSize:10,data:c.userGroupList}]}else{t.lineColor=["#FF9900","#FF33FF"];t.legendData=["评价数","评分"];a.first="评价数";a.second="评分";t.series=[{name:t.legendData[0],type:"line",symbol:"circle",symbolSize:10,data:c.evaluateList},{name:t.legendData[1],type:"line",symbol:"circle",symbolSize:10,yAxisIndex:1,data:c.scoreList}]}t.yAxis=[{type:"value",name:a.first,axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}},{type:"value",name:a.second,axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}];i.option=t};var f=function(){i.columns=[{title:"客户组",visible:true,sortable:true,class:"text-left",field:"name",callbackFunction:function(e){a.go("statistics.customer.customerGroupDetail",{params:{title:e.name,id:e.id}})}},{title:"人数",visible:true,sortable:true,field:"countUser"},{title:"期间增减",visible:true,sortable:true,field:"addUser"},{title:"请求数",visible:true,sortable:true,field:"countTicket"},{title:"期间新增",visible:true,sortable:true,field:"addTicket"},{title:"活跃度",visible:true,sortable:true,field:"liveness",icon:true},{title:"评价数",visible:true,sortable:true,field:"countEvaluate"},{title:"评分",visible:true,sortable:true,sortType:"number",field:"avgScore"},{title:"服务报告",visible:true,sortable:false,field:"serviceReport",icon:true,callbackFunction:function(e){a.go("statistics.serviceReportDetail",{type:"userGroup",id:e.id,dateFrom:n.searchData.startDate,dateTo:n.searchData.endDate})}}]};var p=function(){i.loadComplete=false;i.totalData={name:"统计",countUser:0,addUser:0,countTicket:0,addTicket:0,countEvaluate:0,avgScore:0};i.allData=[];org.ewei.sdk.OpenReportApi().countTicketByUserGroup(u("group")).then({success:function(e){i.loadComplete=true;if(e&&e.length>0){i.allData=e;angular.forEach(e,function(e){i.totalData.countUser+=e.countUser;i.totalData.addUser+=e.addUser;i.totalData.countTicket+=e.countTicket;i.totalData.addTicket+=e.addTicket;if(e.addTicket>0){e.liveness="<span class='iconfont' style='color:#33CC00;'>&#xe74b;</span>"}else{e.liveness="<span class='iconfont' style='color:#FF0000;'>&#xe74a;</span>"}e.serviceReport="<span class='iconfont' style='color:#ccc;'>&#xe627;</span>";i.totalData.countEvaluate+=e.countEvaluate;if(e.avgScore){i.totalData.avgScore+=parseFloat(e.avgScore)*e.countEvaluate}else{e.avgScore="-"}});i.totalData.avgScore=i.totalData.countEvaluate===0?0:(i.totalData.avgScore/i.totalData.countEvaluate).toFixed(2);if(i.totalData.addTicket>0){i.totalData.liveness="<span class='iconfont' style='color:#33CC00;'>&#xe74b;</span>"}else{i.totalData.liveness="<span class='iconfont' style='color:#FF0000;'>&#xe74a;</span>"}}h()}})};var m=function(l){org.ewei.sdk.OpenReportApi().countIncreasingTendency(u("report")).then({success:function(e){var t=[];var a=[];var i=[];var r=[];var n=[];var s=[];angular.forEach(e.ticketList,function(e){t.push(e.value);s.push(e.name)});angular.forEach(e.userList,function(e){i.push(e.value)});angular.forEach(e.userGroupList,function(e){a.push(e.value)});angular.forEach(e.evaluateList,function(e){r.push(e.value)});for(var o=0;o<e.scoreList.length;o++){if(r[o]===0){n.push(0)}else{n.push((e.scoreList[o].value/r[o]).toFixed(2))}}c.ticketList=t;c.userGroupList=a;c.userList=i;c.evaluateList=r;c.scoreList=n;c.timeArr=s;d(l)}})};function h(){var t=[],a=[],e="客户统计-客户组";i.allData.forEach(function(e){t.push([e.name,e.countUser,e.addUser,e.countTicket,e.addTicket,e.countEvaluate,e.avgScore])});i.totalData&&t.unshift([i.totalData.name,i.totalData.countUser,i.totalData.addUser,i.totalData.countTicket,i.totalData.addTicket,i.totalData.countEvaluate,i.totalData.avgScore]);i.columns.forEach(function(e){if(e.field!=="liveness"&&e.field!=="serviceReport"){a.push(e.title)}});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){v()});i.$on("$destroy",function(){s.unRegister(o)});i.$on("statistics.datarange.changed",function(e,t){v()});var v=function(){if(i.showWhichOne["customerGroup"]){m("customerGroup")}else{m("customerEvaluate")}p()};var g=function(){f();l()};g()}})(org.ewei);(function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsCustomerGroupDetailController",e);e.$inject=["$rootScope","$scope","$timeout","$stateParams","StatisticsBreadcrumbService","searchService","coreModelService"];function e(e,i,t,a,r,n,s){i.params=a.params;i.queryName="客户统计-客户组-"+i.params.title;r.push({url:"statistics.customer.customerGroup",name:"客户组"});r.push({name:i.params.title});var o={ticketList:[],userList:[],evaluateList:[],scoreList:[],timeArr:[]};var l=function(){var e={startDate:i.$parent.dateRange.startDate.format("YYYY-MM-DD"),endDate:i.$parent.dateRange.endDate.format("YYYY-MM-DD"),filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,userGroupId:i.params.id};return e};var c=function(e){var t={};var a={first:[],second:[]};t.xAxisData=o.timeArr;if(e==="ticket"){t.titleText="请求走势";t.lineColor=["#FF33FF","#0099FF"];t.legendData=["请求数","人数"];a.first=o.ticketList;a.second=o.userList}else{t.titleText="客户评价";t.lineColor=["#FF33FF","#54DD54"];t.legendData=["评价数","评分"];a.first=o.evaluateList;a.second=o.scoreList}t.yAxis=[{minInterval:1,type:"value",name:t.legendData[0],axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}},{minInterval:1,type:"value",name:t.legendData[1],axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}];t.series=[{name:t.legendData[0],type:"line",symbol:"circle",symbolSize:10,data:a.first},{name:t.legendData[1],type:"line",symbol:"circle",symbolSize:10,yAxisIndex:1,data:a.second}];if(e==="ticket"){i.ticketOption=t}else{i.evaluateOption=t}};var u=function(){org.ewei.sdk.OpenReportApi().countIncreasingTendencyByUserGroupId(l()).then({success:function(e){var t=[];var a=[];var i=[];var r=[];var n=[];angular.forEach(e.ticketList,function(e){t.push(e.value);n.push(e.name)});angular.forEach(e.userList,function(e){a.push(e.value)});angular.forEach(e.evaluateList,function(e){i.push(e.value)});for(var s=0;s<e.scoreList.length;s++){if(i[s]===0){r.push(0)}else{r.push((e.scoreList[s].value/i[s]).toFixed(2))}}o.ticketList=t;o.userList=a;o.evaluateList=i;o.scoreList=r;o.timeArr=n;c("ticket");c("evaluate")}})};i.$on("$destroy",function(){r.pop(2)});var d=function(){u();var e=JSON.parse(n.searchData.filter);e["$and"][0]["$and"].push({$eq:{"requester.userGroup.id":i.params.id}});e["$and"][0]["$and"].push({$eq:{"requester.type":"customer"}});e["$and"][0]["$and"].push({$eq:{"requester.valid":1}});e["$and"][0]["$and"].push({$eq:{"requester.deleted":0}},{$eq:{"requester.status":1}});i.queryParams={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:JSON.stringify(e),customFieldFilter:n.searchData.customFieldFilter,filterDescription:n.searchData.filterDescription,types:[]};if(s.detail.statistics.columns.customer.customerGroup.length>0){i.defaultColumns=s.detail.statistics.columns.customer.customerGroup}else{i.defaultColumns=s.detail.statistics.columns.customer.customerGroup=["subject","requester.name","requester.userGroup.name","via.channelName","evaluate.solved","evaluate.score","evaluate.suggestion","evaluate.system"]}};d()}})();(function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsCustomerController",t);t.$inject=["$rootScope","$scope","$timeout","$state","searchService","coreNotifyService"];function t(e,r,t,a,i,n){var s=this.__proto__.constructor.name+"_"+Date.now();r.questionTip=["请求数：该客户的所有请求数量总和","期间新增：筛选时间段内新产生的工单数量","活跃度：筛选条件内该客户新增工单，则为向上绿色箭头，没有新增工单，则红色向下箭头","评分=筛选条件内该客户所有工单评价分值总和÷筛选条件内该客户所有评价工单量"];r.showWhichOne={customer:true};r.allData=[];var l={ticketList:[],userList:[],evaluateList:[],scoreList:[],timeArr:[]};var o=function(){var e="customer.customer";r.searchData={showDataSource:["ticket.all"],reportType:e,views:[]};i.loadSearchDataView(e,r.searchData.views,function(){h()})};var c=function(e){i.searchData.startDate=r.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=r.$parent.dateRange.endDate.format("YYYY-MM-DD");var t;if(e==="customer"){t={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,customFieldFilter:i.searchData.customFieldFilter,types:[]}}else{t={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,customFieldFilter:i.searchData.customFieldFilter}}return t};r.checked=function(e){r.showWhichOne.customer=false;r.showWhichOne.customerEvaluate=false;r.showWhichOne[e]=true;u(e)};var u=function(e){var t={};t.titleText="";t.xAxisData=l.timeArr;var a={first:"",second:""};var i={first:[],second:[]};if(e==="customer"){t.lineColor=["#FF9900","#33CC00"];t.legendData=["请求数","人数"];a.first="人数";a.second="请求数";i.first=l.ticketList;i.second=l.userList}else{t.lineColor=["#FF9900","#FF33FF"];t.legendData=["评价数","评分"];a.first="评价数";a.second="评分";i.first=l.evaluateList;i.second=l.scoreList}t.series=[{name:t.legendData[0],type:"line",symbol:"circle",symbolSize:10,data:i.first},{name:t.legendData[1],type:"line",symbol:"circle",symbolSize:10,yAxisIndex:1,data:i.second}];t.yAxis=[{type:"value",name:a.first,axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}},{type:"value",name:a.second,axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}];r.option=t};var d=function(){r.columns=[{title:"客户",visible:true,sortable:true,class:"text-left",field:"name",callbackFunction:function(e){a.go("statistics.customer.customerDetail",{params:{title:e.name,id:e.id}})}},{title:"请求数",visible:true,sortable:true,field:"countTicket"},{title:"期间增减",visible:true,sortable:true,field:"addTicket"},{title:"活跃度",visible:true,sortable:true,field:"liveness",icon:true},{title:"评价数",visible:true,sortable:true,field:"countEvaluate"},{title:"评分",visible:true,sortable:true,sortType:"number",field:"avgScore"},{title:"社区活动",visible:true,sortable:true,field:"communityActivity"},{title:"积分",visible:true,sortable:true,field:"integral"},{title:"服务报告",visible:true,sortable:false,field:"serviceReport",icon:true,callbackFunction:function(e){a.go("statistics.serviceReportDetail",{type:"customer",id:e.id,dateFrom:i.searchData.startDate,dateTo:i.searchData.endDate})}}]};var f=function(){r.loadComplete=false;r.totalData={name:"统计",countTicket:0,communityActivity:0,integral:0,addTicket:0,liveness:0,countEvaluate:0,avgScore:0};r.allData=[];org.ewei.sdk.OpenReportApi().countTicketByRequester(c("customer")).then({success:function(e){r.loadComplete=true;if(e&&e.length>0){r.allData=e;angular.forEach(e,function(e){r.totalData.countTicket+=e.countTicket;r.totalData.addTicket+=e.addTicket;r.totalData.communityActivity+=e.communityActivity;if(e.integral){r.totalData.integral+=e.integral}if(e.addTicket>0){e.liveness="<span class='iconfont' style='color:#33CC00;'>&#xe74b;</span>"}else{e.liveness="<span class='iconfont' style='color:#FF0000;'>&#xe74a;</span>"}e.serviceReport="<span class='iconfont' style='color:#ccc;'>&#xe627;</span>";r.totalData.countEvaluate+=e.countEvaluate;if(e.avgScore){r.totalData.avgScore+=parseFloat(e.avgScore)*e.countEvaluate}else{e.avgScore="-"}});r.totalData.avgScore=r.totalData.countEvaluate===0?0:(r.totalData.avgScore/r.totalData.countEvaluate).toFixed(2);if(r.totalData.addTicket>0){r.totalData.liveness="<span class='iconfont' style='color:#33CC00;'>&#xe74b;</span>"}else{r.totalData.liveness="<span class='iconfont' style='color:#FF0000;>&#xe74a;</span>"}}p()}})};function p(){var t=[],a=[],e="会话统计-渠道来源";r.allData.forEach(function(e){t.push([e.name,e.countTicket,e.addTicket,e.countEvaluate,e.avgScore,e.communityActivity,e.integral])});r.totalData&&t.unshift([r.totalData.name,r.totalData.countTicket,r.totalData.addTicket,r.totalData.countEvaluate,r.totalData.avgScore,r.totalData.communityActivity,r.totalData.integral]);r.columns.forEach(function(e){if(e.field!=="serviceReport"&&e.field!=="liveness"){a.push(e.title)}});r.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var m=function(o){org.ewei.sdk.OpenReportApi().countIncreasingTendency(c("report")).then({success:function(e){var t=[];var a=[];var i=[];var r=[];var n=[];angular.forEach(e.userList,function(e){a.push(e.value);n.push(e.name)});angular.forEach(e.ticketList,function(e){t.push(e.value)});angular.forEach(e.evaluateList,function(e){i.push(e.value)});for(var s=0;s<e.scoreList.length;s++){if(i[s]===0){r.push(0)}else{r.push((e.scoreList[s].value/i[s]).toFixed(2))}}l.ticketList=t;l.userList=a;l.evaluateList=i;l.scoreList=r;l.timeArr=n;u(o)}})};n.register(s,n.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){h()});r.$on("$destroy",function(){n.unRegister(s)});r.$on("statistics.datarange.changed",function(e,t){h()});var h=function(){if(r.showWhichOne["customer"]){m("customer")}else{m("customerEvaluate")}f()};var v=function(){d();o()};v()}})(org.ewei);(function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsCustomerDetailController",e);e.$inject=["$rootScope","$scope","$timeout","$stateParams","StatisticsBreadcrumbService","searchService","coreModelService"];function e(e,i,t,a,r,n,s){i.params=a.params;i.queryName="客户统计-客户-"+i.params.title;r.push({url:"statistics.customer.customer",name:"客户"});r.push({name:i.params.title});var o={ticketList:[],evaluateList:[],scoreList:[],timeArr:[]};var l=function(){var e={startDate:i.$parent.dateRange.startDate.format("YYYY-MM-DD"),endDate:i.$parent.dateRange.endDate.format("YYYY-MM-DD"),filter:n.searchData.filter,customFieldFilter:n.searchData.customFieldFilter,userId:i.params.id};return e};var c=function(e){var t={};var a={first:[],second:[]};t.xAxisData=o.timeArr;if(e==="ticket"){t.titleText="请求走势";t.lineColor=["#FF33FF","#0099FF"];t.legendData=[];a.first=o.ticketList;t.yAxis=[{minInterval:1,type:"value",name:"请求数",axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}];t.series=[{name:"请求数",type:"line",symbol:"circle",symbolSize:10,data:a.first}]}else{t.titleText="客户评价";t.lineColor=["#FF33FF","#54DD54"];t.legendData=["评价数","评分"];a.first=o.evaluateList;a.second=o.scoreList;t.yAxis=[{minInterval:1,type:"value",name:t.legendData[0],axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}},{minInterval:1,type:"value",name:t.legendData[1],axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}];t.series=[{name:t.legendData[0],type:"line",symbol:"circle",symbolSize:10,data:a.first},{name:t.legendData[1],type:"line",symbol:"circle",symbolSize:10,yAxisIndex:1,data:a.second}]}if(e==="ticket"){i.ticketOption=t}else{i.evaluateOption=t}};var u=function(){org.ewei.sdk.OpenReportApi().countIncreasingTendencyByUserId(l()).then({success:function(e){var t=[];var a=[];var i=[];var r=[];angular.forEach(e.ticketList,function(e){t.push(e.value);r.push(e.name)});angular.forEach(e.evaluateList,function(e){a.push(e.value)});for(var n=0;n<e.scoreList.length;n++){if(a[n]===0){i.push(0)}else{i.push((e.scoreList[n].value/a[n]).toFixed(2))}}o.ticketList=t;o.evaluateList=a;o.scoreList=i;o.timeArr=r;c("ticket");c("evaluate")}})};i.$on("$destroy",function(){r.pop(2)});var d=function(){u();var e=JSON.parse(n.searchData.filter);e["$and"][0]["$and"].push({$eq:{"requester.id":i.params.id}});i.queryParams={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:JSON.stringify(e),customFieldFilter:n.searchData.customFieldFilter,filterDescription:n.searchData.filterDescription,types:[]};if(s.detail.statistics.columns.customer.customer.length>0){i.defaultColumns=s.detail.statistics.columns.customer.customer}else{i.defaultColumns=s.detail.statistics.columns.customer.customer=["subject","requester.name","requester.userGroup.name","via.channelName","evaluate.solved","evaluate.score","evaluate.suggestion","evaluate.system"]}};d()}})();(function(y){"use strict";angular.module("eweiApp.statistics").controller("StatisticsCustomerEvaluateController",e);e.$inject=["$rootScope","$scope","$timeout","$state","searchService","coreNotifyService"];function e(e,s,t,a,i,r){var n=this.__proto__.constructor.name+"_"+Date.now();s.questionTip=["参评率=筛选时段内处理完毕的工单已评价的数量/筛选时间段内处理完毕的工单数","评分=评分总和/评价次数(满分为5分制)","忠诚度=忠诚度评分总和/评价次数(满分为5分制)","推荐度=推荐度评分总和/评价次数(满分为5分制)"];s.allData=[];var o=s.$parent.dateRange.startDate.format("YYYY-MM-DD");var l=s.$parent.dateRange.endDate.format("YYYY-MM-DD");var d={evaluateRate:0,avgScore:0,avgLoyalty:0,avgRecommend:0};var c=function(){var e="customer.evaluate";s.searchData={showDataSource:["ticket.solved","ticket.closed"],reportType:e,views:[]};i.loadSearchDataView(e,s.searchData.views,function(){h()})};var u=function(e){i.searchData.startDate=s.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=s.$parent.dateRange.endDate.format("YYYY-MM-DD");var t={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,customFieldFilter:i.searchData.customFieldFilter,types:i.searchData.types};return t};var f=function(){s.evaluateList=[{title:"参评率",text:d.evaluateRate,data:[{name:"参评率",value:parseFloat(d.evaluateRate)},{name:"未参评率",value:100-d.evaluateRate}],color:"customer.evaluate.rate"},{title:"评分",text:d.avgScore,data:[{name:"评分",value:parseFloat(d.avgScore)},{name:"未评分",value:5-d.avgScore}],color:"customer.evaluate.avgScore"},{title:"忠诚度",text:d.avgLoyalty,data:[{name:"忠诚度",value:parseFloat(d.avgLoyalty)},{name:"未忠诚度",value:10-d.avgLoyalty}],color:"customer.evaluate.avgLoyalty"},{title:"推荐度",text:d.avgRecommend,data:[{name:"推荐度",value:parseFloat(d.avgRecommend)},{name:"未推荐度",value:10-d.avgRecommend}],color:"customer.evaluate.avgRecommend"}]};var p=function(){s.columns=[{title:"客户",visible:true,sortable:true,class:"text-left",field:"name",callbackFunction:function(e){a.go("statistics.customer.evaluateDetail",{params:{title:e.name,id:e.id}})}},{title:"评价数",visible:true,sortable:true,field:"countEvaluate"},{title:"参评率",visible:true,sortable:true,sortType:"number",field:"evaluateRate"},{title:"评分",visible:true,sortable:true,sortType:"number",field:"avgScore"},{title:"建议",visible:true,sortable:true,field:"suggestionCount"},{title:"忠诚度",visible:true,sortable:true,sortType:"number",field:"avgLoyalty"},{title:"推荐度",visible:true,sortable:true,sortType:"number",field:"avgRecommend"}]};function m(){var t=[],a=[],e="客户统计-满意度";s.allData.forEach(function(e){t.push([e.name,e.countEvaluate,e.evaluateRate,e.avgScore,e.suggestionCount,e.avgLoyalty,e.avgRecommend])});s.totalData&&t.unshift([s.totalData.name,s.totalData.countEvaluate,s.totalData.evaluateRate,s.totalData.avgScore,s.totalData.suggestionCount,s.totalData.avgLoyalty,s.totalData.avgRecommend]);s.columns.forEach(function(e){a.push(e.title)});s.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var h=function(){s.totalData={name:"统计",countEvaluate:0,evaluateRate:0,avgScore:0,suggestionCount:0,avgLoyalty:0,avgRecommend:0};y.sdk.OpenReportApi().countTicketByEvaluate(u()).then({success:function(e){s.loadComplete=true;if(e){v(e);g(e)}}})};function v(e){var t=[];var a=0;var i=0;var r=0;var n=0;var s=0;var o=0;var l=0;var c=0;var u=0;angular.forEach(e,function(e){u++;r+=parseFloat(e.countEvaluate);n+=parseFloat(e.countTicket);if(!angular.isUndefined(e.avgScore)){a+=parseFloat(e.avgScore);i++}if(!angular.isUndefined(e.avgLoyalty)){s+=parseFloat(e.avgLoyalty);o++}if(!angular.isUndefined(e.avgRecommend)){l+=parseFloat(e.avgRecommend);c++}});d.evaluateRate=(n===0?0:r/n*100).toFixed(2);d.avgScore=a===0?0:(a/i).toFixed(2);d.avgLoyalty=s===0?0:(s/o).toFixed(2);d.avgRecommend=l===0?0:(l/c).toFixed(2);f()}function g(e){s.allData=e;var t=0;var a=0;var i=0;var r=0;var n=0;angular.forEach(e,function(e){a++;s.totalData.countEvaluate+=e.countEvaluate;s.totalData.suggestionCount+=e.suggestionCount?e.suggestionCount:0;t+=parseFloat(e.countTicket);e.evaluateRate=(e.countTicket===0?0:e.countEvaluate/e.countTicket*100).toFixed(2)+"%";if(e.avgScore){s.totalData.avgScore+=parseFloat(e.avgScore);i++}else{e.avgScore="-"}if(e.avgLoyalty){s.totalData.avgLoyalty+=parseFloat(e.avgLoyalty);r++}else{e.avgLoyalty="-"}if(e.avgRecommend){s.totalData.avgRecommend+=parseFloat(e.avgRecommend);n++}else{e.avgRecommend="-"}});s.totalData.avgScore=s.totalData.avgScore===0?0:(s.totalData.avgScore/i).toFixed(2);s.totalData.avgLoyalty=s.totalData.avgLoyalty===0?0:(s.totalData.avgLoyalty/r).toFixed(2);s.totalData.avgRecommend=s.totalData.avgRecommend===0?0:(s.totalData.avgRecommend/n).toFixed(2);s.totalData.evaluateRate=(t===0?0:s.totalData.countEvaluate/t*100).toFixed(2)+"%";m()}r.register(n,r.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){h()});s.$on("$destroy",function(){r.unRegister(n)});s.$on("statistics.datarange.changed",function(e,t){h()});var D=function(){p();c()};D()}})(org.ewei);(function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsCustomerEvaluateDetailController",e);e.$inject=["$rootScope","$scope","$timeout","$stateParams","StatisticsBreadcrumbService","searchService","coreModelService"];function e(e,t,a,i,r,n,s){t.params=i.params;t.queryName="客户统计-满意度-"+t.params.title;r.push({url:"statistics.customer.evaluate",name:"满意度"});r.push({name:t.params.title});t.$on("$destroy",function(){r.pop(2)});var o=function(){var e=JSON.parse(n.searchData.filter);e["$and"][0]["$and"].push({$eq:{"requester.id":t.params.id}});t.queryParams={startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:JSON.stringify(e),customFieldFilter:n.searchData.customFieldFilter,filterDescription:n.searchData.filterDescription,types:n.searchData.types};if(s.detail.statistics.columns.customer.evaluate.length>0){t.defaultColumns=s.detail.statistics.columns.customer.evaluate}else{t.defaultColumns=s.detail.statistics.columns.customer.evaluate=["subject","evaluate.solved","evaluate.score","evaluate.suggestion","evaluate.system"]}};o()}})();+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsChatRootController",e);e.$inject=["$rootScope","$scope","$state","StatisticsBreadcrumbService","coreModelService","permissions"];function e(e,t,a,i,r,n){t.breadcrumbs=i.items;t.goto=i.goto;var s=r.config.route.get("statistics-chat");if(s){if(s.permission){if(n.hasPermission(s.permission)){return a.go(s.name,s.params)}else{return a.go("unauthorized")}}else{return a.go(s.name,s.params)}}else{a.go("statistics.chat.quantity")}}}();+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsChatQuantityController",t);t.$inject=["$rootScope","$scope","$state","coreModelService","StatisticsBreadcrumbService","searchService","coreNotifyService"];function t(e,p,t,a,i,r,n){var s=this.__proto__.constructor.name+"_"+Date.now();p.questionTip=["请求数量=所选时间范围内，发起会话数量","漏接数量=所选时间范围内，发起会话并且未被接通的会话数量","接通数量=所选时间范围内，发起会话并且被接通的会话数量","响应数量=所选时间范围内，发起会话并且接通后有客服进行回复的会话数量","自动邀请=所选时间范围内，接受网站自动邀请而发起的会话数量","关联工单=所选时间范围内，有关联工单的会话数量","远程协助数=所选时间范围内，会话中成功进行远程协助的次数","抽检数量 = 所选时间范围内，被质检的会话数量"];var o=function(){var e="chat.quantity";p.searchData={showDataSource:["chat.open","chat.closed"],reportType:e,views:[]};r.loadSearchDataView(e,p.searchData.views,function(){c()})};var l=function(){r.searchData.startDate=p.$parent.dateRange.startDate.format("YYYY-MM-DD");r.searchData.endDate=p.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:r.searchData.startDate,endDate:r.searchData.endDate,filter:r.searchData.filter,types:r.searchData.types};return e};p.columns=[{title:"日期",visible:true,sortable:true,field:"day",callback:true,callbackFunction:function(e){t.go("statistics.chat.quantityDetail",{params:{date:e.day}})}},{title:"请求数量",visible:true,sortable:true,field:"requestCount"},{title:"漏接数量",visible:true,sortable:true,field:"cancelCount"},{title:"接通数量",visible:true,sortable:true,field:"responseCount"},{title:"响应数量",visible:true,sortable:true,field:"realResponseCount"},{title:"自动邀请",visible:true,sortable:true,field:"autoInviteCount"},{title:"关联工单",visible:true,sortable:true,field:"ticketCount"},{title:"远程协助次数",visible:true,sortable:true,field:"remoteCount"},{title:"抽检数量",visible:true,sortable:true,field:"qualityCount"}];var c=function(){org.ewei.sdk.OpenChatReportApi().chatCountReport(l()).then({success:function(e){var t=p.$parent.dateRange.startDate.clone();while(t<=p.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.day==a})){e.push({day:a,requestCount:0,cancelCount:0,realResponseCount:0,responseCount:0,autoInviteCount:0,ticketCount:0,remoteCount:0,qualityCount:0})}t.add(1,"day")}e=_.sortBy(e,function(e){return e.day});p.quantity=e;p.loadComplete=true;var i={titleText:"会话数量-日走势",legendData:["请求","漏接","接通","响应","自动邀请","关联工单","远程协助","抽检"],xAxisData:[],yAxis:{name:"数量"}};var r=[{name:"请求",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"漏接",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"接通",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"响应",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"自动邀请",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"关联工单",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"远程协助",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"抽检",type:"line",symbol:"circle",symbolSize:10,data:[]}];var n=0,s=0,o=0,l=0,c=0,u=0,d=0,f=0;angular.forEach(p.quantity,function(e){i.xAxisData.push(e.day);n+=e.requestCount||0;s+=e.cancelCount||0;o+=e.realResponseCount||0;l+=e.responseCount||0;c+=e.autoInviteCount||0;u+=e.ticketCount||0;d+=e.remoteCount||0;f+=e.qualityCount||0;r[0].data.push(e.requestCount||0);r[1].data.push(e.cancelCount||0);r[2].data.push(e.responseCount||0);r[3].data.push(e.realResponseCount||0);r[4].data.push(e.autoInviteCount||0);r[5].data.push(e.ticketCount||0);r[6].data.push(e.remoteCount||0);r[7].data.push(e.qualityCount||0)});p.totalData={day:"合计",requestCount:n,cancelCount:s,realResponseCount:o,responseCount:l,autoInviteCount:c,ticketCount:u,remoteCount:d,qualityCount:f};i.series=r;p.option=i;m()}})};function m(){var t=[],a=[],e="会话统计-数量统计";p.quantity.forEach(function(e){t.push([e.day,e.requestCount,e.cancelCount,e.responseCount,e.realResponseCount,e.autoInviteCount,e.ticketCount,e.remoteCount,e.qualityCount])});p.totalData&&t.unshift([p.totalData.day,p.totalData.requestCount,p.totalData.cancelCount,p.totalData.responseCount,p.totalData.realResponseCount,p.totalData.autoInviteCount,p.totalData.ticketCount,p.totalData.remoteCount,p.totalData.qualityCount]);p.columns.forEach(function(e){a.push(e.title)});p.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}function u(){o()}u();n.register(s,n.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){c()});p.$on("statistics.datarange.changed",function(e,t){c()});p.$on("$destroy",function(){n.unRegister(s)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsChatQuantityDetailController",e);e.$inject=["$rootScope","$scope","$state","$stateParams","searchService","StatisticsBreadcrumbService","utils","WebChatListManager"];function e(e,i,t,a,r,n,s,o){i.params=a.params;n.push({url:"statistics.chat.quantity",name:"数量统计"});n.push({name:i.params.date});var l=function(){var e={startDate:r.searchData.startDate,endDate:r.searchData.endDate,channelId:i.params.id,channel:i.params.channel,filter:r.searchData.filter,types:r.searchData.types,page:{pageNumber:1,pageSize:999999},createDate:i.params.date};return e};i.columns=[{title:"ID",visible:true,sortable:true,field:"id"},{title:"主题",visible:true,sortable:true,field:"subject",callbackFunction:function(e){if(e.status!=="overflow"&&e.status!=="canceled"){t.go("webchat-history.detail",{id:e.id,key:"chatQuantityDetail"+i.params.date})}},hideLink:function(e){return e.status==="overflow"||e.status==="canceled"}},{title:"客户",visible:true,sortable:true,field:"userName"},{title:"客服",visible:true,sortable:true,field:"engineerName"},{title:"开始时间",visible:true,sortable:true,field:"createdAt"},{title:"结束时间",visible:true,sortable:true,field:"closedAt"}];i.$on("statistics.datarange.changed",function(e,t){c()});var c=function(){org.ewei.sdk.OpenChatReportApi().listChatByDate(l()).then({success:function(e){void 0;if(e.list){i.quantity=e.list||[];var t=[];angular.forEach(i.quantity,function(e){if(e.status!=="overflow"&&e.status!=="canceled"){t.push(e.id)}});o.setHistoryChatList("chatQuantityDetail"+i.params.date,t,l(),e.recordCount);u()}}})};c();function u(){var t=[],a=[],e="会话统计-数量统计-"+i.params.date;i.quantity.forEach(function(e){t.push([e.id,e.subject,e.userName,e.engineerName,e.createdAt,e.closedAt])});i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}i.$on("$destroy",function(){n.pop(2)})}}();+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsChatQualityController",t);t.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService","WebChatListManager"];function t(e,w,t,S,n,i,a,E){var r=this.__proto__.constructor.name+"_"+Date.now();w.questionTip=["排队时长 = 所选时间范围内，会话创建至接通的时长，“统计”值为所有排队时长的平均值","响应时长 = 所选时间范围内，会话接通至客服第一条公开回复的时长，“统计”值为所有响应时长的平均值","会话时长 = 所选时间范围内，会话接通至结束的时长，“统计”值为所有会话时长的平均值","是否自动结束 = 所选时间范围内，会话结束方式，“统计”值为系统结束会话/已结束会话数量比值*100%","评价否 = 所选时间范围内，会话是否被评价，“统计”值为参评率即已评价的会话数量/已结束的会话数量比值*100%","满意度 = 所选时间范围内，已评价会话的评价分值，“统计”值为已评价会话的评价分的平均值","解决否 = 所选时间范围内，已评价会话的解决状态，“统计”值为解决率即评价为“已解决”的会话数量/已评价会话数量比值*100%","一次解决 =  所选时间范围内，已评价会话的一次解决状态，“统计”值为一次性解决率即评价为“已解决”的且未转接的会话数量/已评价会话数量比值*100%","质检否 = 所选时间范围内，会话的质检状态，“统计”值为已质检会话数量/已结束会话数量比值*100%","质检分 = 所选时间范围内，已质检会话的质检分值，“统计”值为已质检会话的质检分平均值"];var s=function(){var e="chat.quality";w.searchData={showDataSource:["chat.open","chat.closed"],reportType:e,views:[]};i.loadSearchDataView(e,w.searchData.views,function(){o();l();c()})};var A=function(){i.searchData.startDate=w.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=w.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,types:i.searchData.types};return e};function x(e,t,a){var i={title:{text:e,x:"center",y:"center",show:true},color:t,series:[{type:"pie",radius:["80%","100%"],hoverAnimation:false,avoidLabelOverlap:false,label:{normal:{show:false,position:"center"}},data:[{value:e},{value:a?5-e:100-e}]}]};return i}w.columns=[{title:"会话",visible:true,sortable:true,class:"text-left",field:"first_message",callback:true,callbackFunction:function(e){if(e.status!=="overflow"&&e.status!=="canceled"){t.go("webchat-history.detail",{id:e.id,key:"chatQuality"})}},hideLink:function(e){return e.status==="overflow"||e.status==="canceled"}},{title:"排队时长",visible:true,sortable:true,sortType:"number",field:"queueTime"},{title:"响应时长",visible:true,sortable:true,sortType:"number",field:"responseTime"},{title:"会话时长",visible:true,sortable:true,sortType:"number",field:"processTime"},{title:"自动结束",visible:true,sortable:true,field:"isAutoClose"},{title:"评价否",visible:true,sortable:true,field:"evaluate"},{title:"满意度",visible:true,sortable:true,field:"score"},{title:"解决否",visible:true,sortable:true,field:"solved"},{title:"一次解决",visible:true,sortable:true,field:"once_solved"},{title:"质检否",visible:true,sortable:true,field:"qualityInspected"},{title:"质检分",visible:true,sortable:true,field:"quality_score"}];w.showWhichOne={circular:true};w.checked=function(e){w.showWhichOne.circular=false;w.showWhichOne.response=false;w.showWhichOne.solved=false;w.showWhichOne[e]=true};var o=function(){org.ewei.sdk.OpenReportApi().countChatQuality(A()).then({success:function(e){void 0;var t=0,a=0,i=0,r=0,n=0,s=0,o=0,l=0,c=0,u=0,d=0;var f=e.length;w.quality=e;w.loadComplete=true;var p=[];if(e.length){angular.forEach(e,function(e){if(e.status!=="overflow"&&e.status!=="canceled"){p.push(e.id)}if(e.evaluate_id){e.evaluate="已评价";e.score=parseFloat(e.score);n+=e.score;s++;r+=1}else{e.evaluate="未评价";e.score="-"}if(e.once_solved&&(e.status==="solved"||e.status==="closed")&&e.evaluate_id&&e.solved){l+=1;e.once_solved="是"}else if(e.once_solved===false||e.solved===false){e.once_solved="否"}else{e.once_solved="-"}if(e.solved){o+=1;e.solved="已解决"}else if(e.solved===false){e.solved="未解决"}else{e.solved="-"}if(e.quality_inspected){d++;u+=e.quality_score||0;e.qualityInspected="已质检"}else{e.qualityInspected="未质检"}if(e.autoClose){c++;e.isAutoClose="是"}else{e.isAutoClose="否"}if(Number(e.queue_seconds)||Number(e.queue_seconds)===0){t+=Number(e.queue_seconds<0?-e.queue_seconds:e.queue_seconds);e.queueTime=S("chartTimeFormat")(e.queue_seconds<0?-e.queue_seconds:e.queue_seconds)}else{e.queueTime="-"}if(Number(e.response_seconds)||Number(e.response_seconds)===0){a+=Number(e.response_seconds<0?-e.response_seconds:e.response_seconds);e.responseTime=S("chartTimeFormat")(e.response_seconds<0?-e.response_seconds:e.response_seconds)}else{e.responseTime="-"}if(Number(e.chat_seconds)||Number(e.chat_seconds)===0){i+=Number(e.chat_seconds<0?-e.chat_seconds:e.chat_seconds);e.processTime=S("chartTimeFormat")(e.chat_seconds<0?-e.chat_seconds:e.chat_seconds)}else{e.processTime="-"}});var m=S("chartTimeFormat")(parseInt(t/f));var h=S("chartTimeFormat")(parseInt(a/f));var v=S("chartTimeFormat")(parseInt(i/f));var g=(r/f*100).toFixed(2);var D=s?(n/s).toFixed(2):0;var y=r?(o/r*100).toFixed(2):0;var b=r?(l/r*100).toFixed(2):0;var C=f?(c/f*100).toFixed(2):0;var T=f?(d/f*100).toFixed(2):0;var k=d?(u/d).toFixed(2):0;w.totalData={first_message:"统计",queueTime:m,responseTime:h,processTime:v,evaluate:g+"%",score:D,solved:y+"%",once_solved:b+"%",isAutoClose:C+"%",qualityInspected:T+"%",quality_score:k};w.chatQuality=[{title:"满意度",chartCircularOption:x(D,["#4B253A","#D3B6C6"],true)},{title:"参评率",chartCircularOption:x(g,["#EFB917","#FCE6A4"])},{title:"解决率",chartCircularOption:x(y,["#45AEEA","#BEE3F7"])},{title:"一次解决率",chartCircularOption:x(b,["#D2D558","#F8F9B6"])},{title:"抽检率",chartCircularOption:x(T,["#73365b","#cc64a3"])}]}else{w.totalData=null;w.chatQuality=[{title:"满意度",chartCircularOption:x(0,["#4B253A","#D3B6C6"],true)},{title:"参评率",chartCircularOption:x(0,["#EFB917","#FCE6A4"])},{title:"解决率",chartCircularOption:x(0,["#45AEEA","#BEE3F7"])},{title:"一次解决率",chartCircularOption:x(0,["#D2D558","#F8F9B6"])},{title:"抽检率",chartCircularOption:x(0,["#73365b","#cc64a3"])}]}E.setHistoryChatList("chatQuality",p,A(),e.recordCount);$()}})};var l=function(){var i={};i.lineColor=[e.mainColor];i.titleText="";i.legendData=["数量"];i.xAxis={name:"会话数量",data:[]};i.yAxis={name:"会话数量"};i.series=[{name:"数量",data:[]}];var r=["<15s","15s-30s","30s-45s","45s-1m",">1m"];org.ewei.sdk.OpenReportApi().countChatResponseDistribution(A()).then({success:function(t){var a=0;_.keys(t).forEach(function(e){a+=t[e]});for(var e=0;e<r.length;e++){if(t[r[e]]||t[r[e]]===0){i.xAxis.data.push(r[e]);i.series[0].data.push({value:t[r[e]],percent:n.getPercentValue(t[r[e]]/a||0)})}}w.responseOption=angular.copy(i)}})};var c=function(){var a={};a.lineColor=[e.mainColor];a.titleText="";a.legendData=["数量"];a.xAxis={name:"会话数量",data:[]};a.yAxis={name:"会话数量"};a.series=[{name:"数量",data:[]}];var i=["<5m","5m-10m","10m-30m","30m-1h",">1h"];org.ewei.sdk.OpenReportApi().countChatSlaSolvedDistribution(A()).then({success:function(e){for(var t=0;t<i.length;t++){if(e[i[t]]||e[i[t]]===0){a.xAxis.data.push(i[t]);a.series[0].data.push(e[i[t]])}}w.solvedOption=angular.copy(a)}})};function $(){var t=[],a=[],e="会话统计-质量统计";w.quality.forEach(function(e){t.push([e.first_message,e.queueTime,e.responseTime,e.processTime,e.isAutoClose,e.evaluate,e.score,e.solved,e.once_solved,e.qualityInspected,e.quality_score])});w.totalData&&t.unshift([w.totalData.first_message,w.totalData.queueTime,w.totalData.responseTime,w.totalData.processTime,w.totalData.isAutoClose,w.totalData.evaluate,w.totalData.score,w.totalData.solved,w.totalData.once_solved,w.totalData.qualityInspected,w.totalData.quality_score]);w.columns.forEach(function(e){a.push(e.title)});w.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var u=function(){s()};u();a.register(r,a.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){o();l();c()});w.$on("statistics.datarange.changed",function(e,t){o();l();c()});w.$on("$destroy",function(){a.unRegister(r)})}}(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsChatChannelController",t);t.$inject=["$rootScope","$scope","$timeout","$filter","$state","searchService","coreNotifyService"];function t(e,n,t,s,a,i,r){var o=this.__proto__.constructor.name+"_"+Date.now();n.questionTip=["请求数量：渠道新增的会话数量","渠道占比=某个渠道的请求数量÷所有渠道请求数量总和×100%","请求人数：通过该渠道发起请求的人数","渠道复用率=请求数量÷请求人数"];var l=function(){var e="chat.channel";n.searchData={showDataSource:["chat.open","chat.closed"],reportType:e,views:[]};i.loadSearchDataView(e,n.searchData.views,function(){u();d();f()})};var c=function(){i.searchData.startDate=n.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=n.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,types:i.searchData.types};return e};n.showWhichOne={circular:true};n.checked=function(e){n.showWhichOne.circular=false;n.showWhichOne.lineGraphStack=false;n.showWhichOne.mapChina=false;n.showWhichOne[e]=true};n.columns=[{title:"渠道",visible:true,sortable:true,class:"text-left",field:"channel_name",callback:true,callbackFunction:function(e){a.go("statistics.chat.channelDetail",{params:{channel_name:e.channel_name,id:e.channel_id,channel:e.channel,channel_uid:e.channel_uid}})}},{title:"请求数量",visible:true,sortable:true,field:"countChat"},{title:"占比",visible:true,sortable:true,sortType:"number",field:"scale"},{title:"请求人数",visible:true,sortable:true,field:"countUser"},{title:"渠道复用率",visible:true,sortable:true,sortType:"number",field:"viaRepetitionRate"},{title:"启/停",visible:true,sortable:true,field:"activeName"},{title:"渠道创建时间",visible:true,sortable:true,field:"created_at"}];var u=function(){org.ewei.sdk.OpenReportApi().countChatVia(c()).then({success:function(e){n.loadComplete=true;if(e.length){n.quantity=e;var t=[],a=[],i=0,r=0;angular.forEach(e,function(e){t.push(e.channel_name);a.push({value:e.countChat,name:e.channel_name});e.created_at=s("date")(e.created_at,"yyyy-MM-dd HH:mm:ss");if(e.enable===0){e.activeName="停用"}else{e.activeName="启用"}i+=e.countChat;r+=e.countUser});angular.forEach(e,function(e){e.scale=(e.countChat/i*100).toFixed(2)+"%"});n.totalData={channel_name:"全部",countChat:i,scale:"100%",countUser:r,viaRepetitionRate:(i/r).toFixed(2),activeName:"-",created_at:"-"};n.chartCircularOption={tooltip:{formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",x:"right",y:"bottom",data:t},series:[{name:"访问来源",type:"pie",radius:["50%","70%"],data:a}]}}else{n.totalData=null;n.quantity=[];n.chartCircularOption={tooltip:{formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"访问来源",type:"pie",radius:["50%","70%"],data:[{value:0,name:"无数据"}]}]}}p()}})};var d=function(){org.ewei.sdk.OpenReportApi().countChatRequestTimeDistribution(c()).then({success:function(e){var t=s("requestTimeDistribution")(e);var a=[],i=[];angular.forEach(t,function(e){a.push(e.name+"时");i.push(e.value)});n.chartLineGraphStackOption={xAxis:{data:a},yAxis:{name:"会话数量"},series:[{name:"会话数量",type:"line",symbol:"circle",symbolSize:10,data:i}]}}})};var f=function(){org.ewei.sdk.OpenReportApi().countChatRequestLocationDistribution(c()).then({success:function(e){var t=_.max(e,function(e){return e.value}).value;n.chartMapChinaOption={visualMap:{max:t||0},series:[{name:"会话数量",data:e}]}}})};function p(){var t=[],a=[],e="会话统计-渠道来源";n.quantity.forEach(function(e){t.push([e.channel_name,e.countChat,e.scale,e.countUser,e.viaRepetitionRate,e.activeName,e.created_at])});n.totalData&&t.unshift([n.totalData.channel_name,n.totalData.countChat,n.totalData.scale,n.totalData.countUser,n.totalData.viaRepetitionRate,n.totalData.activeName,n.totalData.created_at]);n.columns.forEach(function(e){a.push(e.title)});n.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var m=function(){l()};m();r.register(o,r.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){u();d();f()});n.$on("statistics.datarange.changed",function(e,t){u();d();f()});n.$on("$destroy",function(){r.unRegister(o)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsChatChannelDetailController",e);e.$inject=["$rootScope","$scope","$state","$stateParams","coreModelService","StatisticsBreadcrumbService","searchService","coreNotifyService","utils","$filter","WebChatListManager"];function e(e,r,t,i,a,n,s,o,l,c,u){r.params=i.params;n.push({url:"statistics.chat.channel",name:"渠道统计"});n.push({name:r.params.channel_name});r.showWhichOne={day:true};var d=function(e,t){var a=[],i=[];angular.forEach(e,function(e){if(t==="time"){a.push(e.name+"时")}else{a.push(e.name)}i.push(e.value)});r.chartLineGraphStackOption={xAxis:{data:a},yAxis:{name:"会话数量"},series:[{name:"会话数量",type:"line",symbol:"circle",symbolSize:10,data:i}]}};var f=function(){var e={startDate:s.searchData.startDate,endDate:s.searchData.endDate,channelId:r.params.id,channel:r.params.channel,filter:s.searchData.filter,types:s.searchData.types,via:{channelId:r.params.id,channel:r.params.channel,channelUid:r.params.channel_uid}};return e};var p=function(){org.ewei.sdk.OpenReportApi().countChatRequestTimeDistribution(f()).then({success:function(e){var t=c("requestTimeDistribution")(e);if(t.length){d(t,"time")}}})};var m=function(){org.ewei.sdk.OpenReportApi().countChatRequestDayDistribution(f()).then({success:function(e){var t=r.$parent.dateRange.startDate.clone();while(t<=r.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.name==a})){e.push({name:a,value:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.name});if(e.length){d(e)}}})};var h=function(){org.ewei.sdk.OpenReportApi().countChatRequestLocationDistribution(f()).then({success:function(e){var t=_.max(e,function(e){return e.value}).value;r.chartMapChinaOption={visualMap:{max:t||0},series:[{name:"会话数量",data:e}]}}})};r.columns=[{title:"ID",visible:true,sortable:true,field:"id"},{title:"会话",visible:true,sortable:true,field:"firstMessage",callback:true,callbackFunction:function(e){if(e.status!=="overflow"&&e.status!=="canceled"){t.go("webchat-history.detail",{id:e.id,key:"chatChannel"+i.params.channel+i.params.id})}},hideLink:function(e){return e.status==="overflow"||e.status==="canceled"}},{title:"客户",visible:true,sortable:true,field:"user.name"},{title:"客服",visible:true,sortable:true,field:"engineer.user.name"},{title:"开始时间",visible:true,sortable:true,field:"createdAt"},{title:"结束时间",visible:true,sortable:true,field:"closedAt"}];var v=function(){var a=f();a.page={pageSize:9999999,pageNumber:1};org.ewei.sdk.OpenReportApi().listChats(a).then({success:function(e){if(e.list&&e.list.length){r.chatDetail=e.list;var t=[];angular.forEach(r.chatDetail,function(e){if(e.status!=="overflow"&&e.status!=="canceled"){t.push(e.id)}});u.setHistoryChatList("chatChannel"+i.params.channel+i.params.id,t,a,e.recordCount);g()}}})};function g(){var e=JSON.parse(s.searchData.filter);e["$and"][0]["$and"].push({$eq:{"via.channelId":r.params.id}});e["$and"][0]["$and"].push({$eq:{"via.channel":r.params.channel}});var t="会话统计-渠道统计-"+r.params.channel_name;var a=[];r.columns.forEach(function(e){a.push({title:e.title,field:e.field})});r.exportData={startDate:s.searchData.startDate,endDate:s.searchData.endDate,columns:a,filter:e,reportName:t,filterDescription:s.searchData.filterDescription,types:s.searchData.types}}var D=function(){p();m();h();v()};D();r.$on("statistics.datarange.changed",function(e,t){D()});r.checked=function(e){if(e==="day"){m()}else if(e==="time"){p()}r.showWhichOne.day=false;r.showWhichOne.time=false;r.showWhichOne[e]=true};r.$on("$destroy",function(){n.pop(2)})}}();+function(e){"use strict";angular.module("eweiApp.statistics").controller("StatisticsChatServiceCatalogController",t);t.$inject=["$filter","$rootScope","$scope","$state","coreModelService","StatisticsServiceCatalogService","utils","searchService","coreNotifyService","WebChatListManager"];function t(r,t,l,a,e,n,c,i,s,o){l.selectedServiceCatalog=null;l.tableData=[];var u=function(){var e="chat.service_catalog";l.searchData={showDataSource:["chat.open","chat.closed"],reportType:e,views:[]};i.loadSearchDataView(e,l.searchData.views,function(){v()})};var d=function(){var e={};e.lineColor=[t.mainColor];e.titleText="";e.legendData=["数量"];e.xAxis={name:"服务目录",data:[]};e.yAxis={name:"工单数量"};e.series=[{name:"数量",data:[]}];return e};var f=function(){if(l.allServiceCatalog&&l.allServiceCatalogData){if(l.selectedServiceCatalog===null){var e=JSON.parse(JSON.stringify(l.allServiceCatalog));e.unshift({name:"无服务目录",id:-1});b(e,l.allServiceCatalogData,null)}else{var t=JSON.parse(JSON.stringify(l.selectedServiceCatalog.children));b(t,l.allServiceCatalogData,l.selectedServiceCatalog.id)}}};var p=function(){l.columns=[{title:"主题",visible:true,sortable:true,class:"text-left",field:"subject",callbackFunction:function(e){if(e.status!=="overflow"&&e.status!=="canceled"){a.go("webchat-history.detail",{id:e.id,key:"chatServiceCatalog"})}},hideLink:function(e){return e.status==="overflow"||e.status==="canceled"}},{title:"处理人",visible:true,sortable:true,class:"text-left",field:"engineerName",total:0},{title:"客服组",visible:true,sortable:true,class:"text-left",field:"serviceDeskName",total:0},{title:"客户",visible:true,sortable:true,class:"text-left",field:"userName",total:0},{title:"客户组",visible:true,sortable:true,class:"text-left",field:"userGroupName",total:0},{title:"开始时间",visible:true,sortable:true,field:"createdAt",total:0},{title:"结束时间",visible:true,sortable:true,field:"closedAt",total:0},{title:"服务目录",visible:true,sortable:true,class:"text-left",field:"catalog",total:0}]};var m=function(){i.searchData.startDate=l.$parent.dateRange.startDate.format("YYYY-MM-DD");i.searchData.endDate=l.$parent.dateRange.endDate.format("YYYY-MM-DD");var e={startDate:i.searchData.startDate,endDate:i.searchData.endDate,filter:i.searchData.filter,types:i.searchData.types,page:{pageSize:9999999,pageNumber:1}};return e};function h(){var t=[],a=[],e="会话统计-服务目录";l.tableData.forEach(function(e){t.push([e.subject,e.engineerName,e.serviceDeskName,e.userName,e.userGroupName,e.createdAt,e.closedAt,e.catalog])});l.columns.forEach(function(e){a.push(e.title)});l.exportData={startDate:i.searchData.startDate,endDate:i.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:i.searchData.filterDescription,types:i.searchData.types}}var v=function(){y();D()};var g=function(e){if(!e.children||e.children&&e.children.length===0){return[e.id]}else{var t=e.id;for(var a=0;a<e.children.length;a++){t+=","+g(e.children[a])}return t.split(",")}};var D=function(){var e=m();var a=JSON.parse(JSON.stringify(e));var t=JSON.parse(a.filter);if(l.selectedServiceCatalog){var i=g(l.selectedServiceCatalog);t.$and[0].$and.push({$in:{"serviceCatalog.id":i}});a.filter=JSON.stringify(t)}n.getChatListData(a).then(function(e){l.tableData=e?e.list||[]:[];l.loadComplete=true;var t=[];angular.forEach(l.tableData,function(e){e.catalog=e.serviceCatalogNameList?e.serviceCatalogNameList.join("->"):"-";if(e.serviceDeskName==="DEFAULT_SERVICE_DESK_NAME"){e.serviceDeskName=r("translate")("DEFAULT_SERVICE_DESK_NAME")}if(e.status!=="overflow"&&e.status!=="canceled"){t.push(e.id)}});o.setHistoryChatList("chatServiceCatalog",t,a,e.recordCount);h()})};var y=function(){var e=m();n.getChatChartData(e).then(function(e){l.allServiceCatalogData=e;f()})};var b=function(e,t,a){var i=d();i.xAxis.data=[];i.series[0].data=[];var r=0;if(a===null||a!==null&&t[a]){var n=0;if(a===null){for(var s in e){for(var o in t){if(e[s].id==o){r+=t[o];break}}}}else{r=t[a]||0}for(var s in e){for(var o in t){if(e[s].id==o){i.xAxis.data.push(e[s].name);i.series[0].data.push({value:t[o],percent:c.getPercentValue(t[o]/r)});n+=t[o];break}}}if(a!==null){i.xAxis.data.unshift("-");i.series[0].data.unshift({value:r-n,percent:c.getPercentValue((r-n)/r)})}}l.total=r;l.options=i};var C=function(){p();u()};var T=this.__proto__.constructor.name+"_"+Date.now();s.register(T,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){v()});C();l.$on("statistics.datarange.changed",function(){v()});l.$watch("selectedServiceCatalog",function(e,t){if(e!==t){D();f()}});l.$watch("allServiceCatalog",function(e,t){if(e!==t){f()}});l.$on("$destroy",function(){s.unRegister(T)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics").directive("chartCircular",["$window",function(n){return{restrict:"AE",scope:{chartOption:"="},link:function(i,e,t){var r=echarts.getInstanceByDom(e[0])||echarts.init(e[0]);r.showLoading();var a=i.$watch("chartOption",function(e){if(e){var t={series:[]};r.hideLoading();var a=angular.merge(t,i.chartOption);r.setOption(a)}},true);i.$on("$destroy",function(){a();angular.element(n).off("resize",r.resize);if(r){r.dispose()}})}}}]).directive("chartLineGraphStack",["$rootScope","$window",function(n,s){return{restrict:"AE",scope:{chartOption:"="},link:function(i,e,t){var r=echarts.getInstanceByDom(e[0])||echarts.init(e[0]);r.showLoading();var a=i.$watch("chartOption",function(e){if(e){var t={tooltip:{trigger:"axis"},color:[n.mainColor],xAxis:{type:"category",axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},boundaryGap:false,data:[]},yAxis:{minInterval:1,type:"value",axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50},dataZoom:[{show:true,realtime:true,start:0,end:100},{type:"inside",realtime:true,start:0,end:100}],series:[]};r.hideLoading();var a=angular.merge(t,i.chartOption);r.setOption(a)}},true);i.$on("$destroy",function(){a();angular.element(s).off("resize",r.resize);if(r){r.dispose()}})}}}]).directive("chartMapChina",["$window",function(n){return{restrict:"AE",scope:{chartOption:"="},link:function(i,e,t){var r=echarts.getInstanceByDom(e[0])||echarts.init(e[0]);r.showLoading();var a=i.$watch("chartOption",function(e){if(e){var t={tooltip:{trigger:"item"},visualMap:{min:0,left:"left",top:"bottom",text:["高","低"],calculable:true},series:[{type:"map",mapType:"china",roam:false,zoom:"1.25",label:{normal:{show:true},emphasis:{show:true}},data:[]}]};r.hideLoading();var a=angular.merge(t,i.chartOption);r.setOption(a)}},true);i.$on("$destroy",function(){a();angular.element(n).off("resize",r.resize);if(r){r.dispose()}})}}}])}();(function(e,t){if(typeof define==="function"&&define.amd){define(["exports","echarts"],t)}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){t(exports,require("echarts"))}else{t({},e.echarts)}})(this,function(e,t){var a=function(e){if(typeof console!=="undefined"){console&&console.error&&void 0}};if(!t){a("ECharts is not Loaded");return}if(!t.registerMap){a("ECharts Map is not loaded");return}t.registerMap("china",{type:"FeatureCollection",features:[{id:"710000",geometry:{type:"MultiPolygon",coordinates:[["@@°Ü¯Û","@@ƛĴÕƊÉɼģºðʀ\\ƎsÆNŌÔĚänÜƤɊĂǀĆĴĤǊŨxĚĮǂƺòƌâÔ®ĮXŦţƸZûÐƕƑGđ¨ĭMó·ęcëƝɉlÝƯֹÅŃ^Ó·śŃǋƏďíåɛGɉ¿IċããF¥ĘWǬÏĶñÄ","@@\\p|WoYG¿¥Ij@","@@¡@V^RqBbAnTXeQr©C","@@ÆEEkWqë I"]],encodeOffsets:[[[122886,24033],[123335,22980],[122375,24193],[122518,24117],[124427,22618]]]},properties:{cp:[121.509062,25.044332],name:"台湾",childNum:5}},{id:"130000",geometry:{type:"MultiPolygon",coordinates:[["@@\\aM`Ç½ÓnUKĜēs¤­©yrý§uģcJ»eIP]ªrºc_ħ²G¼s`jÎŸnüsÂľP","@@U`Ts¿mÄ","@@FOhđ©OiÃ`ww^ÌkÑH«ƇǤŗĺtFu{Z}Ö@U´ʚLg®¯Oı°Ãw ^VbÉsmAê]]w§RRl£ŭuwNÁ`ÇFēÝčȻuT¡Ĺ¯Õ¯sŗő£YªhVƍ£ƅnëYNgq¼ś¿µı²UºÝUąąŖóxV@tƯJ]eR¾fe|rHA|h~Ėƍl§ÏjVë` ØoÅbbx³^zÃĶ¶Sj®AyÂhðk`«PËµEFÛ¬Y¨Ļrõqi¼Wi°§Ð±²°`[À|ĠO@ÆxO\\ta\\p_Zõ^û{ġȧXýĪÓjùÎRb^Î»j{íděYfíÙTymńŵōHim½éŅ­aVcř§ax¹XŻácWU£ôãºQ¨÷Ñws¥qEHÙ|šYQoŕÇyáĂ£MÃ°oťÊP¡mWO¡v{ôvîēÜISpÌhp¨ jdeŔQÖjX³àĈ[n`Yp@UcM`RKhEbpŞlNut®EtqnsÁgAiúoHqCXhfgu~ÏWP½¢G^}¯ÅīGCÑ^ãziMáļMTÃƘrMc|O_¯Ŏ´|morDkO\\mĆJfl@cĢ¬¢aĦtRıÒXòë¬WP{ŵǫƝīÛ÷ąV×qƥV¿aȉd³BqPBmaËđŻģmÅ®V¹d^KKonYg¯XhqaLdu¥Ípǅ¡KąÅkĝęěhq}HyÃ]¹ǧ£Í÷¿qágPmoei¤o^á¾ZEY^Ný{nOl±Í@Mċèk§daNaÇį¿]øRiiñEūiǱàUtėGyl}ÓM}jpEC~¡FtoQiHkk{ILgĽxqÈƋÄdeVDJj£J|ÅdzÂFt~KŨ¸IÆv|¢r}èonb}`RÎÄn°ÒdÞ²^®lnÐèĄlðÓ×]ªÆ}LiĂ±Ö`^°Ç¶p®đDcŋ`ZÔ¶êqvFÆN®ĆTH®¦O¾IbÐã´BĐɢŴÆíȦpĐÞXR·nndO¤OÀĈƒ­QgµFo|gȒęSWb©osx|hYhgŃfmÖĩnºTÌSp¢dYĤ¶UĈjlǐpäðëx³kÛfw²Xjz~ÂqbTÑěŨ@|oMzv¢ZrÃVw¬ŧĖ¸f°ÐTªqs{S¯r æÝl¼ÖĞ ǆiGĘJ¼lr}~K¨ŸƐÌWö¼Þ°nÞoĦL|C~D©|q]SvKÑcwpÏÏĿćènĪWlĄkT}¬Tp~®Hgd˒ĺBVtEÀ¢ôPĎƗè@~kü\\rÊĔÖæW_§¼F´©òDòjYÈrbĞāøŀG{ƀ|¦ðrb|ÀH`pʞkvGpuARhÞÆǶgĘTǼƹS£¨¡ù³ŘÍ]¿ÂyôEP xX¶¹ÜO¡gÚ¡IwÃé¦ÅBÏ|Ç°N«úmH¯âbęU~xĈbȒ{^xÖlD¸dɂ~"]],encodeOffsets:[[[120023,41045],[121616,39981],[122102,42307]]]},properties:{cp:[114.502461,38.045474],name:"河北",childNum:3}},{id:"140000",geometry:{type:"Polygon",coordinates:["@@ħÜ_ªlìwGkÛÃǏokćiµVZģ¡coTSË¹ĪmnÕńehZg{gtwªpXaĚThȑp{¶Eh®RćƑP¿£PmcªaJyý{ýȥoÅîɡųAďä³aÏJ½¥PG­ąSM­sWz½µÛYÓŖgxoOkĒCo­Èµ]¯_²ÕjāK~©ÅØ^ÔkïçămÏk]­±cÝ¯ÑÃmQÍ~_apm~ç¡qu{JÅŧ·Ls}EyÁÆcI{¤IiCfUcƌÃp§]ě«vD@¡SÀµMÅwuYY¡DbÑc¡h×]nkoQdaMç~eDÛtT©±@¥ù@É¡ZcW|WqOJmĩl«ħşvOÓ«IqăV¥D[mI~Ó¢cehiÍ]Ɠ~ĥqX·eƷn±}v[ěďŕ]_œ`¹§ÕōIo©b­s^}Ét±ū«³p£ÿ¥WÑxçÁ«h×u×¥ř¾dÒ{ºvĴÎêÌɊ²¶ü¨|ÞƸµȲLLúÉƎ¤ϊęĔV`_bªS^|dzY|dz¥pZbÆ£¶ÒK}tĦÔņƠPYznÍvX¶Ěn ĠÔzý¦ª÷ÑĸÙUȌ¸dòÜJð´ìúNM¬XZ´¤ŊǸ_tldI{¦ƀðĠȤ¥NehXnYGR° ƬDj¬¸|CĞKqºfƐiĺ©ª~ĆOQª ¤@ìǦɌ²æBÊTĞHƘÁĪËĖĴŞȀÆÿȄlŤĒötÎ½î¼ĨXh|ªM¤ÐzÞĩÒSrao³"],encodeOffsets:[[117016,41452]]},properties:{cp:[112.549248,37.857014],name:"山西",childNum:1}},{id:"150000",geometry:{type:"MultiPolygon",coordinates:[["@@ǪƫÌÛMĂ[`ÕCn}¶Vcês¯PqFB|S³C|kñHdiÄ¥sŉÅPóÑÑE^ÅPpy_YtShQ·aHwsOnŉÃs©iqjUSiº]ïW«gW¡ARëśĳĘů`çõh]y»ǃǛҤxÒm~zf}pf|ÜroÈzrKÈĵSƧż؜Ġu~è¬vîS¼ĂhĖMÈÄw\\fŦ°W ¢¾luŸDw\\Ŗĝ","@@GVu»Aylßí¹ãe]Eāò³C¹ð¾²iÒAdkò^P²CǜңǄ z¼g^èöŰ_Ĳĕê}gÁnUI«m]jvV¼euhwqAaW_µj»çjioQR¹ēÃßt@r³[ÛlćË^ÍÉáGOUÛOB±XkÅ¹£k|e]olkVÍ¼ÕqtaÏõjgÁ£§U^RLËnX°ÇBz^~wfvypV ¯ƫĉ˭ȫƗŷɿÿĿƑ˃ĝÿÃǃßËőó©ǐȍŒĖM×ÍEyxþp]ÉvïèvƀnÂĴÖ@V~Ĉ³MEĸÅĖtējyÄDXÄxGQuv_i¦aBçw˛wD©{tāmQ{EJ§KPśƘƿ¥@sCTÉ}ɃwƇy±gÑ}T[÷kÐç¦«SÒ¥¸ëBX½HáÅµÀğtSÝÂa[ƣ°¯¦Pï¡]£ġÒk®G²èQ°óMq}EóƐÇ\\@áügQÍu¥FTÕ¿Jû]|mvāÎYua^WoÀa·­ząÒot×¶CLƗi¯¤mƎHǊ¤îìɾŊìTdåwsRÖgĒųúÍġäÕ}Q¶¿A[¡{d×uQAMxVvMOmăl«ct[wº_ÇÊjbÂ£ĦS_éQZ_lwgOiýe`YYJq¥IÁǳ£ÙË[ÕªuƏ³ÍTs·bÁĽäė[b[ŗfãcn¥îC¿÷µ[ŏÀQ­ōĉm¿Á^£mJVmL[{Ï_£F¥Ö{ŹA}×Wu©ÅaųĳƳhB{·TQqÙIķËZđ©Yc|M¡LeVUóK_QWk_ĥ¿ãZ»X\\ĴuUèlG®ěłTĠğDŃGÆÍz]±ŭ©Å]ÅÐ}UË¥©TċïxgckfWgi\\ÏĒ¥HkµEë{»ÏetcG±ahUiñiWsɁ·cCÕk]wȑ|ća}wVaĚá G°ùnM¬¯{ÈÐÆA¥ÄêJxÙ¢hP¢ÛºµwWOóFÁz^ÀŗÎú´§¢T¤ǻƺSėǵhÝÅQgvBHouʝl_o¿Ga{ïq{¥|ſĿHĂ÷aĝÇqZñiñC³ª»E`¨åXēÕqÉû[l}ç@čƘóO¿¡FUsAʽīccocÇS}£IS~ălkĩXçmĈŀÐoÐdxÒuL^T{r@¢ÍĝKén£kQyÅõËXŷƏL§~}kq»IHėǅjĝ»ÑÞoå°qTt|r©ÏS¯·eŨĕx«È[eM¿yupN~¹ÏyN£{©għWí»Í¾səšǅ_ÃĀɗ±ąĳĉʍŌŷSÉA±åǥɋ@ë£R©ąP©}ĹªƏj¹erLDĝ·{i«ƫC½ÉshVzGS|úþXgp{ÁX¿ć{ƱȏñZáĔyoÁhA}ŅĆfdŉ_¹Y°ėǩÑ¡H¯¶oMQqð¡Ë|Ñ`ƭŁX½·óÛxğįÅcQs«tȋǅFù^it«Č¯[hAi©á¥ÇĚ×l|¹y¯Kȝqgů{ñǙµïċĹzŚȭ¶¡oŽäÕG\\ÄT¿Òõr¯LguÏYęRƩɷŌO\\İÐ¢æ^Ŋ ĲȶȆbÜGĝ¬¿ĚVĎgª^íu½jÿĕęjık@Ľ]ėl¥ËĭûÁėéV©±ćn©­ȇÍq¯½YÃÔŉÉNÑÅÝy¹NqáʅDǡËñ­ƁYÅy̱os§ȋµʽǘǏƬɱàưN¢ƔÊuľýľώȪƺɂļxZĈ}ÌŉŪĺœĭFЛĽ̅ȣͽÒŵìƩÇϋÿȮǡŏçƑůĕ~Ç¼ȳÐUfdIxÿ\\G zâɏÙOº·pqy£@qþ@Ǟ˽IBäƣzsÂZÁàĻdñ°ŕzéØűzșCìDȐĴĺf®Àľưø@ɜÖÞKĊŇƄ§͑těï͡VAġÑÑ»d³öǍÝXĉĕÖ{þĉu¸ËʅğU̎éhɹƆ̗̮ȘǊ֥ड़ࡰţાíϲäʮW¬®ҌeרūȠkɬɻ̼ãüfƠSצɩςåȈHϚÎKǳͲOðÏȆƘ¼CϚǚ࢚˼ФÔ¤ƌĞ̪Qʤ´¼mȠJˀƲÀɠmɆǄĜƠ´ǠN~ʢĜ¶ƌĆĘźʆȬ˪ĚĒ¸ĞGȖƴƀj`ĢçĶāàŃºēĢĖćYÀŎüôQÐÂŎŞǆŞêƖoˆDĤÕºÑǘÛˤ³̀gńƘĔÀ^ªƂ`ªt¾äƚêĦĀ¼ÐĔǎ¨Ȕ»͠^ˮÊȦƤøxRrŜH¤¸ÂxDÄ|ø˂˜ƮÐ¬ɚwɲFjĔ²Äw°ǆdÀÉ_ĸdîàŎjÊêTĞªŌŜWÈ|tqĢUB~´°ÎFCU¼pĀēƄN¦¾O¶łKĊOjĚj´ĜYp{¦SĚÍ\\T×ªV÷Ší¨ÅDK°ßtŇĔK¨ǵÂcḷ̌ĚǣȄĽFlġUĵŇȣFʉɁMğįʏƶɷØŭOǽ«ƽū¹Ʊő̝Ȩ§ȞʘĖiɜɶʦ}¨֪ࠜ̀ƇǬ¹ǨE˦ĥªÔêFxúQEr´Wrh¤Ɛ \\talĈDJÜ|[Pll̚¸ƎGú´P¬W¦^¦H]prRn|or¾wLVnÇIujkmon£cX^Bh`¥V¦U¤¸}xRj[^xN[~ªxQ[`ªHÆÂExx^wN¶Ê|¨ìMrdYpoRzNyÀDs~bcfÌ`L¾n|¾T°c¨È¢ar¤`[|òDŞĔöxElÖdHÀI`Ď\\Àì~ÆR¼tf¦^¢ķ¶eÐÚMptgjɡČÅyġLûŇV®ÄÈƀĎ°P|ªVVªj¬ĚÒêp¬E|ŬÂ_~¼rƐK f{ĘFĒƌXưăkÃĄ}nµo×q£ç­kX{uĩ«āíÓUŅÝVUŌ]Ť¥lyň[oi{¦LĸĦ^ôâJ¨^UZðÚĒL¿Ìf£K£ʺoqNwğc`uetOj×°KJ±qÆġmĚŗos¬qehqsuH{¸kH¡ÊRǪÇƌbȆ¢´äÜ¢NìÉʖ¦â©Ɨؗ"]],encodeOffsets:[[[128500,52752],[127089,51784]]]},properties:{cp:[111.670801,40.818311],name:"内蒙古",childNum:2}},{id:"210000",geometry:{type:"MultiPolygon",coordinates:[["@@L@@s]","@@MnNm","@@dc","@@eÀC@b","@@fXwkbrÄ`qg","@@^jtWQ","@@~ Y[c","@@I`ĖN^_¿ZÁM","@@Ïxǌ{q_×^Gigp","@@iX¶BY","@@YZ","@@L_yG`b","@@^WqCTZ","@@\\[§t|]","@@m`p[","@@@é^BntaÊU]x ¯ÄPĲ­°hʙK³VÕ@Y~|EvĹsÇ¦­L^pÃ²ŸÒG Ël]xxÄ_fT¤Ď¤cPC¨¸TVjbgH²sdÎdHt`B²¬GJję¶[ÐhjeXdlwhðSČ¦ªVÊÏÆZÆŶ®²^ÎyÅHńĚDMħĜŁH­kçvV[ĳ¼WYÀäĦ`XlR`ôLUVfK¢{NZdĒªYĸÌÚJRr¸SA|ƴgŴĴÆbvªØX~źB|¦ÕE¤Ð`\\|KUnnI]¤ÀÂĊnŎR®Ő¿¶\\ÀøíDm¦ÎbŨabaĘ\\ľãÂ¸atÎSƐ´©v\\ÖÚÌǴ¤Â¨JKrZ_ZfjþhPkx`YRIjJcVf~sCN¤ EhæmsHy¨SðÑÌ\\\\ĐRÊwS¥fqŒßýáĞÙÉÖ[^¯ǤŲê´\\¦¬ĆPM¯£»uïpùzExanµyoluqe¦W^£ÊL}ñrkqWňûPUP¡ôJoo·U}£[·¨@XĸDXm­ÛÝºGUCÁª½{íĂ^cjk¶Ã[q¤LÉö³cux«|Zd²BWÇ®Yß½ve±ÃCý£W{Ú^q^sÑ·¨ËMr¹·C¥GDrí@wÕKţÃ«V·i}xËÍ÷i©ĝɝǡ]{c±OW³Ya±_ç©HĕoƫŇqr³Lys[ñ³¯OSďOMisZ±ÅFC¥Pq{Ã[Pg}\\¿ghćOk^ĩÃXaĕËĥM­oEqqZûěŉ³F¦oĵhÕP{¯~TÍlªNßYÐ{Ps{ÃVUeĎwk±ŉVÓ½ŽJãÇÇ»Jm°dhcÀffdF~ĀeĖd`sx² ®EĦ¦dQÂd^~ăÔH¦\\LKpĄVez¤NP ǹÓRÆąJSh­a[¦´ÂghwmBÐ¨źhI|VV|p] Â¼èNä¶ÜBÖ¼L`¼bØæKVpoúNZÞÒKxpw|ÊEMnzEQIZZNBčÚFÜçmĩWĪñtÞĵÇñZ«uD±|ƏlǗw·±PmÍada CLǑkùó¡³Ï«QaċÏOÃ¥ÕđQȥċƭy³ÁA"]],encodeOffsets:[[[123686,41445],[126019,40435],[124393,40128],[126117,39963],[125322,40140],[126686,40700],[126041,40374],[125584,40168],[125509,40217],[125453,40165],[125362,40214],[125280,40291],[125774,39997],[125976,40496],[125822,39993],[122731,40949]]]},properties:{cp:[123.429096,41.796767],name:"辽宁",childNum:16}},{id:"220000",geometry:{type:"Polygon",coordinates:["@@ñr½ÉKāGÁ¤ia ÉÈ¹`\\xs¬dĆkNnuNUwNx¶c¸|\\¢GªóĄ~RãÖÎĢùđŴÕhQxtcæëSɽŉíëǉ£ƍG£nj°KƘµDsØÑpyĆ¸®¿bXp]vbÍZuĂ{n^IüÀSÖ¦EvRÎûh@â[ƏÈô~FNr¯ôçR±­HÑlĢ^¤¢OðætxsŒ]ÞÁTĠs¶¿âÆGW¾ìA¦·TÑ¬è¥ÏÐJ¨¼ÒÖ¼ƦɄxÊ~StD@Ă¼Ŵ¡jlºWvÐzƦZÐ²CH AxiukdGgetqmcÛ£Ozy¥cE}|¾cZk¿uŐã[oxGikfeäT@SUwpiÚFM©£è^Ú`@v¶eňf heP¶täOlÃUgÞzŸU`l}ÔÆUvØ_Ō¬Öi^ĉi§²ÃB~¡ĈÚEgc|DC_Ȧm²rBx¼MÔ¦ŮdĨÃâYxƘDVÇĺĿg¿cwÅ\\¹¥Yĭl¤OvLjM_a W`zļMž·\\swqÝSAqŚĳ¯°kRē°wx^ĐkǂÒ\\]nrĂ}²ĊŲÒøãh·M{yMzysěnĒġV·°G³¼XÀ¤¹i´o¤ŃÈ`ÌǲÄUĞd\\iÖmÈBĤÜɲDEh LG¾ƀÄ¾{WaYÍÈĢĘÔRîĐj}ÇccjoUb½{h§Ǿ{KƖµÎ÷GĄØŜçưÌs«lyiē«`å§H¥Ae^§GK}iã\\c]v©ģZmÃ|[M}ģTɟĵÂÂ`ÀçmFK¥ÚíÁbX³ÌQÒHof{]ept·GŋĜYünĎųVY^ydõkÅZW«WUa~U·SbwGçǑiW^qFuNĝ·EwUtW·Ýďæ©PuqEzwAVXRãQ`­©GYYhcUGorBd}ģÉb¡·µMicF«Yƅ»é\\ɹ~ǙG³mØ©BšuT§Ĥ½¢Ã_Ã½L¡ûsT\\rke\\PnwAKy}ywdSefµ]UhĿD@mÿvaÙNSkCuncÿ`lWėVâ¦÷~^fÏ~vwHCį`xqT­­lW«ï¸skmßEGqd¯R©Ý¯¯S\\cZ¹iűƏCuƍÓXoR}M^o£R}oªU­FuuXHlEÅÏ©¤ßgXþ¤D²ÄufàÀ­XXÈ±Ac{Yw¬dvõ´KÊ£\\rµÄlidā]|î©¾DÂVH¹Þ®ÜWnCķ W§@\\¸~¤Vp¸póIO¢VOŇürXql~òÉK]¤¥Xrfkvzpm¶bwyFoúvð¼¤ N°ąO¥«³[éǣű]°Õ\\ÚÊĝôîŇÔaâBYlďQ[ Ë[ïÒ¥RI|`j]P"],encodeOffsets:[[126831,44503]]},properties:{cp:[125.3245,43.886841],name:"吉林",childNum:1}},{id:"230000",geometry:{type:"MultiPolygon",coordinates:[["@@UµNÿ¥īèçHÍøƕ¶Lǽ|g¨|a¾pVidd~ÈiíďÓQġėÇZÎXb½|ſÃH½KFgɱCģÛÇAnjÕc[VĝǱÃËÇ_ £ń³pj£º¿»WH´¯U¸đĢmtĜyzzNN|g¸÷äűÑ±ĉā~mq^[ǁÑďlw]¯xQĔ¯l°řĴrBÞTxr[tŽ¸ĻN_yX`biNKuP£kZĮ¦[ºxÆÀdhĹŀUÈƗCwáZħÄŭcÓ¥»NAw±qȥnD`{ChdÙFć}¢A±Äj¨]ĊÕjŋ«×`VuÓÅ~_kŷVÝyhVkÄãPsOµfgeŇµf@u_Ù ÙcªNªÙEojVxT@ãSefjlwH\\pŏäÀvlY½d{F~¦dyz¤PÜndsrhfHcvlwjF£G±DÏƥYyÏu¹XikĿ¦ÏqƗǀOŜ¨LI|FRĂn sª|C˜zxAè¥bfudTrFWÁ¹Am|ĔĕsķÆF´N}ćUÕ@Áĳſmuçuð^ÊýowFzØÎĕNőǏȎôªÌŒǄàĀÄ˄ĞŀƒʀĀƘŸˮȬƬĊ°Uzouxe]}AyÈW¯ÌmKQ]Īºif¸ÄX|sZt|½ÚUÎ lk^p{f¤lºlÆW A²PVÜPHÊâ]ÎĈÌÜk´\\@qàsĔÄQºpRij¼èi`¶bXrBgxfv»uUi^v~J¬mVp´£´VWrnP½ì¢BX¬hðX¹^TjVriªjtŊÄmtPGx¸bgRsT`ZozÆO]ÒFôÒOÆŊvÅpcGêsx´DR{AEOr°x|íb³Wm~DVjºéNNËÜ˛ɶ­GxŷCSt}]ûōSmtuÇÃĕNāg»íT«u}ç½BĵÞʣ¥ëÊ¡MÛ³ãȅ¡ƋaǩÈÉQG¢·lG|tvgrrf«ptęŘnÅĢrI²¯LiØsPf_vĠdxM prʹL¤¤eËÀđKïÙVY§]Ióáĥ]ķK¥j|pŇ\\kzţ¦šnņäÔVĂîĪ¬|vW®l¤èØrxm¶ă~lÄƯĄ̈́öȄEÔ¤ØQĄĄ»ƢjȦOǺ¨ìSŖÆƬyQv`cwZSÌ®ü±Ǆ]ŀç¬B¬©ńzƺŷɄeeOĨSfm ĊƀP̎ēz©ĊÄÕÊmgÇsJ¥ƔŊśæÎÑqv¿íUOµªÂnĦÁ_½ä@êí£P}Ġ[@gġ}gɊ×ûÏWXá¢užƻÌsNÍ½ƎÁ§čŐAēeL³àydl¦ĘVçŁpśǆĽĺſÊQíÜçÛġÔsĕ¬Ǹ¯YßċġHµ ¡eå`ļrĉŘóƢFìĎWøxÊkƈdƬv|I|·©NqńRŀ¤éeŊŀàŀU²ŕƀBQ£Ď}L¹Îk@©ĈuǰųǨÚ§ƈnTËÇéƟÊcfčŤ^XmHĊĕË«W·ċëx³ǔķÐċJāwİ_ĸȀ^ôWr­°oú¬ĦŨK~ȰCĐ´Ƕ£fNÎèâw¢XnŮeÂÆĶ¾¾xäLĴĘlļO¤ÒĨA¢Êɚ¨®ØCÔ ŬGƠƦYĜĘÜƬDJg_ͥœ@čŅĻA¶¯@wÎqC½Ĉ»NăëKďÍQÙƫ[«ÃígßÔÇOÝáWñuZ¯ĥŕā¡ÑķJu¤E å¯°WKÉ±_d_}}vyõu¬ï¹ÓU±½@gÏ¿rÃ½DgCdµ°MFYxw¿CG£Rƛ½Õ{]L§{qqą¿BÇƻğëܭǊË|c²}Fµ}ÙRsÓpg±QNqǫŋRwŕnéÑÉK«SeYRŋ@{¤SJ}D Ûǖ֍]gr¡µŷjqWÛham³~S«Ü[","@@ƨĶTLÇyqpÇÛqe{~oyen}s`qiXGù]Ëp½©lÉÁp]Þñ´FĂ^fäîºkàz¼BUv¬D"]],encodeOffsets:[[[134456,44547],[127123,51780]]]},properties:{cp:[126.642464,45.756967],name:"黑龙江",childNum:2}},{id:"320000",geometry:{type:"Polygon",coordinates:["@@Õg^vÁbnÀ`Jnĝ¬òM¶ĘTÖŒbe¦¦{¸ZâćNp©Hp|`mjhSEb\\afv`sz^lkljÄtg¤D­¾X¿À|ĐiZȀåB·î}GL¢õcßjayBFµÏC^ĭcÙt¿sğH]j{s©HM¢QnDÀ©DaÜÞ·jgàiDbPufjDk`dPOîhw¡ĥ¥GP²ĐobºrYî¶aHŢ´ ]´rılw³r_{£DB_Ûdåuk|Ũ¯F Cºyr{XFye³Þċ¿ÂkĭB¿MvÛpm`rÚã@Ę¹hågËÖƿxnlč¶Åì½Ot¾dJlVJĂǀŞqvnO^JZż·Q}êÍÅmµÒ]ƍ¦Dq}¬R^èĂ´ŀĻĊIÔtĲyQŐĠMNtR®òLhĚs©»}OÓGZz¶A\\jĨFäOĤHYJvÞHNiÜaĎÉnFQlNM¤B´ĄNöɂtpŬdZÅglmuÇUšŞÚb¤uŃJŴu»¹ĄlȖħŴw̌ŵ²ǹǠ͛hĭłƕrçü±Yrřl¥i`ã__¢ćSÅr[Çq^ùzWmOĈaŐÝɞï²ʯʊáĘĳĒǭPħ͍ôƋÄÄÍīçÛɈǥ£­ÛmY`ó£Z«§°Ó³QafusNıǅ_k}¢m[ÝóDµ¡RLčiXyÅNïă¡¸iĔÏNÌķoıdōîåŤûHcs}~Ûwbù¹£¦ÓCtOPrE^ÒogĉIµÛÅʹK¤½phMú`mR¸¦PƚgÉLRs`£¯ãhD¨|³¤C"],encodeOffsets:[[121451,32518]]},properties:{cp:[118.767413,32.041544],name:"江苏",childNum:1}},{id:"330000",geometry:{type:"MultiPolygon",coordinates:[["@@jX^n","@@sfdM","@@qP\\xz[_i","@@o\\VzRZ}mECy","@@R¢FX}°[m]","@@Cb\\}","@@e|v\\laus","@@v~s{","@@QxÂF©}","@@¹nvÞs©m","@@rQgYIh","@@bi«ZX","@@p[}ILd","@@À¿|","@@¹dnb","@@rS}[Kl","@@g~h}","@@FlCk","@@ůTG°ĄLHm°UF","@@OdRe","@@v[u\\","@@FjâL~wyoo~sµLZ","@@¬e¹aH","@@\\nÔ¡q]L³ë\\ÿ®QÌ","@@ÊA­©]ª","@@Kxv{­","@@@hlIk_","@@pWcrxp","@@Md|_iA","@@¢X£½z\\ðpN","@@hlÜ[LykAvyfw^E ","@@fp¤MusH","@@®_ma~LÁ¬`","@@@°¡mÛGĕ¨§Ianá[ýƤjfæÐNäGp","@@iMt\\","@@Zc[b","@@X®±GrÆ°Zæĉm","@@Z~dOSo|A¿qZv","@@@`EN£p","@@|s","@@@nDi","@@na£¾uYL¯QªmĉÅdMgÇjcº«ę¬­K­´B«Âącoċ\\xK`cįŧ«®á[~ıxu·ÅKsËÉc¢Ù\\ĭƛëbf¹­ģSĜkáƉÔ­ĈZB{aMµfzŉfÓÔŹŁƋǝÊĉ{ğč±g³ne{ç­ií´S¬\\ßðK¦w\\iqªĭiAuA­µ_W¥ƣO\\lċĢttC¨£t`PZäuXßBsĻyekOđġĵHuXBµ]×­­\\°®¬F¢¾pµ¼kŘó¬Wät¸|@L¨¸µrºù³Ù~§WIZW®±Ð¨ÒÉx`²pĜrOògtÁZ{üÙ[|ûKwsPlU[}¦Rvn`hsª^nQ´ĘRWb_ rtČFIÖkĦPJ¶ÖÀÖJĈĄTĚòC ²@PúØz©Pî¢£CÈÚĒ±hŖl¬â~nm¨f©iļ«mntqÒTÜÄjL®EÌFª²iÊxØ¨IÈhhst[Ôx}dtüGæţŔïĬaĸpMËÐjē¢·ðĄÆMzjWKĎ¢Q¶À_ê_@ıi«pZgf¤Nrq]§ĂN®«H±yƳí¾×ŊďŀĐÏŴǝĂíÀBŖÕªÁŐTFqĉ¯³ËCĕģi¨hÜ·ñt»¯Ï","@@ºwZRkĕWK "]],encodeOffsets:[[[125785,31436],[125729,31431],[125513,31380],[125329,30690],[125223,30438],[125115,30114],[124815,29155],[124419,28746],[124095,28635],[124005,28609],[125e3,30713],[125111,30698],[125078,30682],[125150,30684],[124014,28103],[125008,31331],[125411,31468],[125329,31479],[125369,31139],[125626,30916],[125417,30956],[125254,30976],[125199,30997],[125095,31058],[125083,30915],[124885,31015],[125218,30798],[124867,30838],[124755,30788],[124802,30809],[125267,30657],[125218,30578],[125200,30562],[125192,30787],[124968,30474],[125167,30396],[125115,30363],[124955,29879],[124714,29781],[124762,29462],[124325,28754],[124863,30077],[125366,31477]]]},properties:{cp:[120.153576,30.287459],name:"浙江",childNum:43}},{id:"340000",geometry:{type:"MultiPolygon",coordinates:[["@@^iuLV\\","@@e©Edh","@@´CE¶zAXêeödK¡~H¸íæAȽd{ďÅÀ½W®£ChÃsikkly]_teu[bFaTign{]GqªoĈMYá|·¥f¥őaSÕėNµñĞ«Im_m¿Âa]uĜp Z_§{Cäg¤°r[_YjÆOdý[I[á·¥Q_nùgL¾mzˆDÜÆ¶ĊJhpc¹O]iŠ]¥ jtsggDÑ¡w×jÉ©±EFË­KiÛÃÕYvsm¬njĻª§emná}k«ŕgđ²ÙDÇ¤í¡ªOy×Où±@DñSęćăÕIÕ¿IµĥOlJÕÍRÍ|JìĻÒåyķrĕq§ÄĩsWÆßF¶X®¿mwRIÞfßoG³¾©uyHį{Ɓħ¯AFnuPÍÔzVdàôº^Ðæd´oG¤{S¬ćxã}ŧ×Kǥĩ«ÕOEÐ·ÖdÖsƘÑ¨[Û^Xr¢¼§xvÄÆµ`K§ tÒ´Cvlo¸fzŨð¾NY´ı~ÉĔēßúLÃÃ_ÈÏ|]ÂÏHlg`ben¾¢pUh~ƴĖ¶_r sĄ~cƈ]|r c~`¼{À{ȒiJjz`îÀT¥Û³]u}fïQl{skloNdjäËzDvčoQďHI¦rbrHĖ~BmlNRaĥTX\\{fÁKÁ®TLÂÄMtÊgĀDĄXƔvDcÎJbt[¤D@®hh~kt°ǾzÖ@¾ªdbYhüóV´ŮŒ¨Üc±r@J|àuYÇÔG·ĚąĐlŪÚpSJ¨ĸLvÞcPæķŨ®mÐálsgd×mQ¨ųÆ©Þ¤IÎs°KZpĄ|XwWdĎµmkǀwÌÕæhºgBĝâqÙĊzÖgņtÀÁĂÆáhEz|WzqD¹°Eŧl{ævÜcA`¤C`|´qxĲkq^³³GšµbíZ¹qpa±ď OH¦Ħx¢gPícOl_iCveaOjChß¸iÝbÛªCC¿mRV§¢A|tbkĜEÀtîm^g´fÄ"]],encodeOffsets:[[[121722,32278],[119475,30423],[121606,33646]]]},properties:{cp:[117.283042,31.86119],name:"安徽",childNum:3}},{id:"350000",geometry:{type:"MultiPolygon",coordinates:[["@@zht´}[","@@aj^~ĆGå","@@edHse","@@@vPGsyQ","@@sBzddW[O","@@S¨Qy","@@NVucW","@@qptB@q","@@¸[iu","@@Q\\pD[_","@@jSwUappI","@@eXª~","@@AjvFoo","@@fT_Çí\\v|ba¦jZÆy|®","@@IjLg","@@wJIx«¼AoNe{M¥","@@K±¡ÓČ~N¾","@@k¡¹Eh~c®uDqZì¡I~Māe£bN¨gZý¡a±Öcp©PhI¢QqÇGj|¥U g[Ky¬ŏv@OptÉEF\\@ åA¬V{XģĐBycpě¼³Ăp·¤¥ohqqÚ¡ŅLs^Ã¡§qlÀhH¨MCe»åÇGD¥zPO£čÙkJA¼ßėuĕeûÒiÁŧS[¡Uûŗ½ùěcÝ§SùĩąSWó«íęACµeRåǃRCÒÇZÍ¢ź±^dlstjD¸ZpuÔâÃH¾oLUêÃÔjjēò´ĄWƛ^Ñ¥Ħ@ÇòmOw¡õyJyD}¢ďÑÈġfZda©º²z£NjD°Ötj¶¬ZSÎ~¾c°¶ÐmxO¸¢Pl´SL|¥AȪĖMņĲg®áIJČĒü` QF¬h|ĂJ@zµ |ê³È ¸UÖŬŬÀCtrĸr]ðM¤ĶĲHtÏ AĬkvsq^aÎbvdfÊòSD´Z^xPsĂrvƞŀjJd×ŘÉ ®AÎ¦ĤdxĆqAZRÀMźnĊ»İÐZ YXæJyĊ²·¶q§·K@·{sXãô«lŗ¶»o½E¡­«¢±¨Y®Ø¶^AvWĶGĒĢPlzfļtàAvWYãO_¤sD§ssČġ[kƤPX¦`¶®BBvĪjv©jx[L¥àï[F¼ÍË»ğV`«Ip}ccÅĥZEãoP´B@D¸m±z«Ƴ¿å³BRØ¶Wlâþäą`]Z£Tc ĹGµ¶Hm@_©k¾xĨôȉðX«½đCIbćqK³ÁÄš¬OAwã»aLŉËĥW[ÂGIÂNxĳ¤D¢îĎÎB§°_JGs¥E@¤ućPåcuMuw¢BI¿]zG¹guĮI"]],encodeOffsets:[[[123250,27563],[122541,27268],[123020,27189],[122916,27125],[122887,26845],[122808,26762],[122568,25912],[122778,26197],[122515,26757],[122816,26587],[123388,27005],[122450,26243],[122578,25962],[121255,25103],[120987,24903],[122339,25802],[121042,25093],[122439,26024]]]},properties:{cp:[119.306239,26.075302],name:"福建",childNum:18}},{id:"360000",geometry:{type:"Polygon",coordinates:["@@ÖP¬ǦĪØLŨä~Ĉw«|TH£pc³Ïå¹]ĉđxe{ÎÓvOEm°BƂĨİ|Gvz½ª´HàpeJÝQxnÀW­EµàXÅĪt¨ÃĖrÄwÀFÎ|Ă¡WÕ¸cf¥XaęST±m[r«_gmQu~¥V\\OkxtL E¢Ú^~ýØkbēqoě±_Êw§Ñ²ÏƟė¼mĉŹ¿NQYBąrwģcÍ¥B­ŗÊcØiIƝĿuqtāwO]³YCñTeÉcaubÍ]trluīBÐGsĵıN£ï^ķqsq¿DūūVÕ·´Ç{éĈýÿOER_đûIċâJh­ŅıNȩĕB¦K{Tk³¡OP·wnµÏd¯}½TÍ«YiµÕsC¯iM¤­¦¯P|ÿUHvhe¥oFTuõ\\OSsMòđƇiaºćXĊĵà·çhƃ÷Ç{ígu^đgm[ÙxiIN¶Õ»lđÕwZSÆv©_ÈëJbVkĔVÀ¤P¾ºÈMÖxlò~ªÚàGĂ¢B±ÌKyñ`w²¹·`gsÙfIěxŕeykpudjuTfb·hh¿Jd[\\LáƔĨƐAĈepÀÂMD~ņªe^\\^§ý©j×cZØ¨zdÒa¶lÒJìõ`oz÷@¤uŞ¸´ôęöY¼HČƶajlÞƩ¥éZ[|h}^U  ¥pĄžƦO lt¸Æ Q\\aÆ|CnÂOjt­ĚĤdÈF`¶@Ðë ¦ōÒ¨SêvHĢÛ@[ÆQoxHW[ŰîÀt¦Ǆ~NĠ¢lĄtZoCƞÔºCxrpČNpj¢{f_Y`_eq®Aot`@oDXfkp¨|s¬\\DÄSfè©Hn¬^DhÆyøJhØxĢĀLÊƠPżċĄwĮ¶"],encodeOffsets:[[118923,30536]]},properties:{cp:[115.892151,28.676493],name:"江西",childNum:1}},{id:"370000",geometry:{type:"MultiPolygon",coordinates:[["@@Xjd]mE","@@itnq","@@Dl@k","@@TGw","@@K¬U","@@Wd`c","@@PtMs","@@LnXlc","@@ppVu]Qn","@@cdzAU_","@@udRhnCE","@@oIpP","@@M{ĿčwbxƨîKÎMĮ]ZF½Y]â£ph¶¨râøÀÎǨ¤^ºÄGz~grĚĜlĞÆLĆǆ¢Îo¦cvKbgr°WhmZp L]LºcUÆ­nżĤÌĒbAnrOA´ȊcÀbƦUØrĆUÜøĬƞŶǬĴóò_A̈«ªdÎÉnb²ĦhņBĖįĦåXćì@L¯´ywƕCéÃµė ƿ¸lµZæyj|BíÂKNNnoƈfÈMZwnŐNàúÄsTJULîVjǎ¾ĒØDz²XPn±ŴPè¸ŔLƔÜƺ_TüÃĤBBċÈöA´faM¨{«M`¶d¡ôÖ°mȰBÔjj´PM|c^d¤u¤Û´ä«ƢfPk¶Môl]Lb}su^ke{lCMrDÇ­]NÑFsmoõľHyGă{{çrnÓEƕZGª¹Fj¢ÿ©}ÌCǷë¡ąuhÛ¡^KxC`C\\bÅxì²ĝÝ¿_NīCȽĿåB¥¢·IŖÕy\\¹kxÃ£ČáKµË¤ÁçFQ¡KtŵƋ]CgÏAùSedcÚźuYfyMmhUWpSyGwMPqŀÁ¼zK¶G­Y§Ë@´śÇµƕBm@IogZ¯uTMx}CVKï{éƵP_K«pÛÙqċtkkù]gTğwoɁsMõ³ăAN£MRkmEÊčÛbMjÝGuIZGPģãħE[iµBEuDPÔ~ª¼ęt]ûG§¡QMsğNPŏįzs£Ug{đJĿļā³]ç«Qr~¥CƎÑ^n¶ÆéÎR~Ż¸YI] PumŝrƿIā[xeÇ³L¯v¯s¬ÁY~}ťuŁgƋpÝĄ_ņī¶ÏSR´ÁP~¿Cyċßdwk´SsX|t`Ä ÈðAªìÎT°¦Dda^lĎDĶÚY°`ĪŴǒàŠv\\ebZHŖR¬ŢƱùęOÑM­³FÛaj"]],encodeOffsets:[[[123806,39303],[123821,39266],[123742,39256],[123702,39203],[123649,39066],[123847,38933],[123580,38839],[123894,37288],[123043,36624],[123344,38676],[123522,38857],[123628,38858],[118267,36772]]]},properties:{cp:[117.000923,36.675807],name:"山东",childNum:13}},{id:"410000",geometry:{type:"MultiPolygon",coordinates:[["@@dXD}~Hgq~ÔN~zkĘHVsǲßjŬŢ`Pûàl¢\\ÀEhİgÞē X¼`khÍLùµP³swIÓzeŠĠð´E®ÚPtºIŊÊºL«šŕQGYfa[şußǑĩų_Z¯ĵÙčC]kbc¥CS¯ëÍB©ïÇÃ_{sWTt³xlàcČzÀD}ÂOQ³ÐTĬµƑÐ¿ŸghłŦv~}ÂZ«¤lPÇ£ªÝŴÅR§ØnhctâknÏ­ľŹUÓÝdKuķI§oTũÙďkęĆH¸Ó\\Ä¿PcnS{wBIvÉĽ[GqµuŇôYgûZca©@½Õǽys¯}lgg@­C\\£asIdÍuCQñ[L±ęk·ţb¨©kK»KC²òGKmĨS`UQnk}AGēsqaJ¥ĐGRĎpCuÌy ã iMcplk|tRkðev~^´¦ÜSí¿_iyjI|ȑ|¿_»d}q^{Ƈdă}tqµ`ŷé£©V¡om½ZÙÏÁRD|JOÈpÀRsI{ùÓjuµ{t}uËRivGçJFjµåkWê´MÂHewixGw½Yŷpµú³XU½ġyłåkÚwZX·l¢Á¢KzOÎÎjc¼htoDHr|­J½}JZ_¯iPq{tę½ĕ¦Zpĵø«kQĹ¤]MÛfaQpě±ǽ¾]u­Fu÷nčÄ¯ADp}AjmcEÇaª³o³ÆÍSƇĈÙDIzçñİ^KNiÞñ[aA²zzÌ÷D|[íÄ³gfÕÞd®|`Ć~oĠƑô³ŊD×°¯CsøÂ«ìUMhTº¨¸ǝêWÔDruÂÇZ£ĆPZW~ØØv¬gèÂÒw¦X¤Ā´oŬ¬²Ês~]®tªapŎJ¨Öº_ŔfŐ\\Đ\\Ĝu~m²Ƹ¸fWĦrƔ}Î^gjdfÔ¡J}\\n C¦þWxªJRÔŠu¬ĨĨmFdM{\\d\\YÊ¢ú@@¦ª²SÜsC}fNècbpRmlØ^gd¢aÒ¢CZZxvÆ¶N¿¢T@uC¬^ĊðÄn|lIlXhun[","@@hzUq"]],encodeOffsets:[[[116744,37216],[116480,33048]]]},properties:{cp:[113.665412,34.757975],name:"河南",childNum:2}},{id:"420000",geometry:{type:"MultiPolygon",coordinates:[["@@ASd","@@ls{d","@@¾«}{ra®pîÃ\\{øCËyyB±b\\òÝjKL ]ĎĽÌJyÚCƈćÎT´Å´pb©ÈdFin~BCo°BĎÃømv®E^vǾ½Ĝ²RobÜeN^ĺ£R¬lĶ÷YoĖ¥Ě¾|sOr°jY`~I¾®I{GqpCgyl{£ÍÍyPLÂ¡¡¸kWxYlÙæŁĢz¾V´W¶ùŸo¾ZHxjwfxGNÁ³Xéæl¶EièIH ujÌQ~v|sv¶Ôi|ú¢FhQsğ¦SiŠBgÐE^ÁÐ{čnOÂÈUÎóĔÊēĲ}Z³½Mŧïeyp·uk³DsÑ¨L¶_ÅuÃ¨w»¡WqÜ]\\Ò§tƗcÕ¸ÕFÏǝĉăxŻČƟOKÉġÿ×wg÷IÅzCg]m«ªGeçÃTC«[t§{loWeC@ps_Bp­rf_``Z|ei¡oċMqow¹DƝÓDYpûsYkıǃ}s¥ç³[§cY§HK«Qy]¢wwö¸ïx¼ņ¾Xv®ÇÀµRĠÐHM±cÏdƒǍũȅȷ±DSyúĝ£ŤĀàtÖÿï[îb\\}pĭÉI±Ñy¿³x¯No|¹HÏÛmjúË~TuęjCöAwě¬Rđl¯ Ñb­ŇTĿ_[IčĄʿnM¦ğ\\É[T·k¹©oĕ@A¾wya¥Y\\¥Âaz¯ãÁ¡k¥ne£ÛwE©Êō¶˓uoj_U¡cF¹­[WvP©whuÕyBF`RqJUw\\i¡{jEPïÿ½fćQÑÀQ{°fLÔ~wXgītêÝ¾ĺHd³fJd]HJ²EoU¥HhwQsƐ»Xmg±çve]DmÍPoCc¾_hhøYrŊU¶eD°Č_N~øĹĚ·`z]Äþp¼äÌQv\\rCé¾TnkžŐÚÜa¼ÝƆĢ¶ÛodĔňÐ¢JqPb ¾|J¾fXƐîĨ_Z¯À}úƲN_ĒÄ^ĈaŐyp»CÇÄKñL³ġM²wrIÒŭxjb[n«øæà ^²­h¯ÚŐªÞ¸Y²ĒVø}Ā^İ´LÚm¥ÀJÞ{JVųÞŃx×sxxƈē ģMřÚðòIfĊŒ\\Ʈ±ŒdÊ§ĘDvČ_Àæ~Dċ´A®µ¨ØLV¦êHÒ¤"]],encodeOffsets:[[[113712,34e3],[115612,30507],[113649,34054]]]},properties:{cp:[114.298572,30.584355],name:"湖北",childNum:3}},{id:"430000",geometry:{type:"MultiPolygon",coordinates:[["@@nFZw","@@ãÆá½ÔXrCOËRïÿĩ­TooQyÓ[ŅBE¬ÎÓXaį§Ã¸G °ITxpúxÚĳ¥ÏĢ¾edÄ©ĸGàGhM¤Â_U}Ċ}¢pczfþg¤ÇôAV","@@ȴÚĖÁĐiOĜ«BxDõĚivSÌ}iùÜnÐºG{p°M°yÂÒzJ²Ì ÂcXëöüiáÿñőĞ¤ùTz²CȆȸǎŪƑÐc°dPÎğË¶[È½u¯½WM¡­ÉB·rínZÒ `¨GA¾\\pēXhÃRC­üWGġuTé§ŎÑ©êLM³}_EÇģc®ęisÁPDmÅ{b[RÅs·kPŽƥóRoOV~]{g\\êYƪ¦kÝbiċƵGZ»Ěõó·³vŝ£ø@pyö_ëIkÑµbcÑ§y×dYØªiþUjŅ³C}ÁN»hĻħƏâƓKA·³CQ±µ§¿AUƑ¹AtćOwD]JUÖgk¯b£ylZFËÑ±H­}EbóľA¡»Ku¦·³åş¥ùBD^{ÌC´­¦ŷJ£^[ª¿ğ|ƅN skóā¹¿ï]ă~÷O§­@Vm¡Qđ¦¢Ĥ{ºjÔª¥nf´~Õo×ÛąGû¥cÑ[Z¶ŨĪ²SÊǔƐƀAÚŌ¦QØ¼rŭ­«}NÏürÊ¬mjr@ĘrTW ­SsdHzƓ^ÇÂyUi¯DÅYlŹu{hT}mĉ¹¥ěDÿë©ıÓ[Oº£¥ótł¹MÕƪ`PDiÛU¾ÅâìUñBÈ£ýhedy¡oċ`pfmjP~kZaZsÐd°wj§@Ĵ®w~^kÀÅKvNmX\\¨aŃqvíó¿F¤¡@ũÑVw}S@j}¾«pĂrªg àÀ²NJ¶¶DôK|^ª°LX¾ŴäPĪ±£EXd^¶ĲÞÜ~u¸ǔMRhsRe`ÄofIÔ\\Ø  ićymnú¨cj ¢»GČìƊÿÐ¨XeĈĀ¾Oð Fi ¢|[jVxrIQ_EzAN¦zLU`cªxOTu RLÄªpUĪȴ^ŎµªÉFxÜf¤ºgĲèy°Áb[¦Zb¦z½xBĖ@ªpºjS´rVźOd©ʪiĎăJP`"]],encodeOffsets:[[[115640,30489],[112577,27316],[114113,30649]]]},properties:{cp:[112.982279,28.19409],name:"湖南",childNum:3}},{id:"440000",geometry:{type:"MultiPolygon",coordinates:[["@@QdAsa","@@lxDRm","@@sbhNLo","@@Ă ý","@@WltOY[","@@Kr]S","@@e~AS}","@@I|Mym","@@Û³LS²Q","@@nvºBë¥cÕº","@@zdÛJm","@@°³","@@a yAª¸ËJIxØ@ĀHÉÕZofoo","@@sŗÃÔėAƁZÄ ~°ČPºb","@@¶ÝÌvmĞh¹Ĺ","@@HdSjĒ¢D}waru«ZqadY{K","@@el\\LqqO","@@~rMmX","@@f^E","@@øPªoj÷ÍÝħXČx°Q¨ıXJp","@@gÇƳmxatfu","@@EÆC½","@@¸B_¶ekWvSivc}p}Ăº¾NĎyj¦Èm th_®Ä}»âUzLË²Aā¡ßH©Ùñ}wkNÕ¹ÇO½¿£ēUlaUìIÇª`uTÅxYĒÖ¼kÖµMjJÚwn\\hĒv]îh|ÈƄøèg¸Ķß ĉĈWb¹ƀdéĘNTtP[öSvrCZaGubo´ŖÒÇĐ~¡zCIözx¢PnÈñ @ĥÒ¦]ƜX³ăĔñiiÄÓVépKG½ÄÓávYoC·sitiaÀyŧÎ¡ÈYDÑům}ý|m[węõĉZÅxUO}÷N¹³ĉo_qtăqwµŁYÙǝŕ¹tïÛUÃ¯mRCºĭ|µÕÊK½Rē ó]GªęAxNqSF|ām¡diď×YïYWªŉOeÚtĐ«zđ¹TāúEáÎÁWwíHcòßÎſ¿Çdğ·ùT×Çūʄ¡XgWÀǇğ·¿ÃOj YÇ÷Sğ³kzőõmĝ[³¡VÙæÅöMÌ³¹pÁaËýý©D©ÜJŹƕģGą¤{ÙūÇO²«BƱéAÒĥ¡«BhlmtÃPµyU¯ucd·w_bŝcīímGOGBȅŹãĻFŷŽŕ@Óoo¿ē±ß}}ÓF÷tĲWÈCőâUâǙIğŉ©IĳE×Á³AĥDĈ±ÌÜÓĨ£L]ĈÙƺZǾĆĖMĸĤfÎĵlŨnÈĐtFFĤêk¶^k°f¶g}®Faf`vXŲxl¦ÔÁ²¬Ð¦pqÊÌ²iXØRDÎ}Ä@ZĠsx®AR~®ETtĄZƈfŠŠHâÒÐAµ\\S¸^wĖkRzalŜ|E¨ÈNĀňZTpBh£\\ĎƀuXĖtKL¶G|»ĺEļĞ~ÜĢÛĊrOÙîvd]n¬VÊĜ°RÖpMƀ¬HbwEÀ©\\¤]ŸI®¥D³|Ë]CúAŠ¦æ´¥¸Lv¼¢ĽBaôF~®²GÌÒEYzk¤°ahlVÕI^CxĈPsBƒºVÀB¶¨R²´D","@@OR"]],encodeOffsets:[[[117381,22988],[116552,22934],[116790,22617],[116973,22545],[116444,22536],[116931,22515],[116496,22490],[116453,22449],[113301,21439],[118726,21604],[118709,21486],[113210,20816],[115482,22082],[113171,21585],[113199,21590],[115232,22102],[115739,22373],[115134,22184],[113056,21175],[119573,21271],[119957,24020],[115859,22356],[116680,26053],[116561,22649]]]},properties:{cp:[113.280637,23.125178],name:"广东",childNum:24}},{id:"450000",geometry:{type:"MultiPolygon",coordinates:[["@@H TI¡U","@@Ɣ_LÊFZgčP­kini«qÇczÍY®¬Ů»qR×ō©DÕ§ƙǃŵTÉĩ±ıdÑnYYĲvNĆĆØÜ Öp}e³¦m©iÓ|¹ħņ|ª¦QF¢Â¬ʖovg¿em^ucäāmÇÖåB¡Õçĝ}FĻ¼Ĺ{µHKsLSđƃrč¤[AgoSŇYMÿ§Ç{FśbkylQxĕ]T·¶[BÑÏGáşşƇeăYSs­FQ}­BwtYğÃ@~CÍQ ×WjË±rÉ¥oÏ ±«ÓÂ¥kwWűue_b­E~µh¯ecl¯Ïr¯EģJğ}w³Ƈē`ãògK_ÛsUʝćğ¶höO¤Ǜn³c`¡yię[ďĵűMę§]XÎ_íÛ]éÛUćİÕBƣ±dy¹T^dûÅÑŦ·PĻþÙ`K¦¢ÍeĥR¿³£[~äu¼dltW¸oRM¢ď\\z}Æzdvň{ÎXF¶°Â_ÒÂÏL©ÖTmu¼ãlīkiqéfA·Êµ\\őDc¥ÝFyÔćcűH_hLÜêĺĐ¨c}rn`½Ì@¸¶ªVLhŒ\\Ţĺk~Ġið°|gtTĭĸ^xvKVGréAébUuMJVÃO¡qĂXËSģãlýà_juYÛÒBG^éÖ¶§EGÅzěƯ¤EkN[kdåucé¬dnYpAyČ{`]þ±X\\ÞÈk¡ĬjàhÂƄ¢Hè ŔâªLĒ^Öm¶ħĊAǦė¸zÚGn£¾rªŀÜt¬@ÖÚSx~øOŒŶÐÂæȠ\\ÈÜObĖw^oÞLf¬°bI lTØBÌF£Ć¹gñĤaYt¿¤VSñK¸¤nM¼JE±½¸ñoÜCƆæĪ^ĚQÖ¦^f´QüÜÊz¯lzUĺš@ìp¶n]sxtx¶@~ÒĂJb©gk{°~c°`Ô¬rV\\la¼¤ôá`¯¹LCÆbxEræOv[H­[~|aB£ÖsºdAĐzNÂðsÞÆĤªbab`ho¡³F«èVZs\\\\ÔRzpp®SĪº¨ÖºNĳd`a¦¤F³¢@`¢ĨĀìhYvlĆº¦Ċ~nS|gźv^kGÆÀè·"]],encodeOffsets:[[[111707,21520],[113706,26955]]]},properties:{cp:[108.320004,22.82402],name:"广西",childNum:2}},{id:"460000",geometry:{type:"Polygon",coordinates:["@@¦Ŝil¢XƦƞòïè§ŞCêɕrŧůÇąĻõ·ĉ³œ̅kÇm@ċȧŧĥĽʉ­ƅſȓÒË¦ŝE}ºƑ[ÍĜȋ gÎfǐÏĤ¨êƺ\\Ɔ¸ĠĎvʄȀÐ¾jNðĀÒRZǆzÐĊ¢DÀɘZ"],encodeOffsets:[[112750,20508]]},properties:{cp:[110.33119,20.031971],name:"海南",childNum:1}},{id:"510000",geometry:{type:"MultiPolygon",coordinates:[["@@LqSn","@@ĆOìÛÐ@ĞǔNY{¤Á§di´ezÝúØãwIþËQÇ¦ÃqÉSJ»ĂéʔõÔƁİlƞ¹§ĬqtÀƄmÀêErĒtD®ċæcQE®³^ĭ¥©l}äQtoŖÜqÆkµªÔĻĴ¡@Ċ°B²Èw^^RsºTĀ£ŚæQPJvÄz^Đ¹Æ¯fLà´GC²dt­ĀRt¼¤ĦOðğfÔðDŨŁĞƘïPÈ®âbMüÀXZ ¸£@Å»»QÉ­]dsÖ×_Í_ÌêŮPrĔĐÕGĂeZÜîĘqBhtO ¤tE[h|YÔZśÎs´xº±Uñt|OĩĠºNbgþJy^dÂY Į]Řz¦gC³R`Āz¢Aj¸CL¤RÆ»@­Ŏk\\Ç´£YW}z@Z}Ã¶oû¶]´^NÒ}èNªPÍy¹`S°´ATeVamdUĐwʄvĮÕ\\uÆŗ¨Yp¹àZÂmWh{á}WØǍÉüwga§ßAYrÅÂQĀÕ¬LŐý®Xøxª½Ű¦¦[þ`ÜUÖ´òrÙŠ°²ÄkĳnDX{U~ET{ļº¦PZcjF²Ė@pg¨B{u¨ŦyhoÚD®¯¢ WòàFÎ¤¨GDäz¦kŮPġqË¥À]eâÚ´ªKxīPÖ|æ[xÃ¤JÞĥsNÖ½I¬nĨY´®ÐƐmDŝuäđđEbee_v¡}ìęǊē}qÉåT¯µRs¡M@}ůaa­¯wvƉåZw\\Z{åû`[±oiJDÅ¦]ĕãïrG réÏ·~ąSfy×Í·ºſƽĵȁŗūmHQ¡Y¡®ÁÃ×t«­T¤JJJyJÈ`Ohß¦¡uËhIyCjmÿwZGTiSsOB²fNmsPa{M{õE^Hj}gYpaeu¯oáwHjÁ½M¡pMuåmni{fk\\oÎqCwEZ¼KĝAy{m÷LwO×SimRI¯rKõBS«sFe]fµ¢óY_ÆPRcue°Cbo×bd£ŌIHgtrnyPt¦foaXďxlBowz_{ÊéWiêEGhÜ¸ºuFĈIxf®Y½ĀǙ]¤EyF²ċw¸¿@g¢§RGv»áW`ÃĵJwi]t¥wO­½a[×]`Ãi­üL¦LabbTÀåc}ÍhÆh®BHî|îºÉk­¤Sy£ia©taį·Ɖ`ō¥UhOĝLk}©Fos´JmµlŁuønÑJWÎªYÀïAetTŅÓGË«bo{ıwodƟ½OġÜÂµxàNÖ¾P²§HKv¾]|BÆåoZ`¡Ø`ÀmºĠ~ÌÐ§nÇ¿¤]wğ@srğu~Io[é±¹ ¿ſđÓ@qg¹zƱřaí°KtÇ¤V»Ã[ĩǭƑ^ÇÓ@áťsZÏÅĭƋěpwDóÖáŻneQËq·GCœýS]x·ýq³OÕ¶Qzßti{řáÍÇWŝŭñzÇWpç¿JXĩè½cFÂLiVjx}\\NŇĖ¥GeJA¼ÄHfÈu~¸Æ«dE³ÉMA|bÒćhG¬CMõƤąAvüVéŀ_VÌ³ĐwQj´·ZeÈÁ¨X´Æ¡Qu·»ÕZ³ġqDoy`L¬gdp°şp¦ėìÅĮZ°Iähzĵf²å ĚÑKpIN|Ñz]ń·FU×é»R³MÉ»GM«kiér}Ã`¹ăÞmÈnÁîRǀ³ĜoİzŔwǶVÚ£À]ɜ»ĆlƂ²ĠþTº·àUȞÏʦ¶I«dĽĢdĬ¿»Ĕ×h\\c¬ä²GêëĤł¥ÀǿżÃÆMº}BÕĢyFVvwxBèĻĒ©Ĉt@Ğû¸£B¯¨ˋäßkķ½ªôNÔ~t¼Ŵu^s¼{TA¼ø°¢İªDè¾Ň¶ÝJ®Z´ğ~Sn|ªWÚ©òzPOȸbð¢|øĞA"]],encodeOffsets:[[[108815,30935],[100197,35028]]]},properties:{cp:[104.065735,30.659462],name:"四川",childNum:2}},{id:"520000",geometry:{type:"MultiPolygon",coordinates:[["@@G\\lY£cj","@@q|mc¯vÏV","@@hÑ£IsNgßHHªķÃh_¹¡ĝÄ§ń¦uÙùgS¯JH|sÝÅtÁïyMDč»eÕtA¤{b\\}G®u\\åPFqwÅaDK°ºâ_£ùbµmÁÛĹM[q|hlaªāI}Ñµ@swtwm^oµDéĽŠyVky°ÉûÛR³e¥]RÕěħ[ƅåÛDpJiVÂF²I»mN·£LbÒYbWsÀbpkiTZĄă¶Hq`ĥ_J¯ae«KpÝx]aĕÛPÇȟ[ÁåŵÏő÷Pw}TÙ@Õs«ĿÛq©½m¤ÙH·yǥĘĉBµĨÕnđ]K©œáGçş§ÕßgǗĦTèƤƺ{¶ÉHÎd¾ŚÊ·OÐjXWrãLyzÉAL¾ę¢bĶėy_qMĔąro¼hĊw¶øV¤w²Ĉ]ÊKx|`ź¦ÂÈdrcÈbe¸`I¼čTF´¼Óýȃr¹ÍJ©k_șl³´_pĐ`oÒh¶pa^ÓĔ}D»^Xy`d[KvJPhèhCrĂĚÂ^Êƌ wZL­Ġ£ÁbrzOIlMMĪŐžËr×ÎeŦtw|¢mKjSǘňĂStÎŦEtqFT¾Eì¬¬ôxÌO¢ K³ŀºäYPVgŎ¦ŊmŞ¼VZwVlz¤£Tl®ctĽÚó{G­AÇge~Îd¿æaSba¥KKûj®_Ä^\\Ø¾bP®¦x^sxjĶI_Ä Xâ¼Hu¨Qh¡À@Ëô}±GNìĎlT¸`V~R°tbÕĊ`¸úÛtÏFDu[MfqGH·¥yAztMFe|R_GkChZeÚ°tov`xbDnÐ{E}ZèxNEÞREn[Pv@{~rĆAB§EO¿|UZ~ìUf¨J²ĂÝÆsªB`s¶fvö¦Õ~dÔq¨¸º»uù[[§´sb¤¢zþF¢ÆÀhÂW\\ıËIÝo±ĭŠ£þÊs}¡R]ěDg´VG¢j±®èºÃmpU[Áëº°rÜbNu¸}º¼`niºÔXĄ¤¼ÔdaµÁ_ÃftQQgR·Ǔv}Ý×ĵ]µWc¤F²OĩųãW½¯K©]{LóµCIµ±Mß¿h©āq¬o½~@i~TUxð´Đhw­ÀEîôuĶb[§nWuMÆJl½]vuıµb"]],encodeOffsets:[[[112158,27383],[112105,27474],[112095,27476]]]},properties:{cp:[106.713478,26.578343],name:"贵州",childNum:3}},{id:"530000",geometry:{type:"Polygon",coordinates:["@@[ùx½}ÑRHYīĺûsÍniEoã½Ya²ė{c¬ĝgĂsAØÅwďõzFjw}«Dx¿}Uũlê@HÅ­F¨ÇoJ´Ónũuą¡Ã¢pÒÅØ TF²xa²ËXcÊlHîAßËŁkŻƑŷÉ©hW­æßUËs¡¦}teèÆ¶StÇÇ}Fd£jĈZĆÆ¤Tč\\D}O÷£U§~ŃGåŃDĝ¸Tsd¶¶Bª¤u¢ŌĎo~t¾ÍŶÒtD¦ÚiôözØX²ghįh½Û±¯ÿm·zR¦Ɵ`ªŊÃh¢rOÔ´£Ym¼èêf¯ŪĽncÚbw\\zlvWªâ ¦gmĿBĹ£¢ƹřbĥkǫßeeZkÙIKueT»sVesbaĕ  ¶®dNĄÄpªy¼³BE®lGŭCǶwêżĔÂepÍÀQƞpC¼ŲÈ­AÎô¶RäQ^Øu¬°_Èôc´¹ò¨PÎ¢hlĎ¦´ĦÆ´sâÇŲPnÊD^¯°Upv}®BPÌªjǬxSöwlfòªvqĸ|`H­viļndĜ­Ćhňem·FyÞqóSį¯³X_ĞçêtryvL¤§z¦c¦¥jnŞklD¤øz½ĜàĂŧMÅ|áƆàÊcðÂFÜáŢ¥\\\\ºİøÒÐJĴîD¦zK²ǏÎEh~CD­hMn^ÌöÄ©ČZÀaüfɭyœpį´ěFűk]Ôě¢qlÅĆÙa¶~ÄqêljN¬¼HÊNQ´ê¼VØ¸E^ŃÒyM{JLoÒęæe±Ķygã¯JYÆĭĘëo¥Šo¯hcK«z_prC´ĢÖY¼ v¸¢RÅW³Â§fÇ¸Yi³xR´ďUË`êĿUûuĆBƣöNDH«ĈgÑaB{ÊNF´¬c·Åv}eÇÃGB»If¦HňĕM~[iwjUÁKE¾dĪçWIèÀoÈXòyŞŮÈXâÎŚj|àsRyµÖPr´þ ¸^wþTDŔHr¸RÌmfżÕâCôoxĜƌÆĮÐYtâŦÔ@]ÈǮƒ\\Ī¼Ä£UsÈ¯LbîƲŚºyhr@ĒÔƀÀ²º\\êpJ}ĠvqtĠ@^xÀ£È¨mËÏğ}n¹_¿¢×Y_æpÅA^{½Lu¨GO±Õ½ßM¶wÁĢÛPƢ¼pcĲx|apÌ¬HÐŊSfsðBZ¿©XÏÒKk÷Eû¿SrEFsÕūkóVǥŉiTL¡n{uxţÏhôŝ¬ğōNNJkyPaqÂğ¤K®YxÉƋÁ]āęDqçgOgILu\\_gz]W¼~CÔē]bµogpÑ_oď`´³Țkl`IªºÎȄqÔþ»E³ĎSJ»_f·adÇqÇc¥Á_Źw{L^É±ćxU£µ÷xgĉp»ĆqNē`rĘzaĵĚ¡K½ÊBzyäKXqiWPÏÉ¸½řÍcÊG|µƕƣGË÷k°_^ý|_zċBZocmø¯hhcæ\\lMFlư£ĜÆyHF¨µêÕ]HAàÓ^it `þßäkĤÎT~Wlÿ¨ÔPzUCNVv [jâôDôď[}z¿msSh¯{jïğl}šĹ[őgK©U·µË@¾m_~q¡f¹ÅË^»f³ø}Q¡ÖË³gÍ±^Ç\\ëÃA_¿bWÏ[¶ƛé£F{īZgm@|kHǭƁć¦UĔť×ëǟeċ¼ȡȘÏíBÉ£āĘPªĳ¶ŉÿy©nď£G¹¡I±LÉĺÑdĉÜW¥}gÁ{aqÃ¥aıęÏZÁ`"],encodeOffsets:[[104636,22969]]},properties:{cp:[102.712251,25.040609],name:"云南",childNum:1}},{id:"540000",geometry:{type:"Polygon",coordinates:["@@ÂhľxŖxÒVºÅâAĪÝȆµę¯Ňa±r_w~uSÕňqOj]ɄQ£ZUDûoY»©M[L¼qãË{VÍçWVi]ë©Ä÷àyƛhÚU°adcQ~Mx¥caÛcSyFÖk­uRýq¿ÔµQĽ³aG{¿FµëªéĜÿª@¬·K·àariĕĀ«V»ŶĴūgèLǴŇƶaftèBŚ£^âǐÝ®M¦ÁǞÿ¬LhJ¾óƾÆºcxwf]Y´¦|QLn°adĊ\\¨oǀÍŎ´ĩĀd`tÊQŞŕ|¨C^©Ĉ¦¦ÎJĊ{ëĎjª²rÐl`¼Ą[t|¦Stè¾PÜK¸dƄı]s¤î_v¹ÎVòŦj£Əsc¬_Ğ´|Ł¦Av¦w`ăaÝaa­¢e¤ı²©ªSªÈMĄwÉØŔì@T¤Ę\\õª@þo´­xA sÂtŎKzó²ÇČµ¢r^nĊ­Æ¬×üG¢³ {âĊ]G~bÀgVjzlhǶfOfdªB]pjTOtĊn¤}®¦Č¥d¢¼»ddY¼t¢eȤJ¤}Ǿ¡°§¤AÐlc@ĝsªćļđAçwxUuzEÖġ~AN¹ÄÅȀŻ¦¿ģŁéì±Hãd«g[Ø¼ēÀcīľġ¬cJµÐʥVȝ¸ßS¹ý±ğkƁ¼ą^ɛ¤Ûÿb[}¬ōõÃ]ËNm®g@Bg}ÍF±ǐyL¥íCIĳÏ÷Ñį[¹¦[âšEÛïÁÉdƅß{âNÆāŨß¾ě÷yC£k­´ÓH@Â¹TZ¥¢į·ÌAÐ§®Zcv½Z­¹|ÅWZqgW|ieZÅYVÓqdqbc²R@c¥Rã»GeeƃīQ}J[ÒK¬Ə|oėjġĠÑN¡ð¯EBčnwôɍėª²CλŹġǝʅįĭạ̃ūȹ]ΓͧgšsgȽóϧµǛęgſ¶ҍć`ĘąŌJÞä¤rÅň¥ÖÁUětęuůÞiĊÄÀ\\Æs¦ÓRb|Â^řÌkÄŷ¶½÷f±iMÝ@ĥ°G¬ÃM¥n£Øąğ¯ß§aëbéüÑOčk£{\\eµª×MÉfm«Ƒ{Å×Gŏǩãy³©WÑăû··Qòı}¯ãIéÕÂZ¨īès¶ZÈsæĔTŘvgÌsN@îá¾ó@ÙwU±ÉTå»£TđWxq¹Zobs[×¯cĩvėŧ³BM|¹kªħ¥TzNYnÝßpęrñĠĉRS~½ěVVµõ«M££µBĉ¥áºae~³AuĐh`Ü³ç@BÛïĿa©|z²Ý¼D£àč²ŸIûI āóK¥}rÝ_Á´éMaň¨~ªSĈ½½KÙóĿeƃÆB·¬ën×W|Uº}LJrƳlŒµ`bÔ`QÐÓ@s¬ñIÍ@ûws¡åQÑßÁ`ŋĴ{ĪTÚÅTSÄ³Yo|Ç[Ç¾µMW¢ĭiÕØ¿@MhpÕ]jéò¿OƇĆƇpêĉâlØwěsǩĵ¸cbU¹ř¨WavquSMzeo_^gsÏ·¥Ó@~¯¿RiīB\\qTGªÇĜçPoÿfñòą¦óQīÈáPābß{ZŗĸIæÅhnszÁCËìñÏ·ąĚÝUm®ó­L·ăUÈíoù´Êj°ŁŤ_uµ^°ìÇ@tĶĒ¡ÆM³Ģ«İĨÅ®ğRāðggheÆ¢zÊ©Ô\\°ÝĎz~ź¤PnMĪÖB£kné§żćĆKĒ°¼L¶èâz¨u¦¥LDĘz¬ýÎmĘd¾ßFzhg²Fy¦ĝ¤ċņbÎ@yĄæm°NĮZRÖíJ²öLĸÒ¨Y®ƌÐVàtt_ÚÂyĠz]ŢhzĎ{ÂĢXc|ÐqfO¢¤ögÌHNPKŖUú´xx[xvĐCûĀìÖT¬¸^}Ìsòd´_KgžLĴÀBon|H@Êx¦BpŰŌ¿fµƌA¾zǈRx¶FkĄźRzŀ~¶[´HnªVƞuĒ­È¨ƎcƽÌm¸ÁÈM¦x͊ëÀxǆBú^´W£dkɾĬpw˂ØɦļĬIŚÊnŔa¸~J°îlɌxĤÊÈðhÌ®gT´øàCÀ^ªerrƘd¢İP|Ė ŸWªĦ^¶´ÂLaT±üWƜǀRÂŶUńĖ[QhlLüAÜ\\qRĄ©"],encodeOffsets:[[90849,37210]]},properties:{cp:[91.132212,29.660361],name:"西藏",childNum:1}},{id:"610000",geometry:{type:"Polygon",coordinates:["@@¸ÂW¢xR­Fq§uF@N¢XLRMº[ğȣſï|¥Jkc`sŉǷ£Y³WN«ùMëï³ÛIg÷±mTșÚÒķø©þ¥yÓğęmWµÎumZyOŅƟĥÓ~sÑL¤µaÅY¦ocyZ{y c]{Ta©`U_Ěē£ωÊƍKùK¶ȱÝƷ§{û»ÅÁȹÍéuĳ|¹cÑdìUYOuFÕÈYvÁCqÓTǢí§·S¹NgV¬ë÷Át°DØ¯C´ŉƒópģ}ąiEËFéGU¥×K§­¶³BČ}C¿åċ`wġB·¤őcƭ²ő[Å^axwQOñJÙïŚĤNĔwƇÄńwĪ­o[_KÓª³ÙnKÇěÿ]ďă_d©·©Ýŏ°Ù®g]±ß×¥¬÷m\\iaǑkěX{¢|ZKlçhLtŇîŵœè[É@ƉĄEtƇÏ³­ħZ«mJ×¾MtÝĦ£IwÄå\\Õ{OwĬ©LÙ³ÙTª¿^¦rÌĢŭO¥lãyC§HÍ£ßEñX¡­°ÙCgpťzb`wIvA|¥hoĕ@E±iYd¥OÿµÇvPW|mCĴŜǂÒW¶¸AĜh^Wx{@¬­F¸¡ķn£P|ªĴ@^ĠĈæbÔc¶lYi^MicĎ°Â[ävï¶gv@ÀĬ·lJ¸sn|¼u~a]ÆÈtŌºJpþ£KKf~¦UbyäIĺãnÔ¿^­ŵMThĠÜ¤ko¼Ŏìąǜh`[tRd²Ĳ_XPrɲlXiL§à¹H°Ȧqº®QCbAŌJ¸ĕÚ³ĺ§ `d¨YjiZvRĺ±öVKkjGȊÄePĞZmļKÀ[`ösìhïÎoĬdtKÞ{¬èÒÒBÔpĲÇĬJŊ¦±J«[©ārHµàåVKe§|P²ÇÓ·vUzgnN¾yI@oHĆÛķhxen¡QQ±ƝJǖRbzy¸ËÐl¼EºpĤ¼x¼½~Ğà@ÚüdK^mÌSjp²ȮµûGĦ}Ħðǚ¶òƄjɂz°{ºØkÈęâ¦jªBg\\ċ°s¬]jú EȌǆ¬stRÆdĠİwÜ¸ôW¾ƮłÒ_{Ìû¼jº¹¢GǪÒ¯ĘZ`ºŊecņą~BÂgzpâēòYƲȐĎ"],encodeOffsets:[[113634,40474]]},properties:{cp:[108.948024,34.263161],name:"陕西",childNum:1}},{id:"620000",geometry:{type:"MultiPolygon",coordinates:[["@@Vu_^","@@ųEĠtt~nkh`Q¦ÅÄÜdwAb×ĠąJ¤DüègĺqBqj°lI¡Ĩ¶ĖIHdjÎB°aZ¢KJO[|A£Dx}NĂ¬HUnrk kp¼Y kMJn[aGáÚÏ[½rc}aQxOgsPMnUsncZsKúvAtÞġ£®ĀYKdnFw¢JE°Latf`¼h¬we|Æbj}GA·~W`¢MC¤tL©Ĳ°qdfObÞĬ¹ttu`^ZúE`[@Æsîz®¡CƳƜG²R¢RmfwĸgÜą G@pzJM½mhVy¸uÈÔO±¨{LfæU¶ßGĂq\\ª¬²I¥IŉÈīoıÓÑAçÑ|«LÝcspīðÍgtë_õ\\ĉñLYnĝgRǡÁiHLlõUĹ²uQjYi§Z_c¨´ĹĖÙ·ŋIaBD­R¹ȥr¯GºßK¨jWkɱOqWĳ\\a­Q\\sg_ĆǛōëp»£lğÛgSŶN®À]ÓämĹãJaz¥V}Le¤Lýo¹IsŋÅÇ^bz³tmEÁ´a¹cčecÇNĊãÁ\\č¯dNj]jZµkÓdaćå]ğĳ@ ©O{¤ĸm¢E·®«|@Xwg]Aģ±¯XǁÑǳªcwQÚŝñsÕ³ÛV_ý¥\\ů¥©¾÷w©WÕÊĩhÿÖÁRo¸V¬âDb¨hûxÊ×ǌ~Zâg|XÁnßYoº§ZÅŘv[ĭÖʃuďxcVbnUSfB¯³_TzºÎO©çMÑ~M³]µ^püµÄY~y@X~¤Z³[Èōl@®Å¼£QK·Di¡ByÿQ_´D¥hŗy^ĭÁZ]cIzýah¹MĪğPs{ò²Vw¹t³ŜË[Ñ}X\\gsF£sPAgěp×ëfYHāďÖqēŭOÏëdLü\\it^c®RÊº¶¢H°mrY£B¹čIoľu¶uI]vģSQ{UŻÅ}QÂ|Ì°ƅ¤ĩŪU ęĄÌZÒ\\v²PĔ»ƢNHĂyAmƂwVm`]ÈbH`Ì¢²ILvĜH®¤Dlt_¢JJÄämèÔDëþgºƫaʎÌrêYi~ Îİ¤NpÀA¾Ĕ¼bð÷®üszMzÖĖQdȨýv§Tè|ªHÃ¾a¸|Ð ƒwKĢx¦ivr^ÿ ¸l öæfƟĴ·PJv}n\\h¹¶v·À|\\ƁĚN´ĜçèÁz]ġ¤²¨QÒŨTIlªťØ}¼˗ƦvÄùØEÂ«FïËIqōTvāÜŏíÛßÛVj³âwGăÂíNOPìyV³ŉĖýZso§HÑiYw[ß\\X¦¥c]ÔƩÜ·«jÐqvÁ¦m^ċ±R¦΋ƈťĚgÀ»IïĨʗƮ°ƝĻþÍAƉſ±tÍEÕÞāNUÍ¡\\ſčåÒʻĘm ƭÌŹöʥëQ¤µ­ÇcƕªoIýIÉ_mkl³ăƓ¦j¡YzŇi}Msßõīʋ }ÁVm_[n}eı­Uĥ¼ªI{Î§DÓƻėojqYhĹT©oūĶ£]ďxĩǑMĝq`B´ƃ˺Чç~²ņj@¥@đ´ί}ĥtPńÇ¾V¬ufÓÉCtÓ̻¹£G³]ƖƾŎĪŪĘ̖¨ʈĢƂlɘ۪üºňUðǜȢƢż̌ȦǼĤŊɲĖÂ­KqĘŉ¼ĔǲņɾªǀÞĈĂD½ĄĎÌŗĞrôñnN¼â¾ʄľԆ|Ǆ֦ज़ȗǉ̘̭ɺƅêgV̍ʆĠ·ÌĊv|ýĖÕWĊǎÞ´õ¼cÒÒBĢ͢UĜð͒s¨ňƃLĉÕÝ@ɛƯ÷¿Ľ­ĹeȏĳëCȚDŲyê×Ŗyò¯ļcÂßYtÁƤyAã˾J@ǝrý@¤rz¸oP¹ɐÚyáHĀ[JwcVeȴÏ»ÈĖ}ƒŰŐèȭǢόĀƪÈŶë;Ñ̆ȤМľĮEŔĹŊũ~ËUă{ĻƹɁύȩþĽvĽƓÉ@ēĽɲßǐƫʾǗĒpäWÐxnsÀ^ƆwW©¦cÅ¡Ji§vúF¶¨c~c¼īeXǚ\\đ¾JwÀďksãAfÕ¦L}waoZD½Ml«]eÒÅaÉ²áo½FõÛ]ĻÒ¡wYR£¢rvÓ®y®LFLzĈôe]gx}|KK}xklL]c¦£fRtív¦PŨ£","@@M T¥"]],encodeOffsets:[[[108619,36299],[108594,36341],[108600,36306]]]},properties:{cp:[103.823557,36.058039],name:"甘肃",childNum:3}},{id:"630000",geometry:{type:"MultiPolygon",coordinates:[["@@InJo","@@CÆ½OŃĦsΰ~Ē³¦@@Ņi±è}ШƄ˹A³r_ĞǒNĪĐw¤^ŬĵªpĺSZgrpiƼĘÔ¨C|ÍJ©Ħ»®VĲ~f\\m `UnÂ~ʌĬàöNt~ňjy¢ZiƔ¥Ąk´nl`JÊJþ©pdƖ®È£¶ìRʦźõƮËnʼėæÑƀĎ[¢VÎĂMÖÝÎF²sƊƀÎBļýƞ¯ʘƭðħ¼Jh¿ŦęΌƇ¥²Q]Č¥nuÂÏri¸¬ƪÛ^Ó¦d¥[Wàx\\ZjÒ¨GtpþYŊĕ´zUOëPîMĄÁxH´áiÜUàîÜŐĂÛSuŎrJðÌ¬EFÁú×uÃÎkrĒ{V}İ«O_ÌËĬ©ÓŧSRÑ±§Ģ£^ÂyèçěM³Ƃę{[¸¿uºµ[gt£¸OƤĿéYõ·kĀq]juw¥DĩƍõÇPéÄ½G©ã¤GuȧþRcÕĕNyyût­øï»a½ē¿BMoį£Íj}éZËqbʍƬh¹ìÿÓAçãnIÃ¡I`ks£CG­ěUy×Cy@¶ʡÊBnāzGơMē¼±O÷õJËĚăVĪũƆ£¯{ËL½ÌzżVR|ĠTbuvJvµhĻĖHAëáa­OÇðñęNwœľ·LmI±íĠĩPÉ×®ÿscB³±JKßĊ«`ađ»·QAmOVţéÿ¤¹SQt]]Çx±¯A@ĉĳ¢Óļ©l¶ÅÛrŕspãRk~¦ª]Į­´FRåd­ČsCqđéFn¿ÅƃmÉx{W©ºƝºįkÕƂƑ¸wWūÐ©ÈF£\\tÈ¥ÄRÈýÌJ lGr^×äùyÞ³fjc¨£ÂZ|ǓMĝÏ@ëÜőRĝ÷¡{aïȷPu°ËXÙ{©TmĠ}Y³­ÞIňµç½©C¡į÷¯B»|St»]vųs»}MÓ ÿʪƟǭA¡fs»PY¼c¡»¦cċ­¥£~msĉPSi^o©AecPeǵkgyUi¿h}aHĉ^|á´¡HØûÅ«ĉ®]m¡qċ¶±ÈyôōLÁstB®wn±ă¥HSòė£Së@×œÊăxÇN©©T±ª£Ĳ¡fb®Þbb_Ą¥xu¥B{łĝ³«`dƐt¤ťiñÍUuºí`£^tƃĲc·ÛLO½sç¥Ts{ă\\_»kÏ±q©čiìĉ|ÍI¥ć¥]ª§D{ŝŖÉR_sÿc³ĪōƿÎ§p[ĉc¯bKmR¥{³Ze^wx¹dƽÅ½ôIg §Mĕ ƹĴ¿ǣÜÍ]Ý]snåA{eƭ`ǻŊĿ\\ĳŬűYÂÿ¬jĖqßb¸L«¸©@ěĀ©ê¶ìÀEH|´bRľÓ¶rÀQþvl®ÕETzÜdb hw¤{LRdcb¯ÙVgƜßzÃôì®^jUèXÎ|UäÌ»rK\\ªN¼pZCüVY¤ɃRi^rPŇTÖ}|br°qňbĚ°ªiƶGQ¾²x¦PmlŜ[Ĥ¡ΞsĦÔÏâ\\ªÚŒU\\f¢N²§x|¤§xĔsZPòʛ²SÐqF`ªVÞŜĶƨVZÌL`¢dŐIqr\\oäõFÎ·¤»Ŷ×h¹]ClÙ\\¦ďÌį¬řtTӺƙgQÇÓHţĒ´ÃbEÄlbʔC|CŮkƮ[ʼ¬ň´KŮÈΰÌĪ¶ƶlðļATUvdTGº̼ÔsÊDÔveMg"]],encodeOffsets:[[[105308,37219],[95370,40081]]]},properties:{cp:[101.778916,36.623178],name:"青海",childNum:2}},{id:"640000",geometry:{type:"Polygon",coordinates:["@@KëÀęĞ«Oęȿȕı]ŉ¡åįÕÔ«ǴõƪĚQÐZhv K°öqÀÑS[ÃÖHƖčËnL]ûcÙß@ĝ¾}w»»oģF¹»kÌÏ·{zP§B­¢íyÅt@@á]Yv_ssģ¼ißĻL¾ġsKD£¡N_X¸}B~HaiÅf{«x»ge_bsKF¯¡IxmELcÿZ¤­ĢÝsuBLùtYdmVtNmtOPhRw~bd¾qÐ\\âÙH\\bImlNZ»loqlVmGā§~QCw¤{A\\PKNY¯bFkC¥sks_Ã\\ă«¢ħkJi¯rrAhĹûç£CUĕĊ_ÔBixÅÙĄnªÑaM~ħpOu¥sîeQ¥¤^dkKwlL~{L~hw^ófćKyE­K­zuÔ¡qQ¤xZÑ¢^ļöÜ¾Ep±âbÊÑÆ^fk¬NC¾YpxbK~¥eÖäBlt¿Đx½I[ĒǙWf»Ĭ}d§dµùEuj¨IÆ¢¥dXªƅx¿]mtÏwßRĶX¢͎vÆzƂZò®ǢÌʆCrâºMÞzÆMÒÊÓŊZÄ¾r°Î®Ȉmª²ĈUªĚîøºĮ¦ÌĘk^FłĬhĚiĀĖ¾iİbjË"],encodeOffsets:[[109366,40242]]},properties:{cp:[106.278179,38.46637],name:"宁夏",childNum:1}},{id:"650000",geometry:{type:"Polygon",coordinates:["@@QØĔ²X¨~ǘBºjʐßØvKƔX¨vĊOÃ·¢i@~cĝe_«E}QxgɪëÏÃ@sÅyXoŖ{ô«ŸuXêÎf`C¹ÂÿÐGĮÕĞXŪōŸMźÈƺQèĽôe|¿ƸJR¤ĘEjcUóº¯Ĩ_ŘÁMª÷Ð¥OéÈ¿ÖğǤǷÂFÒzÉx[]­Ĥĝœ¦EP}ûƥé¿İƷTėƫœŕƅƱB»Đ±ēO¦E}`cȺrĦáŖuÒª«ĲπdƺÏØZƴwʄ¤ĖGĐǂZĶèH¶}ÚZצʥĪï|ÇĦMŔ»İĝǈì¥Βba­¯¥ǕǚkĆŵĦɑĺƯxūД̵nơʃĽá½M»òmqóŘĝčË¾ăCćāƿÝɽ©ǱŅ»ēėŊLrÁ®ɱĕģŉǻ̋ȥơŻǛȡVï¹Ň۩ûkɗġƁ§ʇė̕ĩũƽō^ƕUv£ƁQïƵkŏ½ΉÃŭÇ³LŇʻ«ƭ\\lŭD{ʓDkaFÃÄa³ŤđÔGRÈƚhSӹŚsİ«ĐË[¥ÚDkº^Øg¼ŵ¸£EÍöůŉT¡c_ËKYƧUśĵÝU_©rETÏʜ±OñtYwē¨{£¨uM³x½şL©Ùá[ÓÐĥ Νtģ¢\\śnkOw¥±T»ƷFɯàĩÞáB¹ÆÑUwŕĽw]kE½Èå~Æ÷QyěCFmĭZīŵVÁƿQƛûXS²b½KÏ½ĉS©ŷXĕ{ĕK·¥Ɨcqq©f¿]ßDõU³h­gËÇïģÉɋwk¯í}I·œbmÉřīJɥĻˁ×xoɹīlc¤³Xù]ǅA¿w͉ì¥wÇN·ÂËnƾƍdÇ§đ®ƝvUm©³G\\}µĿQyŹlăµEwǇQ½yƋBe¶ŋÀůo¥AÉw@{Gpm¿AĳŽKLh³`ñcËtW±»ÕSëüÿďDu\\wwwù³VLŕOMËGh£õP¡erÏd{ġWÁč|yšg^ğyÁzÙs`s|ÉåªÇ}m¢Ń¨`x¥ù^}Ì¥H«YªƅAÐ¹n~ź¯f¤áÀzgÇDIÔ´AňĀÒ¶ûEYospõD[{ù°]uJqU|Soċxţ[õÔĥkŋÞŭZËºóYËüċrw ÞkrťË¿XGÉbřaDü·Ē÷AÃª[ÄäIÂ®BÕĐÞ_¢āĠpÛÄȉĖġDKwbmÄNôfƫVÉviǳHQµâFù­Âœ³¦{YGd¢ĚÜO {Ö¦ÞÍÀP^bƾl[vt×ĈÍEË¨¡Đ~´î¸ùÎhuè`¸HÕŔVºwĠââWò@{ÙNÝ´ə²ȕn{¿¥{l÷eé^eďXj©î\\ªÑòÜìc\\üqÕ[Č¡xoÂċªbØ­ø|¶ȴZdÆÂońéG\\¼C°ÌÆn´nxÊOĨŪƴĸ¢¸òTxÊǪMīĞÖŲÃɎOvʦƢ~FRěò¿ġ~åŊúN¸qĘ[Ĕ¶ÂćnÒPĒÜvúĀÊbÖ{Äî¸~Ŕünp¤ÂH¾ĄYÒ©ÊfºmÔĘcDoĬMŬS¤s²ʘÚžȂVŦ èW°ªB|ĲXŔþÈJĦÆæFĚêYĂªĂ]øªŖNÞüAfɨJ¯ÎrDDĤ`mz\\§~D¬{vJÂ«lµĂb¤pŌŰNĄ¨ĊXW|ų ¿¾ɄĦƐMTòP÷fØĶK¢ȝ˔Sô¹òEð­`Ɩ½ǒÂň×äı§ĤƝ§C~¡hlåǺŦŞkâ~}FøàĲaĞfƠ¥Ŕd®U¸źXv¢aƆúŪtŠųƠjdƺƺÅìnrh\\ĺ¯äɝĦ]èpĄ¦´LƞĬ´ƤǬ˼Ēɸ¤rºǼ²¨zÌPðŀbþ¹ļD¢¹\\ĜÑŚ¶ZƄ³âjĦoâȴLÊȮĐ­ĚăÀêZǚŐ¤qȂ\\L¢ŌİfÆs|zºeªÙæ§΢{Ā´ƐÚ¬¨Ĵà²łhʺKÞºÖTiƢ¾ªì°`öøu®Ê¾ãÖ"],encodeOffsets:[[88824,50096]]},properties:{cp:[87.617733,43.792818],name:"新疆",childNum:1}},{id:"110000",geometry:{type:"Polygon",coordinates:["@@RºaYÕQaúÍÔiþĩȨWĢü|Ėu[qb[swP@ÅğP¿{\\¯Y²·Ñ¨j¯X\\¯MSvU¯YIŕY{[fk­VÁûtŷmiÍt_H»Ĩ±d`¹­{bwYr³S]§§o¹qGtm_SŧoaFLgQN_dV@Zom_ć\\ßW´ÕiœRcfio§ËgToÛJíĔóu|wP¤XnO¢ÉŦ¯pNÄā¤zâŖÈRpŢZÚ{GrFt¦Òx§ø¹RóäV¤XdżâºWbwŚ¨Ud®bêņ¾jnŎGŃŶnzÚScîĚZen¬"],encodeOffsets:[[119421,42013]]},properties:{cp:[116.405285,39.904989],name:"北京",childNum:1}},{id:"120000",geometry:{type:"Polygon",coordinates:["@@ŬgX§Ü«E¶FÌ¬O_ïlÁgz±AXeµÄĵ{¶]gitgIj·¥ì_iU¨ÐƎk}ĕ{gBqGf{¿aU^fIư³õ{YıëNĿk©ïËZukāAīlĕĥs¡bġ«@dekąI[nlPqCnp{ō³°`{PNdƗqSÄĻNNâyj]äÒD ĬH°Æ]~¡HO¾X}ÐxgpgWrDGpù^LrzWxZ^¨´T\\|~@IzbĤjeĊªz£®ĔvěLmV¾Ô_ÈNW~zbĬvG²ZmDM~~"],encodeOffsets:[[120237,41215]]},properties:{cp:[117.190182,39.125596],name:"天津",childNum:1}},{id:"310000",geometry:{type:"MultiPolygon",coordinates:[["@@ɧư¬EpƸÁx]","@@©²","@@MA","@@QpªKWT§¨","@@bŝÕÕEȣÚƥêImɇǦèÜĠÚÄÓŴ·ʌÇ","@@Sô¤r]ìƬįǜûȬɋŭ×^sYɍDŋŽąñCG²«ªč@h_p¯A{oloY¬j@Ĳ`gQÚpptǀ^MĲvtbe´Rh@oj¨","@@ÆLH{a}Eo¦"]],encodeOffsets:[[[124702,32062],[124547,32200],[124808,31991],[124726,32110],[124903,32376],[124065,32166],[124870,31965]]]},properties:{cp:[121.472644,31.231706],name:"上海",childNum:7}},{id:"500000",geometry:{type:"Polygon",coordinates:["@@TÂÛ`Ùƅően½SêqDu[RåÍ¹÷eXÍy¸_ĺę}÷`M¯ċfCVµqŉ÷Zgg^d½pDOÎCn^uf²ènh¼WtƏxRGg¦pVFI±G^Ic´ecGĹÞ½sëÆNäÌ¤KÓe¯|R¸§LÜkPoïƭNï¶}Gywdiù©nkĈzj@Óc£»Wă¹Óf§c[µo·Ó|MvÛaq½«è\\ÂoVnÓØÍ²«bq¿ehCĜ^Q~ Évýş¤²ĮpEĶyhsŊwH½¿gÅ¡ýE¡ya£³t\\¨\\vú¹¼©·Ñr_oÒý¥et³]Et©uÖ¥±ă©KVeë]}wVPÀFA¨ąB}qTjgRemfFmQFÝMyùnÑAmÑCawu_p¯sfÛ_gI_pNysB¦zG¸rHeN\\CvEsÐñÚkcDÖĉsaQ¯}_UzÁē}^R Äd^ÍĸZ¾·¶`wećJE¹vÛ·HgéFXjÉê`|ypxkAwWĐpb¥eOsmzwqChóUQl¥F^lafanòsrEvfQdÁUVfÎvÜ^eftET¬ôA\\¢sJnQTjPØxøK|nBzĞ»LYFDxÓvr[ehľvN¢o¾NiÂxGpâ¬zbfZo~hGi]öF||NbtOMn eA±tPTLjpYQ|SHYĀxinzDJÌg¢và¥Pg_ÇzIIII£®S¬ØsÎ¼¥¨^LnGĲļĲƤjÎƀƾ¹¸ØÎezĆT¸}êÐqHðqĖä¥^CÆIj²p\\_ æüY|[YxƊæu°xb®Űb@~¢NQt°¶Sæ Ê~rǉĔëĚ¢~uf`faĔJåĊnÔ]jƎćÊ@£¾a®£Ű{ŶĕFègLk{Y|¡ĜWƔtƬJÑxq±ĢN´òKLÈÃ¼D|s`ŋć]Ã`đMùƱ¿~Y°ħ`ƏíW½eI½{aOIrÏ¡ĕŇapµÜƃġ²"],encodeOffsets:[[111728,31311]]},properties:{cp:[106.504962,29.533155],name:"重庆",childNum:1}},{id:"810000",geometry:{type:"MultiPolygon",coordinates:[["@@AlFi","@@mp","@@EpHo","@@rMUwAS¬]","@@ea¢pl¸Eõ¹hj[]ÔCÎ@lj¡uBX´AI¹[yDU]W`çwZkmcMpÅv}IoJlcafŃK°ä¬XJmÐ đhI®æÔtSHnEÒrÄc"]],encodeOffsets:[[[117111,23002],[117072,22876],[117045,22887],[116882,22747],[116975,23082]]]},properties:{cp:[114.173355,22.320048],name:"香港",childNum:5}},{id:"820000",geometry:{type:"Polygon",coordinates:["@@áw{Îr"],encodeOffsets:[[116285,22746]]},properties:{cp:[113.54909,22.198951],name:"澳门",childNum:1}}],UTF8Encoding:true})});+function(){"use strict";angular.module("eweiApp.chart").controller("ChartServiceReportController",e);e.$inject=["$scope","$state","$http","$modal_","coreModelService","coreNotifyService","apiServiceReportService","ngTableParams","alertService"];function e(a,i,e,r,t,n,s,o,l){var c=n.constant.EVENT_LIST_TEMPLATES;var u=this.__proto__.constructor.name+"_"+Date.now();var d={_page:1,_count:48};var f;a.show="template";var p=function(){n.register(u,c,function(e){v()})};var m=function(){a.templates=t.detail.templates.gets(t.list.templates.gets(d._page));a.params={page:d._page,total:t.list.templates.total(),count:a.templates.length}};a.page=function(e){if(e){if(a.show=="userList"){if(D._page!=e){D._page=e;y()}}else{if(d._page!=e){d._page=e;v()}}}};var h=function(){n.doNotify(n.constant.EVENT_LIST_DATA_LOADING,{typeKey:c,isLoading:true});s.run(c,d._page,"",d,function(e){n.doNotify(n.constant.EVENT_LIST_DATA_LOADING,{typeKey:c,isLoading:false})})};var v=function(){m();if(JSON.stringify(d)!=JSON.stringify(f)){h();f=angular.copy(d)}};var g=function(){p();v()};g();a.$on("$destroy",function(){n.unRegister(u)});a.deleteTemlate=function(e){a._messages="确定从报告模板中删除？";var t=r({scope:a,title:"删除确认",contentTemplate:"source/views/alter_common.html",html:true,show:true,placement:"center"});a.$ok=function(){a.isLoading=true;s.deleteTemplete(c,{},{reportTemplateId:e.id},function(e){if(angular.isDefined(e.status)&&e.status==0){l.add("删除成功","success");a.isLoading=false;h();t.$promise.then(t.hide)}else{a.isLoading=false;l.add("删除失败","danger")}})};a.$hide=function(){t.$promise.then(t.hide)}};a.dropdownMenu=[{name:"客户组",type:"userGroup"},{name:"客户",type:"customer"}];a.select=a.dropdownMenu[0];a.choose=function(e){a.select=e};a.user={};var D={_page:1,_count:48,_fields:"",_filter:"",_asc:"",_desc:"createdAt",searchType:"advancedQuery",advancedQueryCondition:"",searchKey:""};a.searchUsers=function(){if(!a.searchKey){l.add("请输入名字或名称，查找客户","danger");return}a.show="userList";if(a.searchKey!=a.oldSearchKey||a.select.type!=a.oldSelectType){D._page=1;y();a.oldSearchKey=angular.copy(a.searchKey);a.oldSelectType=angular.copy(a.select.type)}};a.enterSearch=function(e){if(e.keyCode==13){a.searchUsers()}};var y=function(){D._fields=a.select.type=="customer"?"id,name,userGroup.name":"id,name";D._filter=a.select.type=="customer"?'{"$and":[{"$eq":{"valid":true}},{"$eq":{"type":"customer"}}]}':"";D.advancedQueryCondition='{"name":"'+a.searchKey+'"}';s.search(a.select.type,D,{},function(e){if(angular.isDefined(e.status)&&e.status==0){a.user.type=angular.copy(a.select.type);a.user.list=a.select.type=="customer"?e.result.customers:e.result.userGroups;a.user._total=e.result._total;a.userParams={page:D._page,total:e.result._total,count:D._count}}})};a.configs=[{type:"month",name:"月度报告",active:true,listName:"month",list:[{name:" 上一个日历月",value:"1"},{name:" 从今日起前30天",value:"2"},{name:" 从昨日起前30天",value:"3"}]},{type:"season",name:"季度报告",active:false,listName:"season",list:[{name:" 上3个日历月",value:"1"},{name:" 从今日起前3个月",value:"2"},{name:" 从昨日起前3个月",value:"3"}]},{type:"year",name:"年度报告",active:false,listName:"year",list:[{name:" 上个自然年",value:"1"},{name:" 本自然年以来至今天",value:"2"},{name:" 从昨日起前1年",value:"3"}]},{type:"week",name:"周报告",active:false,listName:"week",list:[{name:" 上一周",value:"1"},{name:" 从今天起前7天",value:"2"},{name:" 从昨天起前7天",value:"3"}]}];a.settingTemplate=function(){if(a.show=="setting"){return false}a.oldShow=angular.copy(a.show);a.show="setting";s.getReportConfig("",{},{},function(t){if(angular.isDefined(t.status)&&t.status==0&&t.result.config){a.config=t.result.config;if(t.result.config.type&&t.result.config.value){angular.forEach(a.configs,function(e){if(e.type==t.result.config.type){e.active=true;e.value=t.result.config.value}else{e.active=false}})}else{a.configs[0].active=true;a.configs[0].value="1"}}void 0})};a.selectConfig=function(t){angular.forEach(a.configs,function(e){if(t.type==e.type){e.active=true;if(!e.value){e.value="1"}}else{e.active=false}})};a.save=function(){angular.forEach(a.configs,function(e){if(e.active){a.config.type=e.type;a.config.value=e.value}else{e.value="1"}});s.saveReportConfig("",{},{id:a.config.id?a.config.id:null,type:a.config.type,value:a.config.value},function(e){if(angular.isDefined(e.status)&&e.status==0){l.add("保存成功","success");if(a.oldShow){a.show=angular.copy(a.oldShow)}}else{l.add("保存失败","danger")}})};a.cancel=function(){a.show=angular.copy(a.oldShow)};a.goDetail=function(e,t){i.go("chart.serviceReportDetail",{type:e,id:t.id});a.show="redirect";void 0;if(e=="template"){a.userName=t.type=="customer"?t.user&&t.user.name?t.user.name:"未知模板":t.userGroup&&t.userGroup.name?t.userGroup.name:"未知模板"}else{a.userName=t.name}}}}();+function(){"use strict";angular.module("eweiApp.chart").controller("ChartServiceReportDetailController",e);e.$inject=["$scope","$http","$filter","$state","$stateParams","apiRestfulService","reportData","alertService","ConsoleConfig"];function e(e,n,t,a,i,r,s,o,l){var c=this;if(!s){a.go("chart.serviceReport");return}c.currentUser=l.user;c.reportDate=new Date;c.data=s;if(c.data){f();u();d();c.email=c.data.template.emails}c.beginTime=s.beginTime;c.endTime=s.endTime;if(s.template&&s.template.intro){c.intro=s.template.intro}c.showEmailInput=false;c.showEmailInputForm=function(){c.showEmailInput=true};c.hideEmailInputForm=function(){c.showEmailInput=false};c.editIntro=function(){c.introEditMode=true;c.intro=c.data.template.intro};c.saveIntro=function(){c.introEditMode=false;c.data.template.intro=c.intro};c.cancelEditIntro=function(){c.introEditMode=false};c.deleteIntro=function(){delete c.data.template.intro};c.loadUsers=function(e){if(angular.isObject(e))return;var t=e;if(e&&e.indexOf(",")>-1){var a=e.split(/[,;,；\s]+/gi);if(a&&a.length>1){t=a[a.length-1]}}var i=0;if(c.userGroupId){i=c.userGroupId}if(!t){return[]}var r="/api/v1/engineer_customer_simple_list.json?queryUserType=&key="+t;if(!c.excludeusergroup){r+="&userGroupId="+i}if(c.data.template.user&&c.data.template.user.id){r+="&userId="+c.data.template.user.id}return n.get(r,{}).then(function(e){var t=e.data;var a=[];var i=angular.isDefined(t.result.users)?t.result.users:[];i=_.filter(i,function(e){return e&&!!e.email});angular.forEach(i,function(e){a.push({id:e.id,name:e.name+"("+e.email+")",email:e.email})});return a})};c.updateEmails=function(e){c.data.template.emails=e};c.templateSaving=false;c.saveTemplate=function(){if(c.templateSaving)return;if(c.data.template.emails&&c.data.template.emails.length>500){o.add("Email太多，请减少Email数量。","danger");return}var e=r.run({url:"/api/v1/service_report/save_report_template.json",urlParam:null,dataParam:c.data.template});c.templateSaving=true;e.post(c.data.template,function(e){if(e&&e.status==0&&e.result&&e.result.id){c.data.template.id=e.result.id;o.add("模板保存成功！")}c.templateSaving=false},function(){c.templateSaving=false;void 0})};c.loadReport=function(){c.loading=true;var e=r.run({url:"/api/v1/service_report/show_report.json",urlParam:{type:i.type,targetId:i.id,beginTime:c.beginTime,endTime:c.endTime}});e.get(null,function(e){c.loading=false;if(e.status==0){c.data=e.result;u();d();f();c.email=c.data.template.emails}else{o.add(e.result.errorDescription+"，请重试！","danger");void 0}},function(e){c.loading=false;void 0;o.add("获取服务报告数据失败!请重试.","danger")})};function u(){var a={0:{name:"普通工单（不符合或未订立SLA协议）",slaGroup:false,tickets:[]}};c.data.tickets.forEach(function(e){var t;if(e.slaId&&e.slaName){if(!a.hasOwnProperty(e.slaId)){a[e.slaId]={name:"SLA："+e.slaName,slaGroup:true,qualified:0,tickets:[]}}t=a[e.slaId];if(e.qualified==1){t.qualified++}t.tickets.push(e)}else{t=a[0];t.tickets.push(e)}});c.data.slas=[];for(var e in a){if(a[e].slaGroup){a[e].finishSlaRate=Math.floor(a[e].qualified/a[e].tickets.length*100)+"%";c.data.slas.push(a[e])}}if(a[0].tickets.length>0){c.data.slas.push(a[0])}}function d(){if(c.data.report){c.data.report.solveRate=Math.floor(c.data.report.solveRate*100)+"%";c.data.report.evaluateRate=Math.floor(c.data.report.evaluateRate*100)+"%";c.data.report.finishSlaRate=Math.floor(c.data.report.finishSlaRate*100)+"%";c.data.report.happyRate=Math.floor(c.data.report.happyRate*100)+"%"}}function f(){var e=i.type;if((!e||e=="template")&&c.data&&c.data.template){e=c.data.template.type}switch(e){case"customer":{c.data.template.title=c.data.template.user.name;if(c.data.template&&c.data.template.user&&c.data.template.user.userGroup){c.userGroupId=c.data.template.user.userGroup.id}break}case"userGroup":{c.data.template.title=c.data.template.userGroup.name;if(c.data.template&&c.data.template.userGroup){c.userGroupId=c.data.template.userGroup.id}break}}}c.reloadReport=function(){var e=/2\d{3}\-\d{1,2}\-\d{1,2}/gi;if(c.beginTime==null||c.beginTime==""||!e.test(c.beginTime)){return o.add("开始日期格式不正确，请重新选择！","danger")}e.lastIndex=0;if(c.endTime==null||c.endTime==""||!e.test(c.endTime)){return o.add("结束日期格式不正确，请重新选择！","danger")}if(c.beginTime!=c.data.beginTime||c.endTime!=c.data.endTime){c.loadReport()}c.dateRangeEditMode=false};c.downloading=false;c.download=function(){if(c.downloading)return;c.downloading=true;var e=$("#speaker_form");$("input[name=data]",e).val(JSON.stringify({beginTime:t("date")(c.data.beginTime,"yyyy年MM月dd日"),endTime:t("date")(c.data.endTime,"yyyy年MM月dd日"),customer:c.data.template.title,preface:c.data.template.intro,report:c.data.report,slas:c.data.slas}));e.submit();c.downloading=false};function p(){if(!c.data.template.emails){o.add("请输入Email","danger");return false}if(c.data.template.emails&&c.data.template.emails.length>500){o.add("Email太多，请减少Email数量。","danger");return false}return true}c.sending=false;c.sendEmail=function(){if(c.sending)return;if(!p()){return}var e=c.data.template.emails.split(/[,;\s]+/g);e=_.filter(_.union(e),function(e){return!!e});for(var t=0;t<e.length;t++){if(!verifyEmailAddress(e[t])){o.add("Email地址有误，请检查后重试！","danger");return}}var a=e.join(",");if(!a||a.length==0){o.add("请输入Email","danger");return false}c.sending=true;n.post("/send_service_report_mail",{emails:a,beginTime:c.data.beginTime,endTime:c.data.endTime,customer:c.data.template.title,preface:c.data.template.intro,report:c.data.report,slas:c.data.slas}).then(function(e){c.sending=false;c.showEmailInput=false;if(e&&e.status==200&&e.data&&e.data.status==0){o.add("服务报告发送成功！")}},function(){c.sending=false;c.showEmailInput=false})}}}();+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsServiceReportController",e);e.$inject=["$scope","$state","$http","$modal_","coreModelService","coreNotifyService","apiServiceReportService","ngTableParams","alertService"];function e(a,i,e,r,t,n,s,o,l){var c=n.constant.EVENT_LIST_TEMPLATES;var u=this.__proto__.constructor.name+"_"+Date.now();var d={_page:1,_count:48};var f;a.show="template";var p=function(){n.register(u,c,function(e){v()})};var m=function(){a.templates=t.detail.templates.gets(t.list.templates.gets(d._page));a.params={page:d._page,total:t.list.templates.total(),count:a.templates.length}};a.page=function(e){if(e){if(a.show=="userList"){if(D._page!=e){D._page=e;y()}}else{if(d._page!=e){d._page=e;v()}}}};var h=function(){n.doNotify(n.constant.EVENT_LIST_DATA_LOADING,{typeKey:c,isLoading:true});s.run(c,d._page,"",d,function(e){n.doNotify(n.constant.EVENT_LIST_DATA_LOADING,{typeKey:c,isLoading:false})})};var v=function(){m();if(JSON.stringify(d)!=JSON.stringify(f)){h();f=angular.copy(d)}};var g=function(){p();v()};g();a.$on("$destroy",function(){n.unRegister(u)});a.deleteTemlate=function(e){a._messages="确定从报告模板中删除？";var t=r({scope:a,title:"删除确认",contentTemplate:"source/views/alter_common.html",html:true,show:true,placement:"center"});a.$ok=function(){a.isLoading=true;s.deleteTemplete(c,{},{reportTemplateId:e.id},function(e){if(angular.isDefined(e.status)&&e.status==0){l.add("删除成功","success");a.isLoading=false;h();t.$promise.then(t.hide)}else{a.isLoading=false;l.add("删除失败","danger")}})};a.$hide=function(){t.$promise.then(t.hide)}};a.dropdownMenu=[{name:"客户组",type:"userGroup"},{name:"客户",type:"customer"}];a.select=a.dropdownMenu[0];a.choose=function(e){a.select=e};a.user={};var D={_page:1,_count:48,_fields:"",_filter:"",_asc:"",_desc:"createdAt",searchType:"advancedQuery",advancedQueryCondition:"",searchKey:""};a.searchUsers=function(){if(!a.searchKey){l.add("请输入名字或名称，查找客户","danger");return}a.show="userList";if(a.searchKey!=a.oldSearchKey||a.select.type!=a.oldSelectType){D._page=1;y();a.oldSearchKey=angular.copy(a.searchKey);a.oldSelectType=angular.copy(a.select.type)}};a.enterSearch=function(e){if(e.keyCode==13){a.searchUsers()}};var y=function(){D._fields=a.select.type=="customer"?"id,name,userGroup.name":"id,name";D._filter=a.select.type=="customer"?'{"$and":[{"$eq":{"valid":true}},{"$eq":{"type":"customer"}}]}':"";D.advancedQueryCondition='{"name":"'+a.searchKey+'"}';s.search(a.select.type,D,{},function(e){if(angular.isDefined(e.status)&&e.status==0){a.user.type=angular.copy(a.select.type);a.user.list=a.select.type=="customer"?e.result.customers:e.result.userGroups;a.user._total=e.result._total;a.userParams={page:D._page,total:e.result._total,count:D._count}}})};a.configs=[{type:"month",name:"月度报告",active:true,listName:"month",list:[{name:" 上一个日历月",value:"1"},{name:" 从今日起前30天",value:"2"},{name:" 从昨日起前30天",value:"3"}]},{type:"season",name:"季度报告",active:false,listName:"season",list:[{name:" 上3个日历月",value:"1"},{name:" 从今日起前3个月",value:"2"},{name:" 从昨日起前3个月",value:"3"}]},{type:"year",name:"年度报告",active:false,listName:"year",list:[{name:" 上个自然年",value:"1"},{name:" 本自然年以来至今天",value:"2"},{name:" 从昨日起前1年",value:"3"}]},{type:"week",name:"周报告",active:false,listName:"week",list:[{name:" 上一周",value:"1"},{name:" 从今天起前7天",value:"2"},{name:" 从昨天起前7天",value:"3"}]}];a.settingTemplate=function(){if(a.show=="setting"){return false}a.oldShow=angular.copy(a.show);a.show="setting";s.getReportConfig("",{},{},function(t){if(angular.isDefined(t.status)&&t.status==0&&t.result.config){a.config=t.result.config;if(t.result.config.type&&t.result.config.value){angular.forEach(a.configs,function(e){if(e.type==t.result.config.type){e.active=true;e.value=t.result.config.value}else{e.active=false}})}else{a.configs[0].active=true;a.configs[0].value="1"}}void 0})};a.selectConfig=function(t){angular.forEach(a.configs,function(e){if(t.type==e.type){e.active=true;if(!e.value){e.value="1"}}else{e.active=false}})};a.save=function(){angular.forEach(a.configs,function(e){if(e.active){a.config.type=e.type;a.config.value=e.value}else{e.value="1"}});s.saveReportConfig("",{},{id:a.config.id?a.config.id:null,type:a.config.type,value:a.config.value},function(e){if(angular.isDefined(e.status)&&e.status==0){l.add("保存成功","success");if(a.oldShow){a.show=angular.copy(a.oldShow)}}else{l.add("保存失败","danger")}})};a.cancel=function(){a.show=angular.copy(a.oldShow)};a.goDetail=function(e,t){i.go("statistics.serviceReportDetail",{type:e,id:t.id});a.show="redirect";void 0;if(e=="template"){a.userName=t.type=="customer"?t.user&&t.user.name?t.user.name:"未知模板":t.userGroup&&t.userGroup.name?t.userGroup.name:"未知模板"}else{a.userName=t.name}}}}();+function(){"use strict";angular.module("eweiApp.statistics").controller("StatisticsServiceReportDetailController",e);e.$inject=["$scope","$http","$filter","$state","$stateParams","apiRestfulService","reportData","alertService","ConsoleConfig"];function e(e,n,t,a,i,r,s,o,l){var c=this;if(!s){a.go("statistics.serviceReport");return}c.currentUser=l.user;c.reportDate=new Date;c.data=s;if(c.data){f();u();d();c.email=c.data.template.emails}c.beginTime=s.beginTime;c.endTime=s.endTime;if(s.template&&s.template.intro){c.intro=s.template.intro}c.showEmailInput=false;c.showEmailInputForm=function(){c.showEmailInput=true};c.hideEmailInputForm=function(){c.showEmailInput=false};c.editIntro=function(){c.introEditMode=true;c.intro=c.data.template.intro};c.saveIntro=function(){c.introEditMode=false;c.data.template.intro=c.intro};c.cancelEditIntro=function(){c.introEditMode=false};c.deleteIntro=function(){delete c.data.template.intro};c.loadUsers=function(e){if(angular.isObject(e))return;var t=e;if(e&&e.indexOf(",")>-1){var a=e.split(/[,;,；\s]+/gi);if(a&&a.length>1){t=a[a.length-1]}}var i=0;if(c.userGroupId){i=c.userGroupId}if(!t){return[]}var r="/api/v1/engineer_customer_simple_list.json?queryUserType=&key="+t;if(!c.excludeusergroup){r+="&userGroupId="+i}if(c.data.template.user&&c.data.template.user.id){r+="&userId="+c.data.template.user.id}return n.get(r,{}).then(function(e){var t=e.data;var a=[];var i=angular.isDefined(t.result.users)?t.result.users:[];i=_.filter(i,function(e){return e&&!!e.email});angular.forEach(i,function(e){a.push({id:e.id,name:e.name+"("+e.email+")",email:e.email})});return a})};c.updateEmails=function(e){c.data.template.emails=e};c.templateSaving=false;c.saveTemplate=function(){if(c.templateSaving)return;if(c.data.template.emails&&c.data.template.emails.length>500){o.add("Email太多，请减少Email数量。","danger");return}var e=r.run({url:"/api/v1/service_report/save_report_template.json",urlParam:null,dataParam:c.data.template});c.templateSaving=true;e.post(c.data.template,function(e){if(e&&e.status==0&&e.result&&e.result.id){c.data.template.id=e.result.id;o.add("模板保存成功！")}c.templateSaving=false},function(){c.templateSaving=false;void 0})};c.loadReport=function(){c.loading=true;var e=r.run({url:"/api/v1/service_report/show_report.json",urlParam:{type:i.type,targetId:i.id,beginTime:c.beginTime,endTime:c.endTime}});e.get(null,function(e){c.loading=false;if(e.status==0){c.data=e.result;u();d();f();c.email=c.data.template.emails}else{o.add(e.result.errorDescription+"，请重试！","danger");void 0}},function(e){c.loading=false;void 0;o.add("获取服务报告数据失败!请重试.","danger")})};function u(){var a={0:{name:"普通工单（不符合或未订立SLA协议）",slaGroup:false,tickets:[]}};c.data.tickets.forEach(function(e){var t;if(e.slaId&&e.slaName){if(!a.hasOwnProperty(e.slaId)){a[e.slaId]={name:"SLA："+e.slaName,slaGroup:true,qualified:0,tickets:[]}}t=a[e.slaId];if(e.qualified==1){t.qualified++}t.tickets.push(e)}else{t=a[0];t.tickets.push(e)}});c.data.slas=[];for(var e in a){if(a[e].slaGroup){a[e].finishSlaRate=Math.floor(a[e].qualified/a[e].tickets.length*100)+"%";c.data.slas.push(a[e])}}if(a[0].tickets.length>0){c.data.slas.push(a[0])}}function d(){if(c.data.report){c.data.report.solveRate=Math.floor(c.data.report.solveRate*100)+"%";c.data.report.evaluateRate=Math.floor(c.data.report.evaluateRate*100)+"%";c.data.report.finishSlaRate=Math.floor(c.data.report.finishSlaRate*100)+"%";c.data.report.happyRate=Math.floor(c.data.report.happyRate*100)+"%"}}function f(){var e=i.type;if((!e||e=="template")&&c.data&&c.data.template){e=c.data.template.type}switch(e){case"customer":{c.data.template.title=c.data.template.user.name;if(c.data.template&&c.data.template.user&&c.data.template.user.userGroup){c.userGroupId=c.data.template.user.userGroup.id}break}case"userGroup":{c.data.template.title=c.data.template.userGroup.name;if(c.data.template&&c.data.template.userGroup){c.userGroupId=c.data.template.userGroup.id}break}}}c.reloadReport=function(){var e=/2\d{3}\-\d{1,2}\-\d{1,2}/gi;if(c.beginTime==null||c.beginTime==""||!e.test(c.beginTime)){return o.add("开始日期格式不正确，请重新选择！","danger")}e.lastIndex=0;if(c.endTime==null||c.endTime==""||!e.test(c.endTime)){return o.add("结束日期格式不正确，请重新选择！","danger")}if(c.beginTime!=c.data.beginTime||c.endTime!=c.data.endTime){c.loadReport()}c.dateRangeEditMode=false};c.downloading=false;c.download=function(){if(c.downloading)return;c.downloading=true;var e=$("#speaker_form");$("input[name=data]",e).val(JSON.stringify({beginTime:t("date")(c.data.beginTime,"yyyy年MM月dd日"),endTime:t("date")(c.data.endTime,"yyyy年MM月dd日"),customer:c.data.template.title,preface:c.data.template.intro,report:c.data.report,slas:c.data.slas}));e.submit();c.downloading=false};function p(){if(!c.data.template.emails){o.add("请输入Email","danger");return false}if(c.data.template.emails&&c.data.template.emails.length>500){o.add("Email太多，请减少Email数量。","danger");return false}return true}c.sending=false;c.sendEmail=function(){if(c.sending)return;if(!p()){return}var e=c.data.template.emails.split(/[,;\s]+/g);e=_.filter(_.union(e),function(e){return!!e});for(var t=0;t<e.length;t++){if(!verifyEmailAddress(e[t])){o.add("Email地址有误，请检查后重试！","danger");return}}var a=e.join(",");if(!a||a.length==0){o.add("请输入Email","danger");return false}c.sending=true;n.post("/send_service_report_mail",{emails:a,beginTime:c.data.beginTime,endTime:c.data.endTime,customer:c.data.template.title,preface:c.data.template.intro,report:c.data.report,slas:c.data.slas}).then(function(e){c.sending=false;c.showEmailInput=false;if(e&&e.status==200&&e.data&&e.data.status==0){o.add("服务报告发送成功！")}},function(){c.sending=false;c.showEmailInput=false})}}}();var Ewei=Ewei||{};(function(i){"use strict";var e=function(e){this.id=e;this.allReceivedMsg={};this.getMessageId=0;this.chatLogs=[];this.getMessageTimer=null;this.setGetMessageTimer()};e.prototype.setGetMessageTimer=function(){var e=this;if(e.getMessageTimer){clearTimeout(e.getMessageTimer)}e.getMessageTimer=setTimeout(function(){e.listChatLog(e.getMessageId)},3e4)};e.prototype.getChatById=function(){return i.sdk.OpenWebChatApi().getChatById({id:this.id})};e.prototype.quitWebchat=function(e,t){};e.prototype.getOnlineEngineers=function(){return i.sdk.OpenAccountApi().getOnlineEngineers()};e.prototype.participants=function(){return i.sdk.OpenWebChatApi().participants({chatId:this.id})};e.prototype.chatInvite=function(e,t,a){return i.sdk.OpenWebChatApi().chatInvite({chatId:this.id,inviteMode:e,userOnlines:t,description:a})};e.prototype.closeChat=function(e,t,a){return i.sdk.OpenWebChatApi().closeChat({chatId:this.id,quitUserId:e,closeAction:t,deleteReason:a})};e.prototype.getRelationTicketByRequesterIdAndStatus=function(){};e.prototype.chatToTicket=function(e,t){return i.sdk.OpenWebChatApi().chatToTicket({chatId:this.id,ticketNo:e,ticketTemplateId:t})};e.prototype.sendChatMessage=function(e,t){if(t.sending)return;t.sending=true;this.allReceivedMsg[t.uid]=true;i.sdk.TalkApi().sendChatMessage({userId:e,chatId:this.id,chatLog:t}).then(function(e){t.sendStatus="success";t.sending=false},function(e){t.sendStatus="error";t.sending=false})};e.prototype.listChatLog=function(e,t,a){var c=this;if(c.getMessageId==0){c.getMessageId=e-1}return new Promise(function(l,e){i.sdk.ChatLogApi().listChatLog({page:{pageSize:99999,pageNumber:1},chatId:c.id,excursionId:t,lastId:c.getMessageId,orderBy:a,sort:"ASC"}).then(function(e){var t=e.list;var a=[];var i="";for(var r=0,n=t.length;r<n;r++){var s=t[r];var o=s.content;if(c.allReceivedMsg[s.uid]){continue}if(s.operate&&(s.operate=="close_chat"||s.operate=="system_closed_chat")){i="closed";if(this.getMessageTimer){clearTimeout(this.getMessageTimer)}}s.content=o;if(s.id>c.getMessageId){c.getMessageId=s.id}c.allReceivedMsg[s.uid]=true;c.chatLogs.push(s)}l({chatLogs:c.chatLogs,chatStatus:i})})})};e.prototype.checkUserIsOnline=function(e,t,a){return i.sdk.OpenAccountApi().checkUserIsOnline({userId:e,channel:t,chatId:this.id})};e.prototype.listChatParticipant=function(){return i.sdk.OpenWebChatApi().listChatParticipant({chatId:this.id})};e.prototype.historyChat=function(e){return i.sdk.OpenWebChatApi().historyChat({chatId:e})};e.prototype.acceptChat=function(e){return i.sdk.OpenWebChatApi().acceptChat({id:this.id,assignMe:e})};e.prototype.assignChat=function(e){return i.sdk.OpenWebChatApi().assignChat({chatId:this.id,assignedUserId:e})};Ewei.webchatCore=e})(org.ewei);(function(){"use strict";angular.module("eweiApp.chat").config(e);e.$inject=["$stateProvider","$urlRouterProvider"];function e(e,t){e.state("webchats_new",{url:"/webchats",templateUrl:"source/webchat/template/webchat-list.html",controller:"webchatListController",abstract:true}).state("no-license",{url:"/webchats/no-license",templateUrl:"source/license-control/template/no-license.html",controller:"noLicenseController"}).state("webchats_new.detail",{url:"/detail/{id}",templateUrl:"source/webchat/template/webchat-detail.html",controller:"webchatDetailController",onEnter:["coreModelService","$rootScope","$state","$stateParams","ConsoleConfig",function(e,t,a,i,r){e.config.route.put("chat.from",a.current.name);t.$broadcast("subscribe","/provider/"+r.provider.id+"/chat/"+i.id)}],onExit:["$rootScope","$stateParams","ConsoleConfig","coreNotifyService",function(e,t,a,i){e.$broadcast("unsubscribe","/provider/"+a.provider.id+"/chat/"+t.id);i.doNotify(i.constant.EVENT_OTHER_CHAT_RED_POINT,false)}]}).state("webchats_new.list",{url:"/list",templateUrl:"source/webchat/template/webchat-list-view.html",controller:"webchatListViewController",params:{type:"processing"},onEnter:["coreNotifyService",function(e){e.doNotify(e.constant.EVENT_OTHER_CHAT_RED_POINT,false)}],onExit:["coreNotifyService",function(e){e.doNotify(e.constant.EVENT_OTHER_CHAT_RED_POINT,false)}]}).state("webchats_new.history",{url:"/history/:type",templateUrl:"source/webchat/template/webchat-list-history.html",controller:"webchatListHistoryController"}).state("webchats_new.unauthorized",{url:"/unauthorized",templateUrl:"source/views/unauthorized.html"}).state("webchat-history",{url:"/webchat_history",templateUrl:"source/webchat/template/webchat-history.html",controller:"webchatHistoryController"}).state("webchat-history.list",{url:"/:type",templateUrl:"source/webchat/template/webchat-list-history.html",controller:"webchatListHistoryController",onEnter:["$state","$stateParams","coreModelService",function(e,t,a){a.config.route.put("webchat-history",{name:this.name,params:t})}]}).state("webchat-history.detail",{url:"/detail/:id",templateUrl:"source/webchat/template/webchat-detail.html",controller:"webchatDetailController",params:{key:null}})}})();(function($){"use strict";$.module("eweiApp.chat").factory("WebChatListManager",e);e.$inject=["$q","$timeout","$http","coreModelService","ConsoleConfig"];function e(a,e,t,i,r){var n={total:0,params:null};var s={};var o=undefined;var l={};function c(e){if(e&&!Object.prototype.hasOwnProperty.call(s,e)){s[e]={unreadMessageCount:1}}else if(e){s[e].unreadMessageCount++}return s[e]}function u(e){if(e&&Object.prototype.hasOwnProperty.call(s,e)){delete s[e]}}function d(e){if(e&&Object.prototype.hasOwnProperty.call(s,e)){return s[e]}return{unreadMessageCount:0}}function f(e){if(e&&e.length>0){$.forEach(e,function(e){e.unreadMessageCount=d(e.id).unreadMessageCount})}return e}function p(t){if(sessionStorage){try{sessionStorage.setItem(r.provider.id+"."+r.engineer.id+".chatlist.lastChatId",t)}catch(e){o=t}}else{o=t}}function m(){var t;if(sessionStorage){try{t=parseInt(sessionStorage.getItem(r.provider.id+"."+r.engineer.id+".chatlist.lastChatId"))}catch(e){t=o}}else{t=o}return t}function h(){if(sessionStorage){try{sessionStorage.removeItem(r.provider.id+"."+r.engineer.id+".chatlist.lastChatId")}catch(e){o=undefined}}else{o=undefined}}function v(e,t){switch(e){case"waiting":{return org.ewei.sdk.OpenWebChatApi().waitingChats({page:{pageNumber:1,pageSize:5e4,orderBy:"created_at ASC"},searchKey:t});break}case"processing":{return org.ewei.sdk.OpenWebChatApi().participatedChats({page:{pageNumber:1,pageSize:5e4,orderBy:"created_at ASC"},searchKey:t});break}case"visiable":{return org.ewei.sdk.OpenWebChatApi().visibleChats({page:{pageNumber:1,pageSize:5e4,orderBy:"created_at ASC"},searchKey:t});break}default:{return a.reject("not supported");break}}}function g(){return org.ewei.sdk.OpenWebChatApi().unClosedChatCount()}function D(){return t.get("/api/v1/chat/count_chats.json")}function y(e){return org.ewei.sdk.OpenWebChatApi().getChatById({id:e})}function b(e,t){return org.ewei.sdk.OpenWebChatApi().acceptChat({id:e,assignMe:t})}function C(e,t,a){var i=_.find(e,function(e){return e.id===a});if(i){var r=e.indexOf(i);e.splice(r,1);t.push(i)}}function T(e,t,a,i){n.params=a;n.total=i;if(t&&t.length){l[e]=t}else{l[e]=[]}}function k(e){return l[e]}function w(){return n}function S(){if(n.params.page.pageNumber*n.params.page.pageSize<n.total){n.params.page.pageNumber+=1}}function E(){if(n.params.page.pageNumber>1){n.params.page.pageNumber-=1}}function A(){return org.ewei.sdk.OpenWebChatApi().closedChatIds(n.params)}function x(e){l[e]=[]}return{getChatList:v,getChatCount:g,getHistoryChatCount:D,getChatById:y,acceptChat:b,moveList:C,setChatUnread:c,getChatUnread:d,removeChatUnread:u,restoreChatUnread:f,setLastChatId:p,getLastChatId:m,removeLastChatId:h,setHistoryChatList:T,getHistoryChatList:k,clearHistoryChatList:x,getBrower:w,setBrowerNextPage:S,setBrowerPrevPage:E,loadBrowerChatIds:A}}})(angular);(function(A){"use strict";A.module("eweiApp.chat").controller("webchatListController",e);e.$inject=["$scope","$state","$stateParams","$q","$timeout","$filter","$location","WebChatListManager","alertService","coreNotifyService","commonTools","providerJudgement","$modal_","permissions","ConsoleConfig"];function e(o,l,e,i,a,r,t,c,n,s,u,d,f,p,m){o.$location=t;o.chatList={};o.activeChatId=undefined;o.webchatCount={waitingCount:0,participatedCount:0,visibleCount:0,endChatCount:0,untreatedChatCount:0};o.webchatListModel={placeholderVal:"主题/会话ID/客户/客户组/客服/客服组"};o.webchatWaitModel={placeholderVal:"主题/会话ID/客户/客户组/客服/客服组"};o.webchatVisiableModel={placeholderVal:"主题/会话ID/客户/客户组/客服/客服组"};o.searchChatList=function(){C()};function h(e){if(e==="wait"){o.webchatWaitModel.searchKey=""}else if(e==="processing"){o.webchatListModel.searchKey=""}else{o.webchatVisiableModel.searchKey=""}}o.clearSearch=function(e){h(e);C()};o.switchList=function(e,t){if(o.listType!==e||t){o.listType=e;var a=c.getLastChatId();if(!t&&a&&o.activeChatId!==a&&o.listType==="processing"){l.go("webchats_new.detail",{id:a},{reload:"webchats_new.detail"})}else if(!t){o.activeChatId=undefined;l.go("webchats_new.list")}C().then(function(){if(o.listType==="processing"&&!o.activeChatId&&o.chatList.processing&&o.chatList.processing.length>0){l.go("webchats_new.detail",{id:o.chatList.processing[0].id},{reload:"webchats_new.detail"})}});g()}};o.refresh=_.debounce(function(){o.refreshing=true;a(function(){o.refreshing=false},1e3);g();switch(o.listType){case"waiting":case"visiable":case"processing":{C();break}}},1e3,true);o.acceptChat=function(t){if(!d.isTrue()){return false}var e=o;var a;o.disabledVal=false;o.hideMyselfHandleModal=function(){a.$promise.then(a.hide)};e._messages="您确定要接通该会话，自己处理吗？";a=f({scope:e,title:"接通确认",contentTemplate:"source/views/alter_common.html",html:true,show:true,placement:"center"});e.$ok=function(){if(!d.isTrue()){return false}c.acceptChat(t,true).then({success:function(e){c.moveList(o.chatList.waiting,o.chatList.processing,t);o.switchList("processing");l.go("webchats_new.detail",{id:t},{reload:"webchats_new.detail"})},fail:function(e){if(e&&e.error==="license_limit"){n.add("很抱歉，你今日的工单数量已经达到上限，暂时无法接通会话。","danger")}else if(e&&e.error_description){n.add(r("translate")(response.message),"danger")}else{n.add("操作失败","danger")}}});o.hideMyselfHandleModal()}};o.joinChat=function(t,e){if(e==="USB_PHONE"){n.add("暂不支持加入语音会话","danger");return}if(p.hasPermission("ticket_force_join_chat")){org.ewei.sdk.OpenWebChatApi().forceJoinChat({chatId:t}).then(function(e){if(e){c.moveList(o.chatList.visiable,o.chatList.processing,t);l.go("webchats_new.detail",{id:t},{reload:"webchats_new.detail"})}else{n.add("加入失败！请重试。","danger")}},function(e){if(e&&e.error_description){n.add(r("translate")(e.error_description),"danger")}else{n.add("加入失败！请重试。","danger")}})}else{n.add("对不起，您没有权限加入此会话","danger")}};function v(){o.chatList.waiting=[];o.chatList.processing=[];o.chatList.visiable=[]}function g(){c.getChatCount().then(function(e){o.webchatCount.waitingCount=e.waitingCount;o.webchatCount.participatedCount=e.participatedCount;o.webchatCount.visibleCount=e.visibleCount})}function D(t){return function(e){return e.id===t}}function y(){if(o.chatList.waiting&&o.chatList.waiting.length>0){o.chatList.waiting=_.sortBy(o.chatList.waiting,function(e,t){return u.parseDateTime(e.createdAt)-u.parseDateTime(t.createdAt)})}if(o.chatList.processing&&o.chatList.processing.length>0){o.chatList.processing=_.sortBy(o.chatList.processing,function(e,t){return u.parseDateTime(e.createdAt)-u.parseDateTime(t.createdAt)})}if(o.chatList.visiable&&o.chatList.visiable.length>0){o.chatList.visiable=_.sortBy(o.chatList.visiable,function(e,t){return u.parseDateTime(e.createdAt)-u.parseDateTime(t.createdAt)})}}function b(e){if(o.chatList&&o.chatList.waiting&&_.find(o.chatList.waiting,D(e))){return _.find(o.chatList.waiting,D(e))}else if(o.chatList&&o.chatList.processing&&_.find(o.chatList.processing,D(e))){return _.find(o.chatList.processing,D(e))}else if(o.chatList&&o.chatList.visiable&&_.find(o.chatList.visiable,D(e))){return _.find(o.chatList.visiable,D(e))}return undefined}function C(){o.loading=true;var t=i.defer();var a=o.listType;if(o.listType=="waiting"){c.getChatList(o.listType,o.webchatWaitModel.searchKey).then(function(e){o.loading=false;if(o.listType!=="waiting")return;v();if(e&&e.list){o.chatList.waiting=c.restoreChatUnread(e.list||[])}t.resolve(o.chatList.waiting)},function(e){o.loading=false;t.reject(e)})}else if(o.listType=="processing"||o.listType=="visiable"){c.getChatList(o.listType,o.listType==="processing"?o.webchatListModel.searchKey:o.webchatVisiableModel.searchKey).then(function(e){o.loading=false;if(a!==o.listType)return;v();o.chatList[o.listType]=c.restoreChatUnread(e.list||[]);if(o.listType=="processing"&&!o.webchatListModel.searchKey){o.webchatCount.participatedCount=e.recordCount||0}else if(o.listType=="visiable"&&!o.webchatVisiableModel.searchKey){o.webchatCount.visibleCount=e.recordCount||0}t.resolve(o.chatList)},function(e){o.loading=false;t.reject(e)})}else{}return t.promise}function T(t,a,e){c.getChatById(t).then(function(e){e.unreadMessageCount=c.getChatUnread(t).unreadMessageCount;a.push(e)})}function k(e,t){if(!e||!o.chatList)return;g();switch(e.name){case"request_chat":{if(o.listType==="waiting"){if(!_.find(o.chatList.waiting,D(t.chatId))){T(t.chatId,o.chatList.waiting,"waiting")}}else{o.webchatCount.waitingCount++}break}case"chat_new_notice":{var a=b(t.chatId);if(!a)return;if(a&&t.chatLog){switch(t.chatLog.type){case"audio":{a.lastReplyMessage="[语音]";break}case"video":{a.lastReplyMessage="[视频]";break}case"file":{a.lastReplyMessage="[文件]";break}case"knowledge":{a.lastReplyMessage="[文章]";break}case"image":{a.lastReplyMessage="[图片]";break}case"location":{a.lastReplyMessage="[位置]";break}default:{a.lastReplyMessage=t.chatLog.content;break}}a.lastReplyTime=t.chatLog.createdAt}if(o.activeChatId!==t.chatId&&t.user.id!==m.user.id){if(Object.prototype.hasOwnProperty.call(a,"unreadMessageCount")){a.unreadMessageCount++}else{a.unreadMessageCount=1}}else{a.unreadMessageCount=0;c.removeChatUnread(t.chatId)}break}case"cancel_request_chat":{var i=_.find(o.chatList.waiting,D(t.chatId));if(i){o.chatList.waiting.splice(o.chatList.waiting.indexOf(i),1);o.webchatCount.waitingCount--}break}case"accept_chat":{var i=_.find(o.chatList.waiting,D(t.chatId));if(i){o.chatList.waiting.splice(o.chatList.waiting.indexOf(i),1);o.webchatCount.waitingCount--}if(t.engineerId===m.engineer.id){i=_.find(o.chatList.processing,D(t.chatId));if(!i){T(t.chatId,o.chatList.processing,"processing")}}else{i=_.find(o.chatList.visiable,D(t.chatId));if(!i){T(t.chatId,o.chatList.visiable,"visiable")}}if(t.engineerId!==m.engineer.id&&o.activeChatId===t.chatId){l.go("webchats_new.detail",{chatId:t.chatId},{reload:"webchats_new.detail"})}break}case"close_chat":{if(!t||!t.chatId)return;var r=c.getLastChatId();if(r&&t.chatId===r){c.removeLastChatId()}if(o.activeChatId==t.chatId){o.activeChatId=undefined}var a=_.find(o.chatList.waiting,D(t.chatId));var n=-1;if(a){n=o.chatList.waiting.indexOf(a);if(n!==-1){o.chatList.waiting.splice(n,1);o.webchatCount.waiting--}}a=_.find(o.chatList.processing,D(t.chatId));if(a){n=o.chatList.processing.indexOf(a);if(n!==-1){o.chatList.processing.splice(n,1);o.webchatCount.participatedCount--}}a=_.find(o.chatList.visiable,D(t.chatId));if(a){n=o.chatList.visiable.indexOf(a);if(n!==-1){o.chatList.visiable.splice(n,1);o.webchatCount.participatedCount--}}break}case"chat_log_delete":case"join_chat":{o.refresh();break}case"chat_transfer_responsed":{if(!t||!t.chatId)return;if(t.responseUserId===m.user.id){var a=_.find(o.chatList.waiting,D(t.chatId));var n=-1;var s=false;if(a){s=true;c.moveList(o.chatList.waiting,o.chatList.processing,t.chatId);o.switchList("processing");l.go("webchats_new.detail",{id:t.chatId},{reload:"webchats_new.detail"})}a=_.find(o.chatList.visiable,D(t.chatId));if(a){s=true;c.moveList(o.chatList.visiable,o.chatList.processing,t.chatId);l.go("webchats_new.detail",{id:t.chatId},{reload:"webchats_new.detail"})}if(!s){o.switchList("processing",true);l.go("webchats_new.detail",{id:t.chatId},{reload:"webchats_new.detail"})}}else if(t.inviterId===m.user.id){if(t.chatId===o.activeChatId){c.removeLastChatId()}o.switchList("processing",true)}break}case"response_chat_invite":{if(t.responseType=="accept"&&t.inviteChatMode=="transfer"){if(c.getLastChatId()===t.chatId){c.removeLastChatId()}}if(t.responseType=="accept"&&t.inviteChatMode=="invite"){o.switchList("processing",true)}break}case"chat_invite":{if(t.inviteChatMode==="force_transfer"&&t.invitedUserIds==m.user.id){o.switchList("processing",true)}break}}}function w(e,t){y()}var S="request_chat cancel_request_chat accept_chat join_chat chat_new_notice webchat_message close_chat chat_transfer_responsed response_chat_invite chat_invite chat_log_delete".split(" ");A.forEach(S,function(e){o.$on(e,function(e,t){a(k,0,true,e,t)})});o.$on("active-chat-changed",function(e,t){if(o.chatList.waiting&&o.chatList.waiting.length>0&&_.find(o.chatList.waiting,function(e){return e.id===t})){o.switchList("waiting");c.removeLastChatId()}else if(o.chatList.processing&&o.chatList.processing.length>0&&_.find(o.chatList.processing,function(e){return e.id===t})){c.setLastChatId(t);o.switchList("processing",true)}else if(o.chatList.visiable&&o.chatList.visiable.length>0&&_.find(o.chatList.visiable,function(e){return e.id===t})){c.removeLastChatId();o.switchList("visiable",true)}else{}var a=b(t);if(a){a.unreadMessageCount=0}c.removeChatUnread(t);o.activeChatId=t});o.$on("action-join-chat",function(e,t){if(!t)return;o.joinChat(t)});o.$on("remove-chat-unread",function(e,t){if(t){c.removeChatUnread(t)}});o.$on("chat-assign-success",function(e,t){if(o.activeChatId===t.chatId){o.activeChatId=undefined}if(c.getLastChatId()===t.chatId){c.removeLastChatId()}if(t&&t.assignedUserId===m.user.id){o.switchList("processing",true);l.go("webchats_new.detail",{id:t.chatId},{reload:"webchats_new.detail"})}else{l.go("webchats_new.list",{type:"waiting"})}});o.$watchCollection("chatList.waiting",w);o.$watchCollection("chatList.processing",w);o.$watchCollection("chatList.visiable",w);function E(){var e=c.getLastChatId();if(l.current.name==="webchats_new.history"){o.switchList("history")}else if(l.current.name==="webchats_new.detail"&&l.params&&l.params.id){o.switchList("processing");l.go("webchats_new.detail",{id:l.params.id},{reload:"webchats_new.detail"})}else if(e){o.switchList("processing",true);l.go("webchats_new.detail",{id:e},{reload:"webchats_new.detail"})}else if(l.params&&l.params.type){o.switchList(l.params.type)}else{o.switchList("processing",true)}}E()}})(angular);var Ewei=Ewei||{};(function(L){"use strict";L.module("eweiApp.chat").controller("webchatDetailController",e);e.$inject=["$scope","$stateParams","$state","ConsoleConfig","permissions","$modal_","alertService","createUserGroupService","$filter","$http","$rootScope","eweiChatService","$window","$interval","utils","engineerService","commonTools","$timeout","WebChatListManager"];function e(r,i,n,s,t,a,o,l,c,u,d,f,e,p,m,h,v,g,D){var y=parseInt(i.id);if(n.current.name==="webchats_new.detail"){m.cancelSelect()}r.mode="webchat";if(n.current.name==="webchat-history.detail"){r.mode="history"}if(r.mode==="history"){m.addTab("webchats_history_detail","历史会话详情","webchat-history.detail",{id:i.id,key:i.key},"",true,false);r.showNextButton=false;r.showPrevButton=false;var b;var C=D.getHistoryChatList(i.key);if(C&&C.length>0&&C.indexOf(y)>-1){b=C.indexOf(y);var T=D.getBrower().params.page;var k=D.getBrower().total;if(b>0){r.showPrevButton=true}else{if(T&&T.pageNumber>1){r.showPrevButton=true}}if(b<C.length-1){r.showNextButton=true}else{if(T&&T.pageNumber*T.pageSize<k){r.showNextButton=true}}}r.gotoHistory=function(e){switch(e){case 1:if(C.length-1===b){D.setBrowerNextPage();D.loadBrowerChatIds().then(function(e){D.setHistoryChatList(i.key,_.map(e.list,function(e){return e.id}),D.getBrower().params,e.recordCount);var t=e.list[0].id;n.go("webchat-history.detail",{id:t},{reload:true})})}else{var t=C[b+1];n.go("webchat-history.detail",{id:t},{reload:true})}break;case-1:if(b===0){D.setBrowerPrevPage();D.loadBrowerChatIds().then(function(e){D.setHistoryChatList(i.key,_.map(e.list,function(e){return e.id}),D.getBrower().params,e.recordCount);var t=e.list[e.list.length-1].id;n.go("webchat-history.detail",{id:t},{reload:true})})}else{var a=C[b-1];n.go("webchat-history.detail",{id:a},{reload:true})}break;default:}};r.$on("$destroy",function(e){m.cancelSelect()})}var w=function(){r.webchatCore.getChatById().then(function(e){r.webchat=e;r.webchat.remotePlugStatus=f.getRemotePlugStatus(y)?f.getRemotePlugStatus(y):"";r.webchat.chatStatus=f.getChatStatus(y)?f.getChatStatus(y):"";r.webchat.userOnline=true;if(r.webchat.closedAt!=undefined||r.webchat.cancelAt!=undefined){r.webchat.chatStatus="closed";d.$broadcast("close_chat",{chatId:y})}else{M()}if(r.webchat.myRoleName===undefined){r.webchat.myRoleName="partner"}if(r.webchat.iquit===undefined){r.webchat.iquit=true}if(r.webchat.requestMode==="inside"){r.webchat.isPublicReply=false}else{r.webchat.isPublicReply=true}A();x();r.$on("webchat_message",function(e,t){A(t.log.id)});E()},function(e){if(e&&e.error==="business_error"&&e.error_description==="会话不存在或者不可见"){o.add("会话不存在或者不可见","danger");if(D.getLastChatId()===y){D.removeLastChatId()}n.go("webchats_new.unauthorized")}})};var S=null;var E=function(){var e;if(r.webchat.status==="new"){e=(new Date(r.webchat.nowTime)-new Date(r.webchat.createdAt))/1e3;r.webchat.time=c("chartTimeFormat")(e);S=p(function(){r.webchat.time=c("chartTimeFormat")(e);e+=1},1e3)}else if(r.webchat.chatStatus!=="closed"){e=(new Date(r.webchat.nowTime)-new Date(r.webchat.responseAt))/1e3;r.webchat.time=c("chartTimeFormat")(e);S=p(function(){r.webchat.time=c("chartTimeFormat")(e);e+=1},1e3)}else{if(S){p.cancel(S)}else{e=(new Date(r.webchat.closedAt)-new Date(r.webchat.responseAt))/1e3;r.webchat.time=c("chartTimeFormat")(e)}}};var A=function(e){var t=e||"";r.webchatCore.listChatLog(t).then(function(i){r.webchat.chatStatus=i.chatStatus;i.chatLogs.forEach(function(e,t,a){if(e.type!=="log"){if(i.chatStatus==="closed"){clearInterval(S);f.setChatStatus(r.webchat.id,r.webchat.chatStatus);d.$broadcast("unsubscribe","/provider/"+s.provider.id+"/chat/"+r.webchat.id)}}});if(r.webchat.chatStatus==="closed"){E()}r.webchat.chatLogs=i.chatLogs},function(e){void 0})};var x=function(){if(r.webchat.clientType==="WEIXIN"||r.webchat.clientType==="WEB_MOBILE"||r.webchat.clientType==="DINGDING"){r.webchat.userOnline=true;return}var e="web_console";if(r.webchat.user.type=="customer"){e="chat_"+r.webchat.id}var t=g(function(){r.webchatCore.checkUserIsOnline(r.webchat.user.id,e).then(function(e){if(e==true){r.webchat.userOnline=true}else{r.webchat.userOnline=false}r.$applyAsync()})},5e3)};r.$on("chat_user_status_change",function(e,t){if(L.isObject(r.webchat)&&r.webchat.user){if(r.webchat&&r.webchat.id==t.chatId&&r.webchat.user.id==t.userId){if(t.action==="online"){r.webchat.userOnline=true}else{r.webchat.userOnline=false}v.safeApply(r)}}});r.$on("chat_log_delete",function(e,t){var a="/provider/"+s.provider.id+"/chat/"+r.webchat.id;if(a===t.channel&&t.data&&t.data.chat_log_uid){if(r.webchat.chatLogs&&r.webchat.chatLogs.length>0){var i=r.webchat.chatLogs;i.forEach(function(e){if(e.uid==t.data.chat_log_uid){e.type="log";e.operate="chat_log_delete"}})}}});r.closeWebchatWindow=function(){m.removeTabById(n,"webchats_new.detail"+r.webchat.id)};r.closeReplyShadow=function(){r.webchat.chatStatus=""};var $=function(){r.webchatCore=new Ewei.webchatCore(y);w()};r.$on("go-or-create-user-group",function(e,t){if(!r.webchat.user.userGroup){O();return}n.go("user_groups_detail",{id:r.webchat.user.userGroup.id})});var O=function(){if(t.hasPermission("customer_group_create")){var e=a({scope:r,title:"新建客户分组",contentTemplate:"source/views/customer/user_group_add.html",html:true,show:true,placement:"top"});r.newUserGroup={shared:false,userGroupCustomFields:[]};r.groupField={};r.hideModal=function(){e.$promise.then(e.hide)};r.flag_showMoreOptions=false;r.showMoreOptions=function(){r.flag_showMoreOptions=true};r.$save=function(){l.run(r.newUserGroup,r.groupField.userGroupCustomFields,R)}}else{o.add("您没有创建客户组的权限","danger")}};var R=function(e){if(e.success){r.hideModal();r.newUserGroup.id=e.id;F(r.newUserGroup.id,r.newUserGroup.shared)}else{if(e.message!=null){o.add(c("translate")(e.message),"danger")}else{o.add("保存失败","danger")}}};var M=function(){var e=m.findTabByIdAndStateName("webchats_new.detail"+i.id,"webchats_new.detail");if(e==null){m.addTab("webchats_new.detail"+i.id,r.webchat.firstMessage||"#"+r.webchat.id,"webchats_new.detail",{id:i.id},"",true,false);e=m.findTabByIdAndStateName("webchats_new.detail"+i.id,"webchats_new.detail")}else{e.active=true}if(r.chatIsClose){e.isClose=true}};var F=function(e,t){u({url:"update_user_group.json",method:"POST",data:{id:r.webchat.user.id,userGroupId:e,shared:t}}).success(function(e,t,a,i){if(e.success){n.go("user_group_customers_detail",{id:r.webchat.user.id})}else{o.add("保存失败","danger")}})};r.giveUpRemoteDesk=function(e){r.$broadcast("giveUpRemoteDesk",e)};r.closedownloadApplication=function(){r.webchat.remotePlugStatus="";d.$broadcast("installEweiHubServer","remote_desk",null,true);f.setRemotePlugStatus(r.webchat.id,r.webchat.remotePlugStatus)};r.downloadApplication=function(){e.open(d.applicationUrl);r.webchat.remotePlugStatus="download-done";f.setRemotePlugStatus(r.webchat.id,r.webchat.remotePlugStatus);d.$broadcast("installEweiHubServer","remote_desk")};r.$on("chat_transfer",function(e,t){if(t.transferToEngineerId==s.engineer.id){r.webchat.myRoleName="handler";d.myRoleName="handler"}else{if(r.webchat.myRoleName=="handler"){r.webchat.myRoleName="partner";d.myRoleName="partner";if(t.reason=="force_transfer"){r.webchat.chatStatus="chat_transfer";f.setChatStatus(r.webchat.id,r.webchat.chatStatus)}}}h.get({id:t.transferToEngineerId},function(e){r.webchat.engineer=e.json;if(r.webchat.engineer.user){if(r.webchat.engineer.user.name){r.webchat.engineer.name=r.webchat.engineer.user.name}else if(r.webchat.engineer.user.nickname){r.webchat.engineer.name=r.webchat.engineer.user.nickname}}else if(r.webchat.engineer.nickname){r.webchat.engineer.name=r.webchat.engineer.nickname}})});var N=function(){var e=r.webchatCore.getMessageTimer;if(e){clearTimeout(e)}if(S){p.cancel(S)}};r.webchatTab="log";r.changeTab=function(e){r.webchatTab=e};r.$on("$destroy",function(){N()});r.$emit("active-chat-changed",y);$()}})(angular);(function(e){"use strict";e.module("eweiApp.chat").controller("webchatListViewController",t);t.$inject=["$scope","$state","$stateParams"];function t(e,t,a){}})(angular);(function(x){"use strict";x.module("eweiApp.chat").controller("webchatListHistoryController",e);e.$inject=["$scope","$stateParams","$rootScope","NgTableParams","$ocLazyLoad","ConsoleConfig","historyCommonService","alertService","$modal_","$state","permissions","$http","WebChatListManager","$filter","DefaultColumnWidth"];function e(m,e,h,t,a,v,i,r,n,s,o,l,c,g,D){var y=e.type;m.viewType=y;var u=false;var d=y==="end"?"endSearchCache":"untreatedSearchCache";m.argument=i[d]||{searchKey:"",startDate:moment(),endDate:moment(),page:{pageNumber:1}};m.advancedQueryCondition=i[d]?i[d].advancedQueryCondition||{}:{};m.historyModel={searchParams:[{days:0,name:"今天",startDate:moment(),endDate:moment()},{days:1,name:"昨天",startDate:moment().subtract(1,"days"),endDate:moment().subtract(1,"days")},{days:2,name:"近3天",startDate:moment().subtract(2,"days"),endDate:moment()},{days:6,name:"近7天",startDate:moment().subtract(6,"days"),endDate:moment()},{days:29,name:"近30天",startDate:moment().subtract(29,"days"),endDate:moment()}],dateRange:{startDate:m.argument.startDate,endDate:m.argument.endDate},placeholderVal:"主题/会话ID/客户/客户组/客服/客服组",historyList:[],deleteHistory:{},deleteHistoryList:[],isCheckedAll:false,type:y,title:y==="end"?"已结束会话":"漏接的会话",columnsFields:y==="end"?i.historyListFields:i.untreatedhistoryListFields};function f(){l({url:"api/v1/search_view/"+y+"_chat.json",method:"get"}).success(function(e){if(e.status==0&&e.result){if(e.result.fields){var a=e.result.fields.split(",");var t=m.historyModel.columnsFields;m.historyModel.columnsFields=_.map(t,function(t){if(_.find(a,function(e){return t.field===e})&&!t.default){t.active=true}return t})}m.historyModel.columnsFieldsCopy=x.copy(m.historyModel.columnsFields)}else{var i=["createdAt","user.name","user.email","user.mobilePhone"];m.historyModel.columnsFields=x.forEach(m.historyModel.columnsFields,function(e){if(y==="untreated"&&i.indexOf(e.field)>-1){e.active=true}if(y==="end"&&!e.default){e.active=true}});m.historyModel.columnsFieldsCopy=x.copy(m.historyModel.columnsFields)}})}f();m.dateSearch=function(e){m.historyModel.dateRange={startDate:moment().subtract(e,"days"),endDate:moment().subtract(e!==1?0:1,"days")}};var p=m.$watch("historyModel.dateRange",function(e,t){if(e!==t){m.argument.startDate=m.historyModel.dateRange.startDate,m.argument.endDate=m.historyModel.dateRange.endDate;T()}},true);var b=null;function C(e){b={searchKey:m.argument.searchKey,startDate:m.argument.startDate,endDate:m.argument.endDate,page:m.argument.page};if(b.startDate){b.beginDate=b.startDate.format("YYYY-MM-DD");delete b.startDate}if(b.endDate){b.endDate=b.endDate.format("YYYY-MM-DD")}if(y==="end"){b.chatQuery=m.argument.chatQuery;return org.ewei.sdk.OpenWebChatApi().closedChats(b)}return org.ewei.sdk.OpenWebChatApi().untreatedChats(b)}function T(){m.argument.page.pageNumber=1;m.tableParams.page(1);m.tableParams.reload()}m.searchChatList=function(){T()};m.clearSearch=function(){m.argument.searchKey="";m.argument.chatQuery=undefined;m.advancedQueryCondition=m.argument.advancedQueryCondition={};T()};m.advSearch=function(){$("#queryModal").modal("hide");var e={isAutoClose:m.advancedQueryCondition.isAutoClose,isEvaluation:m.advancedQueryCondition.isEvaluation,isSolved:m.advancedQueryCondition.isSolved,qualityInspected:m.advancedQueryCondition.qualityInspected,channelType:m.advancedQueryCondition.channelType};if(m.advancedQueryCondition.isEvaluation){e.evaluationScoreMin=m.advancedQueryCondition.evaluationScoreMin;e.evaluationScoreMax=m.advancedQueryCondition.evaluationScoreMax}else{e.evaluationScoreMin=undefined;e.evaluationScoreMax=undefined}if(m.advancedQueryCondition.qualityInspected){e.qualityScoreMin=m.advancedQueryCondition.qualityScoreMin;e.qualityScoreMax=m.advancedQueryCondition.qualityScoreMax}else{e.qualityScoreMin=undefined;e.qualityScoreMax}if(m.advancedQueryCondition.engineer!=null){e.engineerId=m.advancedQueryCondition.engineer.id}else if(m.advancedQueryCondition.serviceDesk!=null){e.serviceDeskId=m.advancedQueryCondition.serviceDesk.id}if(m.advancedQueryCondition.user!=null){e.userId=m.advancedQueryCondition.user.id}if(m.advancedQueryCondition.userGroup!=null){e.userGroupId=m.advancedQueryCondition.userGroup.id}if(m.advancedQueryCondition.serviceCatalog!=null){e.serviceCatalogId=m.advancedQueryCondition.serviceCatalog.id}if(m.advancedQueryCondition.via!=null){e.channelType=m.advancedQueryCondition.viaType;e.channelUid=m.advancedQueryCondition.via.uid}var t=true;var a=Object.keys(e);for(var i=0;i<a.length;i++){if(e[a[i]]!==undefined){t=false;break}}if(!t){m.argument.advancedQueryCondition=m.advancedQueryCondition;m.argument.chatQuery=e}else{m.argument.advancedQueryCondition={};m.argument.chatQuery=undefined}T()};m.setRows=function(e){u=true;var t=m.tableParams.count();if(e==t)return;m.tableParams.count(e);m.tableParams.page(m.argument.page.pageNumber||1);m.argument.page.pageSize=e;m.tableParams.getData(m.tableParams)};m.sorting=function(e){if(!e.sortable){return}var t=m.tableParams.isSortBy(e.field,"desc");if(t){if(e.field==="createdAt"){m.argument.page.orderBy="c.created_at ASC"}else if(e.field==="closedAt"){m.argument.page.orderBy="c.closed_at ASC"}}else{if(e.field==="createdAt"){m.argument.page.orderBy="c.created_at DESC"}else if(e.field==="closedAt"){m.argument.page.orderBy="c.closed_at DESC"}}m.tableParams.sorting(e.field,t?"asc":"desc")};k();function k(){m.tableParams=m.tableParams||new t({page:1,count:0},{counts:[],getData:function(t,a){if(!u)return;m.argument.page.pageNumber=a.page();m.historyModel.isLoading=true;C(m.argument.page).then(function(e){x.forEach(e.list,function(e){if(e.createdAt&&e.responseAt&&e.closedAt){e.waitTime=moment(e.responseAt).diff(e.createdAt,"seconds");e.chatTime=moment(e.closedAt).diff(e.responseAt,"seconds")}else{e.waitTime="-";e.chatTime="-"}e.serviceCatalogNames=g("serviceCatalogNameFilter")(e.serviceCatalog);e.autoClose=e.autoClose?"是":"否";e.isChatQuality=e.chatQuality?"已质检":"未质检";e.chatQuality=e.chatQuality?e.chatQuality:{totalScore:"-",user:{name:"-"}}});m.historyModel.historyList=e.list;a.total(e.recordCount);t.resolve(m.historyModel.historyList);m.historyModel.isLoading=false;w();c.setHistoryChatList(y,_.map(m.historyModel.historyList,function(e){return e.id}),b,e.recordCount)})}})}function w(){var e=true;for(var t=0;t<m.historyModel.historyList.length;t++){var a=m.historyModel.historyList[t];if(!m.historyModel.deleteHistory[a.id]){m.historyModel.isCheckedAll=false;e=false;break}}if(e){m.historyModel.isCheckedAll=true}S()}function S(){m.historyModel.deleteHistoryList=[];_.map(m.historyModel.deleteHistory,function(e,t){if(e){m.historyModel.deleteHistoryList.push(t)}})}m.selectAllCheckbox=function(t){x.forEach(m.historyModel.historyList,function(e){if(e.id&&t){m.historyModel.deleteHistory[e.id]=true}else{m.historyModel.deleteHistory[e.id]=false}});S()};m.selectSingleCheckbox=function(){w()};m.cancleChecked=function(){m.historyModel.deleteHistoryList=[];m.historyModel.deleteHistory=_.map(m.historyModel.deleteHistory,function(e){if(e){e=false}return e});m.historyModel.isCheckedAll=false};m.deleteChat=function(e){var a=n({scope:m,title:"删除会话",contentTemplate:"source/webchat/template/deleteChat.html",html:true,show:true,placement:"center"});m.modalTip="确认删除选择的会话内容及附件？";m.$ok=function(){var t=e||m.historyModel.deleteHistoryList;l({url:"/api/v1/chats/delete.json",method:"post",data:t}).success(function(e){if(e.status==0&&e.result){a.$promise.then(a.hide);x.forEach(t,function(e){m.historyModel.deleteHistory[e]=false});T();r.add("删除成功")}else{r.add("删除失败","danger")}})}};m.chatToTicket=function(t){var a=n({scope:m,title:"生成工单",contentTemplate:"source/views/chat_list/deleteChat.html",html:true,show:true,placement:"center"});m.modalTip="确定要将该条漏接的会话请求生成工单？";m.$ok=function(){m.disabled=true;var e={subject:t.firstMessage||t.user.name+"的会话"};l({url:"api/v1/chat_to_ticket/"+t.id+".json",method:"put",data:e}).success(function(e){a.$promise.then(a.hide);m.disabled=false;if(e.status==0&&e.result){s.go("tickets_detail",{id:e.result.ticketId})}else if(e.status===2015){var t=n({scope:m,title:"提示",contentTemplate:"source/views/quantity_limitation.html",html:true,show:true,placement:"center"});m.limit={};m.limit.hasPermission=true;m.goUpgrade=function(){if(o.hasPermission("system_setting_company_account")){s.go("system_setting.detail.provider",{uri:"company_account",settingType:"system"});t.$promise.then(t.hide)}else{m.limit.hasPermission=false}};m.hideLimitModal=function(){t.$promise.then(t.hide)}}else{r.add(e.result.error_description,"danger")}})}};m.selectColumn=function(e){if(!e.default){e.active=!e.active}};m.settingFields=function(){var e=_.filter(m.historyModel.columnsFields,function(e){return e.active});var t=_.map(e,function(e){return e.field}).join(",");var a={fields:t,type:y+"_chat"};l({url:"api/v1/search_view.json",method:"post",data:a}).success(function(e){if(e.status==0&&e.result){r.add("保存成功");m.historyModel.showSettingBox=false}else{r.add("保存失败","danger")}})};m.cancelSettingFields=function(){m.historyModel.showSettingBox=false;m.historyModel.columnsFields=x.copy(m.historyModel.columnsFieldsCopy)};var E=function(n,e){var t=_.map(n,function(e){return e.title});var a=[];var i=1;a.push({A:"查询条件"});i++;a.push({A:"一般查询",B:m.argument.searchKey||""});i++;if(y=="end"&&m.argument.chatQuery){a.push({A:"高级查询"});var r={A:"来访渠道"};if(m.argument.advancedQueryCondition.via&&m.argument.advancedQueryCondition.via.id){r.B=m.argument.advancedQueryCondition.via.name}else if(m.argument.advancedQueryCondition.viaType){r.B=g("channelType")(m.argument.advancedQueryCondition.viaType)}a.push(r);a.push({A:"客户",B:m.argument.advancedQueryCondition.user?m.argument.advancedQueryCondition.user.name:""});a.push({A:"客户组",B:m.argument.advancedQueryCondition.userGroup?m.argument.advancedQueryCondition.userGroup.name:""});var s={A:"客服/客服组"};if(m.argument.advancedQueryCondition.engineer){s.B=m.argument.advancedQueryCondition.engineer.name}else if(m.argument.advancedQueryCondition.serviceDesk){s.B=m.argument.advancedQueryCondition.serviceDesk.name}a.push(s);a.push({A:"服务目录",B:m.argument.advancedQueryCondition.serviceCatalog?m.argument.advancedQueryCondition.serviceCatalogNameChain?m.argument.advancedQueryCondition.serviceCatalogNameChain:m.argument.advancedQueryCondition.serviceCatalog.name||"":""});a.push({A:"自动结束",B:m.argument.advancedQueryCondition.isAutoClose==undefined?"":m.argument.advancedQueryCondition.isAutoClose?"是":"否"});a.push({A:"评价否",B:m.argument.advancedQueryCondition.isEvaluation==undefined?"":m.argument.advancedQueryCondition.isEvaluation?"已评价":"未评价"});a.push({A:"解决否",B:m.argument.advancedQueryCondition.isSolved==undefined?"":m.argument.advancedQueryCondition.isSolved?"已解决":"未解决"});a.push({A:"评价分",B:m.argument.advancedQueryCondition.evaluationScoreMin!=null&&m.argument.advancedQueryCondition.evaluationScoreMax!=null?m.argument.advancedQueryCondition.evaluationScoreMin+" - "+m.argument.advancedQueryCondition.evaluationScoreMax:""});a.push({A:"质检否",B:m.argument.advancedQueryCondition.qualityInspected==undefined?"":m.argument.advancedQueryCondition.qualityInspected?"已质检":"未质检"});a.push({A:"质检分",B:m.argument.advancedQueryCondition.qualityScoreMin!=null&&m.argument.advancedQueryCondition.qualityScoreMax!=null?m.argument.advancedQueryCondition.qualityScoreMin+" - "+m.argument.advancedQueryCondition.qualityScoreMax:""});i+=12}a.push({A:"时间段",B:m.argument.startDate.format("YYYY/MM/DD")+"-"+m.argument.endDate.format("YYYY/MM/DD")||""});var o=40;var l=m.tableParams.total();var c=XLSX.utils.json_to_sheet(a,{skipHeader:true});XLSX.utils.sheet_add_aoa(c,[t],{origin:{r:i++,c:0}});var u=x.copy(m.argument);u.beginDate=u.startDate.format("YYYY-MM-DD");u.endDate=u.endDate.format("YYYY-MM-DD");u.qualityConfig=e;delete u.startDate;delete u.page.pageSize;var d=0;var f=i;c["!cols"]=_.map(n,function(e){return{wpx:D["chat.endFields"][e.field]||180}});c["!merges"]=[{s:{c:0,r:0},e:{c:3,r:0}},{s:{c:1,r:1},e:{c:3,r:1}},{s:{c:1,r:2},e:{c:3,r:2}}];var p=h.batchWorker=new Worker("/source/scripts/webchat-history-batch-export.js");p.onmessage=function(e){if(!e.data||!e.data.type)return;switch(e.data.type){case"ready":{p.postMessage({type:"batch-getdata",pageSize:o,total:l,listType:y,credential:{provider_id:v.provider.id,_token:getCookie("user_token")},params:u});break}case"started":{break}case"progress":{var i=[];var t=e.data.data.data.list;t.forEach(function(t){if(t.createdAt&&t.responseAt&&t.closedAt){t.waitTime=moment(t.responseAt).diff(t.createdAt,"seconds");t.chatTime=moment(t.closedAt).diff(t.responseAt,"seconds")}else{t.waitTime="";t.chatTime=""}t.autoClose=t.autoClose?"是":"否";t.isChatQuality=t.chatQuality?"已质检":"未质检";t.chatQuality=t.chatQuality?t.chatQuality:{totalScore:"",user:{name:""}};var a=[];n.forEach(function(e){if(e.fieldCount){if(e.fieldCount===2){if(Object.prototype.hasOwnProperty.call(t,e.field0)&&Object.prototype.hasOwnProperty.call(t[e.field0],e.field1)){switch(e.field){case"serviceDesk.name":{a.push(g("translate")(t.serviceDesk.name));break}case"chatEvaluation.solved":{a.push(g("evaluateValueFilter")(t.chatEvaluation.solved,"firstQuestion"));break}case"chatEvaluation.score":{a.push(g("evaluateValueFilter")(t.chatEvaluation.score));break}default:{a.push(t[e.field0][e.field1]);break}}}else{a.push("")}}else if(e.fieldCount===3){if(t[e.field0]&&t[e.field0][e.field1]&&t[e.field0][e.field1][e.field2]){a.push(g("nullStringFilter")(t[e.field0][e.field1][e.field2]))}else{a.push("")}}}else{switch(e.field){case"waitTime":case"chatTime":{a.push(g("secondToTimeCh")(t[e.field]));break}case"participants":{a.push(g("participantsFilter")(t[e.field]));break}case"serviceCatalogNames":{a.push(t.serviceCatalog?g("serviceCatalogNameFilter")(t.serviceCatalog):"");break}default:{a.push(t[e.field]);break}}}});i.push(a)});XLSX.utils.sheet_add_aoa(c,i,{origin:{r:f,c:0}});f+=t.length;d+=t.length;h.$broadcast("batch-progress",{finished:d,total:e.data.data.data.recordCount});break}case"finished":{p.terminate();delete h.batchWorker;h.$broadcast("batch-finished",{finished:d,total:l,reason:e.data.data.reason});var a=XLSX.utils.book_new();var r=(g("translate")(m.historyModel.title)||"").replace(/[\\\/\?\*\[\]\'\:\<\>\|\"]/g,"_")+moment().format("YYYYMMDDHHmm");XLSX.utils.book_append_sheet(a,c,r);XLSX.writeFile(a,r+".xlsx");break}}}};var A=function(e){try{var n=_.filter(m.historyModel.columnsFields,function(e){return e.default||e.active});var s=_.some(n,function(e){return e.field1==="totalScore"});var o;n.forEach(function(e,t){if(e.field1==="totalScore"){o=t+1}});if(y=="end"){org.ewei.sdk.OpenChatQualityApi().findQualityConfig().then(function(e){if(e&&e.kpiConfigs&&s){n.splice(o,0,{title:"禁忌项",field:"qualityDetails.tabooDetail",field0:"qualityDetails",field1:"tabooDetail",fieldCount:2});n.splice(o+1,0,{title:"评语",field:"qualityDetails.comment",field0:"qualityDetails",field1:"comment",fieldCount:2});var t=e.kpiConfigs.reverse();for(var a=0;a<t.length;a++){var i=t[a];var r={title:i.name,field:"qualityDetails.kpiDetail."+i.id,field0:"qualityDetails",field1:"kpiDetail",field2:i.id,fieldCount:3};n.splice(o,0,r)}}E(n,e)},function(e){E(n,{})})}else{E(n,{})}}catch(e){h.batchWorker=undefined;h.$broadcast("batch-finished",{finished:finished,total:m.tableParams.total(),reason:"error"})}};m.exportHistoryData=function(){if(h.batchWorker){r.add("上一个批量任务尚未结束，请稍后再试","danger");return}h.$broadcast("batch-started",{total:m.tableParams.total(),batchType:"webchat-history-batch-export"});a.load(["source/lib/xlsx/xlsx.full.min.js"]).then(function(){A(m.argument.advancedQueryCondition||{})},function(e){h.batchWorker=undefined;h.$broadcast("batch-finished",{finished:0,total:m.tableParams.total(),reason:"error"})});return};m.$on("$destroy",function(){i[d]=m.argument;p()})}})(angular);var Ewei=Ewei||{};(function(){"use strict";angular.module("eweiApp.chat").directive("webchatButtonGroup",t).controller("webchatButtonGroupController",e);e.$inject=["$scope","$rootScope","ConsoleConfig","$modal_","filterFilter","utils","alertService","$state","eweiChatService","$filter","permissions","providerJudgement","coreNotifyService","WebChatListManager"];function e(f,r,p,s,n,o,l,c,i,m,u,d,h,v){f.refuseReasons=["无效信息","重复信息","恶意骚扰","其他原因"];var g=function(e){var t=false;for(var a=0;f.hasJoinedEngineer&&a<f.hasJoinedEngineer.length;a++){if(f.hasJoinedEngineer[a].user.id==e){t=true;break}}return t};var D=function(){var a=[];f.selectServiceDesks.forEach(function(e){var t=n(e.engineers,{checked:true});t.forEach(function(e){var t=n(a,{id:e.id});if(!t.length){a.push(e)}})});return a};var y=function(e,t){var a=new Array;function i(e,t){for(var a=0,i=e.length;a<i;a++){if(e[a].id==t){return true}}return false}for(var r=0,n=e.length;r<n;r++){var s=e[r];if(!i(a,s.servicedeskId)){var o=s.servicedeskName;if(s.servicedeskName=="DEFAULT_SERVICE_DESK_NAME"){o=m("translate")("DEFAULT_SERVICE_DESK_NAME")}var l={id:s.servicedeskId,name:o,checked:"false",engineers:[]};a.push(l)}}for(var r=0,n=a.length;r<n;r++){for(var c=0,u=e.length;c<u;c++){var s=e[c];if(s.webSessionId==undefined||s.webSessionId==""){continue}if(s.engineerId==p.engineer.id&&t!="force_transfer"){continue}if(a[r].id==s.servicedeskId&&!g(s.userId,f.hasJoinedEngineer)&&t=="invite"||a[r].id==s.servicedeskId&&t!="invite"){var d={id:s.engineerId,name:s.userName,userId:s.userId,checked:"false",chatCount:s.chatCount,webSessionId:s.webSessionId,engineerId:s.engineerId,userName:s.userName,userEmail:s.userEmail,concurrentChatNumber:s.concurrentChatNumber};a[r].engineers.push(d)}}}return a};f.toSelectEngineers=function(t){if(!d.isTrue()){return false}var a;var i={invite:"选择客服或客服组，邀请加入会话",transfer:"选择客服，转接会话给TA",force_transfer:"选择客服，强制转接会话给TA"};var r="source/views/ticket/apps.helpdesk.engineer_list_multiple.html";f.hideSelectEngineerModal=function(){a.$promise.then(a.hide)};f.setMutipleEngineer=function(t,e){if(e){t.engineers.forEach(function(e){e.checked=t.checked});return}var a=n(t.engineers,{checked:true});if(a.length&&a.length===t.engineers.length){t.checked=true}else{t.checked=false}};f.mutipleEngineerDescription="";f.isInviteing=false;f.$inviteEngineer=function(){f.isInviteing=true;var e=[];e=angular.toJson(D());if(e.length<=2){l.add("请选择客服","danger");f.isInviteing=false;return}f.webchatCore.chatInvite(t,e,f.mutipleEngineerDescription).then(function(e){if(e&&e.success){f.hideSelectEngineerModal()}else{l.add("邀请失败","danger")}f.isInviteing=false},function(e){void 0})};Promise.all([f.webchatCore.getOnlineEngineers(),f.webchatCore.participants()]).then(function(e){f.hasJoinedEngineer=e[1];f.selectServiceDesks=y(e[0],t);f.engineersIsZero=[];f.selectServiceDesks.forEach(function(e){if(e.engineers.length==0){f.engineersIsZero.push(e)}});if(f.engineersIsZero.length==f.selectServiceDesks.length){f.showOffline=true}else{f.showOffline=false}f.showServiceDeskList=true;a=s({scope:f,title:i[t],prefixEvent:"chat_modal",template:"modal/modal.tpl.w380.html",contentTemplate:r,html:true,show:true,placement:"center"})},function(e){void 0})};f.existWebChat=function(e,t,a){if(f.webchat.chatStatus=="chat_transfer"){f.webchat.chatStatus="";i.setChatStatus(f.webchat.id,"");return}if(f.webchat.iquit&&f.closeAction=="go_ticket"){f.goTicket(f.webchat.ticket.id,f.webchat.ticket.subject);return}if(a==="close"){C({closeAction:t,deleteReason:""});return}b(t,a);e.stopPropagation()};var b=function(t,e){var a;f.$ok=function(e){if(t==="refuse"){if(!e||!e.length||e==""){f.refuseErrorMessage="请选择拒绝服务理由";return}}C(t,e);a.$promise.then(a.hide)};f._messages=f.webchat.myRoleName==="handler"?"您确定退出当前会话吗？您是当前会话的主接人，退出后当前会话也将被结束。":"您确定退出当前会话吗？";a=s({scope:f,title:"退出确认",contentTemplate:"source/views/alter_common.html",html:true,show:true,placement:"center"});f.closeChat=function(e){t=e;f.$ok()}};var C=function(a,e){f.webchatCore.closeChat(p.user.id,a,e).then(function(e){r.$broadcast("pre_chat_assign");r.$broadcast("close_chat",{chatId:f.webchat.id});if(e&&e.message){var t=JSON.parse(e.message);if(a=="go_ticket"&&t.ticketId!=undefined){f.goTicket(t.ticketId,t.ticketSubject)}else{o.removeTabById(c,"webchats_new.detail"+f.webchat.id);v.removeLastChatId()}}else{l.add("结束失败","danger")}})};f.goTicket=function(e,t){var a=o.findTabById("webchats_new.detail"+f.webchat.id);if(a!=null){f.$applyAsync(function(){o.splice(a)})}var i=o.findTabByIdAndStateName("tickets_detail"+e,"tickets_detail");if(i==null){o.addTab("tickets_detail"+e,t,"tickets_detail",{id:e},"")}else{i.active=true}i=o.findTabByIdAndStateName("tickets_detail"+e,"tickets_detail");c.go(i.stateName,i.params)};f.searchedData={serviceDesks:[]};f.searchEngineer=function(a,e){f.searchedData.serviceDesks=[];var i=e.target.value.trim();if(i.length<1){f.showServiceDeskList=true;return false}f.showServiceDeskList=false;f.selectServiceDesks.forEach(function(e){var t={id:e.id,name:e.name,engineers:[]};e.engineers.forEach(function(e){if(e.name.search(new RegExp(i,"i"))>-1||e.username&&e.username.search(new RegExp(i,"i"))>-1||e.userEmail&&e.userEmail.search(new RegExp(i,"i"))>-1){t.engineers.push(e)}});if(a==1){if(e.name.search(new RegExp(i,"i"))>-1||t.engineers.length>0){f.searchedData.serviceDesks.push(t);if(t.engineers.length<=0){t.engineers=[];e.engineers.forEach(function(e){t.engineers.push(e)})}}}else if(a==0){if(e.name.search(new RegExp(i,"i"))>-1||t.engineers.length>0){if(e.name.search(new RegExp(i,"i"))>-1&&t.engineers.length==0){return}f.searchedData.serviceDesks.push(t)}}})};f.handleChat=function(){if(!d.isTrue()){return false}var e=f;var t;f.disabledVal=false;f.hideMyselfHandleModal=function(){t.$promise.then(t.hide)};e._messages="您确定要接通该会话，自己处理吗？";t=s({scope:e,title:"接通确认",contentTemplate:"source/views/alter_common.html",html:true,show:true,placement:"center"});e.$ok=function(){if(!d.isTrue()){return false}f.webchatCore.acceptChat(true).then({success:function(e){c.go("webchats_new.detail",{id:f.webchat.id},{reload:"webchats_new.detail"})},fail:function(e){if(e&&e.error==="license_limit"){l.add("很抱歉，你今日的工单数量已经达到上限，暂时无法接通会话。","danger")}else if(e&&e.error_description){l.add(m("translate")(response.message),"danger")}else{l.add("操作失败","danger")}}});f.hideMyselfHandleModal()}};f.assignChat=function(){if(!u.hasPermission("ticket_chat_assign")){l.add("您没有权限分派会话","danger");return false}if(!d.isTrue()){return false}var e=f;var a;var n="";f.setwaitingEngineer=function(e){if(e){a=e.userId}};f.sendChatRequest=function(){var t=f.webchat.id;f.disabledVal=true;if(typeof a=="undefined"){l.add("请选择一个客服分派","danger");f.disabledVal=false;return false}f.webchatCore.assignChat(a).then({success:function(e){f.disabledVal=false;if(e){h.doNotify(h.constant.EVENT_LIST_CHAT_WAITTING,true);l.add(m("translate")("ASSIGN_WAITINGCHAT_SUCC"));r.$broadcast("chat-assign-success",{chatId:t,assignedUserId:a})}else{l.add("分派失败！请重试。","danger")}},fail:function(e){f.disabledVal=false;if(e&&e.error==="license_limit"){l.add("很抱歉，你今日的工单数量已经达到上限，暂时无法接通会话。","danger")}else if(e&&e.error_description){l.add(m("translate")(e.error_description),"danger")}else{l.add("分派失败！请重试。","danger")}}});f.hideSelectEngineerModal()};var t=function(e){var t=new Array;function a(e,t){for(var a=0,i=e.length;a<i;a++){if(e[a].id==t){return true}}return false}for(var i=0,r=e.length;i<r;i++){var n=e[i];if(!a(t,n.servicedeskId)){var s={id:n.servicedeskId,name:n.servicedeskName,engineers:[]};t.push(s)}}for(var i=0,r=t.length;i<r;i++){for(var o=0,l=e.length;o<l;o++){var n=e[o];if(n.webSessionId==undefined||n.webSessionId==""){continue}if(t[i].id==n.servicedeskId){var c={id:n.engineerId,name:n.userName,userId:n.userId,chatCount:n.chatCount,concurrentChatNumber:n.concurrentChatNumber};t[i].engineers.push(c)}}}return t};var i;f.hideSelectEngineerModal=function(){i.$promise.then(i.hide)};i=s({scope:e,title:"选择客服人员",contentTemplate:"source/dashboard/select__engineers_single.html",html:true,show:true,placement:"top"});f.loadtime=0;f.loadEngineers=function(){var e=(new Date).getTime();if(f.loadtime!=0&&e-f.loadtime<1500){return}f.loadtime=e;f.onlineCount=0;org.ewei.sdk.OpenAccountApi().getOnlineEngineers().then(function(e){f.selectServiceDesks=t(e);n=f.selectServiceDesks})};f.loadEngineers();f.searchCustomer=function(){void 0;var e=new RegExp(transferConversation.searchCustomerCond.value);var t=n;var a=[];if(transferConversation.searchCustomerCond.value==""){f.selectServiceDesks=n}else{for(var i in t){a[i]=[];a[i].engineers=[];for(var r in t[i].engineers){if(e.test(t[i].engineers[r].name)){a[i].id=t[i].id;a[i].name=t[i].name;a[i].engineers.push(t[i].engineers[r])}}}f.selectServiceDesks=a}}};f.joinChat=function(){f.$emit("action-join-chat",f.webchat.id)};var e=function(){};e()}t.$inject=[];function t(){return{restrict:"EA",replace:true,scope:{webchat:"=",webchatCore:"="},templateUrl:"source/webchat/directive/webchat-button-group/webchat-button-group.html",controller:"webchatButtonGroupController"}}})();(function(){"use strict";angular.module("eweiApp.chat").directive("webchatReplyBox",t).controller("webchatReplyBoxController",e);e.$inject=["$scope","$http","ConsoleConfig","utils","emojiService","alertService","locker","$rootScope","eweiChatService","commonTools","$document","$filter","$timeout","quickreplyService","providerJudgement"];function e(o,n,s,r,t,l,a,i,c,u,e,d,f,p,m){o.chatContentInp="在这里输入，按Enter发送，Shift+Enter换行。“/”搜索快捷回复，“//”搜索知识库文章或问题";o.matchItems=[];o.toggleIsPublicReply=function(){o.webchat.isPublicReply=!o.webchat.isPublicReply;if(o.webchat.isPublicReply){o.chatContentInp="在这里输入，按Enter发送，Shift+Enter换行。“/”搜索快捷回复，“//”搜索知识库文章或问题"}else{o.chatContentInp="私密回复，仅客服人员可见"}};o.sendTextMessage=function(){a.driver("session").namespace("eweiApp.chat").forget(o.webchat.id);var e=t.parseHtmlToSend(angular.copy(o.textMessage));if(e!=""){if(e.length>3e3){l.add("消息不能超过3000个字符","danger");return}if(e.indexOf("/")===0){o.questions=[]}o.sendMessage("text",e)}else{l.add("消息不能为空","danger")}o.textMessage=""};o.sendReplay=function(e){if(!m.isTrue()){return false}o.sendTextMessage();if(window.addEventListener){e.cancelBubble=true;e.preventDefault();e.stopPropagation()}return false};o.sendMessage=function(e,t,a,i){if(t==""&&a==undefined&&i==undefined){l.add("消息不能为空","danger");return}var r={type:e,content:t,createdAt:(new Date).format("yyyy-MM-dd hh:mm:ss"),isPublic:o.webchat.isPublicReply,user:s.user,uid:eweiCommon.uuid(32,16).toLowerCase()};switch(e){case"text":{r.content=t;break}case"file":{r.attachment=a;r.attachmentId=a.id;break}case"knowledge":{if(i!=null){r.questionId=i}else if(o.textQuestionId!=null){r.questionId=o.textQuestionId;o.textQuestionId=null}else{r.questionId=null}break}}f(function(){if(r.sendStatus===undefined){r.sendStatus="send"}},1e3);o.webchat.chatLogs.push(r);o.webchatCore.sendChatMessage(s.user.id,r);o.clearMatchItems()};o.getQuickReplys=function(){p.run("",{_do_count:false,_count:1e4},false,function(e){o.quickReplys=e.quickReplys})};o.getQuickReplys();var h=0;o.matchQuickReplys=_.debounce(function(e){if(o.webchat.chatStatus==="closed"||e.keyCode===38||e.keyCode===40){void 0;return false}var t=o.textMessage;var a="";o.clearMatchItems();if(o.textMessage==""){return}if(t.indexOf("//")>=0){a=t.substr(t.lastIndexOf("/")+1);o.loadQuestionBykey(a);return}if(o.quickReplys==undefined||o.quickReplys.length==0){return}if(t.indexOf("/")>=0){if(t.lastIndexOf("/")==t.length-1){a=""}else{a=t.substr(t.lastIndexOf("/")+1)}}else{a=t}for(var i=0,r=o.quickReplys.length;i<r;i++){if(o.matchItems.length>4){o.itemMouseenter(o.matchItems[0].id);return}if(a==""){var n={id:o.quickReplys[i].id,content:o.quickReplys[i].content,selected:false};var s=o.quickReplys[i].title;n.html=s;o.matchItems.push(n)}else{if(o.quickReplys[i].title.indexOf(a)>=0){var n={id:o.quickReplys[i].id,content:o.quickReplys[i].content,selected:false};var s=o.quickReplys[i].title.replaceAll(a,"<label class='highlightedText'>"+a+"</label>");n.html=s;o.matchItems.push(n)}}}h=0;o.matchItems[0]&&(o.matchItems[0].selected=true);o.$applyAsync()},300);o.loadQuestionBykey=function(e){n({url:"searchQuestionByKey.json",method:"GET",params:{key:e,paseSize:20,pageNo:1,providerId:s.provider.id,topicType:"questionAndArticle"}}).success(function(e,t,a,i){if(e.success){o.questions=e.json;o.quickmatchItems="knowledge"}else{o.questions=[]}o.$applyAsync()})};var v=function(e){if(o.matchItems.length){if(e.keyCode===38){e.preventDefault();h=h===0?o.matchItems.length-1:h-1}else if(e.keyCode===40){e.preventDefault();h=h===o.matchItems.length-1?0:h+1}o.itemMouseenter(o.matchItems[h]&&o.matchItems[h].id)}if(o.matchItems.length&&e.keyCode===13){e.preventDefault();o.selectmatchQuickReplys(o.matchItems[h].content)}};o.selectmatchQuickReplys=function(e){if(o.textMessage.indexOf("/")>=0){o.textMessage=o.textMessage.substr(0,o.textMessage.lastIndexOf("/"))+e}else{o.textMessage=e}o.clearMatchItems()};o.clearMatchItems=function(){o.quickmatchItems="";o.matchItems=[];o.$applyAsync()};o.itemMouseenter=function(e){for(var t=0,a=o.matchItems.length;t<a;t++){if(o.matchItems[t].id==e){o.matchItems[t].selected=true;h=t}else{o.matchItems[t].selected=false}}o.$applyAsync()};o.inputKeypress=function(e){if(e.keyCode===13&&!e.shiftKey){setTimeout(function(){if(!m.isTrue()){return false}o.sendTextMessage()},200);if(window.addEventListener){e.cancelBubble=true;e.preventDefault();e.stopPropagation()}return false}};o.sendKnowledge=function(e){o.sendMessage("knowledge",e.title,"",e.id);o.questions=[];o.textMessage="";a.driver("session").namespace("eweiApp.chat").forget(o.webchat.id)};o.editKnowledge=function(i){n({url:"question_body_"+i.id+".json",method:"GET"}).success(function(e){var t=o.textMessage.split("//");var a=r.htmlToPlainText(e.json.articleBody);o.textMessage=t[0]+a;o.textQuestionId=i.id});o.questions=[];document.getElementById("webchatTextMessage").focus()};o.requestScreenshot=function(){var e={type:"chat",chatId:o.webchat.id,open:o.webchat.isPublicReply};if(i.isInstallApplication){i.$broadcast("requestScreenshot",e)}else{o.webchat.remotePlugStatus="download";c.setRemotePlugStatus(o.webchat.id,o.webchat.remotePlugStatus)}};o.requestVideo=function(){var e={type:"chat",chatId:o.webchat.id,open:o.webchat.isPublicReply};if(i.isInstallApplication){i.$broadcast("requestVideo",e)}else{o.webchat.remotePlugStatus="download";c.setRemotePlugStatus(o.webchat.id,o.webchat.remotePlugStatus)}};o.remoteDeskPlugEnable=false;var g;var D=null;o.checkRemoteDeskPlug=function(e){if(i.isInstallApplication){o.remoteDeskPlugEnable=false;o.remoteFunction=e;var t={cmd:"respondD",data:{user:o.webchat.user.showName,type:"chat",chatId:o.webchat.id,remoteFunction:"remote_desk"}};if(e=="video_call"){t.cmd="respondV";t.data.remoteFunction="video_call";o.requestPlugType="video_call"}else{o.requestPlugType="remote_desk"}if(i.providerLicense.type=="free"||i.providerLicense.type=="professional"){if(s.engineer.role.name=="创始人"){i.$broadcast("checkRemoteDeskPlug",JSON.stringify(t));D=setTimeout(function(){if(!o.remoteDeskPlugEnable){o.remoteDeskPlugEnable=true}},1e3)}else{var a=$modal_({scope:o,title:"提示",contentTemplate:"source/views/fun_restriction_reminder.html",html:true,show:true,placement:"center"});o.hasPermission=true;o.tipNotSupportService="当前服务版本不支持此功能，请升级服务后再试。";o.goAuthorization=function(){void 0;if(permissions.hasPermission("system_setting_company_account")){$state.go("system_setting.detail.provider",{uri:"company_account",settingType:"system"});a.$promise.then(a.hide)}else{o.hasPermission=false;o.tipNotSupportService="很抱歉，你没有访问授权计划的权限"}};o.hideModal_=function(){a.$promise.then(a.hide)}}}else{i.$broadcast("checkRemoteDeskPlug",JSON.stringify(t));D=setTimeout(function(){if(!o.remoteDeskPlugEnable){o.remoteDeskPlugEnable=true}},1e3)}}else{o.webchat.remotePlugStatus="download";c.setRemotePlugStatus(o.webchat.id,o.webchat.remotePlugStatus);i.$broadcast("installEweiHubServer","remote_desk")}};o.requestRemoteDesk=function(){if(o.webchat.chatStatus==="closed"){return}if(o.requestPlugType=="remote_desk"){o.webchat.remotePlugStatus="desk-requesting"}else{o.webchat.remotePlugStatus="video-requesting"}o.remoteDesktopStatus="requesting";var r=o.webchat.user;if(o.webchat.user.id==s.user.id){r=o.webchat.engineer.user}g=r.id;if(i.isInstallApplication){n({url:"request_remote_desk.json",method:"GET",params:{targetUserId:g,chatId:o.webchat.id,remoteFunction:o.remoteFunction,h264:"1"}}).success(function(e,t,a,i){if(e.success){o.assistUser=r}else{if(e.message!=null){l.add(d("translate")(e.message),"danger")}else{l.add("请求失败","danger")}}})}else{l.add("请先运行"+i.providerEweiProductName+"程序","danger")}};o.$watch("remoteDeskPlugEnable",function(){if(o.remoteDeskPlugEnable){o.requestRemoteDesk()}});function y(e){void 0;if(D){clearTimeout(D)}if(e.cmd=="respondD"&&e.data.type=="chat"&&o.webchat.id==e.data.chatId){if(e.run==false||e.run=="false"){o.requestRemoteDesk("remote_desk");o.requestPlugType="remote_desk"}else{l.add("远桌正在进行中","danger")}}else if(e.cmd=="respondV"&&e.data.type=="chat"&&o.webchat.id==e.data.chatId){if(e.run==false||e.run=="false"){if(e.camera||e.microphone){o.requestRemoteDesk("video_call");o.requestPlugType="video_call"}else{l.add("你的电脑没有摄像头和麦克风","danger")}}else{l.add("视频通话正在进行中","danger")}}}o.$on("plugInstalled",function(){o.webchat.remotePlugStatus="";c.setRemotePlugStatus(o.webchat.id,o.webchat.remotePlugStatus)});o.$on("checkRemoteDeskPlugResult",function(e,t){void 0;if(D){clearTimeout(D)}if(t.cmd=="respondD"&&t.data.type=="chat"&&o.webchat.id==t.data.chatId){if(t.run==false||t.run=="false"){if(!o.remoteDeskPlugEnable){o.remoteDeskPlugEnable=true}}else{l.add("远桌正在进行中","danger")}}else if(t.cmd=="respondV"&&t.data.type=="chat"&&o.webchat.id==t.data.chatId){if(t.run==false||t.run=="false"){if(t.camera||t.microphone){if(!o.remoteDeskPlugEnable){o.remoteDeskPlugEnable=true}}else{l.add("你的电脑没有摄像头和麦克风","danger")}}else{l.add("视频通话正在进行中","danger")}}});o.$on("modal_remote_desk.hide",function(e,t){if(o.remoteDesktopStatus=="requesting"){o.remoteDesktopStatus="canceled";o.cancelRemoteDesk("cancel")}});o.cancelRemoteDesk=function(e){var t={chatId:o.webchat.id,cancelUserId:s.user.id,cancelType:e,targetUserId:g,remoteFunction:o.remoteFunction,t:(new Date).getTime()};n({url:"cancel_remote_desk.json",method:"GET",params:t}).success(function(e,t,a,i){if(e.success){o.remoteDesktopStatus="canceled"}})};o.$on("giveUpRemoteDesk",function(e){if(o.remoteDesktopStatus=="accept"||o.remoteDesktopStatus=="rejected"){}else{o.cancelRemoteDesk("canceled")}if(e=="video_call"){o.webchat.remotePlugStatus=""}else{o.webchat.remotePlugStatus=""}o.webchat.remotePlugStatus="";c.setRemotePlugStatus(o.webchat.id,o.webchat.remotePlugStatus);o.remoteDesktopStatus="canceled"});o.$on("chat_lack_plugin",function(e,t){if(t.chatId==o.webchat.id){o.webchat.remotePlugStatus="lack-plug";c.setRemotePlugStatus(o.webchat.id,o.webchat.remotePlugStatus);o.remoteDesktopStatus=""}});o.$on("accept_remote_desk",function(e,t){if(t.chatId){if(t.remoteFunction=="video_call"){o.webchat.remotePlugStatus="video-accept"}else{o.webchat.remotePlugStatus="desk-accept"}if(t.chatId==o.webchat.id){o.remoteDesktopStatus="accept"}}});o.$on("reject_remote_desk",function(e,t){if(t.remoteFunction=="video_call"){o.webchat.remotePlugStatus=""}else{o.webchat.remotePlugStatus=""}if(t.chatId==o.webchat.id){o.remoteDesktopStatus="rejected"}});o.$on("request_remote_desk",function(e,t){if(t.chatId==o.webchat.id){o.$apply(function(){o.remoteDeskData=t});o.remoteDesktopStatus="get_request";o.remoteFunction=t.remoteFunction}});o.acceptRemoteDesk=function(){var e=eweiCommon.uuid();void 0;i.$broadcast("requestEweiHubServer","requestRD");var t="2JB"+e+'|{"cmd":"requestRD","addr":"'+EweiConfig.p2p_server+'","lic":"'+EweiConfig.p2p_license+'","requestClientId":"'+o.remoteDeskData.requesterId+'","user":"'+o.remoteDeskData.requesterName+'","jsparam":{"chatId":'+o.remoteDeskData.chatId+',"acceptUserId":'+s.user.id+',"h264":'+o.remoteDeskData.h264+"}}";if(o.remoteDeskData.remoteFunction=="video_call"){t="2JV"+e+'|{"cmd":"requestVD","moblie":"no","addr":"'+EweiConfig.p2p_server+'","lic":"'+EweiConfig.p2p_license+'","requestClientId":"'+o.remoteDeskData.requesterId+'","user":"'+o.remoteDeskData.requesterName+'","username":"'+o.remoteDeskData.requesterName+'","jsparam":{"chatId":'+o.remoteDeskData.chatId+',"acceptUserId":'+s.user.id+',"remoteFunction":"'+o.remoteDeskData.remoteFunction+'"}}'}ew.socketMgr.get().send(t);o.remoteDeskData={};o.remoteDesktopStatus="accept_request"};o.$on("mypc_not_support_remote",function(e,t){o.rejectRemoteDesk()});o.rejectRemoteDesk=function(){void 0;var e={chatId:o.remoteDeskData.chatId,rejectUserId:s.user.id,rejectType:"reject",targetUserId:o.remoteDeskData.requesterId,t:(new Date).getTime()};n({url:"reject_remote_desk.json",method:"GET",params:e}).success(function(e,t,a,i){if(e.success){o.remoteDeskData={};o.remoteDesktopStatus="reject_request"}})};o.$on("cancel_remote_desk",function(e,t){if(t.chatId==o.webchat.id){o.$apply(function(){o.remoteDeskData={};o.remoteDesktopStatus=""})}});o.wechatEmojiPanelOpen=false;o.showWechatEmoji=function(e){o.wechatEmojiPanelOpen=!o.wechatEmojiPanelOpen;if(e.stopPropagation){e.stopPropagation()}if(e.preventDefault){e.preventDefault()}};o.cacheFiles=[];o.uploading=false;o.filesAdded=function(e,t){void 0;plupload.each(t,function(e){e.uploading=true;e.progress=0;o.cacheFiles.push(e)})};o.beforeUpload=function(e,t){void 0;if(t.size>52428800){void 0;e.stop()}};o.uploadProgress=function(e,t){var a=e.total.percent;o.$emit("uploading",true);t.progress=a;u.safeApply(o)};o.fileUploaded=function(e,t,a){t.progress=100;o.cacheFiles.splice(o.cacheFiles.indexOf(t),1);n({url:"save_attachment.json",method:"POST",params:{fileName:t.name,contentType:t.type,contentUrl:JSON.parse(a).key,size:t.size}}).success(function(e,t,a,i){if(e.json){void 0;o.sendMessage("file","",e.json)}else{void 0}})};o.uploadError=function(e,t,a){o.$emit("uploading",false);if(t.code==-600){l.add("上传文件不能大于50M。","danger");e.stop()}};o.uploadComplete=function(){o.$emit("uploading",false)};o.removeCacheFile=function(e){o.cacheFiles.splice(o.cacheFiles.indexOf(e),1);o.$broadcast("stopUploadingFile",e);o.isImgUpload=false};o.saveDraft=function(){a.driver("session").namespace("eweiApp.chat").put(o.webchat.id,webchatTextMessage.innerText)};e.on("keydown",v);o.$on("$destroy",function(){e.off("keydown",v)})}t.$inject=[];function t(){return{restrict:"EA",replace:true,scope:{webchatCore:"=",webchat:"="},templateUrl:"source/webchat/directive/webchat-reply-box/webchat-reply-box.html",controller:"webchatReplyBoxController"}}})();(function(E){"use strict";angular.module("eweiApp.chat").directive("webchatUserTicket",t).controller("webchatUserTicketController",e).filter("clientIcon",[function(){return function(e,t){var a={WEB_PC:{icon:"&#xe71f;",color:"#459AFF"},WEB_MOBILE:{icon:"&#xe783;",color:"#44C9F3"},APP:{icon:"&#xe783;",color:"#44C9F3"},WEIXIN:{icon:"&#xe786;",color:"#40BC1E"},DINGDING:{icon:"&#xe785;",color:"#AFA3EE"},IOS_SDK:{icon:"&#xe783;",color:"#44C9F3"},ANDROID_SDK:{icon:"&#xe783;",color:"#44C9F3"},WEB_SDK:{icon:"&#xe71f;",color:"#459AFF"},MOBILE_SDK:{icon:"&#xe783;",color:"#44C9F3"},IOS_APP:{icon:"&#xe783;",color:"#44C9F3"},ANDROID_APP:{icon:"&#xe783;",color:"#44C9F3"},USB_PHONE:{icon:"&#xe782;",color:"#B37DDD"},DESKTOP_HELPCENTER:{icon:"&#xe780;",color:"#3286FF"},HELPCENTER:{icon:"&#xe71f;",color:"#459AFF"},YUNZHIJIA:{icon:"&#xe7a3;",color:"#38BBFF"},SMALL_APP:{icon:"&#xe681;",color:"#38BBFF"}};if(a[e][t]){return a[e][t]}return e}}]);e.$inject=["$scope","$rootScope","license","$state","permissions","alertService","$modal_","ticketDetailService","$filter","groupUserTicketChainService","utils","ConsoleConfig","eweiChatService"];function e(s,a,e,r,n,o,l,t,i,c,u,d,f){s.goUserGroup=function(){s.$emit("go-or-create-user-group",null)};s.tabSwitch=function(e){s.showTab=e;if(e==="ticket"){p()}else if(e==="chat_quality"){k()}};s.userTickets={page:1,count:5,total:0,list:[]};var p=function(n){if(s.webchat){if(s.webchat.user.type==="customer"){E.sdk.OpenTicketApi().getTicketsByRequesterIdAndStatus({requesterId:s.webchat.user.id,status:["new","open","pending","assigned"],page:{pageSize:5,pageNumber:s.userTickets.page,orderBy:"t.updated_at ASC"}}).then(function(e){var t=e.list;var a=null;var i=-1;for(var r=0;r<t.length;r++){if(s.webchat.ticket&&t[r].no===s.webchat.ticket.no){t[r].hasChainToTicket=true;a=t[r];i=r}else{t[r].hasChainToTicket=false}}if(i!==-1){t.splice(i,1)}if(n){t.forEach(function(e){s.userTickets.list.push(e)})}else{s.userTickets.list=t;if(s.webchat.ticket&&a){t.unshift(a)}if(e.recordCount>5){s.userTickets.hasMore=true}else{s.userTickets.hasMore=false}}s.userTickets.total=e.recordCount})}}};s.getMoreUserTicket=function(){if(m()){s.userTickets.page++;s.userTickets.hasMore=true;p(true)}else{s.userTickets.hasMore=false}};var m=function(){return s.userTickets.total>s.userTickets.count*s.userTickets.page};s.ticketRelation=function(e){if(e&&e.hasChainToTicket){return}if(e&&e.id>0){s.chainChatToTicket(e.no)}else{s.chainChatToTicket()}};var h=false;s.chainChatToTicket=function(i){if(h){return}h=true;if(!i&&!n.hasPermission("ticket_create")){o.add("您没有创建工单的权限","danger");return}s.webchatCore.chatToTicket(i).then(function(e){if(!i){r.go("tickets_detail",{id:e.id});return}var t=null;for(var a=0;a<s.userTickets.list.length;a++){t=s.userTickets.list[a];if(t.no===i){s.userTickets.list.splice(a,1);t.hasChainToTicket=true;s.webchat.ticket=t;s.userTickets.list.unshift(t)}else{t.hasChainToTicket=false}}h=false},function(e){h=false;if(e&&e.error_description&&e.error_description.indexOf("工单数量已经超出限制")!==-1){var t=l({scope:s,title:"提示",contentTemplate:"source/views/quantity_limitation.html",html:true,show:true,placement:"center"});s.limit={};s.limit.hasPermission=true;s.goUpgrade=function(){if(n.hasPermission("system_setting_company_account")){r.go("system_setting.detail.provider",{uri:"company_account",settingType:"system"});t.$promise.then(t.hide)}else{s.limit.hasPermission=false}};s.hideLimitModal=function(){t.$promise.then(t.hide)}}else{o.add(e.error_description,"danger")}})};var v=s.webchat.firstMessage;s.updateChatSubject=function(){if(!s.webchat.firstMessage){s.webchat.firstMessage=v;return false}if(v===s.webchat.firstMessage){return false}var e={chatId:s.webchat.id,subject:s.webchat.firstMessage};org.ewei.sdk.OpenWebChatApi().updateChatSubject(e).then(function(e){if(e){o.add("修改成功");u.updateChatSubject("webchats_new.detail"+s.webchat.id,"webchats_new.detail",s.webchat.firstMessage)}else{o.add("修改失败","danger")}})};s.$on("selectedUser",function(e,t){void 0;if(s.webchat.ticket){s.ticket=s.webchat.ticket;if(s.ticket.id!=null){var a=t==null?null:t.id;var i=s.ticket.requester==null?null:s.ticket.requester.id;var r=i==null?null:s.ticket.requester.name;if(a!=i){E.sdk.OpenTicketApi().updateTicketRequester({id:s.ticket.id,requesterId:a,requesterName:t==null?null:t.name,oldRequesterName:r}).then(function(e){if(e){s.ticket.requester=t;s.webchat.user=t;c.setUser(t);s.$broadcast("ticket_sla_update",{ticketId:s.ticket.id});if(s.webchat.id){g(t.id)}}else{o.add("修改工单客户失败","danger","left")}})}}}else{if(s.webchat.id&&(!s.webchat.user||s.webchat.user.id!==t.id)){g(t.id)}}});var g=function(e){E.sdk.OpenWebChatApi().updateChatUser({chatId:s.webchat.id,userId:e}).then(function(e){if(!e){if(response.message=="chat_is_null"){void 0}else if(response.message=="chat_user_is_engineer"){void 0}else if(response.message=="user_is_null"){void 0}else{void 0}}s.$parent.$parent.$broadcast("updateChatUser");p()})};s.$on("close_chat",function(e,t){removeCookie("chatDraft_"+d.engineer.id+"_"+s.webchat.id);if(!t.hasOwnProperty("closeAction")){f.setChatStatus(s.webchat.id,s.webchat.chatStatus);return}s.webchat.chatStatus="closed";y();if(t.ticketId){D(t.ticketId)}if(t.hasOwnProperty("closeAction")){s.webchat.iquit=true}a.$broadcast("unsubscribe","/provider/"+d.provider.id+"/chat/"+s.webchat.id)});s.$on("chat_to_ticket",function(e,t){D(t.ticketId)});var D=function(e){t.run(e,{},true,function(e){if(e.status==0&&e.result){var t=e.result;s.webchat.ticket=t;for(var a=0;a<s.userTickets.list.length;a++){if(s.userTickets.list[a].id===t.id){s.userTickets.list.splice(a,1);break}}s.userTickets.list.unshift(t)}})};var y=function(){var e=s.webchatCore.getMessageTimer;if(e){clearTimeout(e)}};var b=0;var C=null,T;function k(){s.chatQualityModel={};if(n.hasPermission("chat_quality")){s.chatQualityModel.hasPermission=true}if(e.type()==="enterprise_basic"||e.type()==="enterprise_basic_19"||e.type()==="remote_assistance_basic"||e.type()==="enterprise_trial"){s.chatQualityModel.hasVersions=true;org.ewei.sdk.OpenChatQualityApi().findQualityConfig().then(function(t){if(t.kpiConfigs.length){s.chatQualityModel.hasFunction=true;C=angular.copy(t);org.ewei.sdk.OpenChatQualityApi().findChatQuality({chatUid:s.webchat.uid}).then(function(e){if(e){s.chatQualityModel.kpiDetail=angular.fromJson(e.kpiDetail);s.chatQualityModel.tabooDetail=angular.fromJson(e.tabooDetail);s.chatQualityModel.comment=e.comment;s.chatQualityModel.id=e.id;T=true}else{s.chatQualityModel.kpiDetail=t.kpiConfigs;s.chatQualityModel.tabooDetail=t.tabooConfigs}w()})}})}}function w(){s.chatQualityModel.allMaxScore=_.reduce(s.chatQualityModel.kpiDetail,function(e,t){var a=Number(t.maxScore)||0;return e+a},0)}s.getAllScore=function(){b=_.reduce(s.chatQualityModel.kpiDetail,function(e,t){var a=Number(t.score)||0;return e+a},0);return b};s.scoreChange=function(e){var t=/^0$|^[1-9]{1}[0-9]{0,2}$/;if(e.score&&(!t.test(e.score)||e.score>e.maxScore)){e.score="";o.add("分值只能为数字且不能超过满分值","danger")}};s.selectedChange=function(e){if(s.chatQualityModel.isEdit){e.selected=!e.selected}};s.edit=function(){s.chatQualityModelCopy=angular.copy(s.chatQualityModel);s.chatQualityModel.isEdit=true;if(T){s.chatQualityModel.kpiDetail=_.map(C.kpiConfigs,function(t){var e=_.find(s.chatQualityModel.kpiDetail,function(e){return t.id===e.id&&t.maxScore===e.maxScore});if(e){t.score=e.score}return angular.copy(t)});s.chatQualityModel.tabooDetail=_.map(C.tabooConfigs,function(t){var e=_.find(s.chatQualityModel.tabooDetail,function(e){return t.id===e.id});if(e){t.selected=e.selected}return t});w()}};s.cancel=function(){s.chatQualityModel=angular.copy(s.chatQualityModelCopy);s.chatQualityModel.isEdit=false};s.update=function(){var e=angular.copy(s.chatQualityModel.kpiDetail);var t=[];for(var a=0;a<e.length;a++){if(e[a].score===undefined||e[a].score===""||e[a].score>e[a].maxScore){o.add("分值不能为空且不能超过最大分值","danger");return false}else{t.push({id:e[a].id,name:e[a].name,score:e[a].score,maxScore:e[a].maxScore})}}var i=_.map(s.chatQualityModel.tabooDetail,function(e){return{id:e.id,name:e.name,selected:e.selected}});var r={chatUid:s.webchat.uid,totalScore:b,kpiDetail:angular.toJson(t),tabooDetail:angular.toJson(i),comment:s.chatQualityModel.comment};if(s.chatQualityModel.id){r.id=s.chatQualityModel.id}org.ewei.sdk.OpenChatQualityApi().doChatQuality({quality:r}).then(function(e){if(e){o.add("质检成功");k()}})};s.$on("selectedServiceCatalog",function(e,t,a,i){E.sdk.OpenWebChatApi().updateServiceCatalog({chatId:s.webchat.id,serviceCatalogId:t?t.id:null}).then(function(e){o.add("服务目录修改成功！")})});var S=function(){s.showTab="user";p()};S()}t.$inject=[];function t(){return{restrict:"EA",replace:true,scope:{webchat:"=",webchatCore:"="},templateUrl:"source/webchat/directive/webchat-user-ticket/webchat-user-ticket.html",controller:"webchatUserTicketController"}}})(org.ewei);angular.module("com.ewei.angular.ui").controller("webchatLogs",["$scope","ConsoleConfig","alertService","$modal_",function(a,t,i,r){a.cancelProgess=function(e){var t=e.log.contentUrl;a.$emit("stopUpload",{id:t});e.$parent.logLists.splice(e.$index,1)};a.reSendMessage=function(e){a.webchatCore.sendChatMessage(t.user.id,e)};a.isShowRecall=function(e){if(t.user.id==e.user.id&&e.sendStatus!=="error"&&a.webchat&&a.webchat.chatStatus!=="closed"){e.showRecall=moment(e.createdAt).add(3,"minutes").isAfter(new Date)}};a.hideRecall=function(e){e.showRecall=false};a.recall=function(e){a._messages="您确定要撤回这条消息吗？";var t=r({scope:a,title:"消息撤回",contentTemplate:"source/views/alter_common.html",html:true,show:true,placement:"center"});a.$ok=function(){a.isLoading=true;org.ewei.sdk.ChatLogApi().deleteByUid({chatLogUid:e.uid}).then(function(e){if(e){a.isLoading=false;t.$promise.then(t.hide)}else{a.isLoading=false;i.add("撤回失败","danger")}},function(){i.add("撤回失败","danger");a.isLoading=false})};a.$hide=function(){t.$promise.then(t.hide)}}}]).directive("webchatLogs",[function(){return{restrict:"E",scope:{logLists:"=logLists",webchatCore:"=",webchat:"="},templateUrl:"/source/webchat/directive/webchat-logs/webchat-logs.html",controller:"webchatLogs"}}]);angular.module("com.ewei.angular.ui").controller("webchatPeopleController",["$scope","ConsoleConfig","$filter",function(t,e,n){var a=function(){t.webchatCore.listChatParticipant().then(function(e){var i;var r;e.forEach(function(e,t,a){if(e.roleName==="handler"){e.name="接待客服";i=e;r=t}else if(e.roleName==="customer"){e.name="访客"}if(e.user.serviceDesk&&e.user.serviceDesk.name==="DEFAULT_SERVICE_DESK_NAME"){e.user.serviceDesk.name=n("translate")("DEFAULT_SERVICE_DESK_NAME")}});e.splice(r,1);e.splice(1,0,i);t.participantList=e})};var i=function(){a()};i()}]).directive("webchatPeople",[function(){return{restrict:"E",scope:{webchatCore:"="},templateUrl:"/source/webchat/directive/webchat-people/webchat-people.html",controller:"webchatPeopleController"}}]);angular.module("com.ewei.angular.ui").controller("webchatRecordController",["$scope","ConsoleConfig",function(t,e){var a;t.getHistoryChat=function(){if(!t.hasMoreRecord){return}t.webchatCore.historyChat(a).then(function(e){if(JSON.stringify(e)!=="{}"){a=e.chat.id;t.recorList.unshift(e);t.hasMoreRecord=true}else{t.hasMoreRecord=false}})};t.$on("updateChatUser",function(){i()});var i=function(){t.recorList=[];a=t.webchat.id;t.hasMoreRecord=true;t.getHistoryChat()};i()}]).directive("webchatRecord",[function(){return{restrict:"E",scope:{webchatCore:"=",webchat:"="},templateUrl:"/source/webchat/directive/webchat-record/webchat-record.html",controller:"webchatRecordController"}}]);angular.module("com.ewei.angular.ui").controller("webchatAttachmentDetailController",["$rootScope","$scope","attachmentService","$http","$location","$sce","EweiConfig",function(e,t,a,i,r,n,s){t.timeNow=(new Date).toString();t.domain=r.host();var o=function(e){t.isImage=e=="image"?true:false;t.isAudio=e=="audio"?true:false;t.isVideo=e=="video"?true:false;t.isKnowledge=e=="knowledge"?true:false;t.isOther=e=="other"?true:false;t.isMap=e=="map"?true:false};this.setType=o;t.viewImage=function(){window.open("/no_auth_ewei_attachment?contentUrl="+t.attachment.contentUrl,"_blank","toolbar=0,location=no,menubar=0,modal=yes,alwaysRaised=yes")};t.saveAsImage=function(e){window.open("/no_auth_ewei_attachment?contentUrl="+t.attachment.contentUrl+"&attname="+encodeURIComponent(t.attachment.fileName))};t.errorAudio=function(e){};if(t.questionId&&t.questionId>0){o("knowledge");i({url:"question/"+t.questionId+".json",method:"GET"}).success(function(e){t.question=e.json;if(!t.question.summary){if(t.question.remark){t.question.summary=t.question.remark.replace(/<\/?[^>]*>/g,"")}else if(t.question.articleBody){t.question.summary=t.question.articleBody.replace(/<\/?[^>]*>/g,"")}}}).error(function(){})}else{t.file=t.attachment;var l=t.attachment.contentType;if(l=="image/jpeg"||l=="image/gif"||l=="image/png"){if(t.allFile==="yes"){o("other")}else if(t.maptype==5||t.log&&t.log.type==="location"){o("map")}else if(t.attachment.size>=8388608){o("other")}else{o("image")}}else if(l=="audio/amr"||l=="audio/mp3"||l=="audio/mpeg"||l=="audio"){o("audio")}else if(l=="video/mp4"||l=="video/mpeg4"||l=="video/ogg"||l=="video/webm"||l=="video/x-sgi-movie"||l=="video/x-ms-wm"){o("video")}else{o("other")}if(t.transit=="true"){if(t.isImage){t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl+"-log.200"}else if(t.isAudio){t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl;+".mp3"}else if(t.isOther){t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl+"&fileName="+encodeURIComponent(t.attachment.fileName)}else{t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl}}else{if(t.isImage){t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl+"-log.200"}else if(t.isMap){if(t.log&&t.log.type==="location"){t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl+"-log.200";t.location=t.log.msgLatitude+","+t.log.msgLongitude;t.addr=t.log.msgAddress}else{t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl+"-log.200";var c=t.mapcontent.split(",");t.location=c[0]+","+c[1];t.addr=c[2]}}else if(t.isOther){t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl+"&fileName="+encodeURIComponent(t.attachment.fileName);var u=l.split("/")[1];if(l.indexOf("image")!==-1){if(u==="x-icon"){if(t.attachment.fileName.indexOf(".ico")===-1){t.url+=".ico"}}else if(u==="photoshop"){if(t.attachment.fileName.indexOf(".psd")===-1){t.url+=".psd"}}else{t.url+="."+u}}}else if(t.isAudio&&l=="audio/amr"){t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl+".mp3"}else{t.url="/ewei_attachment?contentUrl="+t.attachment.contentUrl}}}}]).directive("webchatAttachmentDetail",function(){return{restrict:"EA",scope:{attachmentid:"@",attachment:"=",maptype:"@",mapcontent:"@",transit:"@",questionId:"@",log:"=",sendStatus:"@"},link:function(e,t,a,i){e.allFile=a.allFile;if(e.log&&e.log.createdAt&&e.log.phoneHangUpAt){var r=new Date(e.log.createdAt.replace(" ","T"));var n=new Date(e.log.phoneHangUpAt.replace(" ","T"));var s=n-r;e.log.time=parseInt(s/1e3)}},templateUrl:"/source/webchat/directive/webchat-attachment-detail/webchat-attachment-detail.html",controller:"attachmentDetailIemController"}});(function(){var e;angular.module("com.ewei.angular.ui").directive("ngWebchatDateRange",[function(){var e=function(a,e,t){a.format="YYYY/MM/DD";var i={opens:"right",startDate:moment().clone().endOf("day"),endDate:moment().clone().endOf("day"),maxDate:moment(),dateLimit:{days:366},buttonClasses:["btn"],applyClass:"btn-confirm",cancelClass:"btn-cancel",separator:" - ",locale:{applyLabel:"确定",cancelLabel:"取消",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1,format:a.format}};$("div",e).daterangepicker(i,function(e,t){a.dateRange.startDate=e;a.dateRange.endDate=t});var r=$("div",e).data("daterangepicker");var n=a.$watch("dateRange.startDate",function(e){e&&r.setStartDate(e)});var s=a.$watch("dateRange.endDate",function(e){e&&r.setEndDate(e)});a.$on("$destroy",function(){n();s()})};return{restrict:"E",templateUrl:"source/webchat/directive/webchat-daterange-picker/webchat-daterange-picker.html",scope:{dateRange:"="},link:e}}])})();(function(){"use strict";angular.module("eweiApp.chat").directive("webchatList",e).controller("webchatListDirectiveController",t);e.$inject=[];function e(){return{restrict:"AE",replace:true,scope:{type:"@",chatList:"=",activeChatId:"=",onJoinChat:"&",onAcceptChat:"&"},templateUrl:"/source/webchat/directive/webchat-list/webchat-list.html",controller:"webchatListDirectiveController"}}t.$inject=["$scope","$state","alertService"];function t(i,t,a){i.joinChat=function(e,t,a){e.stopPropagation();if(i.onJoinChat){i.onJoinChat({chatId:t,clientType:a})}};i.acceptChat=function(e,t){e.stopPropagation();if(i.onAcceptChat){i.onAcceptChat({chatId:t})}};i.goChatDetail=function(e){if(e.clientType==="USB_PHONE"){a.add("暂不支持查看语音会话","danger");return}e.unreadMessageCount=0;t.go("webchats_new.detail",{id:e.id},{reload:"webchats_new.detail"})}}})();!function(e){"use strict";e.module("com.ewei.angular.ui").controller("eweiSearchController",t).directive("eweiSearch",a);t.$inject=[];function t(){}a.$inject=[];function a(){return{restrict:"EA",templateUrl:"/source/webchat/directive/ewei-search/ewei-search.html",controller:"eweiSearchController",scope:{searchkey:"=",placeholderval:"@",searchmethods:"&",clearSearch:"&",advSearchMethod:"&",advancedQueryEnabled:"=",advancedQueryCondition:"=",clearEnabled:"="}}}}(angular);(function(){"use strict";angular.module("eweiApp.chat").filter("chattime",e);e.$inject=["commonTools","$filter"];function e(i,r){return function(e){var t=e;if(typeof e==="string"){t=i.parseDateTime(e)}if(t instanceof Date){var a=new Date;if(a.getFullYear()!==t.getFullYear()){return r("date")(t,"yyyy-MM-dd HH:mm")}if(a.getDate()!==t.getDate()){return r("date")(t,"MM-dd HH:mm")}return r("date")(t,"HH:mm")}return e}}})();(function(){"use strict";angular.module("eweiApp.chat").service("historyCommonService",e);e.$inject=["ChatEvaluateConfig"];function e(e){this.historyListFields=[{title:"ID",field:"id"},{title:"主题",field:"firstMessage",default:true},{title:"渠道",field:"via.channelName",field0:"via",field1:"channelName",fieldCount:2},{title:"客户",field:"user.name",fieldCount:2,field0:"user",field1:"name"},{title:"客户组",field:"user.userGroup.name",field0:"user",field1:"userGroup",field2:"name",fieldCount:3},{title:"客服",field:"participants"},{title:"客服组",field:"serviceDesk.name",field0:"serviceDesk",field1:"name",fieldCount:2},{title:"服务目录",field:"serviceCatalogNames"},{title:"自动结束",field:"autoClose"},{title:"解决否",field:"chatEvaluation.solved",field0:"chatEvaluation",field1:"solved",fieldCount:2},{title:"满意度",field:"chatEvaluation.score",field0:"chatEvaluation",field1:"score",fieldCount:2},{title:"质检否",field:"isChatQuality"},{title:"质检分",field:"chatQuality.totalScore",field0:"chatQuality",field1:"totalScore",fieldCount:2},{title:"质检人",field:"chatQuality.user.name",field0:"chatQuality",field1:"user",field2:"name",fieldCount:3},{title:"排队时长",field:"waitTime"},{title:"会话时长",field:"chatTime"},{title:"开始时间",field:"createdAt",sortable:true},{title:"结束时间",field:"closedAt",sortable:true}];this.untreatedhistoryListFields=[{title:"ID",field:"id"},{title:"主题",field:"firstMessage",default:true},{title:"渠道",field:"via.channelName",fieldCount:2,field0:"via",field1:"channelName"},{title:"客户",field:"user.name",fieldCount:2,field0:"user",field1:"name"},{title:"客户组",field:"user.userGroup.name",field0:"user",field1:"userGroup",field2:"name",fieldCount:3},{title:"Email",field:"user.email",fieldCount:2,field0:"user",field1:"email"},{title:"手机",field:"user.mobilePhone",fieldCount:2,field0:"user",field1:"mobilePhone"},{title:"客服组",field:"serviceDesk.name",fieldCount:2,field0:"serviceDesk",field1:"name"},{title:"时间",field:"createdAt"}];this.endSearchCache=null;this.untreatedSearchCache=null}})();(function(){"use strict";angular.module("eweiApp.chat").filter("participantsFilter",e).filter("evaluateValueFilter",t).filter("serviceCatalogNameFilter",a);e.$inject=["commonTools","$filter"];function e(e,t){return function(e){var t="";var a=[];if(e.length){angular.forEach(e,function(e){if(e.user&&e.user.name){a.push(e.user.name)}});t=a.join(",")}t=t||"-";return t}}t.$inject=["$filter","ChatEvaluateConfig"];function t(e,t){var a=t;var i={firstQuestion:{},secondQuestion:{}};angular.forEach(a.firstQuestionOptions,function(e){i.firstQuestion[e.value.toString()]=e.name});angular.forEach(a.secondQuestionOptions,function(e){i.secondQuestion[e.value.toString()]=e.name});return function(e,t){if(t&&e!==undefined&&e!==null&&Object.prototype.hasOwnProperty.call(i,t)&&Object.prototype.hasOwnProperty.call(i.firstQuestion,e.toString())){return i[t][e.toString()]}else if(!t&&e!==undefined&&e!==null){return e}return"-"}}a.$inject=[];function a(){function a(e,t){if(e.parent){a(e.parent,t)}t.push(e.name);return t}return function(e){var t=[];if(e){a(e,t);return t.join("/")}return"-"}}})();(function(e){"use strict";e.module("eweiApp.chat").controller("webchatHistoryController",t);t.$inject=["$scope","$state","$stateParams","WebChatListManager","coreModelService"];function t(e,t,a,i,r){function n(){if(t.current.name==="webchat-history"){var e=r.config.route.get("webchat-history");if(e&&e.params.type){t.go(e.name,e.params)}else{t.go("webchat-history.list",{type:"end"})}}}n()}})(angular);(function(){"use strict";angular.module("eweiApp.license",[])})();(function(e){"use strict";e.module("eweiApp.license").controller("noLicenseController",t);t.$inject=["$scope","$state","$stateParams"];function t(e,t,a){e.openService=function(){$("#ewei-websdk-portal").trigger("click")}}})(angular);+function(){"use strict";angular.module("eweiApp.statistics-menggang",["eweiApp.common","ui.router","ui.bootstrap"])}();+function(){"use strict";angular.module("eweiApp.statistics-menggang").config(e);e.$inject=["$stateProvider","$urlRouterProvider"];function e(e,t){e.state("statistics-menggang",{url:"/statistics-menggang",controller:"statisticsMenggangController",templateUrl:"source/statistics-menggang/statistics.view.html"}).state("statistics-menggang.performance",{url:"/performance",controller:"statisticsMenggangPerformanceRootController",templateUrl:"source/statistics-menggang/performance/performance.view.html",onEnter:a("statistics-menggang")}).state("statistics-menggang.performance.kpi",{url:"/kpi",controller:"statisticsMenggangPerformanceKPIController",templateUrl:"source/statistics-menggang/performance/performance.kpi.view.html",onEnter:a("statistics-menggang-performance")}).state("statistics-menggang.performance.kpiConfig",{url:"/kpi",controller:"statisticsMenggangPerformanceKPIConfigController",templateUrl:"source/statistics-menggang/performance/performance.kpi.config.view.html",onEnter:a("statistics-menggang-performance")}).state("statistics-menggang.timeout",{url:"/timeout",controller:"statisticsMenggangTimeoutRootController",templateUrl:"source/statistics-menggang/timeout/timeout.view.html",onEnter:a("statistics-menggang")}).state("statistics-menggang.timeout.response",{url:"/response",controller:"statisticsMenggangTimeoutResponseController",templateUrl:"source/statistics-menggang/timeout/timeout.response.view.html",onEnter:a("statistics-menggang-timeout")}).state("statistics-menggang.timeout.solve",{url:"/solve",controller:"statisticsMenggangTimeoutSolveController",templateUrl:"source/statistics-menggang/timeout/timeout.solve.view.html",onEnter:a("statistics-menggang-timeout")}).state("statistics-menggang.customer",{url:"/customer",controller:"statisticsMenggangCustomerRootController",templateUrl:"source/statistics-menggang/customer/customer.view.html",onEnter:a("statistics-menggang")}).state("statistics-menggang.customer.customer",{url:"/customer",controller:"statisticsMenggangCustomerController",templateUrl:"source/statistics-menggang/customer/customer.customer.view.html",onEnter:a("statistics-menggang-customer")}).state("statistics-menggang.customer.customerDetail",{url:"/customer",controller:"statisticsMenggangCustomerDetailController",params:{params:null},templateUrl:"source/statistics-menggang/customer/customer.customer.detail.view.html",onEnter:a("statistics-menggang-customer")}).state("statistics-menggang.customer.customerGroup",{url:"/customerGroup",controller:"statisticsMenggangCustomerGroupController",templateUrl:"source/statistics-menggang/customer/customer.customerGroup.view.html",onEnter:a("statistics-menggang-customer")}).state("statistics-menggang.customer.customerGroupDetail",{url:"/customerGroup",params:{params:null},controller:"statisticsMenggangCustomerGroupDetailController",templateUrl:"source/statistics-menggang/customer/customer.customerGroup.detail.view.html",onEnter:a("statistics-menggang-customer")}).state("statistics-menggang.resolutionrate",{url:"/resolutionrate",controller:"statisticsMenggangResolutionRateRootController",templateUrl:"source/statistics-menggang/resolutionrate/resolutionrate.view.html",onEnter:a("statistics-menggang")}).state("statistics-menggang.resolutionrate.resolutionrate",{url:"/resolutionrate",controller:"statisticsMenggangResolutionRateResolutionrateController",templateUrl:"source/statistics-menggang/resolutionrate/resolutionrate.resolutionrate.view.html",onEnter:a("statistics-menggang-resolutionrate")}).state("statistics-menggang.distribution",{url:"/distribution",controller:"statisticsMenggangDistributionRootController",templateUrl:"source/statistics-menggang/distribution/distribution.view.html",onEnter:a("statistics-menggang")}).state("statistics-menggang.distribution.engineer",{url:"/engineer",controller:"statisticsMenggangDistributionEngineerController",templateUrl:"source/statistics-menggang/distribution/distribution.engineer.view.html",onEnter:a("statistics-menggang-distribution")}).state("statistics-menggang.distribution.area",{url:"/area",controller:"statisticsMenggangDistributionAreaController",templateUrl:"source/statistics-menggang/distribution/distribution.area.view.html",onEnter:a("statistics-menggang-distribution")}).state("statistics-menggang.distribution.serviceCatalogBySecond",{url:"/serviceCatalogBySecond",controller:"statisticsMenggangDistributionServiceCatalogBySecondController",templateUrl:"source/statistics-menggang/distribution/distribution.serviceCatalogBySecond.view.html",onEnter:a("statistics-menggang-distribution")}).state("statistics-menggang.distribution.serviceCatalogByThird",{url:"/serviceCatalogByThird",controller:"statisticsMenggangDistributionServiceCatalogByThirdController",templateUrl:"source/statistics-menggang/distribution/distribution.serviceCatalogByThird.view.html",onEnter:a("statistics-menggang-distribution")});function a(i){e.$inject=["$state","$stateParams","coreModelService"];function e(e,t,a){a.config.route.put(i,{name:this.name,params:t,permission:this.permission||""})}return e}}}();+function(){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangController",e);e.$inject=["$rootScope","$scope","$state","$location","permissions","coreModelService","ConsoleConfig"];function e(e,s,t,a,i,r,n){s.dateFormat="YYYY/MM/DD";var o=moment(new Date("2017/08/01"));s.minRangeDate=o.clone();s.maxRangeDate=moment();var l=moment();var c;try{c=JSON.parse(sessionStorage.getItem("statistics.daterange"));c.startDate=moment(c.startDate);c.endDate=moment(c.endDate)}catch(e){}if(c){s.dateRange=c}else{s.dateRange={startDate:l.clone().subtract(6,"days").endOf("day"),endDate:l.clone().endOf("day")}}if(s.dateRange.startDate<o){s.dateRange.startDate=o.clone()}s.$broadcast("statistics.datarange.changed",{startDate:s.dateRange.startDate.format(s.dateFormat),endDate:s.dateRange.endDate.format(s.dateFormat)});s.nextRange=function(){if(s.dateRangeSelectroDisabled)return;var e=s.dateRange.endDate-s.dateRange.startDate;var t=s.dateRange.endDate.clone().add(1,"days").startOf("day");var a={startDate:t.clone(),endDate:t.clone().add(e)};if(a.startDate<o){a.startDate=o.clone();a.endDate=moment(a.startDate).add(e)}s.dateRange=a};s.prevRange=function(){if(s.dateRangeSelectroDisabled)return;var e=s.dateRange.endDate-s.dateRange.startDate;var t=s.dateRange.startDate.clone().subtract(1,"days").endOf("day");var a={startDate:t.clone().subtract(e),endDate:t.clone()};if(a.startDate<o){a.startDate=o.clone();a.endDate=moment(a.startDate).add(e)}s.dateRange=a};s.$watch("dateRange",function(e,t){if(e!==t){void 0;void 0;var a={startDate:s.dateRange.startDate.clone(),endDate:s.dateRange.endDate.clone()};s.$broadcast("statistics.datarange.changed",a);try{sessionStorage.setItem("statistics.daterange",JSON.stringify(a))}catch(e){}}},true);s.$location=a;s.hideOldVersionSwitch=false;s.hideDateRangeSelector=t.current.name.endsWith("Detail")||t.current.name.indexOf("serviceReport")>-1;if(n.provider.createdAt){var u=moment(n.provider.createdAt);if(u.isAfter("2017-07-03")){s.hideOldVersionSwitch=true}}s.$on("$stateChangeStart",function(e,t,a,i,r,n){if(t&&t.name.startsWith("statistics.")){if(t.name.indexOf("serviceReport")>-1){s.hideDateRangeSelector=true}else{s.hideDateRangeSelector=false}if(t.name.endsWith("Detail")){s.dateRangeSelectroDisabled=true}else{s.dateRangeSelectroDisabled=false}}});var d=r.config.route.get("statistics-menggang");if(d){t.go(d.name,d.params)}else{t.go("statistics-menggang.performance.kpi")}s.$on("$destroy",function(){void 0})}}();+function(r){"use strict";angular.module("eweiApp.statistics-menggang").service("kpiConfigService",e);e.$inject=["$q"];function e(e){var t={scoreGood:{name:"好评",value:0},countResponseTimeOut:{name:"响应超时",value:0},countSolvedTimeOut:{name:"处理超时",value:0},scoreNegative:{name:"差评",value:0}};var a={};this.getAdjustB=function(){var t=e.defer();if(angular.equals({},a)){r.sdk.OpenCustomReportApi().listServiceCatalogLeafNodes({_token:getCookie("user_token")}).then(function(e){if(e&&e.length>0){a=i(e);t.resolve(a)}})}else{t.resolve(a)}return t.promise};this.getAdjustA=function(){return t};function i(e){var t={519947:{value:14},519948:{value:14},519957:{value:45},519977:{value:18},519978:{value:18},519979:{value:18},519980:{value:10},534887:{value:23},534888:{value:21},534890:{value:20},534891:{value:23},534892:{value:23},536873:{value:28},537322:{value:18},539493:{value:10},539497:{value:26},539499:{value:14},539500:{value:14},539501:{value:14},539517:{value:33},539527:{value:18},539528:{value:18},539533:{value:33},539560:{value:15},539561:{value:21},539562:{value:15},539563:{value:21},539564:{value:21},539565:{value:18},539566:{value:25},539567:{value:24},539568:{value:22},540956:{value:10},541169:{value:18},541170:{value:24},541223:{value:26},541299:{value:25},541302:{value:58},541306:{value:18},541308:{value:14},541309:{value:20},541329:{value:18},541836:{value:24},542366:{value:5},542370:{value:18},542371:{value:18},542372:{value:18},543311:{value:12},543327:{value:58},543841:{value:13},547256:{value:18},547257:{value:21},547414:{value:14},547415:{value:17},547492:{value:10},549932:{value:18},549933:{value:18},549934:{value:17},550118:{value:17},539530:{value:18},519951:{value:26},539518:{value:29},541304:{value:78},555093:{value:6},555682:{value:21},560431:{value:22},568802:{value:33},572629:{value:24},572723:{value:9},572724:{value:9},572725:{value:6},588444:{value:18},594469:{value:20},590528:{value:21},588325:{value:18}};angular.forEach(e,function(e){if(t[e.id]){t[e.id].name=e.name}else{t[e.id]={name:e.name,value:0}}});return t}}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangPerformanceRootController",e);e.$inject=["$rootScope","$scope","$state","permissions","coreModelService","StatisticsBreadcrumbService"];function e(e,t,a,i,r,n){t.breadcrumbs=n.items;t.goto=n.goto;var s=r.config.route.get("statistics-menggang-performance");if(s){if(s.permission){if(i.hasPermission(s.permission)){return a.go(s.name,s.params)}else{return a.go("unauthorized")}}else{return a.go(s.name,s.params)}}else{a.go("statistics-menggang.performance.kpi")}}}();+function(g){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangPerformanceKPIController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService","kpiConfigService"];function e(e,s,t,a,i,r,n,o){var l=this.__proto__.constructor.name+"_"+Date.now();var c;var u=function(){var e="menggang.performance.kpi";s.hasAddSearch=false;s.searchData={showDataSource:["ticket.closed"],reportType:e,views:[]};r.loadLocalSearchDataView(e,["TICKET_CLOSED_AT"],s.searchData.views,function(){d()})};function d(){s.kpiAdjustA=o.getAdjustA();o.getAdjustB().then(function(e){s.kpiAdjustB=e;m()})}var f=function(){r.searchData.startDate=s.$parent.dateRange.startDate.format("YYYY-MM-DD");r.searchData.endDate=s.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:r.searchData.startDate,endDate:r.searchData.endDate,filter:r.searchData.filter,customFieldFilter:r.searchData.cutsomFieldfilter,types:r.searchData.types,customFieldId:106955}};var p=function(){s.columns=[{title:"姓名",visible:true,sortable:true,field:"name"},{title:"所属组",visible:true,sortable:true,field:"serviceDeskName"},{title:"KPI",visible:true,sortable:true,field:"kpi"},{title:"事件处理总量",visible:true,sortable:true,field:"countTicket"},{title:"响应超时数量",visible:true,sortable:true,field:"countResponseTimeOut"},{title:"处理超时数量",visible:true,sortable:true,field:"countSolvedTimeOut"}];var e=[{title:"附加分",visible:true,sortable:true,field:"countBonusPoint"},{title:"好评数",visible:true,sortable:true,field:"scoreGood"},{title:"差评数",visible:true,sortable:true,field:"scoreNegative"}];var t=[];var a;for(var i=0;i<c.length;i++){a={title:"",visible:true,sortable:true,field:""};a.title=c[i]._name;a.field="service_catalog_"+c[i]._id;t.push(a)}s.columns=s.columns.concat(t).concat(e)};var m=function(){g.sdk.OpenCustomReportApi().countEngineersKpi(f()).then(function(e){s.loadComplete=true;s.chartDataA={};s.chartDataB=[];s.tableData=[];s.totalData={};c=e.catalogs;var t=e.resultList;if(t&&t.length>0){p();var a;var i;var r={name:"统计",countResponseTimeOut:0,countSolvedTimeOut:0,countTicket:0,scoreGood:0,scoreNegative:0,countBonusPoint:0,containsServiceCatalog:"",kpi:0};angular.forEach(c,function(e){i="service_catalog_"+e._id;r[i]=0});angular.forEach(t,function(t){a={};a.name=t.name;a.countResponseTimeOut=t.countResponseTimeOut;a.countSolvedTimeOut=t.countSolvedTimeOut;a.countTicket=t.countTicket;a.scoreGood=t.scoreGood;a.scoreNegative=t.scoreNegative;a.serviceDeskName=t.serviceDeskName;a.countBonusPoint=t.countBonusPoint||0;a.kpi=s.kpiAdjustA["scoreGood"].value*t.scoreGood+s.kpiAdjustA["countResponseTimeOut"].value*t.countResponseTimeOut+s.kpiAdjustA["countSolvedTimeOut"].value*t.countSolvedTimeOut+s.kpiAdjustA["scoreNegative"].value*t.scoreNegative;if(t.containsServiceCatalog){var e=t.containsServiceCatalog.split(",");angular.forEach(e,function(e){if(s.kpiAdjustB[e]){a.kpi+=s.kpiAdjustB[e].value}})}if(t.countBonusPoint){a.kpi+=t.countBonusPoint}r.countResponseTimeOut+=t.countResponseTimeOut;r.countSolvedTimeOut+=t.countSolvedTimeOut;r.countTicket+=t.countTicket;r.scoreGood+=t.scoreGood;r.scoreNegative+=t.scoreNegative;r.kpi+=a.kpi;if(t.countBonusPoint){r.countBonusPoint+=t.countBonusPoint}if(t.containsServiceCatalog){r.containsServiceCatalog+=t.containsServiceCatalog}angular.forEach(c,function(e){i="service_catalog_"+e._id;t[i]=t[i]?t[i]:0;r[i]+=t[i];a[i]=t[i]});s.tableData.push(a)});r.kpi=s.tableData.length===0?0:Math.round(r.kpi/s.tableData.length);s.totalData=r;var n=["30","35"];s.chartDataA={title:"平均KPI",text:r.kpi,data:[{name:"达标率",value:s.totalData.kpi}],color:"menggang.kpi.kpi",radius:["40","50"]};s.chartDataB=[{title:"所有事件",text:r.countTicket,data:[{name:"达标率",value:r.countTicket}],color:"menggang.kpi.ticketCount",radius:n},{title:"响应超时",text:r.countResponseTimeOut,data:[{name:"达标率",value:r.countResponseTimeOut}],color:"menggang.kpi.responseTimeoutCount",radius:n},{title:"处理超时",text:r.countSolvedTimeOut,data:[{name:"达标率",value:r.countSolvedTimeOut}],color:"menggang.kpi.solveTimeoutCount",radius:n},{title:"好评",text:r.scoreGood,data:[{name:"达标率",value:r.scoreGood}],color:"menggang.kpi.evaluateGoodCount",radius:n},{title:"差评",text:r.scoreNegative,data:[{name:"达标率",value:r.scoreNegative}],color:"menggang.kpi.evaluateBadCount",radius:n}];h()}})};function h(){var e=[],a=[],t=[],i="绩效统计-KPI";s.tableData.forEach(function(t){a=[];s.columns.forEach(function(e){a.push(t[e.field])});e.push(a)});a=[];s.columns.forEach(function(e){a.push(s.totalData[e.field]);t.push(e.title)});e.unshift(a);s.exportData={startDate:r.searchData.startDate,endDate:r.searchData.endDate,dataList:e,titleList:t,reportName:i,filterDescription:r.searchData.filterDescription,types:r.searchData.types}}function v(){u()}v();n.register(l,n.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){m()});s.$on("statistics.datarange.changed",function(){m()});s.$on("$destroy",function(){n.unRegister(l)})}}(org.ewei);+function(e){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangPerformanceKPIConfigController",t);t.$inject=["$rootScope","$scope","$state","$filter","utils","StatisticsBreadcrumbService","kpiConfigService"];function t(e,t,a,i,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();function l(){t.kpiAdjustA=s.getAdjustA();s.getAdjustB().then(function(e){t.kpiAdjustB=e})}t.confirm=function(){a.go("statistics-menggang.performance.kpi")};t.cancel=function(){a.go("statistics-menggang.performance.kpi")};function c(){l()}c();n.push({url:"statistics-menggang.performance.kpi",name:"KPI"});n.push({name:"KPI核算标准调校"});t.$on("$destroy",function(){n.pop(2)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangTimeoutRootController",e);e.$inject=["$rootScope","$scope","$state","permissions","coreModelService","StatisticsBreadcrumbService"];function e(e,t,a,i,r,n){t.breadcrumbs=n.items;t.goto=n.goto;var s=r.config.route.get("statistics-menggang-timeout");if(s){if(s.permission){if(i.hasPermission(s.permission)){return a.go(s.name,s.params)}else{return a.go("unauthorized")}}else{return a.go(s.name,s.params)}}else{a.go("statistics-menggang.timeout.response")}}}();+function(g){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangTimeoutResponseController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService"];function e(e,i,t,a,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();var l=function(){var e="menggang.timeout.response";i.hasAddSearch=false;i.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};n.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],i.searchData.views,function(){m()})};var c=function(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.cutsomFieldfilter,types:n.searchData.types}};var u=function(){i.columns=[{title:"日期",visible:true,sortable:true,field:"nameDate"},{title:"超时-已关闭数量",visible:true,sortable:true,field:"countTicketTimeOutAndClosed"},{title:"超时-未关闭数量",visible:true,sortable:true,field:"countTicketTimeOutAndNotClosed"},{title:"超时-全部",visible:true,sortable:true,field:"countTicketTimeOutAll"},{title:"超时-已关闭占比",visible:true,sortable:false,field:"timeOutClosedRate"},{title:"超时-未关闭占比",visible:true,sortable:false,field:"timeOutNotClosedRate"},{title:"超时-全部占比",visible:true,sortable:false,field:"timeOutTotalRate"},{title:"全部事件",visible:true,sortable:true,field:"countTicketAll"}]};var d=function(){i.chartDataB={legendData:["超时-未关闭","超时-已关闭","总事件"],lineColor:["#ee7b1a","#4c9dd7","#b8c2d3"],xAxisData:[]};i.chartDataB.yAxis={minInterval:1,type:"value",name:"工单数量",axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}};i.chartDataB.series=[{name:"超时-未关闭",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"超时-已关闭",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"总事件",type:"line",symbol:"circle",symbolSize:10,data:[]}]};var f=function(){i.chartDataA={legendData:["超时-未关闭","超时-已关闭","总事件"],xAxisData:[],yAxisName:"工单数量",series:[]};i.chartDataA.series[0]={name:"超时-未关闭",data:[]};i.chartDataA.series[1]={name:"超时-已关闭",data:[]};i.chartDataA.series[2]={name:"总事件",data:[]}};var p=function(){i.chartDataC=[{titleText:"超时-未关闭",legendData:[],series:{name:"超时-未关闭",data:[]}},{titleText:"超时-已关闭",legendData:[],series:{name:"超时-已关闭",data:[]}},{titleText:"总事件",legendData:[],series:{name:"总事件",data:[]}}]};var m=function(){g.sdk.OpenCustomReportApi().countResponseTimeOutTicket(c()).then(function(e){i.loadComplete=true;if(e.length){var t=i.$parent.dateRange.startDate.clone();while(t<=i.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.nameDate==a})){e.push({nameDate:a,countTicketAll:0,countTicketTimeOutAll:0,countTicketTimeOutAndClosed:0,countTicketTimeOutAndNotClosed:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.nameDate});i.tableData=[];i.totalData={};d();f();p();i.totalData={nameDate:"统计",countTicketAll:0,countTicketTimeOutAll:0,countTicketTimeOutAndClosed:0,countTicketTimeOutAndNotClosed:0};e.forEach(function(e,t){i.tableData.push({countTicketAll:e.countTicketAll,countTicketTimeOutAll:e.countTicketTimeOutAll,countTicketTimeOutAndClosed:e.countTicketTimeOutAndClosed,countTicketTimeOutAndNotClosed:e.countTicketTimeOutAndNotClosed,nameDate:e.nameDate,timeOutClosedRate:e.countTicketTimeOutAndClosed?(e.countTicketTimeOutAndClosed*100/e.countTicketTimeOutAll).toFixed(2)+"%":"0%",timeOutNotClosedRate:e.countTicketTimeOutAndNotClosed?(e.countTicketTimeOutAndNotClosed*100/e.countTicketTimeOutAll).toFixed(2)+"%":"0%",timeOutTotalRate:e.countTicketTimeOutAll?(e.countTicketTimeOutAll*100/e.countTicketAll).toFixed(2)+"%":"0%"});i.totalData.countTicketAll+=e.countTicketAll;i.totalData.countTicketTimeOutAll+=e.countTicketTimeOutAll;i.totalData.countTicketTimeOutAndClosed+=e.countTicketTimeOutAndClosed;i.totalData.countTicketTimeOutAndNotClosed+=e.countTicketTimeOutAndNotClosed;i.chartDataA.xAxisData.push(e.nameDate);i.chartDataB.xAxisData.push(e.nameDate);var a=new Date(e.nameDate).format("MM月dd日");i.chartDataC[0].legendData.push(a);i.chartDataA.series[0].data.push(e.countTicketTimeOutAndNotClosed);i.chartDataA.series[1].data.push(e.countTicketTimeOutAndClosed);i.chartDataA.series[2].data.push(e.countTicketAll);i.chartDataB.series[0].data.push(e.countTicketTimeOutAndNotClosed);i.chartDataB.series[1].data.push(e.countTicketTimeOutAndClosed);i.chartDataB.series[2].data.push(e.countTicketAll);i.chartDataC[0].series.data.push({name:a,value:e.countTicketTimeOutAndNotClosed});i.chartDataC[1].series.data.push({name:a,value:e.countTicketTimeOutAndClosed});i.chartDataC[2].series.data.push({name:a,value:e.countTicketAll})});i.totalData.timeOutClosedRate=i.totalData.countTicketTimeOutAndClosed?(i.totalData.countTicketTimeOutAndClosed*100/i.totalData.countTicketTimeOutAll).toFixed(2)+"%":"0%";i.totalData.timeOutNotClosedRate=i.totalData.countTicketTimeOutAndNotClosed?(i.totalData.countTicketTimeOutAndNotClosed*100/i.totalData.countTicketTimeOutAll).toFixed(2)+"%":"0%";i.totalData.timeOutTotalRate=i.totalData.countTicketTimeOutAll?(i.totalData.countTicketTimeOutAll*100/i.totalData.countTicketAll).toFixed(2)+"%":"0%";h()}})};i.chartShow={A:true,B:false,C:false};i.selectChart=function(e){i.chartShow.A=false;i.chartShow.B=false;i.chartShow.C=false;i.chartShow[e]=true};function h(){var t=[],a=[],e="超时统计-响应超时";i.tableData.forEach(function(e){t.push([e.nameDate,e.countTicketTimeOutAndClosed,e.countTicketTimeOutAndNotClosed,e.countTicketTimeOutAll,e.timeOutClosedRate,e.timeOutNotClosedRate,e.timeOutTotalRate,e.countTicketAll])});t.unshift([i.totalData.nameDate,i.totalData.countTicketTimeOutAndClosed,i.totalData.countTicketTimeOutAndNotClosed,i.totalData.countTicketTimeOutAll,i.totalData.timeOutClosedRate,i.totalData.timeOutNotClosedRate,i.totalData.timeOutTotalRate,i.totalData.countTicketAll]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function v(){l();u()}v();s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){m()});i.$on("statistics.datarange.changed",function(){m()});i.$on("$destroy",function(){s.unRegister(o)})}}(org.ewei);+function(g){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangTimeoutSolveController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService"];function e(e,i,t,a,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();var l=function(){var e="menggang.timeout.response";i.hasAddSearch=false;i.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};n.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],i.searchData.views,function(){m()})};var c=function(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.cutsomFieldfilter,types:n.searchData.types}};var u=function(){i.columns=[{title:"日期",visible:true,sortable:true,field:"nameDate"},{title:"超时-已关闭数量",visible:true,sortable:true,field:"countTicketTimeOutAndClosed"},{title:"超时-未关闭数量",visible:true,sortable:true,field:"countTicketTimeOutAndNotClosed"},{title:"超时-全部",visible:true,sortable:true,field:"countTicketTimeOutAll"},{title:"超时-已关闭占比",visible:true,sortable:false,field:"timeOutClosedRate"},{title:"超时-未关闭占比",visible:true,sortable:false,field:"timeOutNotClosedRate"},{title:"超时-全部占比",visible:true,sortable:false,field:"timeOutTotalRate"},{title:"全部事件",visible:true,sortable:true,field:"countTicketAll"}]};var d=function(){i.chartDataB={legendData:["超时-未关闭","超时-已关闭","总事件"],lineColor:["#ee7b1a","#4c9dd7","#b8c2d3"],xAxisData:[]};i.chartDataB.yAxis={minInterval:1,type:"value",name:"工单数量",axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}};i.chartDataB.series=[{name:"超时-未关闭",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"超时-已关闭",type:"line",symbol:"circle",symbolSize:10,data:[]},{name:"总事件",type:"line",symbol:"circle",symbolSize:10,data:[]}]};var f=function(){i.chartDataA={legendData:["超时-未关闭","超时-已关闭","总事件"],xAxisData:[],yAxisName:"工单数量",series:[]};i.chartDataA.series[0]={name:"超时-未关闭",data:[]};i.chartDataA.series[1]={name:"超时-已关闭",data:[]};i.chartDataA.series[2]={name:"总事件",data:[]}};var p=function(){i.chartDataC=[{titleText:"超时-未关闭",legendData:[],series:{name:"超时-未关闭",data:[]}},{titleText:"超时-已关闭",legendData:[],series:{name:"超时-已关闭",data:[]}},{titleText:"总事件",legendData:[],series:{name:"总事件",data:[]}}]};var m=function(){g.sdk.OpenCustomReportApi().countSolvedTimeOutTicket(c()).then(function(e){i.loadComplete=true;if(e.length){var t=i.$parent.dateRange.startDate.clone();while(t<=i.$parent.dateRange.endDate){var a=t.format("YYYY-MM-DD");if(!_.find(e,function(e){return e.nameDate==a})){e.push({nameDate:a,countTicketAll:0,countTicketTimeOutAll:0,countTicketTimeOutAndClosed:0,countTicketTimeOutAndNotClosed:0})}t.add(1,"days")}e=_.sortBy(e,function(e){return e.nameDate});i.tableData=[];i.totalData={};d();f();p();i.totalData={nameDate:"统计",countTicketAll:0,countTicketTimeOutAll:0,countTicketTimeOutAndClosed:0,countTicketTimeOutAndNotClosed:0};e.forEach(function(e,t){i.tableData.push({countTicketAll:e.countTicketAll,countTicketTimeOutAll:e.countTicketTimeOutAll,countTicketTimeOutAndClosed:e.countTicketTimeOutAndClosed,countTicketTimeOutAndNotClosed:e.countTicketTimeOutAndNotClosed,nameDate:e.nameDate,timeOutClosedRate:e.countTicketTimeOutAndClosed?(e.countTicketTimeOutAndClosed*100/e.countTicketTimeOutAll).toFixed(2)+"%":"0%",timeOutNotClosedRate:e.countTicketTimeOutAndNotClosed?(e.countTicketTimeOutAndNotClosed*100/e.countTicketTimeOutAll).toFixed(2)+"%":"0%",timeOutTotalRate:e.countTicketTimeOutAll?(e.countTicketTimeOutAll*100/e.countTicketAll).toFixed(2)+"%":"0%"});i.totalData.countTicketAll+=e.countTicketAll;i.totalData.countTicketTimeOutAll+=e.countTicketTimeOutAll;i.totalData.countTicketTimeOutAndClosed+=e.countTicketTimeOutAndClosed;i.totalData.countTicketTimeOutAndNotClosed+=e.countTicketTimeOutAndNotClosed;i.chartDataA.xAxisData.push(e.nameDate);i.chartDataB.xAxisData.push(e.nameDate);var a=new Date(e.nameDate).format("MM月dd日");i.chartDataC[0].legendData.push(a);i.chartDataA.series[0].data.push(e.countTicketTimeOutAndNotClosed);i.chartDataA.series[1].data.push(e.countTicketTimeOutAndClosed);i.chartDataA.series[2].data.push(e.countTicketAll);i.chartDataB.series[0].data.push(e.countTicketTimeOutAndNotClosed);i.chartDataB.series[1].data.push(e.countTicketTimeOutAndClosed);i.chartDataB.series[2].data.push(e.countTicketAll);i.chartDataC[0].series.data.push({name:a,value:e.countTicketTimeOutAndNotClosed});i.chartDataC[1].series.data.push({name:a,value:e.countTicketTimeOutAndClosed});i.chartDataC[2].series.data.push({name:a,value:e.countTicketAll})});i.totalData.timeOutClosedRate=i.totalData.countTicketTimeOutAndClosed?(i.totalData.countTicketTimeOutAndClosed*100/i.totalData.countTicketTimeOutAll).toFixed(2)+"%":"0%";i.totalData.timeOutNotClosedRate=i.totalData.countTicketTimeOutAndNotClosed?(i.totalData.countTicketTimeOutAndNotClosed*100/i.totalData.countTicketTimeOutAll).toFixed(2)+"%":"0%";i.totalData.timeOutTotalRate=i.totalData.countTicketTimeOutAll?(i.totalData.countTicketTimeOutAll*100/i.totalData.countTicketAll).toFixed(2)+"%":"0%";h()}})};i.chartShow={A:true,B:false,C:false};i.selectChart=function(e){i.chartShow.A=false;i.chartShow.B=false;i.chartShow.C=false;i.chartShow[e]=true};function h(){var t=[],a=[],e="超时统计-处理超时";i.tableData.forEach(function(e){t.push([e.nameDate,e.countTicketTimeOutAndClosed,e.countTicketTimeOutAndNotClosed,e.countTicketTimeOutAll,e.timeOutClosedRate,e.timeOutNotClosedRate,e.timeOutTotalRate,e.countTicketAll])});t.unshift([i.totalData.nameDate,i.totalData.countTicketTimeOutAndClosed,i.totalData.countTicketTimeOutAndNotClosed,i.totalData.countTicketTimeOutAll,i.totalData.timeOutClosedRate,i.totalData.timeOutNotClosedRate,i.totalData.timeOutTotalRate,i.totalData.countTicketAll]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function v(){l();u()}v();s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){m()});i.$on("statistics.datarange.changed",function(){m()});i.$on("$destroy",function(){s.unRegister(o)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangCustomerRootController",e);e.$inject=["$rootScope","$scope","$state","permissions","coreModelService","StatisticsBreadcrumbService"];function e(e,t,a,i,r,n){t.breadcrumbs=n.items;t.goto=n.goto;var s=r.config.route.get("statistics-menggang-customer");if(s){if(s.permission){if(i.hasPermission(s.permission)){return a.go(s.name,s.params)}else{return a.go("unauthorized")}}else{return a.go(s.name,s.params)}}else{a.go("statistics-menggang.customer.customer")}}}();+function(v){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangCustomerController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService"];function e(e,u,n,d,t,f,a){var i=this.__proto__.constructor.name+"_"+Date.now();u.hasAddSearch=false;var p;u.showWhichOne={trend:true};var r=function(){var e="menggang.customer.customer";u.hasAddSearch=false;u.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};f.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],u.searchData.views,function(){l("trend")})};var s=function(){f.searchData.startDate=u.$parent.dateRange.startDate.format("YYYY-MM-DD");f.searchData.endDate=u.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:f.searchData.startDate,endDate:f.searchData.endDate,filter:f.searchData.filter,customFieldFilter:f.searchData.cutsomFieldfilter,types:f.searchData.types}};u.checked=function(e){u.showWhichOne.trend=false;u.showWhichOne.eventRate=false;u.showWhichOne[e]=true;m(e)};var o=function(){u.columns=[{title:"客户",visible:true,sortable:true,field:"name",callbackFunction:function(e){n.go("statistics-menggang.customer.customerDetail",{params:{title:e.name,id:e.id}})}}];var e=[{title:"全部事件",visible:true,sortable:true,field:"allEvent"},{title:"事件占比",visible:true,sortable:false,field:"eventRate"}];var t=[];var a=[];var i;for(var r=0;r<p.length;r++){i={title:"",visible:true,sortable:true,field:""};i.title=p[r]._name;i.field="service_catalog_"+p[r]._id;t.push(i);i={title:"",visible:true,sortable:false,field:""};i.title=p[r]._name+"占比";i.field=p[r]._id+"_rate";a.push(i)}u.columns=u.columns.concat(t).concat(a).concat(e)};var l=function(c){v.sdk.OpenCustomReportApi().countTicketByUserAndServiceCatalog(s()).then(function(e){u.tableData=[];u.totalData={};p=e.catalogs;var t=e.resultList;if(t.length){o();var a;var i;var r={name:"统计",allEvent:0};angular.forEach(p,function(e){i="service_catalog_"+e._id;r[i]=0});t.forEach(function(t){a={};if(t.countTicket){r.allEvent+=t.countTicket}a.name=t.name;a.id=t.id;a.allEvent=t.countTicket?t.countTicket:0;angular.forEach(p,function(e){i="service_catalog_"+e._id;t[i]=t[i]?t[i]:0;r[i]+=t[i];a[i]=t[i];a[e._id+"_rate"]=a.allEvent?(t[i]*100/a.allEvent).toFixed(2)+"%":"0%"});u.tableData.push(a)});u.tableData.forEach(function(e){e.eventRate=r.allEvent?(e.allEvent*100/r.allEvent).toFixed(2)+"%":"0%"});angular.forEach(p,function(e){i="service_catalog_"+e._id;r[e._id+"_rate"]=r.allEvent?(r[i]*100/r.allEvent).toFixed(2)+"%":"0%"});u.totalData=r;h()}u.loadComplete=true});v.sdk.OpenCustomReportApi().countTicketByDayAndServiceCatalog(s()).then(function(e){p=e.catalogs;var i=e.resultList;var r;var n=[];var s={};if(i&&i.length>0){var t=new Date(f.searchData.startDate);var a=new Date(f.searchData.endDate);var o=24*3600*1e3;while(t<=a){n.push(d("date")(t,"yyyy-MM-dd"));t=new Date(t.getTime()+o)}angular.forEach(p,function(e){s["service_catalog_"+e._id]=[]});var l;angular.forEach(p,function(e){r="service_catalog_"+e._id;var t=0;for(var a=0;a<n.length;a++){l=i[t];if(l&&l.nameDate===n[a]){l[r]=l[r]||0;s[r].push(i[t][r]);t++}else{s[r].push(0)}}});u.chartData={xAxisData:n,seriesData:s};m(c)}})};var m=function(e){var t;if(e==="trend"){t={titleText:"",xAxisData:u.chartData.xAxisData,legendData:[],series:[]};var a="工单数量";var i=u.chartData.seriesData;angular.forEach(p,function(e){t.legendData.push(e._name);t.series.push({name:e._name,type:"line",symbol:"circle",symbolSize:10,data:i["service_catalog_"+e._id]})});t.yAxis=[{type:"value",name:a,axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},minInterval:1,nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}]}else{t={titleText:"",legendData:[],series:{name:"事件占比",data:[]}};var i=u.chartData.seriesData;angular.forEach(p,function(e){t.legendData.push(e._name);t.series.data.push({name:e._name,value:u.totalData["service_catalog_"+e._id]})})}u.option=t};function h(){var e=[],a=[],t=[],i="客户统计-客户";u.tableData.forEach(function(t){a=[];u.columns.forEach(function(e){a.push(t[e.field])});e.push(a)});a=[];u.columns.forEach(function(e){a.push(u.totalData[e.field]);t.push(e.title)});e.unshift(a);u.exportData={startDate:f.searchData.startDate,endDate:f.searchData.endDate,dataList:e,titleList:t,reportName:i,filterDescription:f.searchData.filterDescription,types:f.searchData.types}}function c(){r()}c();a.register(i,a.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){if(u.showWhichOne["trend"]){l("trend")}else{l("eventRate")}});u.$on("statistics.datarange.changed",function(){if(u.showWhichOne["trend"]){l("trend")}else{l("eventRate")}});u.$on("$destroy",function(){a.unRegister(i)})}}(org.ewei);+function(b){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangCustomerDetailController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService","StatisticsBreadcrumbService","$stateParams"];function e(e,l,t,c,a,u,i,r,n){var s=this.__proto__.constructor.name+"_"+Date.now();l.params=n.params;r.push({url:"statistics-menggang.customer.customer",name:"客户"});r.push({name:l.params.title});var d;l.showWhichOne={trend:true};var o=function(){var e="menggang.customer.customer";l.hasAddSearch=false;l.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};u.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],l.searchData.views,function(){m()})};var f=function(){u.searchData.startDate=l.$parent.dateRange.startDate.format("YYYY-MM-DD");u.searchData.endDate=l.$parent.dateRange.endDate.format("YYYY-MM-DD");var e=JSON.parse(u.searchData.filter);e["$and"][0]["$and"].push({$eq:{"requester.id":l.params.id}});return{startDate:u.searchData.startDate,endDate:u.searchData.endDate,filter:JSON.stringify(e),customFieldFilter:u.searchData.cutsomFieldfilter,types:u.searchData.types}};var p=function(){l.columns=[{title:"日期",visible:true,sortable:true,field:"name"}];var e=[{title:"全部事件",visible:true,sortable:true,field:"allEvent"},{title:"事件占比",visible:true,sortable:false,field:"eventRate"}];var t=[];var a=[];var i;for(var r=0;r<d.length;r++){i={title:"",visible:true,sortable:true,field:""};i.title=d[r]._name;i.field="service_catalog_"+d[r]._id;t.push(i);i={title:"",visible:true,sortable:false,field:""};i.title=d[r]._name+"占比";i.field=d[r]._id+"_rate";a.push(i)}l.columns=l.columns.concat(t).concat(a).concat(e)};var m=function(){b.sdk.OpenCustomReportApi().countTicketByDayAndServiceCatalog(f()).then(function(e){l.tableData=[];l.totalData={};d=e.catalogs;var t=e.resultList;if(t.length){p();h(t);v(t);D()}l.loadComplete=true})};function h(e){var a;var i;var r={name:"统计",allEvent:0};angular.forEach(d,function(e){i="service_catalog_"+e._id;r[i]=0});e.forEach(function(t){a={};if(t.countTicket){r.allEvent+=t.countTicket}a.name=t.nameDate;a.allEvent=t.countTicket?t.countTicket:0;angular.forEach(d,function(e){i="service_catalog_"+e._id;t[i]=t[i]?t[i]:0;r[i]+=t[i];a[i]=t[i];a[e._id+"_rate"]=a.allEvent?(t[i]*100/a.allEvent).toFixed(2)+"%":"0%"});a.eventRate=r.allEvent?(a.allEvent*100/r.allEvent).toFixed(2)+"%":"0%";l.tableData.push(a)});l.tableData.forEach(function(e){e.eventRate=r.allEvent?(e.allEvent*100/r.allEvent).toFixed(2)+"%":"0%"});angular.forEach(d,function(e){i="service_catalog_"+e._id;r[e._id+"_rate"]=r.allEvent?(r[i]*100/r.allEvent).toFixed(2)+"%":"0%"});l.totalData=r}function v(i){var r;var n=[];var s={};if(i&&i.length>0){var e=new Date(u.searchData.startDate);var t=new Date(u.searchData.endDate);var a=24*3600*1e3;while(e<=t){n.push(c("date")(e,"yyyy-MM-dd"));e=new Date(e.getTime()+a)}angular.forEach(d,function(e){s["service_catalog_"+e._id]=[]});var o;angular.forEach(d,function(e){r="service_catalog_"+e._id;var t=0;for(var a=0;a<n.length;a++){o=i[t];if(o&&o.nameDate===n[a]){o[r]=o[r]||0;s[r].push(i[t][r]);t++}else{s[r].push(0)}}});l.chartData={xAxisData:n,seriesData:s};g()}}var g=function(){var t={titleText:"",xAxisData:l.chartData.xAxisData,legendData:[],series:[]};var a={titleText:"",legendData:[],series:{name:"事件占比",data:[]}};var i=l.chartData.seriesData;t.yAxis=[{type:"value",name:"工单数量",axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},minInterval:1,nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}];angular.forEach(d,function(e){t.legendData.push(e._name);a.legendData.push(e._name);t.series.push({name:e._name,type:"line",symbol:"circle",symbolSize:10,data:i["service_catalog_"+e._id]});a.series.data.push({name:e._name,value:l.totalData["service_catalog_"+e._id]})});l.trendOption=t;l.rateOption=a};function D(){var e=[],a=[],t=[],i="客户统计-客户";l.tableData.forEach(function(t){a=[];l.columns.forEach(function(e){a.push(t[e.field])});e.push(a)});a=[];l.columns.forEach(function(e){a.push(l.totalData[e.field]);t.push(e.title)});e.unshift(a);l.exportData={startDate:u.searchData.startDate,endDate:u.searchData.endDate,dataList:e,titleList:t,reportName:i,filterDescription:u.searchData.filterDescription,types:u.searchData.types}}function y(){o()}y();i.register(s,i.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){m()});l.$on("statistics.datarange.changed",function(){m()});l.$on("$destroy",function(){i.unRegister(s);r.pop(2)})}}(org.ewei);+function(v){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangCustomerGroupController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService"];function e(e,u,n,d,t,f,a){var i=this.__proto__.constructor.name+"_"+Date.now();u.hasAddSearch=false;var p;u.showWhichOne={trend:true};var r=function(){var e="menggang.customer.customer";u.hasAddSearch=false;u.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};f.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],u.searchData.views,function(){l("trend")})};var s=function(){f.searchData.startDate=u.$parent.dateRange.startDate.format("YYYY-MM-DD");f.searchData.endDate=u.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:f.searchData.startDate,endDate:f.searchData.endDate,filter:f.searchData.filter,customFieldFilter:f.searchData.cutsomFieldfilter,types:f.searchData.types}};u.checked=function(e){u.showWhichOne.trend=false;u.showWhichOne.eventRate=false;u.showWhichOne[e]=true;m(e)};var o=function(){u.columns=[{title:"客户组",visible:true,sortable:true,field:"name",callbackFunction:function(e){n.go("statistics-menggang.customer.customerGroupDetail",{params:{title:e.name,id:e.id}})}}];var e=[{title:"全部事件",visible:true,sortable:true,field:"allEvent"},{title:"事件占比",visible:true,sortable:false,field:"eventRate"}];var t=[];var a=[];var i;for(var r=0;r<p.length;r++){i={title:"",visible:true,sortable:true,field:""};i.title=p[r]._name;i.field="service_catalog_"+p[r]._id;t.push(i);i={title:"",visible:true,sortable:false,field:""};i.title=p[r]._name+"占比";i.field=p[r]._id+"_rate";a.push(i)}u.columns=u.columns.concat(t).concat(a).concat(e)};var l=function(c){v.sdk.OpenCustomReportApi().countTicketByUserGroupAndServiceCatalog(s()).then(function(e){u.tableData=[];u.totalData={};p=e.catalogs;var t=e.resultList;if(t.length){o();var a;var i;var r={name:"统计",allEvent:0};angular.forEach(p,function(e){i="service_catalog_"+e._id;r[i]=0});t.forEach(function(t){a={};if(t.countTicket){r.allEvent+=t.countTicket}a.name=t.name?t.name:"暂无客户组";a.id=t.id;a.allEvent=t.countTicket?t.countTicket:0;angular.forEach(p,function(e){i="service_catalog_"+e._id;t[i]=t[i]?t[i]:0;r[i]+=t[i];a[i]=t[i];a[e._id+"_rate"]=a.allEvent?(t[i]*100/a.allEvent).toFixed(2)+"%":"0%"});a.eventRate=r.allEvent?(a.allEvent*100/r.allEvent).toFixed(2)+"%":"0%";u.tableData.push(a)});u.tableData.forEach(function(e){e.eventRate=r.allEvent?(e.allEvent*100/r.allEvent).toFixed(2)+"%":"0%"});angular.forEach(p,function(e){i="service_catalog_"+e._id;r[e._id+"_rate"]=r.allEvent?(r[i]*100/r.allEvent).toFixed(2)+"%":"0%"});u.totalData=r;h()}u.loadComplete=true});v.sdk.OpenCustomReportApi().countTicketByDayAndServiceCatalog(s()).then(function(e){p=e.catalogs;var i=e.resultList;var r;var n=[];var s={};if(i&&i.length>0){var t=new Date(f.searchData.startDate);var a=new Date(f.searchData.endDate);var o=24*3600*1e3;while(t<=a){n.push(d("date")(t,"yyyy-MM-dd"));t=new Date(t.getTime()+o)}angular.forEach(p,function(e){s["service_catalog_"+e._id]=[]});var l;angular.forEach(p,function(e){r="service_catalog_"+e._id;var t=0;for(var a=0;a<n.length;a++){l=i[t];if(l&&l.nameDate===n[a]){l[r]=l[r]||0;s[r].push(i[t][r]);t++}else{s[r].push(0)}}});u.chartData={xAxisData:n,seriesData:s};m(c)}})};var m=function(e){var t;if(e==="trend"){t={titleText:"",xAxisData:u.chartData.xAxisData,legendData:[],series:[]};var a="工单数量";var i=u.chartData.seriesData;angular.forEach(p,function(e){t.legendData.push(e._name);t.series.push({name:e._name,type:"line",symbol:"circle",symbolSize:10,data:i["service_catalog_"+e._id]})});t.yAxis=[{type:"value",name:a,axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},minInterval:1,axisTick:{lineStyle:{color:"#eef2f9"}},nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}]}else{t={titleText:"",legendData:[],series:{name:"事件占比",data:[]}};var i=u.chartData.seriesData;angular.forEach(p,function(e){t.legendData.push(e._name);t.series.data.push({name:e._name,value:u.totalData["service_catalog_"+e._id]})})}u.option=t};function h(){var e=[],a=[],t=[],i="客户统计-客户组";u.tableData.forEach(function(t){a=[];u.columns.forEach(function(e){a.push(t[e.field])});e.push(a)});a=[];u.columns.forEach(function(e){a.push(u.totalData[e.field]);t.push(e.title)});e.unshift(a);u.exportData={startDate:f.searchData.startDate,endDate:f.searchData.endDate,dataList:e,titleList:t,reportName:i,filterDescription:f.searchData.filterDescription,types:f.searchData.types}}function c(){r()}c();a.register(i,a.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){if(u.showWhichOne["trend"]){l("trend")}else{l("eventRate")}});u.$on("statistics.datarange.changed",function(){if(u.showWhichOne["trend"]){l("trend")}else{l("eventRate")}});u.$on("$destroy",function(){a.unRegister(i)})}}(org.ewei);+function(b){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangCustomerGroupDetailController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService","StatisticsBreadcrumbService","$stateParams"];function e(e,l,t,c,a,u,i,r,n){var s=this.__proto__.constructor.name+"_"+Date.now();l.params=n.params;r.push({url:"statistics-menggang.customer.customerGroup",name:"客户组"});r.push({name:l.params.title});var d;l.showWhichOne={trend:true};var o=function(){var e="menggang.customer.customer";l.hasAddSearch=false;l.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};u.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],l.searchData.views,function(){m()})};var f=function(){u.searchData.startDate=l.$parent.dateRange.startDate.format("YYYY-MM-DD");u.searchData.endDate=l.$parent.dateRange.endDate.format("YYYY-MM-DD");var e=JSON.parse(u.searchData.filter);e["$and"][0]["$and"].push({$eq:{"requester.userGroup.id":l.params.id}});e["$and"][0]["$and"].push({$eq:{"requester.type":"customer"}});e["$and"][0]["$and"].push({$eq:{"requester.valid":1}});e["$and"][0]["$and"].push({$eq:{"requester.deleted":0}},{$eq:{"requester.status":1}});return{startDate:u.searchData.startDate,endDate:u.searchData.endDate,filter:JSON.stringify(e),customFieldFilter:u.searchData.cutsomFieldfilter,types:u.searchData.types}};var p=function(){l.columns=[{title:"日期",visible:true,sortable:true,field:"name"}];var e=[{title:"全部事件",visible:true,sortable:true,field:"allEvent"},{title:"事件占比",visible:true,sortable:false,field:"eventRate"}];var t=[];var a=[];var i;for(var r=0;r<d.length;r++){i={title:"",visible:true,sortable:true,field:""};i.title=d[r]._name;i.field="service_catalog_"+d[r]._id;t.push(i);i={title:"",visible:true,sortable:false,field:""};i.title=d[r]._name+"占比";i.field=d[r]._id+"_rate";a.push(i)}l.columns=l.columns.concat(t).concat(a).concat(e)};var m=function(){b.sdk.OpenCustomReportApi().countTicketByDayAndServiceCatalog(f()).then(function(e){l.tableData=[];l.totalData={};d=e.catalogs;var t=e.resultList;if(t.length){p();h(t);v(t);D()}l.loadComplete=true})};function h(e){var a;var i;var r={name:"统计",allEvent:0};angular.forEach(d,function(e){i="service_catalog_"+e._id;r[i]=0});e.forEach(function(t){a={};if(t.countTicket){r.allEvent+=t.countTicket}a.name=t.nameDate;a.allEvent=t.countTicket?t.countTicket:0;angular.forEach(d,function(e){i="service_catalog_"+e._id;t[i]=t[i]?t[i]:0;r[i]+=t[i];a[i]=t[i];a[e._id+"_rate"]=a.allEvent?(t[i]*100/a.allEvent).toFixed(2)+"%":"0%"});a.eventRate=r.allEvent?(a.allEvent*100/r.allEvent).toFixed(2)+"%":"0%";l.tableData.push(a)});l.tableData.forEach(function(e){e.eventRate=r.allEvent?(e.allEvent*100/r.allEvent).toFixed(2)+"%":"0%"});angular.forEach(d,function(e){i="service_catalog_"+e._id;r[e._id+"_rate"]=r.allEvent?(r[i]*100/r.allEvent).toFixed(2)+"%":"0%"});l.totalData=r}function v(i){var r;var n=[];var s={};if(i&&i.length>0){var e=new Date(u.searchData.startDate);var t=new Date(u.searchData.endDate);var a=24*3600*1e3;while(e<=t){n.push(c("date")(e,"yyyy-MM-dd"));e=new Date(e.getTime()+a)}angular.forEach(d,function(e){s["service_catalog_"+e._id]=[]});var o;angular.forEach(d,function(e){r="service_catalog_"+e._id;var t=0;for(var a=0;a<n.length;a++){o=i[t];if(o&&o.nameDate===n[a]){o[r]=o[r]||0;s[r].push(i[t][r]);t++}else{s[r].push(0)}}});l.chartData={xAxisData:n,seriesData:s};g()}}var g=function(){var t={titleText:"",xAxisData:l.chartData.xAxisData,legendData:[],series:[]};var a={titleText:"",legendData:[],series:{name:"事件占比",data:[]}};var i=l.chartData.seriesData;t.yAxis=[{type:"value",name:"工单数量",axisLine:{show:false},splitLine:{lineStyle:{color:"#eef2f9"}},axisTick:{lineStyle:{color:"#eef2f9"}},minInterval:1,nameLocation:"middle",nameTextStyle:{fontSize:12,fontFamily:"微软雅黑"},nameGap:50,axisLabel:{formatter:"{value}"}}];angular.forEach(d,function(e){t.legendData.push(e._name);a.legendData.push(e._name);t.series.push({name:e._name,type:"line",symbol:"circle",symbolSize:10,data:i["service_catalog_"+e._id]});a.series.data.push({name:e._name,value:l.totalData["service_catalog_"+e._id]})});l.trendOption=t;l.rateOption=a};function D(){var e=[],a=[],t=[],i="客户统计-客户";l.tableData.forEach(function(t){a=[];l.columns.forEach(function(e){a.push(t[e.field])});e.push(a)});a=[];l.columns.forEach(function(e){a.push(l.totalData[e.field]);t.push(e.title)});e.unshift(a);l.exportData={startDate:u.searchData.startDate,endDate:u.searchData.endDate,dataList:e,titleList:t,reportName:i,filterDescription:u.searchData.filterDescription,types:u.searchData.types}}function y(){o()}y();i.register(s,i.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){m()});l.$on("statistics.datarange.changed",function(){m()});l.$on("$destroy",function(){i.unRegister(s);r.pop(2)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangDistributionRootController",e);e.$inject=["$rootScope","$scope","$state","permissions","coreModelService","StatisticsBreadcrumbService"];function e(e,t,a,i,r,n){t.breadcrumbs=n.items;t.goto=n.goto;var s=r.config.route.get("statistics-menggang-distribution");if(s){if(s.permission){if(i.hasPermission(s.permission)){return a.go(s.name,s.params)}else{return a.go("unauthorized")}}else{return a.go(s.name,s.params)}}else{a.go("statistics-menggang.distribution.engineer")}}}();+function(m){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangDistributionEngineerController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService"];function e(e,i,t,a,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();i.hasAddSearch=false;i.showWhichOne={trend:true};var l=function(){var e="menggang.customer.customer";i.hasAddSearch=false;i.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};n.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],i.searchData.views,function(){d()})};var c=function(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.cutsomFieldfilter,types:n.searchData.types}};var u=function(){i.columns=[{title:"支持人员",visible:true,sortable:true,field:"name"},{title:"处理事件数",visible:true,sortable:true,field:"countTicket"},{title:"占比",visible:true,sortable:false,field:"rate"},{title:"超时事件数",visible:true,sortable:true,field:"qualified"},{title:"差评事件数",visible:true,sortable:true,field:"scoreNegative"}]};var d=function(){m.sdk.OpenCustomReportApi().countTicketByEngineer(c()).then(function(e){i.tableData=[];i.totalData={};if(e&&e.length>0){var t;var a={name:"统计",countTicket:0,qualified:0,scoreNegative:0,rate:"-"};angular.forEach(e,function(e){t={};t.name=e.name;t.countTicket=e.countTicket;t.qualified=e.qualified;t.scoreNegative=e.scoreNegative;i.tableData.push(t);a.countTicket+=e.countTicket;a.qualified+=e.qualified;a.scoreNegative+=e.scoreNegative});angular.forEach(i.tableData,function(e){e.rate=a.countTicket?(e.countTicket*100/a.countTicket).toFixed(2)+"%":"0%"});i.totalData=a;f()}})};function f(){var t=[],a=[],e="事件分布-在人员上的分布";i.tableData.forEach(function(e){t.push([e.name,e.countTicket,e.rate,e.qualified,e.scoreNegative])});t.unshift([i.totalData.name,i.totalData.countTicket,i.totalData.rate,i.totalData.qualified,i.totalData.scoreNegative]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function p(){l();u()}p();s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){d()});i.$on("statistics.datarange.changed",function(){d()});i.$on("$destroy",function(){s.unRegister(o)})}}(org.ewei);+function(m){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangDistributionAreaController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService"];function e(e,i,t,a,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();i.hasAddSearch=false;i.showWhichOne={trend:true};var l=function(){var e="menggang.customer.customer";i.hasAddSearch=false;i.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};n.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],i.searchData.views,function(){d()})};var c=function(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.cutsomFieldfilter,types:n.searchData.types,customFieldId:98321}};var u=function(){i.columns=[{title:"区域名称",visible:true,sortable:true,field:"name"},{title:"处理事件数",visible:true,sortable:true,field:"countTicket"},{title:"占比",visible:true,sortable:false,field:"rate"},{title:"超时事件数",visible:true,sortable:true,field:"qualified"},{title:"差评事件数",visible:true,sortable:true,field:"scoreNegative"}]};var d=function(){m.sdk.OpenCustomReportApi().countTicketByCustomFieldValue(c()).then(function(e){i.tableData=[];i.totalData={};if(e&&e.length>0){var t;var a={name:"统计",countTicket:0,qualified:0,scoreNegative:0,rate:"-"};angular.forEach(e,function(e){t={};t.name=e.value;t.countTicket=e.countTicket;t.qualified=e.qualified;t.scoreNegative=e.scoreNegative?e.scoreNegative:0;i.tableData.push(t);a.countTicket+=e.countTicket;a.qualified+=e.qualified;a.scoreNegative+=e.scoreNegative?e.scoreNegative:0});angular.forEach(i.tableData,function(e){e.rate=a.countTicket?(e.countTicket*100/a.countTicket).toFixed(2)+"%":"0%"});i.totalData=a;f()}})};function f(){var t=[],a=[],e="事件分布-在区域上分布";i.tableData.forEach(function(e){t.push([e.name,e.countTicket,e.rate,e.qualified,e.scoreNegative])});t.unshift([i.totalData.name,i.totalData.countTicket,i.totalData.rate,i.totalData.qualified,i.totalData.scoreNegative]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function p(){l();u()}p();s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){d()});i.$on("statistics.datarange.changed",function(){d()});i.$on("$destroy",function(){s.unRegister(o)})}}(org.ewei);+function(m){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangDistributionServiceCatalogBySecondController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService"];function e(e,i,t,a,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();i.hasAddSearch=false;i.showWhichOne={trend:true};var l=function(){var e="menggang.customer.customer";i.hasAddSearch=false;i.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};n.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],i.searchData.views,function(){d()})};var c=function(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.cutsomFieldfilter,types:n.searchData.types}};var u=function(){i.columns=[{title:"二级类目名称",visible:true,sortable:true,field:"name"},{title:"事件数",visible:true,sortable:true,field:"countTicket"},{title:"占比",visible:true,sortable:false,field:"rate"},{title:"超时事件数",visible:true,sortable:true,field:"countTicketTimeOut"},{title:"差评事件数",visible:true,sortable:true,field:"countTicketScoreNegative"}]};var d=function(){m.sdk.OpenCustomReportApi().countTicketBySecondStageServiceCatalog(c()).then(function(e){i.tableData=[];i.totalData={};if(e&&e.length>0){var t;var a={name:"统计",countTicket:0,countTicketTimeOut:0,countTicketScoreNegative:0,rate:"-"};angular.forEach(e,function(e){t={};t.name=e._name;t.countTicket=e.countTicket;t.countTicketTimeOut=e.countTicketTimeOut;t.countTicketScoreNegative=e.countTicketScoreNegative;i.tableData.push(t);a.countTicket+=e.countTicket;a.countTicketTimeOut+=e.countTicketTimeOut;a.countTicketScoreNegative+=e.countTicketScoreNegative});angular.forEach(i.tableData,function(e){e.rate=a.countTicket?(e.countTicket*100/a.countTicket).toFixed(2)+"%":"0%"});i.totalData=a;f()}})};function f(){var t=[],a=[],e="事件分布-在二级类目上分布";i.tableData.forEach(function(e){t.push([e.name,e.countTicket,e.rate,e.countTicketTimeOut,e.countTicketScoreNegative])});t.unshift([i.totalData.name,i.totalData.countTicket,i.totalData.rate,i.totalData.countTicketTimeOut,i.totalData.countTicketScoreNegative]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function p(){l();u()}p();s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){d()});i.$on("statistics.datarange.changed",function(){d()});i.$on("$destroy",function(){s.unRegister(o)})}}(org.ewei);+function(m){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangDistributionServiceCatalogByThirdController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService"];function e(e,i,t,a,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();i.hasAddSearch=false;i.showWhichOne={trend:true};var l=function(){var e="menggang.customer.customer";i.hasAddSearch=false;i.searchData={showDataSource:["ticket.create"],reportType:e,views:[]};n.loadLocalSearchDataView(e,["TICKET_CREATED_AT"],i.searchData.views,function(){d()})};var c=function(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.cutsomFieldfilter,types:n.searchData.types}};var u=function(){i.columns=[{title:"三级类目名称",visible:true,sortable:true,field:"name"},{title:"事件数",visible:true,sortable:true,field:"countTicket"},{title:"占比",visible:true,sortable:false,field:"rate"},{title:"超时事件数",visible:true,sortable:true,field:"countTicketTimeOut"},{title:"差评事件数",visible:true,sortable:true,field:"countTicketScoreNegative"}]};var d=function(){m.sdk.OpenCustomReportApi().countTicketByThirdStageServiceCatalog(c()).then(function(e){i.tableData=[];i.totalData={};if(e&&e.length>0){var t={};var a={name:"统计",countTicket:0,countTicketTimeOut:0,countTicketScoreNegative:0,rate:"-"};angular.forEach(e,function(e){t={};t.name=e._name;t.countTicket=e.countTicket;t.countTicketTimeOut=e.countTicketTimeOut;t.countTicketScoreNegative=e.countTicketScoreNegative;i.tableData.push(t);a.countTicket+=e.countTicket;a.countTicketTimeOut+=e.countTicketTimeOut;a.countTicketScoreNegative+=e.countTicketScoreNegative});angular.forEach(i.tableData,function(e){e.rate=a.countTicket?(e.countTicket*100/a.countTicket).toFixed(2)+"%":"0%"});i.totalData=a;f()}})};function f(){var t=[],a=[],e="事件分布-在三级类目上分布";i.tableData.forEach(function(e){t.push([e.name,e.countTicket,e.rate,e.countTicketTimeOut,e.countTicketScoreNegative])});t.unshift([i.totalData.name,i.totalData.countTicket,i.totalData.rate,i.totalData.countTicketTimeOut,i.totalData.countTicketScoreNegative]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function p(){l();u()}p();s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){d()});i.$on("statistics.datarange.changed",function(){d()});i.$on("$destroy",function(){s.unRegister(o)})}}(org.ewei);+function(){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangResolutionRateRootController",e);e.$inject=["$rootScope","$scope","$state","permissions","coreModelService","StatisticsBreadcrumbService"];function e(e,t,a,i,r,n){t.breadcrumbs=n.items;t.goto=n.goto;var s=r.config.route.get("statistics-menggang-resolutionrate");if(s){if(s.permission){if(i.hasPermission(s.permission)){return a.go(s.name,s.params)}else{return a.go("unauthorized")}}else{return a.go(s.name,s.params)}}else{a.go("statistics-menggang.resolutionrate.resolutionrate")}}}();+function(h){"use strict";angular.module("eweiApp.statistics-menggang").controller("statisticsMenggangResolutionRateResolutionrateController",e);e.$inject=["$rootScope","$scope","$state","$filter","utils","searchService","coreNotifyService"];function e(e,i,t,a,r,n,s){var o=this.__proto__.constructor.name+"_"+Date.now();i.hasAddSearch=false;var l=function(){var e="menggang.customer.customer";i.hasAddSearch=false;i.searchData={showDataSource:["ticket.closed"],reportType:e,views:[]};n.loadLocalSearchDataView(e,["TICKET_CLOSED_AT"],i.searchData.views,function(){d()})};var c=function(){n.searchData.startDate=i.$parent.dateRange.startDate.format("YYYY-MM-DD");n.searchData.endDate=i.$parent.dateRange.endDate.format("YYYY-MM-DD");return{startDate:n.searchData.startDate,endDate:n.searchData.endDate,filter:n.searchData.filter,customFieldFilter:n.searchData.cutsomFieldfilter,types:n.searchData.types}};var u=function(){i.columns=[{title:"所属组",visible:true,sortable:true,field:"name"},{title:"事件处理总量",visible:true,sortable:true,field:"countTicket"},{title:"超时事件数",visible:true,sortable:true,field:"qualified"},{title:"处理事件占比",visible:true,sortable:false,field:"rate"}]};var d=function(){h.sdk.OpenCustomReportApi().countTicketByServiceDesk(c()).then(function(e){i.loadComplete=true;i.tableData=[];i.totalData={};if(e&&e.length){var t;var a={name:"统计",countTicket:0,qualified:0,rate:"-"};angular.forEach(e,function(e){t={};a.countTicket+=e.countTicket;a.qualified+=e.qualified;t.countTicket=e.countTicket;t.qualified=e.qualified;t.name=e.name;i.tableData.push(t)});i.tableData.forEach(function(e){e.rate=a.countTicket?(e.countTicket*100/a.countTicket).toFixed(2)+"%":"0%"});i.totalData=a;f();p()}})};var f=function(){var t;t={titleText:"",legendData:[],series:{name:"事件占比",data:[]}};angular.forEach(i.tableData,function(e){t.legendData.push(e.name);t.series.data.push({name:e.name,value:e.rate.split("%")[0]})});i.option=t};function p(){var t=[],a=[],e="事件解决率";i.tableData.forEach(function(e){t.push([e.name,e.countTicket,e.qualified,e.rate])});t.unshift([i.totalData.name,i.totalData.countTicket,i.totalData.qualified,i.totalData.rate]);i.columns.forEach(function(e){a.push(e.title)});i.exportData={startDate:n.searchData.startDate,endDate:n.searchData.endDate,dataList:t,titleList:a,reportName:e,filterDescription:n.searchData.filterDescription,types:n.searchData.types}}function m(){l();u()}m();s.register(o,s.constant.EVENT_STATISTICS_SEARCH_DONE,function(e,t){d()});i.$on("statistics.datarange.changed",function(){d()});i.$on("$destroy",function(){s.unRegister(o)})}}(org.ewei);